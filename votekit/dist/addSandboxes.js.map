{"mappings":"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","sources":["src/ui/Changes.js","src/ui/DraggableManager.js","src/ui/Screen.js","lib/canvas2svg.esm.js","src/ui/addSVGOutput.js","src/menu/Button.js","src/menu/ButtonGroup.js","src/menu/MenuItem.js","src/menu/Menu.js","src/castVotes/AreaSummer.js","src/castVotes/castVotes.js","src/castVotes/pluralityBallot.js","src/electionMethods/electionMethods.js","src/electionMethods/plurality.js","src/electionMethods/randomWinner.js","src/electionMethods/huntingtonHill.js","src/election/ElectionMethod.js","src/election/Election.js","../node_modules/process/browser.js","lib/tween.esm.js","src/sim/entities/CircleGraphic.js","lib/d3-delaunay.esm.js","src/sim/entities/VoronoiGroup.js","src/sim/entities/VoterCircle.js","src/sim/entities/SquareGraphic.js","src/sim/entities/Candidate.js","src/sim/entities/graphicsUtilities.js","src/sim/states/SimOne.js","src/sim/entities/SimVoterCircle.js","src/sim/entities/CandidateDistribution.js","src/sim/states/SimMany.js","src/sim/Sim.js","src/election/CandidateDistributionSampler.js","src/election/simpleCandidate.js","src/election/SimElections.js","src/ui/sandbox.js","src/ui/divSandbox.js","src/ui/addSandboxes.js"],"sourcesContent":["/** @module */\r\n\r\n/**\r\n * keep track of changes that occur to a simulation's configuration.\r\n */\r\nexport default function Changes() {\r\n    const self = this\r\n\r\n    const changes = ['init']\r\n\r\n    self.add = (changeList) => {\r\n        changeList.forEach(\r\n            (c) => changes.push(c),\r\n        )\r\n    }\r\n    self.check = (changeList) => {\r\n        let n = 0\r\n        changeList.forEach(\r\n            (c) => { n += changes.includes(c) ? 1 : 0 },\r\n        )\r\n        return n > 0\r\n    }\r\n    self.checkNone = () => (changes.length === 0)\r\n    self.clear = () => {\r\n        changes.splice(0, changes.length)\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Draggable Manager gives draggable behavior to objects on a canvas.\r\n * If anything changes, an item is added to the \"changes\" array.\r\n * @param {Screen} screen\r\n * @param {Changes} changes\r\n */\r\nexport default function DraggableManager(screen, changes) {\r\n    const self = this\r\n\r\n    // private variables\r\n    let drag = {}\r\n    const draggables = []\r\n\r\n    const { canvas } = screen\r\n\r\n    // add draggable objects\r\n    self.newSquareHandle = function (o, g) {\r\n        // set properties here so that we don't set properties on the actual object\r\n        const p = { isSquare: true }\r\n        draggables.push({ o, g, p })\r\n    }\r\n    self.newCircleHandle = function (o, g) { // object, graphic\r\n        const p = { isCircle: true }\r\n        draggables.push({ o, g, p })\r\n    }\r\n    self.clear = () => {\r\n        draggables.splice(0, draggables.length)\r\n    }\r\n\r\n    // mouse controls\r\n    // As a sidenote, it is interesting that we don't need to call model.update here\r\n    // because we are using a game loop that will call model.update.\r\n    canvas.onmousedown = function (event) {\r\n        const mouse = {}\r\n        mouse.x = event.offsetX\r\n        mouse.y = event.offsetY\r\n        const nd = draggables.length\r\n        for (let i = 0; i < nd; i++) {\r\n            const d = draggables[i]\r\n            if (hitTest(d, mouse)) {\r\n                drag.iDragging = i\r\n                drag.isDragging = true\r\n                drag.offX = d.o.x - mouse.x\r\n                drag.offY = d.o.y - mouse.y\r\n                d.g.pickUp()\r\n                canvas.dataset.cursor = 'grabbing' // CSS data attribute\r\n                break // exit after picking one object\r\n            }\r\n        }\r\n    }\r\n\r\n    canvas.onmouseup = function () {\r\n        if (drag.iDragging !== undefined) {\r\n            const dragging = draggables[drag.iDragging]\r\n            dragging.g.drop()\r\n        }\r\n        drag = {}\r\n    }\r\n\r\n    canvas.onmousemove = function (event) {\r\n        const mouse = {}\r\n        mouse.x = event.offsetX\r\n        mouse.y = event.offsetY\r\n        if (drag.isDragging) { // because the mouse is moving\r\n            const dragging = draggables[drag.iDragging]\r\n            dragging.o.setX(mouse.x + drag.offX) // updates state.config too\r\n            dragging.o.setY(mouse.y + drag.offY)\r\n            changes.add(['draggables'])\r\n        } else {\r\n            // see if we're hovering over something grabbable\r\n            // because we want the user to see if they can grab something\r\n            const nd = draggables.length\r\n            for (let i = 0; i < nd; i++) {\r\n                const d = draggables[i]\r\n                if (hitTest(d, mouse)) {\r\n                    canvas.dataset.cursor = 'grab'\r\n                    return\r\n                }\r\n            }\r\n            canvas.dataset.cursor = '' // nothing to grab\r\n        }\r\n    }\r\n\r\n    function hitTest(d, m) {\r\n        // Only drag an object if we're near it.\r\n        const x = d.o.x - m.x\r\n        const y = d.o.y - m.y\r\n        if (d.p.isCircle) {\r\n            const { r } = d.g\r\n            const hit = x * x + y * y < r * r\r\n            return hit\r\n        } if (d.p.isSquare) {\r\n            const { w, h } = d.g\r\n            const hit = Math.abs(x) < 0.5 * w && Math.abs(y) < 0.5 * h\r\n            return hit\r\n        }\r\n        return false\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Set up a screen to view some objects.\r\n * A detail here is that we have browser pixels and device pixels.\r\n * Broswer pixels feel about the same size on any device (visual arc length).\r\n * Device pixels can be much smaller for high-dpi devices.\r\n * @param {Number} w - width in browser pixels of the canvas.\r\n * @param {Number} h - height in browser pixels of the canvas.\r\n */\r\nexport default function Screen(w, h) {\r\n    const self = this\r\n\r\n    self.width = w // measured in browser pixels\r\n    self.height = h\r\n\r\n    // attach canvas\r\n    self.canvas = document.createElement('canvas')\r\n    self.canvas.setAttribute('class', 'interactive')\r\n\r\n    self.ctx = self.canvas.getContext('2d')\r\n    self.noBuffers = false\r\n\r\n    // use scaling for high DPI devices instead of multiplying every time inside draw calls\r\n    // https://www.html5rocks.com/en/tutorials/canvas/hidpi/\r\n    self.pixelRatio = getPixelRatio(self.ctx)\r\n\r\n    self.canvas.width = w * self.pixelRatio // measured in device pixels\r\n    self.canvas.height = h * self.pixelRatio\r\n\r\n    self.canvas.style.width = `${w}px`\r\n    self.canvas.style.height = `${h}px`\r\n\r\n    self.ctx.scale(self.pixelRatio, self.pixelRatio)\r\n    self.clear = function () {\r\n        self.ctx.clearRect(0, 0, self.canvas.width, self.canvas.height)\r\n    }\r\n    self.setCtx = function (c) {\r\n        self.ctx = c\r\n    }\r\n    self.setNoBuffers = function (noBuffers) {\r\n        self.noBuffers = noBuffers\r\n    }\r\n}\r\n\r\nfunction getPixelRatio(context) {\r\n    const backingStore = context.backingStorePixelRatio\r\n          || context.webkitBackingStorePixelRatio\r\n          || context.mozBackingStorePixelRatio\r\n          || context.msBackingStorePixelRatio\r\n          || context.oBackingStorePixelRatio\r\n          || context.backingStorePixelRatio || 1\r\n\r\n    return (window.devicePixelRatio || 1) / backingStore\r\n}\r\n","/*!!\r\n *  Canvas 2 Svg v1.0.19\r\n *  A low level canvas to SVG converter. Uses a mock canvas context to build an SVG document.\r\n *\r\n *  Licensed under the MIT license:\r\n *  http://www.opensource.org/licenses/mit-license.php\r\n *\r\n *  Author:\r\n *  Kerry Liu\r\n *\r\n *  Copyright (c) 2014 Gliffy Inc.\r\n */\r\n\r\n// Altered to make into an ES2015 module.\r\n\r\nvar STYLES, ctx, CanvasGradient, CanvasPattern, namedEntities;\r\n\r\n//helper function to format a string\r\nfunction format(str, args) {\r\n    var keys = Object.keys(args), i;\r\n    for (i=0; i<keys.length; i++) {\r\n        str = str.replace(new RegExp(\"\\\\{\" + keys[i] + \"\\\\}\", \"gi\"), args[keys[i]]);\r\n    }\r\n    return str;\r\n}\r\n\r\n//helper function that generates a random string\r\nfunction randomString(holder) {\r\n    var chars, randomstring, i;\r\n    if (!holder) {\r\n        throw new Error(\"cannot create a random attribute name for an undefined object\");\r\n    }\r\n    chars = \"ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz\";\r\n    randomstring = \"\";\r\n    do {\r\n        randomstring = \"\";\r\n        for (i = 0; i < 12; i++) {\r\n            randomstring += chars[Math.floor(Math.random() * chars.length)];\r\n        }\r\n    } while (holder[randomstring]);\r\n    return randomstring;\r\n}\r\n\r\n//helper function to map named to numbered entities\r\nfunction createNamedToNumberedLookup(items, radix) {\r\n    var i, entity, lookup = {}, base10, base16;\r\n    items = items.split(',');\r\n    radix = radix || 10;\r\n    // Map from named to numbered entities.\r\n    for (i = 0; i < items.length; i += 2) {\r\n        entity = '&' + items[i + 1] + ';';\r\n        base10 = parseInt(items[i], radix);\r\n        lookup[entity] = '&#'+base10+';';\r\n    }\r\n    //FF and IE need to create a regex from hex values ie &nbsp; == \\xa0\r\n    lookup[\"\\\\xa0\"] = '&#160;';\r\n    return lookup;\r\n}\r\n\r\n//helper function to map canvas-textAlign to svg-textAnchor\r\nfunction getTextAnchor(textAlign) {\r\n    //TODO: support rtl languages\r\n    var mapping = {\"left\":\"start\", \"right\":\"end\", \"center\":\"middle\", \"start\":\"start\", \"end\":\"end\"};\r\n    return mapping[textAlign] || mapping.start;\r\n}\r\n\r\n//helper function to map canvas-textBaseline to svg-dominantBaseline\r\nfunction getDominantBaseline(textBaseline) {\r\n    //INFO: not supported in all browsers\r\n    var mapping = {\"alphabetic\": \"alphabetic\", \"hanging\": \"hanging\", \"top\":\"text-before-edge\", \"bottom\":\"text-after-edge\", \"middle\":\"central\"};\r\n    return mapping[textBaseline] || mapping.alphabetic;\r\n}\r\n\r\n// Unpack entities lookup where the numbers are in radix 32 to reduce the size\r\n// entity mapping courtesy of tinymce\r\nnamedEntities = createNamedToNumberedLookup(\r\n    '50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,' +\r\n        '5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,' +\r\n        '5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,' +\r\n        '5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,' +\r\n        '68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,' +\r\n        '6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,' +\r\n        '6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,' +\r\n        '75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,' +\r\n        '7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,' +\r\n        '7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,' +\r\n        'sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,' +\r\n        'st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,' +\r\n        't9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,' +\r\n        'tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,' +\r\n        'u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,' +\r\n        '81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,' +\r\n        '8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,' +\r\n        '8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,' +\r\n        '8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,' +\r\n        '8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,' +\r\n        'nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,' +\r\n        'rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,' +\r\n        'Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,' +\r\n        '80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,' +\r\n        '811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro', 32);\r\n\r\n\r\n//Some basic mappings for attributes and default values.\r\nSTYLES = {\r\n    \"strokeStyle\":{\r\n        svgAttr : \"stroke\", //corresponding svg attribute\r\n        canvas : \"#000000\", //canvas default\r\n        svg : \"none\",       //svg default\r\n        apply : \"stroke\"    //apply on stroke() or fill()\r\n    },\r\n    \"fillStyle\":{\r\n        svgAttr : \"fill\",\r\n        canvas : \"#000000\",\r\n        svg : null, //svg default is black, but we need to special case this to handle canvas stroke without fill\r\n        apply : \"fill\"\r\n    },\r\n    \"lineCap\":{\r\n        svgAttr : \"stroke-linecap\",\r\n        canvas : \"butt\",\r\n        svg : \"butt\",\r\n        apply : \"stroke\"\r\n    },\r\n    \"lineJoin\":{\r\n        svgAttr : \"stroke-linejoin\",\r\n        canvas : \"miter\",\r\n        svg : \"miter\",\r\n        apply : \"stroke\"\r\n    },\r\n    \"miterLimit\":{\r\n        svgAttr : \"stroke-miterlimit\",\r\n        canvas : 10,\r\n        svg : 4,\r\n        apply : \"stroke\"\r\n    },\r\n    \"lineWidth\":{\r\n        svgAttr : \"stroke-width\",\r\n        canvas : 1,\r\n        svg : 1,\r\n        apply : \"stroke\"\r\n    },\r\n    \"globalAlpha\": {\r\n        svgAttr : \"opacity\",\r\n        canvas : 1,\r\n        svg : 1,\r\n        apply :  \"fill stroke\"\r\n    },\r\n    \"font\":{\r\n        //font converts to multiple svg attributes, there is custom logic for this\r\n        canvas : \"10px sans-serif\"\r\n    },\r\n    \"shadowColor\":{\r\n        canvas : \"#000000\"\r\n    },\r\n    \"shadowOffsetX\":{\r\n        canvas : 0\r\n    },\r\n    \"shadowOffsetY\":{\r\n        canvas : 0\r\n    },\r\n    \"shadowBlur\":{\r\n        canvas : 0\r\n    },\r\n    \"textAlign\":{\r\n        canvas : \"start\"\r\n    },\r\n    \"textBaseline\":{\r\n        canvas : \"alphabetic\"\r\n    },\r\n    \"lineDash\" : {\r\n        svgAttr : \"stroke-dasharray\",\r\n        canvas : [],\r\n        svg : null,\r\n        apply : \"stroke\"\r\n    }\r\n};\r\n\r\n/**\r\n *\r\n * @param gradientNode - reference to the gradient\r\n * @constructor\r\n */\r\nCanvasGradient = function (gradientNode, ctx) {\r\n    this.__root = gradientNode;\r\n    this.__ctx = ctx;\r\n};\r\n\r\n/**\r\n * Adds a color stop to the gradient root\r\n */\r\nCanvasGradient.prototype.addColorStop = function (offset, color) {\r\n    var stop = this.__ctx.__createElement(\"stop\"), regex, matches;\r\n    stop.setAttribute(\"offset\", offset);\r\n    if (color.indexOf(\"rgba\") !== -1) {\r\n        //separate alpha value, since webkit can't handle it\r\n        regex = /rgba\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d?\\.?\\d*)\\s*\\)/gi;\r\n        matches = regex.exec(color);\r\n        stop.setAttribute(\"stop-color\", format(\"rgb({r},{g},{b})\", {r:matches[1], g:matches[2], b:matches[3]}));\r\n        stop.setAttribute(\"stop-opacity\", matches[4]);\r\n    } else {\r\n        stop.setAttribute(\"stop-color\", color);\r\n    }\r\n    this.__root.appendChild(stop);\r\n};\r\n\r\nCanvasPattern = function (pattern, ctx) {\r\n    this.__root = pattern;\r\n    this.__ctx = ctx;\r\n};\r\n\r\n/**\r\n * The mock canvas context\r\n * @param o - options include:\r\n * ctx - existing Context2D to wrap around\r\n * width - width of your canvas (defaults to 500)\r\n * height - height of your canvas (defaults to 500)\r\n * enableMirroring - enables canvas mirroring (get image data) (defaults to false)\r\n * document - the document object (defaults to the current document)\r\n */\r\nctx = function (o) {\r\n    var defaultOptions = { width:500, height:500, enableMirroring : false}, options;\r\n\r\n    //keep support for this way of calling C2S: new C2S(width,height)\r\n    if (arguments.length > 1) {\r\n        options = defaultOptions;\r\n        options.width = arguments[0];\r\n        options.height = arguments[1];\r\n    } else if ( !o ) {\r\n        options = defaultOptions;\r\n    } else {\r\n        options = o;\r\n    }\r\n\r\n    if (!(this instanceof ctx)) {\r\n        //did someone call this without new?\r\n        return new ctx(options);\r\n    }\r\n\r\n    //setup options\r\n    this.width = options.width || defaultOptions.width;\r\n    this.height = options.height || defaultOptions.height;\r\n    this.enableMirroring = options.enableMirroring !== undefined ? options.enableMirroring : defaultOptions.enableMirroring;\r\n\r\n    this.canvas = this;   ///point back to this instance!\r\n    this.__document = options.document || document;\r\n\r\n    // allow passing in an existing context to wrap around\r\n    // if a context is passed in, we know a canvas already exist\r\n    if (options.ctx) {\r\n        this.__ctx = options.ctx;\r\n    } else {\r\n        this.__canvas = this.__document.createElement(\"canvas\");\r\n        this.__ctx = this.__canvas.getContext(\"2d\");\r\n    }\r\n\r\n    this.__setDefaultStyles();\r\n    this.__stack = [this.__getStyleState()];\r\n    this.__groupStack = [];\r\n\r\n    //the root svg element\r\n    this.__root = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\r\n    this.__root.setAttribute(\"version\", 1.1);\r\n    this.__root.setAttribute(\"xmlns\", \"http://www.w3.org/2000/svg\");\r\n    this.__root.setAttributeNS(\"http://www.w3.org/2000/xmlns/\", \"xmlns:xlink\", \"http://www.w3.org/1999/xlink\");\r\n    this.__root.setAttribute(\"width\", this.width);\r\n    this.__root.setAttribute(\"height\", this.height);\r\n\r\n    //make sure we don't generate the same ids in defs\r\n    this.__ids = {};\r\n\r\n    //defs tag\r\n    this.__defs = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"defs\");\r\n    this.__root.appendChild(this.__defs);\r\n\r\n    //also add a group child. the svg element can't use the transform attribute\r\n    this.__currentElement = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\");\r\n    this.__root.appendChild(this.__currentElement);\r\n};\r\n\r\n\r\n/**\r\n * Creates the specified svg element\r\n * @private\r\n */\r\nctx.prototype.__createElement = function (elementName, properties, resetFill) {\r\n    if (typeof properties === \"undefined\") {\r\n        properties = {};\r\n    }\r\n\r\n    var element = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", elementName),\r\n        keys = Object.keys(properties), i, key;\r\n    if (resetFill) {\r\n        //if fill or stroke is not specified, the svg element should not display. By default SVG's fill is black.\r\n        element.setAttribute(\"fill\", \"none\");\r\n        element.setAttribute(\"stroke\", \"none\");\r\n    }\r\n    for (i=0; i<keys.length; i++) {\r\n        key = keys[i];\r\n        element.setAttribute(key, properties[key]);\r\n    }\r\n    return element;\r\n};\r\n\r\n/**\r\n * Applies default canvas styles to the context\r\n * @private\r\n */\r\nctx.prototype.__setDefaultStyles = function () {\r\n    //default 2d canvas context properties see:http://www.w3.org/TR/2dcontext/\r\n    var keys = Object.keys(STYLES), i, key;\r\n    for (i=0; i<keys.length; i++) {\r\n        key = keys[i];\r\n        this[key] = STYLES[key].canvas;\r\n    }\r\n};\r\n\r\n/**\r\n * Applies styles on restore\r\n * @param styleState\r\n * @private\r\n */\r\nctx.prototype.__applyStyleState = function (styleState) {\r\n    var keys = Object.keys(styleState), i, key;\r\n    for (i=0; i<keys.length; i++) {\r\n        key = keys[i];\r\n        this[key] = styleState[key];\r\n    }\r\n};\r\n\r\n/**\r\n * Gets the current style state\r\n * @return {Object}\r\n * @private\r\n */\r\nctx.prototype.__getStyleState = function () {\r\n    var i, styleState = {}, keys = Object.keys(STYLES), key;\r\n    for (i=0; i<keys.length; i++) {\r\n        key = keys[i];\r\n        styleState[key] = this[key];\r\n    }\r\n    return styleState;\r\n};\r\n\r\n/**\r\n * Apples the current styles to the current SVG element. On \"ctx.fill\" or \"ctx.stroke\"\r\n * @param type\r\n * @private\r\n */\r\nctx.prototype.__applyStyleToCurrentElement = function (type) {\r\n    var currentElement = this.__currentElement;\r\n    var currentStyleGroup = this.__currentElementsToStyle;\r\n    if (currentStyleGroup) {\r\n        currentElement.setAttribute(type, \"\");\r\n        currentElement = currentStyleGroup.element;\r\n        currentStyleGroup.children.forEach(function (node) {\r\n            node.setAttribute(type, \"\");\r\n        })\r\n    }\r\n\r\n    var keys = Object.keys(STYLES), i, style, value, id, regex, matches;\r\n    for (i = 0; i < keys.length; i++) {\r\n        style = STYLES[keys[i]];\r\n        value = this[keys[i]];\r\n        if (style.apply) {\r\n            //is this a gradient or pattern?\r\n            if (value instanceof CanvasPattern) {\r\n                //pattern\r\n                if (value.__ctx) {\r\n                    //copy over defs\r\n                    while(value.__ctx.__defs.childNodes.length) {\r\n                        id = value.__ctx.__defs.childNodes[0].getAttribute(\"id\");\r\n                        this.__ids[id] = id;\r\n                        this.__defs.appendChild(value.__ctx.__defs.childNodes[0]);\r\n                    }\r\n                }\r\n                currentElement.setAttribute(style.apply, format(\"url(#{id})\", {id:value.__root.getAttribute(\"id\")}));\r\n            }\r\n            else if (value instanceof CanvasGradient) {\r\n                //gradient\r\n                currentElement.setAttribute(style.apply, format(\"url(#{id})\", {id:value.__root.getAttribute(\"id\")}));\r\n            } else if (style.apply.indexOf(type)!==-1 && style.svg !== value) {\r\n                if ((style.svgAttr === \"stroke\" || style.svgAttr === \"fill\") && value.indexOf(\"rgba\") !== -1) {\r\n                    //separate alpha value, since illustrator can't handle it\r\n                    regex = /rgba\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d?\\.?\\d*)\\s*\\)/gi;\r\n                    matches = regex.exec(value);\r\n                    currentElement.setAttribute(style.svgAttr, format(\"rgb({r},{g},{b})\", {r:matches[1], g:matches[2], b:matches[3]}));\r\n                    //should take globalAlpha here\r\n                    var opacity = matches[4];\r\n                    var globalAlpha = this.globalAlpha;\r\n                    if (globalAlpha != null) {\r\n                        opacity *= globalAlpha;\r\n                    }\r\n                    currentElement.setAttribute(style.svgAttr+\"-opacity\", opacity);\r\n                } else {\r\n                    var attr = style.svgAttr;\r\n                    if (keys[i] === 'globalAlpha') {\r\n                        attr = type+'-'+style.svgAttr;\r\n                        if (currentElement.getAttribute(attr)) {\r\n                                //fill-opacity or stroke-opacity has already been set by stroke or fill.\r\n                            continue;\r\n                        }\r\n                    }\r\n                    //otherwise only update attribute if right type, and not svg default\r\n                    currentElement.setAttribute(attr, value);\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * Will return the closest group or svg node. May return the current element.\r\n * @private\r\n */\r\nctx.prototype.__closestGroupOrSvg = function (node) {\r\n    node = node || this.__currentElement;\r\n    if (node.nodeName === \"g\" || node.nodeName === \"svg\") {\r\n        return node;\r\n    } else {\r\n        return this.__closestGroupOrSvg(node.parentNode);\r\n    }\r\n};\r\n\r\n/**\r\n * Returns the serialized value of the svg so far\r\n * @param fixNamedEntities - Standalone SVG doesn't support named entities, which document.createTextNode encodes.\r\n *                           If true, we attempt to find all named entities and encode it as a numeric entity.\r\n * @return serialized svg\r\n */\r\nctx.prototype.getSerializedSvg = function (fixNamedEntities) {\r\n    var serialized = new XMLSerializer().serializeToString(this.__root),\r\n        keys, i, key, value, regexp, xmlns;\r\n\r\n    //IE search for a duplicate xmnls because they didn't implement setAttributeNS correctly\r\n    xmlns = /xmlns=\"http:\\/\\/www\\.w3\\.org\\/2000\\/svg\".+xmlns=\"http:\\/\\/www\\.w3\\.org\\/2000\\/svg/gi;\r\n    if (xmlns.test(serialized)) {\r\n        serialized = serialized.replace('xmlns=\"http://www.w3.org/2000/svg','xmlns:xlink=\"http://www.w3.org/1999/xlink');\r\n    }\r\n\r\n    if (fixNamedEntities) {\r\n        keys = Object.keys(namedEntities);\r\n        //loop over each named entity and replace with the proper equivalent.\r\n        for (i=0; i<keys.length; i++) {\r\n            key = keys[i];\r\n            value = namedEntities[key];\r\n            regexp = new RegExp(key, \"gi\");\r\n            if (regexp.test(serialized)) {\r\n                serialized = serialized.replace(regexp, value);\r\n            }\r\n        }\r\n    }\r\n\r\n    return serialized;\r\n};\r\n\r\n\r\n/**\r\n * Returns the root svg\r\n * @return\r\n */\r\nctx.prototype.getSvg = function () {\r\n    return this.__root;\r\n};\r\n/**\r\n * Will generate a group tag.\r\n */\r\nctx.prototype.save = function () {\r\n    var group = this.__createElement(\"g\");\r\n    var parent = this.__closestGroupOrSvg();\r\n    this.__groupStack.push(parent);\r\n    parent.appendChild(group);\r\n    this.__currentElement = group;\r\n    this.__stack.push(this.__getStyleState());\r\n};\r\n/**\r\n * Sets current element to parent, or just root if already root\r\n */\r\nctx.prototype.restore = function () {\r\n    this.__currentElement = this.__groupStack.pop();\r\n    this.__currentElementsToStyle = null;\r\n    //Clearing canvas will make the poped group invalid, currentElement is set to the root group node.\r\n    if (!this.__currentElement) {\r\n        this.__currentElement = this.__root.childNodes[1];\r\n    }\r\n    var state = this.__stack.pop();\r\n    this.__applyStyleState(state);\r\n};\r\n\r\n/**\r\n * Helper method to add transform\r\n * @private\r\n */\r\nctx.prototype.__addTransform = function (t) {\r\n    //if the current element has siblings, add another group\r\n    var parent = this.__closestGroupOrSvg();\r\n    if (parent.childNodes.length > 0) {\r\n        if (this.__currentElement.nodeName === \"path\") {\r\n            if (!this.__currentElementsToStyle) this.__currentElementsToStyle = {element: parent, children: []};\r\n            this.__currentElementsToStyle.children.push(this.__currentElement)\r\n            this.__applyCurrentDefaultPath();\r\n        }\r\n\r\n        var group = this.__createElement(\"g\");\r\n        parent.appendChild(group);\r\n        this.__currentElement = group;\r\n    }\r\n\r\n    var transform = this.__currentElement.getAttribute(\"transform\");\r\n    if (transform) {\r\n        transform += \" \";\r\n    } else {\r\n        transform = \"\";\r\n    }\r\n    transform += t;\r\n    this.__currentElement.setAttribute(\"transform\", transform);\r\n};\r\n\r\n/**\r\n *  scales the current element\r\n */\r\nctx.prototype.scale = function (x, y) {\r\n    if (y === undefined) {\r\n        y = x;\r\n    }\r\n    this.__addTransform(format(\"scale({x},{y})\", {x:x, y:y}));\r\n};\r\n\r\n/**\r\n * rotates the current element\r\n */\r\nctx.prototype.rotate = function (angle) {\r\n    var degrees = (angle * 180 / Math.PI);\r\n    this.__addTransform(format(\"rotate({angle},{cx},{cy})\", {angle:degrees, cx:0, cy:0}));\r\n};\r\n\r\n/**\r\n * translates the current element\r\n */\r\nctx.prototype.translate = function (x, y) {\r\n    this.__addTransform(format(\"translate({x},{y})\", {x:x,y:y}));\r\n};\r\n\r\n/**\r\n * applies a transform to the current element\r\n */\r\nctx.prototype.transform = function (a, b, c, d, e, f) {\r\n    this.__addTransform(format(\"matrix({a},{b},{c},{d},{e},{f})\", {a:a, b:b, c:c, d:d, e:e, f:f}));\r\n};\r\n\r\n/**\r\n * Create a new Path Element\r\n */\r\nctx.prototype.beginPath = function () {\r\n    var path, parent;\r\n\r\n    // Note that there is only one current default path, it is not part of the drawing state.\r\n    // See also: https://html.spec.whatwg.org/multipage/scripting.html#current-default-path\r\n    this.__currentDefaultPath = \"\";\r\n    this.__currentPosition = {};\r\n\r\n    path = this.__createElement(\"path\", {}, true);\r\n    parent = this.__closestGroupOrSvg();\r\n    parent.appendChild(path);\r\n    this.__currentElement = path;\r\n};\r\n\r\n/**\r\n * Helper function to apply currentDefaultPath to current path element\r\n * @private\r\n */\r\nctx.prototype.__applyCurrentDefaultPath = function () {\r\n    var currentElement = this.__currentElement;\r\n    if (currentElement.nodeName === \"path\") {\r\n        currentElement.setAttribute(\"d\", this.__currentDefaultPath);\r\n    } else {\r\n        console.error(\"Attempted to apply path command to node\", currentElement.nodeName);\r\n    }\r\n};\r\n\r\n/**\r\n * Helper function to add path command\r\n * @private\r\n */\r\nctx.prototype.__addPathCommand = function (command) {\r\n    this.__currentDefaultPath += \" \";\r\n    this.__currentDefaultPath += command;\r\n};\r\n\r\n/**\r\n * Adds the move command to the current path element,\r\n * if the currentPathElement is not empty create a new path element\r\n */\r\nctx.prototype.moveTo = function (x,y) {\r\n    if (this.__currentElement.nodeName !== \"path\") {\r\n        this.beginPath();\r\n    }\r\n\r\n    // creates a new subpath with the given point\r\n    this.__currentPosition = {x: x, y: y};\r\n    this.__addPathCommand(format(\"M {x} {y}\", {x:x, y:y}));\r\n};\r\n\r\n/**\r\n * Closes the current path\r\n */\r\nctx.prototype.closePath = function () {\r\n    if (this.__currentDefaultPath) {\r\n        this.__addPathCommand(\"Z\");\r\n    }\r\n};\r\n\r\n/**\r\n * Adds a line to command\r\n */\r\nctx.prototype.lineTo = function (x, y) {\r\n    this.__currentPosition = {x: x, y: y};\r\n    if (this.__currentDefaultPath.indexOf('M') > -1) {\r\n        this.__addPathCommand(format(\"L {x} {y}\", {x:x, y:y}));\r\n    } else {\r\n        this.__addPathCommand(format(\"M {x} {y}\", {x:x, y:y}));\r\n    }\r\n};\r\n\r\n/**\r\n * Add a bezier command\r\n */\r\nctx.prototype.bezierCurveTo = function (cp1x, cp1y, cp2x, cp2y, x, y) {\r\n    this.__currentPosition = {x: x, y: y};\r\n    this.__addPathCommand(format(\"C {cp1x} {cp1y} {cp2x} {cp2y} {x} {y}\",\r\n        {cp1x:cp1x, cp1y:cp1y, cp2x:cp2x, cp2y:cp2y, x:x, y:y}));\r\n};\r\n\r\n/**\r\n * Adds a quadratic curve to command\r\n */\r\nctx.prototype.quadraticCurveTo = function (cpx, cpy, x, y) {\r\n    this.__currentPosition = {x: x, y: y};\r\n    this.__addPathCommand(format(\"Q {cpx} {cpy} {x} {y}\", {cpx:cpx, cpy:cpy, x:x, y:y}));\r\n};\r\n\r\n\r\n/**\r\n * Return a new normalized vector of given vector\r\n */\r\nvar normalize = function (vector) {\r\n    var len = Math.sqrt(vector[0] * vector[0] + vector[1] * vector[1]);\r\n    return [vector[0] / len, vector[1] / len];\r\n};\r\n\r\n/**\r\n * Adds the arcTo to the current path\r\n *\r\n * @see http://www.w3.org/TR/2015/WD-2dcontext-20150514/#dom-context-2d-arcto\r\n */\r\nctx.prototype.arcTo = function (x1, y1, x2, y2, radius) {\r\n    // Let the point (x0, y0) be the last point in the subpath.\r\n    var x0 = this.__currentPosition && this.__currentPosition.x;\r\n    var y0 = this.__currentPosition && this.__currentPosition.y;\r\n\r\n    // First ensure there is a subpath for (x1, y1).\r\n    if (typeof x0 == \"undefined\" || typeof y0 == \"undefined\") {\r\n        return;\r\n    }\r\n\r\n    // Negative values for radius must cause the implementation to throw an IndexSizeError exception.\r\n    if (radius < 0) {\r\n        throw new Error(\"IndexSizeError: The radius provided (\" + radius + \") is negative.\");\r\n    }\r\n\r\n    // If the point (x0, y0) is equal to the point (x1, y1),\r\n    // or if the point (x1, y1) is equal to the point (x2, y2),\r\n    // or if the radius radius is zero,\r\n    // then the method must add the point (x1, y1) to the subpath,\r\n    // and connect that point to the previous point (x0, y0) by a straight line.\r\n    if (((x0 === x1) && (y0 === y1))\r\n        || ((x1 === x2) && (y1 === y2))\r\n        || (radius === 0)) {\r\n        this.lineTo(x1, y1);\r\n        return;\r\n    }\r\n\r\n    // Otherwise, if the points (x0, y0), (x1, y1), and (x2, y2) all lie on a single straight line,\r\n    // then the method must add the point (x1, y1) to the subpath,\r\n    // and connect that point to the previous point (x0, y0) by a straight line.\r\n    var unit_vec_p1_p0 = normalize([x0 - x1, y0 - y1]);\r\n    var unit_vec_p1_p2 = normalize([x2 - x1, y2 - y1]);\r\n    if (unit_vec_p1_p0[0] * unit_vec_p1_p2[1] === unit_vec_p1_p0[1] * unit_vec_p1_p2[0]) {\r\n        this.lineTo(x1, y1);\r\n        return;\r\n    }\r\n\r\n    // Otherwise, let The Arc be the shortest arc given by circumference of the circle that has radius radius,\r\n    // and that has one point tangent to the half-infinite line that crosses the point (x0, y0) and ends at the point (x1, y1),\r\n    // and that has a different point tangent to the half-infinite line that ends at the point (x1, y1), and crosses the point (x2, y2).\r\n    // The points at which this circle touches these two lines are called the start and end tangent points respectively.\r\n\r\n    // note that both vectors are unit vectors, so the length is 1\r\n    var cos = (unit_vec_p1_p0[0] * unit_vec_p1_p2[0] + unit_vec_p1_p0[1] * unit_vec_p1_p2[1]);\r\n    var theta = Math.acos(Math.abs(cos));\r\n\r\n    // Calculate origin\r\n    var unit_vec_p1_origin = normalize([\r\n        unit_vec_p1_p0[0] + unit_vec_p1_p2[0],\r\n        unit_vec_p1_p0[1] + unit_vec_p1_p2[1]\r\n    ]);\r\n    var len_p1_origin = radius / Math.sin(theta / 2);\r\n    var x = x1 + len_p1_origin * unit_vec_p1_origin[0];\r\n    var y = y1 + len_p1_origin * unit_vec_p1_origin[1];\r\n\r\n    // Calculate start angle and end angle\r\n    // rotate 90deg clockwise (note that y axis points to its down)\r\n    var unit_vec_origin_start_tangent = [\r\n        -unit_vec_p1_p0[1],\r\n        unit_vec_p1_p0[0]\r\n    ];\r\n    // rotate 90deg counter clockwise (note that y axis points to its down)\r\n    var unit_vec_origin_end_tangent = [\r\n        unit_vec_p1_p2[1],\r\n        -unit_vec_p1_p2[0]\r\n    ];\r\n    var getAngle = function (vector) {\r\n        // get angle (clockwise) between vector and (1, 0)\r\n        var x = vector[0];\r\n        var y = vector[1];\r\n        if (y >= 0) { // note that y axis points to its down\r\n            return Math.acos(x);\r\n        } else {\r\n            return -Math.acos(x);\r\n        }\r\n    };\r\n    var startAngle = getAngle(unit_vec_origin_start_tangent);\r\n    var endAngle = getAngle(unit_vec_origin_end_tangent);\r\n\r\n    // Connect the point (x0, y0) to the start tangent point by a straight line\r\n    this.lineTo(x + unit_vec_origin_start_tangent[0] * radius,\r\n                y + unit_vec_origin_start_tangent[1] * radius);\r\n\r\n    // Connect the start tangent point to the end tangent point by arc\r\n    // and adding the end tangent point to the subpath.\r\n    this.arc(x, y, radius, startAngle, endAngle);\r\n};\r\n\r\n/**\r\n * Sets the stroke property on the current element\r\n */\r\nctx.prototype.stroke = function () {\r\n    if (this.__currentElement.nodeName === \"path\") {\r\n        this.__currentElement.setAttribute(\"paint-order\", \"fill stroke markers\");\r\n    }\r\n    this.__applyCurrentDefaultPath();\r\n    this.__applyStyleToCurrentElement(\"stroke\");\r\n};\r\n\r\n/**\r\n * Sets fill properties on the current element\r\n */\r\nctx.prototype.fill = function () {\r\n    if (this.__currentElement.nodeName === \"path\") {\r\n        this.__currentElement.setAttribute(\"paint-order\", \"stroke fill markers\");\r\n    }\r\n    this.__applyCurrentDefaultPath();\r\n    this.__applyStyleToCurrentElement(\"fill\");\r\n};\r\n\r\n/**\r\n *  Adds a rectangle to the path.\r\n */\r\nctx.prototype.rect = function (x, y, width, height) {\r\n    if (this.__currentElement.nodeName !== \"path\") {\r\n        this.beginPath();\r\n    }\r\n    this.moveTo(x, y);\r\n    this.lineTo(x+width, y);\r\n    this.lineTo(x+width, y+height);\r\n    this.lineTo(x, y+height);\r\n    this.lineTo(x, y);\r\n    this.closePath();\r\n};\r\n\r\n\r\n/**\r\n * adds a rectangle element\r\n */\r\nctx.prototype.fillRect = function (x, y, width, height) {\r\n    var rect, parent;\r\n    rect = this.__createElement(\"rect\", {\r\n        x : x,\r\n        y : y,\r\n        width : width,\r\n        height : height\r\n    }, true);\r\n    parent = this.__closestGroupOrSvg();\r\n    parent.appendChild(rect);\r\n    this.__currentElement = rect;\r\n    this.__applyStyleToCurrentElement(\"fill\");\r\n};\r\n\r\n/**\r\n * Draws a rectangle with no fill\r\n * @param x\r\n * @param y\r\n * @param width\r\n * @param height\r\n */\r\nctx.prototype.strokeRect = function (x, y, width, height) {\r\n    var rect, parent;\r\n    rect = this.__createElement(\"rect\", {\r\n        x : x,\r\n        y : y,\r\n        width : width,\r\n        height : height\r\n    }, true);\r\n    parent = this.__closestGroupOrSvg();\r\n    parent.appendChild(rect);\r\n    this.__currentElement = rect;\r\n    this.__applyStyleToCurrentElement(\"stroke\");\r\n};\r\n\r\n\r\n/**\r\n * Clear entire canvas:\r\n * 1. save current transforms\r\n * 2. remove all the childNodes of the root g element\r\n */\r\nctx.prototype.__clearCanvas = function () {\r\n    var current = this.__closestGroupOrSvg(),\r\n        transform = current.getAttribute(\"transform\");\r\n    var rootGroup = this.__root.childNodes[1];\r\n    var childNodes = rootGroup.childNodes;\r\n    for (var i = childNodes.length - 1; i >= 0; i--) {\r\n        if (childNodes[i]) {\r\n            rootGroup.removeChild(childNodes[i]);\r\n        }\r\n    }\r\n    this.__currentElement = rootGroup;\r\n    //reset __groupStack as all the child group nodes are all removed.\r\n    this.__groupStack = [];\r\n    if (transform) {\r\n        this.__addTransform(transform);\r\n    }\r\n};\r\n\r\n/**\r\n * \"Clears\" a canvas by just drawing a white rectangle in the current group.\r\n */\r\nctx.prototype.clearRect = function (x, y, width, height) {\r\n    //clear entire canvas\r\n    if (x === 0 && y === 0 && width === this.width && height === this.height) {\r\n        this.__clearCanvas();\r\n        return;\r\n    }\r\n    var rect, parent = this.__closestGroupOrSvg();\r\n    rect = this.__createElement(\"rect\", {\r\n        x : x,\r\n        y : y,\r\n        width : width,\r\n        height : height,\r\n        fill : \"#FFFFFF\"\r\n    }, true);\r\n    parent.appendChild(rect);\r\n};\r\n\r\n/**\r\n * Adds a linear gradient to a defs tag.\r\n * Returns a canvas gradient object that has a reference to it's parent def\r\n */\r\nctx.prototype.createLinearGradient = function (x1, y1, x2, y2) {\r\n    var grad = this.__createElement(\"linearGradient\", {\r\n        id : randomString(this.__ids),\r\n        x1 : x1+\"px\",\r\n        x2 : x2+\"px\",\r\n        y1 : y1+\"px\",\r\n        y2 : y2+\"px\",\r\n        \"gradientUnits\" : \"userSpaceOnUse\"\r\n    }, false);\r\n    this.__defs.appendChild(grad);\r\n    return new CanvasGradient(grad, this);\r\n};\r\n\r\n/**\r\n * Adds a radial gradient to a defs tag.\r\n * Returns a canvas gradient object that has a reference to it's parent def\r\n */\r\nctx.prototype.createRadialGradient = function (x0, y0, r0, x1, y1, r1) {\r\n    var grad = this.__createElement(\"radialGradient\", {\r\n        id : randomString(this.__ids),\r\n        cx : x1+\"px\",\r\n        cy : y1+\"px\",\r\n        r  : r1+\"px\",\r\n        fx : x0+\"px\",\r\n        fy : y0+\"px\",\r\n        \"gradientUnits\" : \"userSpaceOnUse\"\r\n    }, false);\r\n    this.__defs.appendChild(grad);\r\n    return new CanvasGradient(grad, this);\r\n\r\n};\r\n\r\n/**\r\n * Parses the font string and returns svg mapping\r\n * @private\r\n */\r\nctx.prototype.__parseFont = function () {\r\n    var regex = /^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))(?:\\s*\\/\\s*(normal|[.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])))?\\s*([-,\\'\\\"\\sa-z0-9]+?)\\s*$/i;\r\n    var fontPart = regex.exec( this.font );\r\n    var data = {\r\n        style : fontPart[1] || 'normal',\r\n        size : fontPart[4] || '10px',\r\n        family : fontPart[6] || 'sans-serif',\r\n        weight: fontPart[3] || 'normal',\r\n        decoration : fontPart[2] || 'normal',\r\n        href : null\r\n    };\r\n\r\n    //canvas doesn't support underline natively, but we can pass this attribute\r\n    if (this.__fontUnderline === \"underline\") {\r\n        data.decoration = \"underline\";\r\n    }\r\n\r\n    //canvas also doesn't support linking, but we can pass this as well\r\n    if (this.__fontHref) {\r\n        data.href = this.__fontHref;\r\n    }\r\n\r\n    return data;\r\n};\r\n\r\n/**\r\n * Helper to link text fragments\r\n * @param font\r\n * @param element\r\n * @return {*}\r\n * @private\r\n */\r\nctx.prototype.__wrapTextLink = function (font, element) {\r\n    if (font.href) {\r\n        var a = this.__createElement(\"a\");\r\n        a.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"xlink:href\", font.href);\r\n        a.appendChild(element);\r\n        return a;\r\n    }\r\n    return element;\r\n};\r\n\r\n/**\r\n * Fills or strokes text\r\n * @param text\r\n * @param x\r\n * @param y\r\n * @param action - stroke or fill\r\n * @private\r\n */\r\nctx.prototype.__applyText = function (text, x, y, action) {\r\n    var font = this.__parseFont(),\r\n        parent = this.__closestGroupOrSvg(),\r\n        textElement = this.__createElement(\"text\", {\r\n            \"font-family\" : font.family,\r\n            \"font-size\" : font.size,\r\n            \"font-style\" : font.style,\r\n            \"font-weight\" : font.weight,\r\n            \"text-decoration\" : font.decoration,\r\n            \"x\" : x,\r\n            \"y\" : y,\r\n            \"text-anchor\": getTextAnchor(this.textAlign),\r\n            \"dominant-baseline\": getDominantBaseline(this.textBaseline)\r\n        }, true);\r\n\r\n    textElement.appendChild(this.__document.createTextNode(text));\r\n    this.__currentElement = textElement;\r\n    this.__applyStyleToCurrentElement(action);\r\n    parent.appendChild(this.__wrapTextLink(font,textElement));\r\n};\r\n\r\n/**\r\n * Creates a text element\r\n * @param text\r\n * @param x\r\n * @param y\r\n */\r\nctx.prototype.fillText = function (text, x, y) {\r\n    this.__applyText(text, x, y, \"fill\");\r\n};\r\n\r\n/**\r\n * Strokes text\r\n * @param text\r\n * @param x\r\n * @param y\r\n */\r\nctx.prototype.strokeText = function (text, x, y) {\r\n    this.__applyText(text, x, y, \"stroke\");\r\n};\r\n\r\n/**\r\n * No need to implement this for svg.\r\n * @param text\r\n * @return {TextMetrics}\r\n */\r\nctx.prototype.measureText = function (text) {\r\n    this.__ctx.font = this.font;\r\n    return this.__ctx.measureText(text);\r\n};\r\n\r\n/**\r\n *  Arc command!\r\n */\r\nctx.prototype.arc = function (x, y, radius, startAngle, endAngle, counterClockwise) {\r\n    // in canvas no circle is drawn if no angle is provided.\r\n    if (startAngle === endAngle) {\r\n        return;\r\n    }\r\n    startAngle = startAngle % (2*Math.PI);\r\n    endAngle = endAngle % (2*Math.PI);\r\n    if (startAngle === endAngle) {\r\n        //circle time! subtract some of the angle so svg is happy (svg elliptical arc can't draw a full circle)\r\n        endAngle = ((endAngle + (2*Math.PI)) - 0.001 * (counterClockwise ? -1 : 1)) % (2*Math.PI);\r\n    }\r\n    var endX = x+radius*Math.cos(endAngle),\r\n        endY = y+radius*Math.sin(endAngle),\r\n        startX = x+radius*Math.cos(startAngle),\r\n        startY = y+radius*Math.sin(startAngle),\r\n        sweepFlag = counterClockwise ? 0 : 1,\r\n        largeArcFlag = 0,\r\n        diff = endAngle - startAngle;\r\n\r\n    // https://github.com/gliffy/canvas2svg/issues/4\r\n    if (diff < 0) {\r\n        diff += 2*Math.PI;\r\n    }\r\n\r\n    if (counterClockwise) {\r\n        largeArcFlag = diff > Math.PI ? 0 : 1;\r\n    } else {\r\n        largeArcFlag = diff > Math.PI ? 1 : 0;\r\n    }\r\n\r\n    this.lineTo(startX, startY);\r\n    this.__addPathCommand(format(\"A {rx} {ry} {xAxisRotation} {largeArcFlag} {sweepFlag} {endX} {endY}\",\r\n        {rx:radius, ry:radius, xAxisRotation:0, largeArcFlag:largeArcFlag, sweepFlag:sweepFlag, endX:endX, endY:endY}));\r\n\r\n    this.__currentPosition = {x: endX, y: endY};\r\n};\r\n\r\n/**\r\n * Generates a ClipPath from the clip command.\r\n */\r\nctx.prototype.clip = function () {\r\n    var group = this.__closestGroupOrSvg(),\r\n        clipPath = this.__createElement(\"clipPath\"),\r\n        id =  randomString(this.__ids),\r\n        newGroup = this.__createElement(\"g\");\r\n\r\n    this.__applyCurrentDefaultPath();\r\n    group.removeChild(this.__currentElement);\r\n    clipPath.setAttribute(\"id\", id);\r\n    clipPath.appendChild(this.__currentElement);\r\n\r\n    this.__defs.appendChild(clipPath);\r\n\r\n    //set the clip path to this group\r\n    group.setAttribute(\"clip-path\", format(\"url(#{id})\", {id:id}));\r\n\r\n    //clip paths can be scaled and transformed, we need to add another wrapper group to avoid later transformations\r\n    // to this path\r\n    group.appendChild(newGroup);\r\n\r\n    this.__currentElement = newGroup;\r\n\r\n};\r\n\r\n/**\r\n * Draws a canvas, image or mock context to this canvas.\r\n * Note that all svg dom manipulation uses node.childNodes rather than node.children for IE support.\r\n * http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#dom-context-2d-drawimage\r\n */\r\nctx.prototype.drawImage = function () {\r\n    //convert arguments to a real array\r\n    var args = Array.prototype.slice.call(arguments),\r\n        image=args[0],\r\n        dx, dy, dw, dh, sx=0, sy=0, sw, sh, parent, svg, defs, group,\r\n        currentElement, svgImage, canvas, context, id;\r\n\r\n    if (args.length === 3) {\r\n        dx = args[1];\r\n        dy = args[2];\r\n        sw = image.width;\r\n        sh = image.height;\r\n        dw = sw;\r\n        dh = sh;\r\n    } else if (args.length === 5) {\r\n        dx = args[1];\r\n        dy = args[2];\r\n        dw = args[3];\r\n        dh = args[4];\r\n        sw = image.width;\r\n        sh = image.height;\r\n    } else if (args.length === 9) {\r\n        sx = args[1];\r\n        sy = args[2];\r\n        sw = args[3];\r\n        sh = args[4];\r\n        dx = args[5];\r\n        dy = args[6];\r\n        dw = args[7];\r\n        dh = args[8];\r\n    } else {\r\n        throw new Error(\"Invalid number of arguments passed to drawImage: \" + arguments.length);\r\n    }\r\n\r\n    parent = this.__closestGroupOrSvg();\r\n    currentElement = this.__currentElement;\r\n    var translateDirective = \"translate(\" + dx + \", \" + dy + \")\";\r\n    if (image instanceof ctx) {\r\n        //canvas2svg mock canvas context. In the future we may want to clone nodes instead.\r\n        //also I'm currently ignoring dw, dh, sw, sh, sx, sy for a mock context.\r\n        svg = image.getSvg().cloneNode(true);\r\n        if (svg.childNodes && svg.childNodes.length > 1) {\r\n            defs = svg.childNodes[0];\r\n            while(defs.childNodes.length) {\r\n                id = defs.childNodes[0].getAttribute(\"id\");\r\n                this.__ids[id] = id;\r\n                this.__defs.appendChild(defs.childNodes[0]);\r\n            }\r\n            group = svg.childNodes[1];\r\n            if (group) {\r\n                //save original transform\r\n                var originTransform = group.getAttribute(\"transform\");\r\n                var transformDirective;\r\n                if (originTransform) {\r\n                    transformDirective = originTransform+\" \"+translateDirective;\r\n                } else {\r\n                    transformDirective = translateDirective;\r\n                }\r\n                group.setAttribute(\"transform\", transformDirective);\r\n                parent.appendChild(group);\r\n            }\r\n        }\r\n    } else if (image.nodeName === \"CANVAS\" || image.nodeName === \"IMG\") {\r\n        //canvas or image\r\n        svgImage = this.__createElement(\"image\");\r\n        svgImage.setAttribute(\"width\", dw);\r\n        svgImage.setAttribute(\"height\", dh);\r\n        svgImage.setAttribute(\"preserveAspectRatio\", \"none\");\r\n\r\n        if (sx || sy || sw !== image.width || sh !== image.height) {\r\n            //crop the image using a temporary canvas\r\n            canvas = this.__document.createElement(\"canvas\");\r\n            canvas.width = dw;\r\n            canvas.height = dh;\r\n            context = canvas.getContext(\"2d\");\r\n            context.drawImage(image, sx, sy, sw, sh, 0, 0, dw, dh);\r\n            image = canvas;\r\n        }\r\n        svgImage.setAttribute(\"transform\", translateDirective);\r\n        svgImage.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"xlink:href\",\r\n            image.nodeName === \"CANVAS\" ? image.toDataURL() : image.getAttribute(\"src\"));\r\n        parent.appendChild(svgImage);\r\n    }\r\n};\r\n\r\n/**\r\n * Generates a pattern tag\r\n */\r\nctx.prototype.createPattern = function (image, repetition) {\r\n    var pattern = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"pattern\"), id = randomString(this.__ids),\r\n        img;\r\n    pattern.setAttribute(\"id\", id);\r\n    pattern.setAttribute(\"width\", image.width);\r\n    pattern.setAttribute(\"height\", image.height);\r\n    if (image.nodeName === \"CANVAS\" || image.nodeName === \"IMG\") {\r\n        img = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"image\");\r\n        img.setAttribute(\"width\", image.width);\r\n        img.setAttribute(\"height\", image.height);\r\n        img.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"xlink:href\",\r\n            image.nodeName === \"CANVAS\" ? image.toDataURL() : image.getAttribute(\"src\"));\r\n        pattern.appendChild(img);\r\n        this.__defs.appendChild(pattern);\r\n    } else if (image instanceof ctx) {\r\n        pattern.appendChild(image.__root.childNodes[1]);\r\n        this.__defs.appendChild(pattern);\r\n    }\r\n    return new CanvasPattern(pattern, this);\r\n};\r\n\r\nctx.prototype.setLineDash = function (dashArray) {\r\n    if (dashArray && dashArray.length > 0) {\r\n        this.lineDash = dashArray.join(\",\");\r\n    } else {\r\n        this.lineDash = null;\r\n    }\r\n};\r\n\r\n/**\r\n * Not yet implemented\r\n */\r\nctx.prototype.drawFocusRing = function () {};\r\nctx.prototype.createImageData = function () {};\r\nctx.prototype.getImageData = function () {};\r\nctx.prototype.putImageData = function () {};\r\nctx.prototype.globalCompositeOperation = function () {};\r\nctx.prototype.setTransform = function () {};\r\n\r\nexport {ctx as C2S}","/** @module */\r\n\r\nimport { C2S } from '../../lib/canvas2svg.esm.js'\r\n/**\r\n * add a button so that we can generate an SVG of what is being rendered\r\n * @param {Object} screen the screen where the drawing context is.\r\n * We will temporarily change the drawing context.\r\n * @param {Object} draw the drawing function that renders drawings to the context.\r\n */\r\nexport default function addSVGOutput(screen, draw) {\r\n    const w = screen.width\r\n    const h = screen.height\r\n\r\n    const svgUIDiv = document.createElement('div')\r\n\r\n    // svg output button\r\n    const button = document.createElement('button')\r\n    button.innerText = 'Make SVG'\r\n    button.onclick = makeSVG\r\n    svgUIDiv.appendChild(button)\r\n\r\n    // svg download link\r\n    const downloadLink = document.createElement('a')\r\n    downloadLink.innerText = 'Download SVG'\r\n    downloadLink.download = 'vote.svg'\r\n    downloadLink.hidden = true\r\n    svgUIDiv.appendChild(downloadLink)\r\n\r\n    // svg hide button\r\n    const svgHideButton = document.createElement('button')\r\n    svgHideButton.innerText = 'Hide SVG'\r\n    svgHideButton.hidden = true\r\n    svgHideButton.onclick = hideSVG\r\n    svgUIDiv.appendChild(svgHideButton)\r\n\r\n    // hidden svg output div\r\n    const svgDiv = document.createElement('div')\r\n    svgDiv.setAttribute('class', 'svgDiv')\r\n    svgDiv.style.width = `${w}px`\r\n    svgDiv.style.height = `${h}px`\r\n    svgDiv.hidden = true\r\n    svgUIDiv.appendChild(svgDiv)\r\n\r\n    const svgCtx = new C2S(w, h)\r\n\r\n    function makeSVG() {\r\n        // temporarily swap drawing context, render SVG,\r\n        // then output SVG to div and to a download link\r\n        const old = screen.ctx\r\n        screen.setCtx(svgCtx)\r\n        screen.setNoBuffers(true)\r\n        draw()\r\n        outputSVG()\r\n        screen.setCtx(old)\r\n        screen.setNoBuffers(false)\r\n    }\r\n\r\n    function outputSVG() {\r\n        const svg = svgCtx.getSerializedSvg(true)\r\n        svgDiv.innerHTML = svg\r\n        svgDiv.hidden = false\r\n        svgHideButton.hidden = false\r\n        downloadLink.hidden = false\r\n\r\n        const url = `data:image/svg+xml;charset=utf-8,${encodeURIComponent(svg)}`\r\n        downloadLink.href = url\r\n    }\r\n\r\n    function hideSVG() {\r\n        svgDiv.hidden = true\r\n        svgHideButton.hidden = true\r\n        downloadLink.hidden = true\r\n    }\r\n\r\n    return svgUIDiv\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Class for a single button.\r\n * @param {*} buttonConfig\r\n * @param {*} onChoose\r\n */\r\nexport default function Button(buttonConfig, onChoose) {\r\n    const self = this\r\n\r\n    self.config = buttonConfig\r\n    self.name = buttonConfig.name\r\n    self.nameIsHTML = buttonConfig.nameIsHTML || false\r\n    self.dom = document.createElement('div')\r\n    self.dom.setAttribute('class', 'button')\r\n\r\n    // overwrite margins.  The old way was not working.\r\n    let fixMargin = buttonConfig.margin\r\n    fixMargin = fixMargin || 0\r\n    fixMargin = Math.max(fixMargin, 4)\r\n    self.dom.style.marginRight = `${fixMargin}px`\r\n\r\n    // Click!\r\n    self.draw = function () {\r\n        if (self.nameIsHTML) {\r\n            self.dom.innerHTML = self.name\r\n        } else {\r\n            self.dom.innerText = self.name\r\n        }\r\n    }\r\n    self.draw()\r\n    self.dom.setAttribute('title', buttonConfig.realname || '')\r\n    self.onClick = function () {\r\n        onChoose(self, buttonConfig)\r\n    }\r\n    self.dom.onclick = self.onClick\r\n    // Turn on or off!\r\n    self.turnOff = function () {\r\n        self.isOn = false\r\n        self.config.isOn = false\r\n        self.dom.setAttribute('on', 'no')\r\n    }\r\n    self.turnOn = function () {\r\n        self.isOn = true\r\n        self.config.isOn = true\r\n        self.dom.setAttribute('on', 'yes')\r\n    }\r\n    self.turnOff()\r\n}\r\n","/** @module */\r\n\r\nimport Button from './Button.js'\r\n\r\n/**\r\n * Create a group of buttons.\r\n * @param {*} config\r\n */\r\nexport default function ButtonGroup(config) {\r\n    const self = this\r\n    self.config = config\r\n\r\n    // check if there is a function to make the data\r\n    // this function can be used later to update the buttons\r\n    if (config.data === undefined) {\r\n        config.data = []\r\n        if (config.makeData === undefined) {\r\n            config.makeData = () => []\r\n        }\r\n        self.makeData = config.makeData\r\n        self.buttonConfigs = self.makeData()\r\n        self.doMakeData = true\r\n    }\r\n    self.buttonConfigs = config.data\r\n\r\n    self.labelName = config.label\r\n    self.labelIsHTML = config.labelIsHTML || false\r\n\r\n    self.onChoose = config.onChoose\r\n    self.isCheckbox = config.isCheckbox || false\r\n    self.isCheckboxBool = config.isCheckboxBool || false\r\n    self.justButton = config.justButton || false\r\n    self.buttonHidden = config.buttonHidden || {}\r\n\r\n    // DOM!\r\n    self.dom = document.createElement('div')\r\n    self.dom.setAttribute('class', 'button-group')\r\n\r\n    self.buttonDOMByValue = []\r\n\r\n    self.init = function () {\r\n        if (self.doMakeData) self.buttonConfigs = self.makeData()\r\n\r\n        // clear\r\n        self.dom.innerHTML = ''\r\n        self.buttons = []\r\n        self.buttonsByName = {}\r\n\r\n        // Label!\r\n        self.labelDOM = document.createElement('div')\r\n        self.labelDOM.setAttribute('class', 'button-group-label')\r\n        self.draw()\r\n        self.dom.appendChild(self.labelDOM)\r\n\r\n        // Create & place buttons!\r\n        for (let i = 0; i < self.buttonConfigs.length; i++) {\r\n            const conf = self.buttonConfigs[i]\r\n            const button = new Button(conf, self.onToggle)\r\n            self.buttonsByName[conf.name] = button\r\n            button.dom.style.width = `${config.width}px` // whatever\r\n            if (conf.width) button.dom.style.width = `${conf.width}px` // whatever\r\n            self.buttons.push(button)\r\n            self.dom.appendChild(button.dom)\r\n            self.buttonDOMByValue[conf.value] = button.dom\r\n        }\r\n\r\n        // And then select the one that says \"selected\"! Fake a click.\r\n        for (let i = 0; i < self.buttons.length; i++) {\r\n            const button = self.buttons[i]\r\n            if (button.config.selected) {\r\n                button.turnOn()\r\n                break\r\n            }\r\n        }\r\n        self.draw()\r\n    }\r\n    self.updateNames = function () {\r\n        const data2 = self.makeData()\r\n        for (let i = 0; i < self.buttonConfigs.length; i++) {\r\n            self.buttonConfigs[i].name = data2[i].name\r\n            self.buttons[i].name = self.buttonConfigs[i].name\r\n        }\r\n    }\r\n    self.redraw = function () {\r\n        self.updateNames()\r\n        self.draw()\r\n    }\r\n    self.draw = function () {\r\n        if (self.labelIsHTML) {\r\n            self.labelDOM.innerHTML = self.labelName\r\n        } else {\r\n            self.labelDOM.innerText = self.labelName\r\n        }\r\n        for (const button of self.buttons) {\r\n            button.draw()\r\n        }\r\n    }\r\n\r\n    self.configureHidden = function () {\r\n        for (const [buttonName, hidden] of Object.entries(self.buttonHidden)) {\r\n            self.buttonsByName[buttonName].dom.hidden = hidden\r\n        }\r\n    }\r\n\r\n    // Toggle buttons\r\n    self.onToggle = function (button, buttonData) {\r\n        if (self.isCheckbox || self.isCheckboxBool) {\r\n            if (button.isOn) {\r\n                button.turnOff()\r\n            } else {\r\n                button.turnOn()\r\n            }\r\n        } else { // justButton means it doesn't get selected\r\n            // Turn all off\r\n            for (let i = 0; i < self.buttons.length; i++) self.buttons[i].turnOff()\r\n            button.turnOn() // except one\r\n            if (self.justButton) {\r\n                // turn on for a little while, then off\r\n                setTimeout(() => button.turnOff(), 800)\r\n            }\r\n        }\r\n        // And send the data up\r\n        self.onChoose(buttonData)\r\n    }\r\n\r\n    // Highlight based on data...\r\n    self.highlight = function (propName, propValue) {\r\n        // if we haven't set up the buttons yet, then don't do anything yet\r\n        if (self.buttons.length === 0) return\r\n\r\n        // Turn all off\r\n        for (let i = 0; i < self.buttons.length; i++) self.buttons[i].turnOff()\r\n\r\n        if (self.isCheckbox) {\r\n            for (const ibu in self.buttons) {\r\n                const bu = self.buttons[ibu]\r\n                if (propValue.includes(bu.config[propName])) { // the propValue is an array of values\r\n                    bu.turnOn()\r\n                }\r\n            }\r\n        } else if (self.isCheckboxBool) {\r\n            for (const ibu in self.buttons) {\r\n                const bu = self.buttons[ibu]\r\n                const buttonName = bu.config[propName]\r\n                // if (Object.keys(propValue).includes(buttonName)) { // the propValue is an array of values\r\n                if (buttonName in propValue) {\r\n                    if (propValue[buttonName]) {\r\n                        bu.turnOn()\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            // Find the one...\r\n            const theButton = self.buttons.filter((button) => {\r\n                const { config } = button\r\n                return (config[propName] === propValue)\r\n            })[0]\r\n            if (theButton !== undefined) {\r\n                theButton.turnOn()\r\n            }\r\n        }\r\n    }\r\n\r\n    self.init()\r\n}\r\n","/** @module */\r\n\r\nimport ButtonGroup from './ButtonGroup.js'\r\n\r\n/**\r\n * Make a selection that determines a single property's value.\r\n * Defer handling dependent calculations to the next update step,\r\n * where we will look at a dependency tree to determine what else needs updating.\r\n * @param {Object.<string>} object\r\n * @param {(String|Number|Boolean)} object.prop - The property being selected in the menu.\r\n * @param {String} prop - Name of prop\r\n * @param {MenuItem~setProp} setProp - The action that is performed as part of onclick.\r\n * @param {String} label - The prompt presented to the user.\r\n * @param {Object[]} options - the list of options that the UI presents to the user.\r\n * @param {(String|Number|Boolean)} options[].value - Value to pass to setProp\r\n * @param {String[]} change - list of changes made when pressing a button.\r\n * @param {Changes} changes\r\n */\r\nexport default function MenuItem(object, prop, setProp, label, options, change, changes) {\r\n    const self = this\r\n    self.list = options\r\n    self.onChoose = function (data) {\r\n        // LOAD INPUT\r\n\r\n        setProp(data.value)\r\n        // CONFIGURE\r\n        self.configure()\r\n        // UPDATE\r\n        changes.add(change)\r\n    }\r\n    self.choose = new ButtonGroup({\r\n        label,\r\n        width: bw(2),\r\n        data: self.list,\r\n        onChoose: self.onChoose,\r\n    })\r\n    self.configure = function () {\r\n    }\r\n    self.select = function () {\r\n        self.choose.highlight('value', object[prop])\r\n    }\r\n}\r\n\r\n/**\r\n * Called in onclick.\r\n * @callback MenuItem~setProp\r\n * @param {(String|Number|Boolean)} value\r\n */\r\n\r\nfunction bw(x) { return (220 - 4 * (x - 1)) / x - 2 }\r\n","/** @module */\r\n\r\nimport MenuItem from './MenuItem.js'\r\n\r\n/**\r\n * Make a menu.\r\n * @param {Changes} changes\r\n */\r\nexport default function Menu(changes) {\r\n    const self = this\r\n\r\n    self.divMenu = document.createElement('div')\r\n    self.addMenuItem = function (object, choice) {\r\n        const {\r\n            prop, setProp, label, options, change,\r\n        } = choice\r\n\r\n        const menuItem = new MenuItem(object, prop, setProp, label, options, change, changes)\r\n        menuItem.select()\r\n\r\n        self.divMenu.appendChild(menuItem.choose.dom)\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Sum area of voter distributions to tally the votes.\r\n * @param {Candidate[]} cans\r\n */\r\nexport default function AreaSummer(cans) {\r\n    const self = this\r\n\r\n    const lines = findLines(cans)\r\n\r\n    // todo: figure out if this is really just a function rather than a class.\r\n\r\n    self.sumArea = function sumArea(voterGroup) {\r\n        // draw lines across shape of voterGroup\r\n\r\n        const n = lines.length\r\n        const area = Array(n)\r\n        for (let i = 0; i < n; i++) {\r\n            const lineSet = lines[i]\r\n            // return area for each candidate\r\n            area[i] = sumCircle(voterGroup, lineSet)\r\n        }\r\n        return area\r\n    }\r\n}\r\n\r\nfunction findLines(cans) {\r\n    // find all lines\r\n    const n = cans.length\r\n    const lines = new Array(n) // each candidate has a set of lines for themselves\r\n    for (let i = 0; i < n; i++) {\r\n        lines[i] = []\r\n        for (let k = 0; k < n; k++) {\r\n            // skip sames\r\n            if (i === k) continue\r\n            // find equation for a line\r\n            const c1 = cans[i]\r\n            const c2 = cans[k]\r\n            // lines[i][k] = equidistantLine(c1,c2) // problem when i === k\r\n            lines[i].push(equidistantLine(c1, c2))\r\n        }\r\n    }\r\n\r\n    return lines\r\n}\r\n\r\nexport function testEquidistantLine(eq, assert) {\r\n    // Takes an assertion function.\r\n    // Returns a test function.\r\n\r\n    return [{\r\n        label: 'Finds line equation equidistant from two points.',\r\n        test: () => {\r\n            const m = equidistantLine({ x: 0, y: 0 }, { x: 1, y: 1 })\r\n            const e = { A: { x: 1, y: 1 }, b: 1 }\r\n            eq(e.A.x / e.b, m.A.x / m.b)\r\n            eq(e.A.y / e.b, m.A.y / m.b)\r\n        },\r\n    }, {\r\n        label: 'The first point satisfies Ac < b. A[0,0] < b. ',\r\n        test: () => {\r\n            const m = equidistantLine({ x: 0, y: 0 }, { x: 1, y: 1 })\r\n            assert(m.b > 0)\r\n        },\r\n    },\r\n    ]\r\n}\r\n\r\nfunction equidistantLine(c1, c2) {\r\n    // Ac < b\r\n    // this is the condition that x counts for a candidate.\r\n\r\n    // line equidistant from two points\r\n    // https://math.stackexchange.com/a/771773\r\n\r\n    // difference between points\r\n    const dx = c2.x - c1.x\r\n    const dy = c2.y - c1.y\r\n\r\n    // midpoint between points\r\n    const mx = (c1.x + c2.x) * 0.5\r\n    const my = (c1.y + c2.y) * 0.5\r\n\r\n    // equation for line\r\n    // (y-my) / (x-mx) = - dx / dy\r\n    // implies y * dy - my * dy = - x * dx + mx * dx\r\n    // implies dx * x + dy * y = mx * dx + my * dy\r\n    // rename to A = [dx;dy]\r\n    //           b = mx * dx + my * dy\r\n    const A = { x: dx, y: dy }\r\n    const b = mx * dx + my * dy\r\n\r\n    // is c1 or c2 closer?\r\n    // c1 is closer is equivalent to Ac < b\r\n\r\n    return { A, b }\r\n}\r\n\r\nfunction sumCircle(circle, lineSet) {\r\n    // integrate inside\r\n    //   Need a direction for \"inside\" for each line.\r\n    //   Then do a 1D consideration of what is inside.\r\n\r\n    // for each x coordinate,\r\n    const dx = 2\r\n    let sum = 0\r\n    const x1 = circle.x\r\n    const y1 = circle.y\r\n    const { r } = circle\r\n    // x only goes from x1-r to x1+r\r\n    for (let x = x1 - r; x < x1 + r; x += dx) {\r\n        // find bounds\r\n\r\n        // find equation for circle\r\n\r\n        // (y - y1)**2 + (x-x1)**2 < r**2\r\n        const diff2 = r ** 2 - (x - x1) ** 2\r\n        let half\r\n        if (diff2 > 0) {\r\n            half = Math.sqrt(diff2)\r\n        } else {\r\n            half = 0\r\n        }\r\n        let high = y1 + half\r\n        let low = y1 - half\r\n\r\n        // for each of the constraints, figure out if it is an upper or lower bound,\r\n        // then adjust the bound.\r\n        // The y coefficient tells us whether this is an upper or lower bound.\r\n        // Imagine infinite +y.\r\n        // If the y coefficient is negative, then Ac < b, and Ac = b is a lower bound.\r\n        // A.x * x + A.y * y = b\r\n        // y = (b - A.x * x) / A.y\r\n        lineSet.forEach((line) => {\r\n            const ay = line.A.y\r\n            const ax = line.A.x\r\n            const { b } = line\r\n            if (ay === 0) {\r\n                if (ax * x < b) {\r\n                    // no bounds\r\n                } else {\r\n                    low = Infinity // bounded by x\r\n                }\r\n                // not handling 0,0 case\r\n            } else {\r\n                const y2 = (b - ax * x) / ay\r\n                if (ay < 0) {\r\n                    low = Math.max(low, y2)\r\n                } else {\r\n                    high = Math.min(high, y2)\r\n                }\r\n            }\r\n        })\r\n\r\n        // count area inside lines\r\n        const dy = high - low\r\n        if (dy > 0) {\r\n            const area = dy * dx\r\n            sum += area\r\n        }\r\n    }\r\n    return sum\r\n}\r\n","/** @module */\r\n\r\nimport pluralityBallot from './pluralityBallot.js'\r\n\r\n/**\r\n * a collection of ways to cast votes\r\n */\r\n\r\nconst castVotes = { pluralityBallot }\r\n\r\nexport default castVotes\r\n","/** @module */\r\n\r\nimport AreaSummer from './AreaSummer.js'\r\n\r\n/**\r\n * Vote for one.\r\n * Voters cast votes for candidates.\r\n * There is also a separate graphical representation in VoronoiGroup.js.\r\n * @param {*} candidates - an array of objects with x and y attributes.\r\n * @param {*} voterGroups - an array of objects with x,y, and r attributes.\r\n * @returns votes, an object\r\n */\r\nexport default function pluralityBallot(candidates, voterGroups) {\r\n    const summer = new AreaSummer(candidates)\r\n\r\n    // get fraction of votes for each candidate so we can summarize results\r\n    const n = candidates.length\r\n    let tally = (new Array(n)).fill(0)\r\n    voterGroups.forEach((voterGroup) => {\r\n        const area = summer.sumArea(voterGroup)\r\n        tally = tally.map((value, index) => value + area[index])\r\n    })\r\n    const total = tally.reduce((p, c) => p + c)\r\n    const tallyFractions = tally.map((x) => x / total)\r\n    const votes = { tallyFractions }\r\n    return votes\r\n}\r\n","/** @module */\r\n\r\nimport plurality from './plurality.js'\r\nimport randomWinner from './randomWinner.js'\r\nimport huntingtonHill from './huntingtonHill.js'\r\n\r\n/** a collection of election methods\r\n *  */\r\nconst electionMethods = { plurality, randomWinner, huntingtonHill }\r\n\r\nexport default electionMethods\r\n","/** @module */\r\n\r\n/**\r\n * the candidate with the highest tally wins\r\n * @param {Object} votes\r\n * @param {Number[]} votes.tallyFractions\r\n * @returns {results}\r\n */\r\nexport default function plurality(votes) {\r\n    const max = Math.max(...votes.tallyFractions)\r\n    const iWinner = votes.tallyFractions.indexOf(max)\r\n\r\n    const results = { iWinner }\r\n    return results\r\n}\r\n/**\r\n * @typedef {Object} results\r\n * @property {Number} iWinner - Index of winner. Indexing according to votes[].\r\n */\r\n","/** @module */\r\n\r\n/**\r\n * pick a random candidate as the winner\r\n * @param {Object} votes\r\n * @param {Number} votes.tallyFractions.length - Number of candidates.\r\n * @returns {results}\r\n */\r\nexport default function randomWinner(votes) {\r\n    const nk = votes.tallyFractions.length\r\n    const iWinner = Math.floor(Math.random() * nk)\r\n    const results = { iWinner }\r\n    return results\r\n}\r\n/**\r\n * @typedef {Object} results\r\n * @property {Number} iWinner - Index of winner. Indexing according to votes[].\r\n */\r\n","/** @module */\r\n\r\n/**\r\n * Run the Huntington-Hill method of apportionment and return an allocation of seats.\r\n * @param {Object} votes\r\n * @param {number[]} votes.tallyFractions - tallies for each party as a fraction of 1.\r\n * @param {Object} electionMethodOptions\r\n * @param {number} electionMethodOptions.seats - The number of seats to fill.\r\n * @param {number} electionMethodOptions.threshold - The minimum fraction of voters\r\n * that a party needs to be eligible for a seat.\r\n * @returns {{allocation:number[]}} - results, with property allocation.\r\n * Allocation is an array of integers that say how many representatives each party gets.\r\n */\r\n\r\nexport default function huntingtonHill(votes, electionMethodOptions) {\r\n    const { seats, threshold } = electionMethodOptions\r\n\r\n    const populations = votes.tallyFractions.map(\r\n        (p) => ((p < threshold) ? 0 : p),\r\n    )\r\n\r\n    const nparties = populations.length\r\n\r\n    // When the threshold is 0, we have to give each party a seat.\r\n    if (threshold === 0 && nparties > seats) {\r\n        // sort parties by population\r\n        // sort decreasing\r\n        const populationsSorted = [...populations].sort(\r\n            (a, b) => b - a,\r\n        )\r\n        const minPopulation = populationsSorted[seats - 1]\r\n        const pops2 = votes.tallyFractions\r\n\r\n        // todo: consider ties\r\n        const allocation = pops2.map(\r\n            (p) => p >= minPopulation,\r\n        )\r\n        return allocation\r\n    }\r\n\r\n    // make a list of break points / divisors, independent of vote totals\r\n    const divisorPattern = Array(nparties).fill().map(\r\n        (_, i) => Math.sqrt((i) * (i + 1)),\r\n    )\r\n\r\n    // Scale the divisor pattern for each party.\r\n    // Call them signposts, like Balinski and Young.\r\n    // Ref: Balinski and Young 1982, pages 60-66, Chapter 7, Overview of Methods.\r\n    // Really, these are the divisors for each party.\r\n    // They are also a ratio of the representatives to the population\r\n    // except that the divisorPattern is used to substitute a slightly different number\r\n    // than the number of respresentatives.\r\n    const signposts = populations.map(\r\n        (p) => (p === 0 ? [] : divisorPattern.map((d) => d / p)),\r\n    ).flat()\r\n\r\n    // find last signpost to fill all seats\r\n    // sort increasing\r\n    const sortedSignposts = signposts.flat().sort(\r\n        (a, b) => a - b,\r\n    )\r\n\r\n    const lastSignpost = sortedSignposts[seats - 1]\r\n\r\n    // In the jargon:\r\n    //   Divide by populations by the divisors to get the quotients.\r\n    // Or, more clearly:\r\n    //   Count how many signposts each party has passed.\r\n\r\n    // lastSignpost = d/p\r\n    // d = p * lastSignpost\r\n    // sqrt(i*(i+1)) = d\r\n    // i=0 is one seat\r\n    // i**2 + i = d**2\r\n    // i = -b + sqrt(b-4ac) / 2a\r\n    // a = 1, b = 1, c = -d**2\r\n    // i = (-1 + sqrt(1+4d**2) ) / 2\r\n    const quotients = populations.map(\r\n        (p) => (-1 + Math.sqrt(1 + 4 * (p * lastSignpost) ** 2)) * 0.5,\r\n    )\r\n    const allocation = quotients.map(\r\n        (p) => Math.floor(p) + 1,\r\n    )\r\n\r\n    // Todo: consider if there is a tie.\r\n    // Right now, we give extra seats to all the tied parties if there is a tie.\r\n\r\n    const results = { allocation }\r\n    return results\r\n}\r\n","/** @module */\r\n\r\nimport electionMethods from '../electionMethods/electionMethods.js'\r\n\r\n/**\r\n * Store settings and functions that deal with the election method.\r\n * @param {Candidate[]} candidates\r\n * @param {Menu} menu\r\n */\r\nexport default function ElectionMethod(candidates, menu) {\r\n    const self = this\r\n\r\n    self.run = (votes) => {\r\n        // why have two different kinds of results?\r\n        // methodResults, the smaller one,\r\n        //   is in the context of the election method,\r\n        //   which has tallies go in and analysis come out\r\n        // electionResults, the larger one,\r\n        //   is in the context of candidate objects and voter objects.\r\n        let electionResults\r\n        if (self.checkElectionType() === 'allocation') {\r\n            const electionMethodOptions = { seats: 5, threshold: 0.2 }\r\n            const methodResults = electionMethods[self.electionMethod](votes, electionMethodOptions)\r\n            const { allocation } = methodResults\r\n            electionResults = { allocation, candidates }\r\n        } else {\r\n            const methodResults = electionMethods[self.electionMethod](votes)\r\n            const { iWinner } = methodResults\r\n            const winner = candidates[iWinner]\r\n            electionResults = { iWinner, winner }\r\n        }\r\n        return electionResults\r\n    }\r\n\r\n    // -- Menu --\r\n\r\n    // a list of election methods\r\n    self.electionMethodList = [\r\n        { name: 'Huntington Hill', value: 'huntingtonHill', type: 'allocation' },\r\n        { name: 'Plurality', value: 'plurality', type: 'singleWinner' },\r\n        { name: 'Random Winner', value: 'randomWinner', type: 'singleWinner' },\r\n    ]\r\n\r\n    // utilities for looking up this list\r\n    self.checkElectionType = () => self.electionMethodListByFunctionName[self.electionMethod].type\r\n    self.electionMethodListByFunctionName = []\r\n    self.electionMethodList.forEach(\r\n        (x) => { self.electionMethodListByFunctionName[x.value] = x },\r\n    )\r\n\r\n    // add a menu item to switch between types of elections\r\n    self.electionMethod = 'plurality'\r\n    menu.addMenuItem(\r\n        self,\r\n        {\r\n            label: 'Election Method:',\r\n            prop: 'electionMethod',\r\n            setProp: (p) => { self.electionMethod = p },\r\n            options: self.electionMethodList,\r\n            change: ['electionMethod'],\r\n        },\r\n    )\r\n}\r\n","/** @module */\r\n\r\nimport castVotes from '../castVotes/castVotes.js'\r\nimport ElectionMethod from './ElectionMethod.js'\r\n\r\n/**\r\n * Here we are in the context of a single election with voter objects and candidate jects.\r\n * @param {Menu} menu\r\n */\r\nexport default function Election(menu) {\r\n    const self = this\r\n\r\n    const voterGroups = []\r\n    const candidates = []\r\n    self.method = new ElectionMethod(candidates, menu)\r\n\r\n    self.newVoterGroup = function (voterGroup) {\r\n        voterGroups.push(voterGroup)\r\n    }\r\n\r\n    self.newCandidate = function (can) {\r\n        candidates.push(can)\r\n    }\r\n\r\n    self.clearCandidates = function () {\r\n        candidates.splice(0, candidates.length)\r\n    }\r\n    self.clear = () => {\r\n        candidates.splice(0, candidates.length)\r\n        voterGroups.splice(0, voterGroups.length)\r\n    }\r\n\r\n    self.getCandidates = function () {\r\n        // return candidates.map(can =>  {x:can.x,y:can.y}) // todo: why doesn't this work?\r\n        return candidates\r\n    }\r\n\r\n    // -- Update --\r\n\r\n    self.runElection = function () {\r\n        // Voters cast votes for candidates.\r\n        // There is also a separate graphical representation in VoronoiGroup.js\r\n        const votes = castVotes.pluralityBallot(candidates, voterGroups)\r\n\r\n        const electionResults = self.method.run(votes)\r\n        return electionResults\r\n    }\r\n\r\n    self.updateTallies = function () {\r\n        // only update the tallies for each candidate so they can be shown\r\n\r\n        // Voters cast votes for candidates.\r\n        // There is also a separate graphical representation in VoronoiGroup.js\r\n        const votes = castVotes.pluralityBallot(candidates, voterGroups)\r\n\r\n        candidates.forEach((can, index) => {\r\n            const fraction = votes.tallyFractions[index]\r\n            can.setFraction(fraction)\r\n        })\r\n    }\r\n}\r\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","/**\r\n * The Ease class provides a collection of easing functions for use with tween.js.\r\n */\r\n var Easing = {\r\n    Linear: {\r\n        None: function (amount) {\r\n            return amount;\r\n        },\r\n    },\r\n    Quadratic: {\r\n        In: function (amount) {\r\n            return amount * amount;\r\n        },\r\n        Out: function (amount) {\r\n            return amount * (2 - amount);\r\n        },\r\n        InOut: function (amount) {\r\n            if ((amount *= 2) < 1) {\r\n                return 0.5 * amount * amount;\r\n            }\r\n            return -0.5 * (--amount * (amount - 2) - 1);\r\n        },\r\n    },\r\n    Cubic: {\r\n        In: function (amount) {\r\n            return amount * amount * amount;\r\n        },\r\n        Out: function (amount) {\r\n            return --amount * amount * amount + 1;\r\n        },\r\n        InOut: function (amount) {\r\n            if ((amount *= 2) < 1) {\r\n                return 0.5 * amount * amount * amount;\r\n            }\r\n            return 0.5 * ((amount -= 2) * amount * amount + 2);\r\n        },\r\n    },\r\n    Quartic: {\r\n        In: function (amount) {\r\n            return amount * amount * amount * amount;\r\n        },\r\n        Out: function (amount) {\r\n            return 1 - --amount * amount * amount * amount;\r\n        },\r\n        InOut: function (amount) {\r\n            if ((amount *= 2) < 1) {\r\n                return 0.5 * amount * amount * amount * amount;\r\n            }\r\n            return -0.5 * ((amount -= 2) * amount * amount * amount - 2);\r\n        },\r\n    },\r\n    Quintic: {\r\n        In: function (amount) {\r\n            return amount * amount * amount * amount * amount;\r\n        },\r\n        Out: function (amount) {\r\n            return --amount * amount * amount * amount * amount + 1;\r\n        },\r\n        InOut: function (amount) {\r\n            if ((amount *= 2) < 1) {\r\n                return 0.5 * amount * amount * amount * amount * amount;\r\n            }\r\n            return 0.5 * ((amount -= 2) * amount * amount * amount * amount + 2);\r\n        },\r\n    },\r\n    Sinusoidal: {\r\n        In: function (amount) {\r\n            return 1 - Math.cos((amount * Math.PI) / 2);\r\n        },\r\n        Out: function (amount) {\r\n            return Math.sin((amount * Math.PI) / 2);\r\n        },\r\n        InOut: function (amount) {\r\n            return 0.5 * (1 - Math.cos(Math.PI * amount));\r\n        },\r\n    },\r\n    Exponential: {\r\n        In: function (amount) {\r\n            return amount === 0 ? 0 : Math.pow(1024, amount - 1);\r\n        },\r\n        Out: function (amount) {\r\n            return amount === 1 ? 1 : 1 - Math.pow(2, -10 * amount);\r\n        },\r\n        InOut: function (amount) {\r\n            if (amount === 0) {\r\n                return 0;\r\n            }\r\n            if (amount === 1) {\r\n                return 1;\r\n            }\r\n            if ((amount *= 2) < 1) {\r\n                return 0.5 * Math.pow(1024, amount - 1);\r\n            }\r\n            return 0.5 * (-Math.pow(2, -10 * (amount - 1)) + 2);\r\n        },\r\n    },\r\n    Circular: {\r\n        In: function (amount) {\r\n            return 1 - Math.sqrt(1 - amount * amount);\r\n        },\r\n        Out: function (amount) {\r\n            return Math.sqrt(1 - --amount * amount);\r\n        },\r\n        InOut: function (amount) {\r\n            if ((amount *= 2) < 1) {\r\n                return -0.5 * (Math.sqrt(1 - amount * amount) - 1);\r\n            }\r\n            return 0.5 * (Math.sqrt(1 - (amount -= 2) * amount) + 1);\r\n        },\r\n    },\r\n    Elastic: {\r\n        In: function (amount) {\r\n            if (amount === 0) {\r\n                return 0;\r\n            }\r\n            if (amount === 1) {\r\n                return 1;\r\n            }\r\n            return -Math.pow(2, 10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI);\r\n        },\r\n        Out: function (amount) {\r\n            if (amount === 0) {\r\n                return 0;\r\n            }\r\n            if (amount === 1) {\r\n                return 1;\r\n            }\r\n            return Math.pow(2, -10 * amount) * Math.sin((amount - 0.1) * 5 * Math.PI) + 1;\r\n        },\r\n        InOut: function (amount) {\r\n            if (amount === 0) {\r\n                return 0;\r\n            }\r\n            if (amount === 1) {\r\n                return 1;\r\n            }\r\n            amount *= 2;\r\n            if (amount < 1) {\r\n                return -0.5 * Math.pow(2, 10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI);\r\n            }\r\n            return 0.5 * Math.pow(2, -10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI) + 1;\r\n        },\r\n    },\r\n    Back: {\r\n        In: function (amount) {\r\n            var s = 1.70158;\r\n            return amount * amount * ((s + 1) * amount - s);\r\n        },\r\n        Out: function (amount) {\r\n            var s = 1.70158;\r\n            return --amount * amount * ((s + 1) * amount + s) + 1;\r\n        },\r\n        InOut: function (amount) {\r\n            var s = 1.70158 * 1.525;\r\n            if ((amount *= 2) < 1) {\r\n                return 0.5 * (amount * amount * ((s + 1) * amount - s));\r\n            }\r\n            return 0.5 * ((amount -= 2) * amount * ((s + 1) * amount + s) + 2);\r\n        },\r\n    },\r\n    Bounce: {\r\n        In: function (amount) {\r\n            return 1 - Easing.Bounce.Out(1 - amount);\r\n        },\r\n        Out: function (amount) {\r\n            if (amount < 1 / 2.75) {\r\n                return 7.5625 * amount * amount;\r\n            }\r\n            else if (amount < 2 / 2.75) {\r\n                return 7.5625 * (amount -= 1.5 / 2.75) * amount + 0.75;\r\n            }\r\n            else if (amount < 2.5 / 2.75) {\r\n                return 7.5625 * (amount -= 2.25 / 2.75) * amount + 0.9375;\r\n            }\r\n            else {\r\n                return 7.5625 * (amount -= 2.625 / 2.75) * amount + 0.984375;\r\n            }\r\n        },\r\n        InOut: function (amount) {\r\n            if (amount < 0.5) {\r\n                return Easing.Bounce.In(amount * 2) * 0.5;\r\n            }\r\n            return Easing.Bounce.Out(amount * 2 - 1) * 0.5 + 0.5;\r\n        },\r\n    },\r\n};\r\n\r\nvar now;\r\n// Include a performance.now polyfill.\r\n// In node.js, use process.hrtime.\r\n// eslint-disable-next-line\r\n// @ts-ignore\r\nif (typeof self === 'undefined' && typeof process !== 'undefined' && process.hrtime) {\r\n    now = function () {\r\n        // eslint-disable-next-line\r\n        // @ts-ignore\r\n        var time = process.hrtime();\r\n        // Convert [seconds, nanoseconds] to milliseconds.\r\n        return time[0] * 1000 + time[1] / 1000000;\r\n    };\r\n}\r\n// In a browser, use self.performance.now if it is available.\r\nelse if (typeof self !== 'undefined' && self.performance !== undefined && self.performance.now !== undefined) {\r\n    // This must be bound, because directly assigning this function\r\n    // leads to an invocation exception in Chrome.\r\n    now = self.performance.now.bind(self.performance);\r\n}\r\n// Use Date.now if it is available.\r\nelse if (Date.now !== undefined) {\r\n    now = Date.now;\r\n}\r\n// Otherwise, use 'new Date().getTime()'.\r\nelse {\r\n    now = function () {\r\n        return new Date().getTime();\r\n    };\r\n}\r\nvar now$1 = now;\r\n\r\n/**\r\n * Controlling groups of tweens\r\n *\r\n * Using the TWEEN singleton to manage your tweens can cause issues in large apps with many components.\r\n * In these cases, you may want to create your own smaller groups of tween\r\n */\r\nvar Group = /** @class */ (function () {\r\n    function Group() {\r\n        this._tweens = {};\r\n        this._tweensAddedDuringUpdate = {};\r\n    }\r\n    Group.prototype.getAll = function () {\r\n        var _this = this;\r\n        return Object.keys(this._tweens).map(function (tweenId) {\r\n            return _this._tweens[tweenId];\r\n        });\r\n    };\r\n    Group.prototype.removeAll = function () {\r\n        this._tweens = {};\r\n    };\r\n    Group.prototype.add = function (tween) {\r\n        this._tweens[tween.getId()] = tween;\r\n        this._tweensAddedDuringUpdate[tween.getId()] = tween;\r\n    };\r\n    Group.prototype.remove = function (tween) {\r\n        delete this._tweens[tween.getId()];\r\n        delete this._tweensAddedDuringUpdate[tween.getId()];\r\n    };\r\n    Group.prototype.update = function (time, preserve) {\r\n        if (time === void 0) { time = now$1(); }\r\n        if (preserve === void 0) { preserve = false; }\r\n        var tweenIds = Object.keys(this._tweens);\r\n        if (tweenIds.length === 0) {\r\n            return false;\r\n        }\r\n        // Tweens are updated in \"batches\". If you add a new tween during an\r\n        // update, then the new tween will be updated in the next batch.\r\n        // If you remove a tween during an update, it may or may not be updated.\r\n        // However, if the removed tween was added during the current batch,\r\n        // then it will not be updated.\r\n        while (tweenIds.length > 0) {\r\n            this._tweensAddedDuringUpdate = {};\r\n            for (var i = 0; i < tweenIds.length; i++) {\r\n                var tween = this._tweens[tweenIds[i]];\r\n                var autoStart = !preserve;\r\n                if (tween && tween.update(time, autoStart) === false && !preserve) {\r\n                    delete this._tweens[tweenIds[i]];\r\n                }\r\n            }\r\n            tweenIds = Object.keys(this._tweensAddedDuringUpdate);\r\n        }\r\n        return true;\r\n    };\r\n    return Group;\r\n}());\r\n\r\n/**\r\n *\r\n */\r\nvar Interpolation = {\r\n    Linear: function (v, k) {\r\n        var m = v.length - 1;\r\n        var f = m * k;\r\n        var i = Math.floor(f);\r\n        var fn = Interpolation.Utils.Linear;\r\n        if (k < 0) {\r\n            return fn(v[0], v[1], f);\r\n        }\r\n        if (k > 1) {\r\n            return fn(v[m], v[m - 1], m - f);\r\n        }\r\n        return fn(v[i], v[i + 1 > m ? m : i + 1], f - i);\r\n    },\r\n    Bezier: function (v, k) {\r\n        var b = 0;\r\n        var n = v.length - 1;\r\n        var pw = Math.pow;\r\n        var bn = Interpolation.Utils.Bernstein;\r\n        for (var i = 0; i <= n; i++) {\r\n            b += pw(1 - k, n - i) * pw(k, i) * v[i] * bn(n, i);\r\n        }\r\n        return b;\r\n    },\r\n    CatmullRom: function (v, k) {\r\n        var m = v.length - 1;\r\n        var f = m * k;\r\n        var i = Math.floor(f);\r\n        var fn = Interpolation.Utils.CatmullRom;\r\n        if (v[0] === v[m]) {\r\n            if (k < 0) {\r\n                i = Math.floor((f = m * (1 + k)));\r\n            }\r\n            return fn(v[(i - 1 + m) % m], v[i], v[(i + 1) % m], v[(i + 2) % m], f - i);\r\n        }\r\n        else {\r\n            if (k < 0) {\r\n                return v[0] - (fn(v[0], v[0], v[1], v[1], -f) - v[0]);\r\n            }\r\n            if (k > 1) {\r\n                return v[m] - (fn(v[m], v[m], v[m - 1], v[m - 1], f - m) - v[m]);\r\n            }\r\n            return fn(v[i ? i - 1 : 0], v[i], v[m < i + 1 ? m : i + 1], v[m < i + 2 ? m : i + 2], f - i);\r\n        }\r\n    },\r\n    Utils: {\r\n        Linear: function (p0, p1, t) {\r\n            return (p1 - p0) * t + p0;\r\n        },\r\n        Bernstein: function (n, i) {\r\n            var fc = Interpolation.Utils.Factorial;\r\n            return fc(n) / fc(i) / fc(n - i);\r\n        },\r\n        Factorial: (function () {\r\n            var a = [1];\r\n            return function (n) {\r\n                var s = 1;\r\n                if (a[n]) {\r\n                    return a[n];\r\n                }\r\n                for (var i = n; i > 1; i--) {\r\n                    s *= i;\r\n                }\r\n                a[n] = s;\r\n                return s;\r\n            };\r\n        })(),\r\n        CatmullRom: function (p0, p1, p2, p3, t) {\r\n            var v0 = (p2 - p0) * 0.5;\r\n            var v1 = (p3 - p1) * 0.5;\r\n            var t2 = t * t;\r\n            var t3 = t * t2;\r\n            return (2 * p1 - 2 * p2 + v0 + v1) * t3 + (-3 * p1 + 3 * p2 - 2 * v0 - v1) * t2 + v0 * t + p1;\r\n        },\r\n    },\r\n};\r\n\r\n/**\r\n * Utils\r\n */\r\nvar Sequence = /** @class */ (function () {\r\n    function Sequence() {\r\n    }\r\n    Sequence.nextId = function () {\r\n        return Sequence._nextId++;\r\n    };\r\n    Sequence._nextId = 0;\r\n    return Sequence;\r\n}());\r\n\r\nvar mainGroup = new Group();\r\n\r\n/**\r\n * Tween.js - Licensed under the MIT license\r\n * https://github.com/tweenjs/tween.js\r\n * ----------------------------------------------\r\n *\r\n * See https://github.com/tweenjs/tween.js/graphs/contributors for the full list of contributors.\r\n * Thank you all, you're awesome!\r\n */\r\nvar Tween = /** @class */ (function () {\r\n    function Tween(_object, _group) {\r\n        if (_group === void 0) { _group = mainGroup; }\r\n        this._object = _object;\r\n        this._group = _group;\r\n        this._isPaused = false;\r\n        this._pauseStart = 0;\r\n        this._valuesStart = {};\r\n        this._valuesEnd = {};\r\n        this._valuesStartRepeat = {};\r\n        this._duration = 1000;\r\n        this._initialRepeat = 0;\r\n        this._repeat = 0;\r\n        this._yoyo = false;\r\n        this._isPlaying = false;\r\n        this._reversed = false;\r\n        this._delayTime = 0;\r\n        this._startTime = 0;\r\n        this._easingFunction = Easing.Linear.None;\r\n        this._interpolationFunction = Interpolation.Linear;\r\n        this._chainedTweens = [];\r\n        this._onStartCallbackFired = false;\r\n        this._id = Sequence.nextId();\r\n        this._isChainStopped = false;\r\n        this._goToEnd = false;\r\n    }\r\n    Tween.prototype.getId = function () {\r\n        return this._id;\r\n    };\r\n    Tween.prototype.isPlaying = function () {\r\n        return this._isPlaying;\r\n    };\r\n    Tween.prototype.isPaused = function () {\r\n        return this._isPaused;\r\n    };\r\n    Tween.prototype.to = function (properties, duration) {\r\n        // TODO? restore this, then update the 07_dynamic_to example to set fox\r\n        // tween's to on each update. That way the behavior is opt-in (there's\r\n        // currently no opt-out).\r\n        // for (const prop in properties) this._valuesEnd[prop] = properties[prop]\r\n        this._valuesEnd = Object.create(properties);\r\n        if (duration !== undefined) {\r\n            this._duration = duration;\r\n        }\r\n        return this;\r\n    };\r\n    Tween.prototype.duration = function (d) {\r\n        this._duration = d;\r\n        return this;\r\n    };\r\n    Tween.prototype.start = function (time) {\r\n        if (this._isPlaying) {\r\n            return this;\r\n        }\r\n        // eslint-disable-next-line\r\n        this._group && this._group.add(this);\r\n        this._repeat = this._initialRepeat;\r\n        if (this._reversed) {\r\n            // If we were reversed (f.e. using the yoyo feature) then we need to\r\n            // flip the tween direction back to forward.\r\n            this._reversed = false;\r\n            for (var property in this._valuesStartRepeat) {\r\n                this._swapEndStartRepeatValues(property);\r\n                this._valuesStart[property] = this._valuesStartRepeat[property];\r\n            }\r\n        }\r\n        this._isPlaying = true;\r\n        this._isPaused = false;\r\n        this._onStartCallbackFired = false;\r\n        this._isChainStopped = false;\r\n        this._startTime = time !== undefined ? (typeof time === 'string' ? now$1() + parseFloat(time) : time) : now$1();\r\n        this._startTime += this._delayTime;\r\n        this._setupProperties(this._object, this._valuesStart, this._valuesEnd, this._valuesStartRepeat);\r\n        return this;\r\n    };\r\n    Tween.prototype._setupProperties = function (_object, _valuesStart, _valuesEnd, _valuesStartRepeat) {\r\n        for (var property in _valuesEnd) {\r\n            var startValue = _object[property];\r\n            var startValueIsArray = Array.isArray(startValue);\r\n            var propType = startValueIsArray ? 'array' : typeof startValue;\r\n            var isInterpolationList = !startValueIsArray && Array.isArray(_valuesEnd[property]);\r\n            // If `to()` specifies a property that doesn't exist in the source object,\r\n            // we should not set that property in the object\r\n            if (propType === 'undefined' || propType === 'function') {\r\n                continue;\r\n            }\r\n            // Check if an Array was provided as property value\r\n            if (isInterpolationList) {\r\n                var endValues = _valuesEnd[property];\r\n                if (endValues.length === 0) {\r\n                    continue;\r\n                }\r\n                // handle an array of relative values\r\n                endValues = endValues.map(this._handleRelativeValue.bind(this, startValue));\r\n                // Create a local copy of the Array with the start value at the front\r\n                _valuesEnd[property] = [startValue].concat(endValues);\r\n            }\r\n            // handle the deepness of the values\r\n            if ((propType === 'object' || startValueIsArray) && startValue && !isInterpolationList) {\r\n                _valuesStart[property] = startValueIsArray ? [] : {};\r\n                // eslint-disable-next-line\r\n                for (var prop in startValue) {\r\n                    // eslint-disable-next-line\r\n                    // @ts-ignore FIXME?\r\n                    _valuesStart[property][prop] = startValue[prop];\r\n                }\r\n                _valuesStartRepeat[property] = startValueIsArray ? [] : {}; // TODO? repeat nested values? And yoyo? And array values?\r\n                // eslint-disable-next-line\r\n                // @ts-ignore FIXME?\r\n                this._setupProperties(startValue, _valuesStart[property], _valuesEnd[property], _valuesStartRepeat[property]);\r\n            }\r\n            else {\r\n                // Save the starting value, but only once.\r\n                if (typeof _valuesStart[property] === 'undefined') {\r\n                    _valuesStart[property] = startValue;\r\n                }\r\n                if (!startValueIsArray) {\r\n                    // eslint-disable-next-line\r\n                    // @ts-ignore FIXME?\r\n                    _valuesStart[property] *= 1.0; // Ensures we're using numbers, not strings\r\n                }\r\n                if (isInterpolationList) {\r\n                    // eslint-disable-next-line\r\n                    // @ts-ignore FIXME?\r\n                    _valuesStartRepeat[property] = _valuesEnd[property].slice().reverse();\r\n                }\r\n                else {\r\n                    _valuesStartRepeat[property] = _valuesStart[property] || 0;\r\n                }\r\n            }\r\n        }\r\n    };\r\n    Tween.prototype.stop = function () {\r\n        if (!this._isChainStopped) {\r\n            this._isChainStopped = true;\r\n            this.stopChainedTweens();\r\n        }\r\n        if (!this._isPlaying) {\r\n            return this;\r\n        }\r\n        // eslint-disable-next-line\r\n        this._group && this._group.remove(this);\r\n        this._isPlaying = false;\r\n        this._isPaused = false;\r\n        if (this._onStopCallback) {\r\n            this._onStopCallback(this._object);\r\n        }\r\n        return this;\r\n    };\r\n    Tween.prototype.end = function () {\r\n        this._goToEnd = true;\r\n        this.update(Infinity);\r\n        return this;\r\n    };\r\n    Tween.prototype.pause = function (time) {\r\n        if (time === void 0) { time = now$1(); }\r\n        if (this._isPaused || !this._isPlaying) {\r\n            return this;\r\n        }\r\n        this._isPaused = true;\r\n        this._pauseStart = time;\r\n        // eslint-disable-next-line\r\n        this._group && this._group.remove(this);\r\n        return this;\r\n    };\r\n    Tween.prototype.resume = function (time) {\r\n        if (time === void 0) { time = now$1(); }\r\n        if (!this._isPaused || !this._isPlaying) {\r\n            return this;\r\n        }\r\n        this._isPaused = false;\r\n        this._startTime += time - this._pauseStart;\r\n        this._pauseStart = 0;\r\n        // eslint-disable-next-line\r\n        this._group && this._group.add(this);\r\n        return this;\r\n    };\r\n    Tween.prototype.stopChainedTweens = function () {\r\n        for (var i = 0, numChainedTweens = this._chainedTweens.length; i < numChainedTweens; i++) {\r\n            this._chainedTweens[i].stop();\r\n        }\r\n        return this;\r\n    };\r\n    Tween.prototype.group = function (group) {\r\n        this._group = group;\r\n        return this;\r\n    };\r\n    Tween.prototype.delay = function (amount) {\r\n        this._delayTime = amount;\r\n        return this;\r\n    };\r\n    Tween.prototype.repeat = function (times) {\r\n        this._initialRepeat = times;\r\n        this._repeat = times;\r\n        return this;\r\n    };\r\n    Tween.prototype.repeatDelay = function (amount) {\r\n        this._repeatDelayTime = amount;\r\n        return this;\r\n    };\r\n    Tween.prototype.yoyo = function (yoyo) {\r\n        this._yoyo = yoyo;\r\n        return this;\r\n    };\r\n    Tween.prototype.easing = function (easingFunction) {\r\n        this._easingFunction = easingFunction;\r\n        return this;\r\n    };\r\n    Tween.prototype.interpolation = function (interpolationFunction) {\r\n        this._interpolationFunction = interpolationFunction;\r\n        return this;\r\n    };\r\n    Tween.prototype.chain = function () {\r\n        var tweens = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            tweens[_i] = arguments[_i];\r\n        }\r\n        this._chainedTweens = tweens;\r\n        return this;\r\n    };\r\n    Tween.prototype.onStart = function (callback) {\r\n        this._onStartCallback = callback;\r\n        return this;\r\n    };\r\n    Tween.prototype.onUpdate = function (callback) {\r\n        this._onUpdateCallback = callback;\r\n        return this;\r\n    };\r\n    Tween.prototype.onRepeat = function (callback) {\r\n        this._onRepeatCallback = callback;\r\n        return this;\r\n    };\r\n    Tween.prototype.onComplete = function (callback) {\r\n        this._onCompleteCallback = callback;\r\n        return this;\r\n    };\r\n    Tween.prototype.onStop = function (callback) {\r\n        this._onStopCallback = callback;\r\n        return this;\r\n    };\r\n    /**\r\n     * @returns true if the tween is still playing after the update, false\r\n     * otherwise (calling update on a paused tween still returns true because\r\n     * it is still playing, just paused).\r\n     */\r\n    Tween.prototype.update = function (time, autoStart) {\r\n        if (time === void 0) { time = now$1(); }\r\n        if (autoStart === void 0) { autoStart = true; }\r\n        if (this._isPaused)\r\n            return true;\r\n        var property;\r\n        var elapsed;\r\n        var endTime = this._startTime + this._duration;\r\n        if (!this._goToEnd && !this._isPlaying) {\r\n            if (time > endTime)\r\n                return false;\r\n            if (autoStart)\r\n                this.start(time);\r\n        }\r\n        this._goToEnd = false;\r\n        if (time < this._startTime) {\r\n            return true;\r\n        }\r\n        if (this._onStartCallbackFired === false) {\r\n            if (this._onStartCallback) {\r\n                this._onStartCallback(this._object);\r\n            }\r\n            this._onStartCallbackFired = true;\r\n        }\r\n        elapsed = (time - this._startTime) / this._duration;\r\n        elapsed = this._duration === 0 || elapsed > 1 ? 1 : elapsed;\r\n        var value = this._easingFunction(elapsed);\r\n        // properties transformations\r\n        this._updateProperties(this._object, this._valuesStart, this._valuesEnd, value);\r\n        if (this._onUpdateCallback) {\r\n            this._onUpdateCallback(this._object, elapsed);\r\n        }\r\n        if (elapsed === 1) {\r\n            if (this._repeat > 0) {\r\n                if (isFinite(this._repeat)) {\r\n                    this._repeat--;\r\n                }\r\n                // Reassign starting values, restart by making startTime = now\r\n                for (property in this._valuesStartRepeat) {\r\n                    if (!this._yoyo && typeof this._valuesEnd[property] === 'string') {\r\n                        this._valuesStartRepeat[property] =\r\n                            // eslint-disable-next-line\r\n                            // @ts-ignore FIXME?\r\n                            this._valuesStartRepeat[property] + parseFloat(this._valuesEnd[property]);\r\n                    }\r\n                    if (this._yoyo) {\r\n                        this._swapEndStartRepeatValues(property);\r\n                    }\r\n                    this._valuesStart[property] = this._valuesStartRepeat[property];\r\n                }\r\n                if (this._yoyo) {\r\n                    this._reversed = !this._reversed;\r\n                }\r\n                if (this._repeatDelayTime !== undefined) {\r\n                    this._startTime = time + this._repeatDelayTime;\r\n                }\r\n                else {\r\n                    this._startTime = time + this._delayTime;\r\n                }\r\n                if (this._onRepeatCallback) {\r\n                    this._onRepeatCallback(this._object);\r\n                }\r\n                return true;\r\n            }\r\n            else {\r\n                if (this._onCompleteCallback) {\r\n                    this._onCompleteCallback(this._object);\r\n                }\r\n                for (var i = 0, numChainedTweens = this._chainedTweens.length; i < numChainedTweens; i++) {\r\n                    // Make the chained tweens start exactly at the time they should,\r\n                    // even if the `update()` method was called way past the duration of the tween\r\n                    this._chainedTweens[i].start(this._startTime + this._duration);\r\n                }\r\n                this._isPlaying = false;\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    };\r\n    Tween.prototype._updateProperties = function (_object, _valuesStart, _valuesEnd, value) {\r\n        for (var property in _valuesEnd) {\r\n            // Don't update properties that do not exist in the source object\r\n            if (_valuesStart[property] === undefined) {\r\n                continue;\r\n            }\r\n            var start = _valuesStart[property] || 0;\r\n            var end = _valuesEnd[property];\r\n            var startIsArray = Array.isArray(_object[property]);\r\n            var endIsArray = Array.isArray(end);\r\n            var isInterpolationList = !startIsArray && endIsArray;\r\n            if (isInterpolationList) {\r\n                _object[property] = this._interpolationFunction(end, value);\r\n            }\r\n            else if (typeof end === 'object' && end) {\r\n                // eslint-disable-next-line\r\n                // @ts-ignore FIXME?\r\n                this._updateProperties(_object[property], start, end, value);\r\n            }\r\n            else {\r\n                // Parses relative end values with start as base (e.g.: +10, -3)\r\n                end = this._handleRelativeValue(start, end);\r\n                // Protect against non numeric properties.\r\n                if (typeof end === 'number') {\r\n                    // eslint-disable-next-line\r\n                    // @ts-ignore FIXME?\r\n                    _object[property] = start + (end - start) * value;\r\n                }\r\n            }\r\n        }\r\n    };\r\n    Tween.prototype._handleRelativeValue = function (start, end) {\r\n        if (typeof end !== 'string') {\r\n            return end;\r\n        }\r\n        if (end.charAt(0) === '+' || end.charAt(0) === '-') {\r\n            return start + parseFloat(end);\r\n        }\r\n        else {\r\n            return parseFloat(end);\r\n        }\r\n    };\r\n    Tween.prototype._swapEndStartRepeatValues = function (property) {\r\n        var tmp = this._valuesStartRepeat[property];\r\n        var endValue = this._valuesEnd[property];\r\n        if (typeof endValue === 'string') {\r\n            this._valuesStartRepeat[property] = this._valuesStartRepeat[property] + parseFloat(endValue);\r\n        }\r\n        else {\r\n            this._valuesStartRepeat[property] = this._valuesEnd[property];\r\n        }\r\n        this._valuesEnd[property] = tmp;\r\n    };\r\n    return Tween;\r\n}());\r\n\r\nvar VERSION = '18.6.4';\r\n\r\n/**\r\n * Tween.js - Licensed under the MIT license\r\n * https://github.com/tweenjs/tween.js\r\n * ----------------------------------------------\r\n *\r\n * See https://github.com/tweenjs/tween.js/graphs/contributors for the full list of contributors.\r\n * Thank you all, you're awesome!\r\n */\r\nvar nextId = Sequence.nextId;\r\n/**\r\n * Controlling groups of tweens\r\n *\r\n * Using the TWEEN singleton to manage your tweens can cause issues in large apps with many components.\r\n * In these cases, you may want to create your own smaller groups of tweens.\r\n */\r\nvar TWEEN = mainGroup;\r\n// This is the best way to export things in a way that's compatible with both ES\r\n// Modules and CommonJS, without build hacks, and so as not to break the\r\n// existing API.\r\n// https://github.com/rollup/rollup/issues/1961#issuecomment-423037881\r\nvar getAll = TWEEN.getAll.bind(TWEEN);\r\nvar removeAll = TWEEN.removeAll.bind(TWEEN);\r\nvar add = TWEEN.add.bind(TWEEN);\r\nvar remove = TWEEN.remove.bind(TWEEN);\r\nvar update = TWEEN.update.bind(TWEEN);\r\nvar exports = {\r\n    Easing: Easing,\r\n    Group: Group,\r\n    Interpolation: Interpolation,\r\n    now: now$1,\r\n    Sequence: Sequence,\r\n    nextId: nextId,\r\n    Tween: Tween,\r\n    VERSION: VERSION,\r\n    getAll: getAll,\r\n    removeAll: removeAll,\r\n    add: add,\r\n    remove: remove,\r\n    update: update,\r\n};\r\n\r\nexport default exports;\r\nexport { Easing, Group, Interpolation, Sequence, Tween, VERSION, add, getAll, nextId, now$1 as now, remove, removeAll, update };","/** @module */\r\n\r\nimport { Tween } from '../../../lib/tween.esm.js'\r\n\r\n/**\r\n */\r\n\r\n/**\r\n * Shows a circle at the parent object xy coordinates.\r\n * Animates the circle when picking up and dropping.\r\n * @param {(Candidate|CandidateDistribution|VoterCircle|SimVoterCircle)} parent\r\n *  - something with x and y attributes.\r\n * @param {Number} r - radius of graphic\r\n * @param {String} color - color code\r\n * @param {Screen} screen - something with .ctx to draw to.\r\n */\r\nexport default function CircleGraphic(parent, r, color, screen) {\r\n    const self = this\r\n\r\n    self.r = r\r\n    self.trueR = r\r\n\r\n    self.pickUp = function () {\r\n        self.tween = new Tween(self)\r\n        self.tween.to({ r: self.trueR * 2 }, 100)\r\n        self.tween.start()\r\n    }\r\n    self.drop = function () {\r\n        self.tween = new Tween(self)\r\n        self.tween.to({ r: self.trueR }, 100)\r\n        self.tween.start()\r\n    }\r\n\r\n    // Graphics component\r\n    self.render = function () {\r\n        const { ctx } = screen\r\n\r\n        if (self.tween) {\r\n            self.tween.update()\r\n        }\r\n\r\n        // handle\r\n\r\n        ctx.beginPath()\r\n        ctx.fillStyle = color\r\n        ctx.arc(parent.x, parent.y, self.r, 0, 2 * Math.PI)\r\n        ctx.fill()\r\n        ctx.stroke()\r\n    }\r\n}\r\n","// https://github.com/d3/d3-delaunay v6.0.2 Copyright 2018-2021 Observable, Inc., 2021 Mapbox\r\n\r\n// Altered to make into an ES2015 module.\r\n\r\nconst epsilon$1 = 1.1102230246251565e-16;\r\nconst splitter = 134217729;\r\nconst resulterrbound = (3 + 8 * epsilon$1) * epsilon$1;\r\n\r\n// fast_expansion_sum_zeroelim routine from oritinal code\r\nfunction sum(elen, e, flen, f, h) {\r\n    let Q, Qnew, hh, bvirt;\r\n    let enow = e[0];\r\n    let fnow = f[0];\r\n    let eindex = 0;\r\n    let findex = 0;\r\n    if ((fnow > enow) === (fnow > -enow)) {\r\n        Q = enow;\r\n        enow = e[++eindex];\r\n    } else {\r\n        Q = fnow;\r\n        fnow = f[++findex];\r\n    }\r\n    let hindex = 0;\r\n    if (eindex < elen && findex < flen) {\r\n        if ((fnow > enow) === (fnow > -enow)) {\r\n            Qnew = enow + Q;\r\n            hh = Q - (Qnew - enow);\r\n            enow = e[++eindex];\r\n        } else {\r\n            Qnew = fnow + Q;\r\n            hh = Q - (Qnew - fnow);\r\n            fnow = f[++findex];\r\n        }\r\n        Q = Qnew;\r\n        if (hh !== 0) {\r\n            h[hindex++] = hh;\r\n        }\r\n        while (eindex < elen && findex < flen) {\r\n            if ((fnow > enow) === (fnow > -enow)) {\r\n                Qnew = Q + enow;\r\n                bvirt = Qnew - Q;\r\n                hh = Q - (Qnew - bvirt) + (enow - bvirt);\r\n                enow = e[++eindex];\r\n            } else {\r\n                Qnew = Q + fnow;\r\n                bvirt = Qnew - Q;\r\n                hh = Q - (Qnew - bvirt) + (fnow - bvirt);\r\n                fnow = f[++findex];\r\n            }\r\n            Q = Qnew;\r\n            if (hh !== 0) {\r\n                h[hindex++] = hh;\r\n            }\r\n        }\r\n    }\r\n    while (eindex < elen) {\r\n        Qnew = Q + enow;\r\n        bvirt = Qnew - Q;\r\n        hh = Q - (Qnew - bvirt) + (enow - bvirt);\r\n        enow = e[++eindex];\r\n        Q = Qnew;\r\n        if (hh !== 0) {\r\n            h[hindex++] = hh;\r\n        }\r\n    }\r\n    while (findex < flen) {\r\n        Qnew = Q + fnow;\r\n        bvirt = Qnew - Q;\r\n        hh = Q - (Qnew - bvirt) + (fnow - bvirt);\r\n        fnow = f[++findex];\r\n        Q = Qnew;\r\n        if (hh !== 0) {\r\n            h[hindex++] = hh;\r\n        }\r\n    }\r\n    if (Q !== 0 || hindex === 0) {\r\n        h[hindex++] = Q;\r\n    }\r\n    return hindex;\r\n}\r\n\r\nfunction estimate(elen, e) {\r\n    let Q = e[0];\r\n    for (let i = 1; i < elen; i++) Q += e[i];\r\n    return Q;\r\n}\r\n\r\nfunction vec(n) {\r\n    return new Float64Array(n);\r\n}\r\n\r\nconst ccwerrboundA = (3 + 16 * epsilon$1) * epsilon$1;\r\nconst ccwerrboundB = (2 + 12 * epsilon$1) * epsilon$1;\r\nconst ccwerrboundC = (9 + 64 * epsilon$1) * epsilon$1 * epsilon$1;\r\n\r\nconst B = vec(4);\r\nconst C1 = vec(8);\r\nconst C2 = vec(12);\r\nconst D = vec(16);\r\nconst u = vec(4);\r\n\r\nfunction orient2dadapt(ax, ay, bx, by, cx, cy, detsum) {\r\n    let acxtail, acytail, bcxtail, bcytail;\r\n    let bvirt, c, ahi, alo, bhi, blo, _i, _j, _0, s1, s0, t1, t0, u3;\r\n\r\n    const acx = ax - cx;\r\n    const bcx = bx - cx;\r\n    const acy = ay - cy;\r\n    const bcy = by - cy;\r\n\r\n    s1 = acx * bcy;\r\n    c = splitter * acx;\r\n    ahi = c - (c - acx);\r\n    alo = acx - ahi;\r\n    c = splitter * bcy;\r\n    bhi = c - (c - bcy);\r\n    blo = bcy - bhi;\r\n    s0 = alo * blo - (s1 - ahi * bhi - alo * bhi - ahi * blo);\r\n    t1 = acy * bcx;\r\n    c = splitter * acy;\r\n    ahi = c - (c - acy);\r\n    alo = acy - ahi;\r\n    c = splitter * bcx;\r\n    bhi = c - (c - bcx);\r\n    blo = bcx - bhi;\r\n    t0 = alo * blo - (t1 - ahi * bhi - alo * bhi - ahi * blo);\r\n    _i = s0 - t0;\r\n    bvirt = s0 - _i;\r\n    B[0] = s0 - (_i + bvirt) + (bvirt - t0);\r\n    _j = s1 + _i;\r\n    bvirt = _j - s1;\r\n    _0 = s1 - (_j - bvirt) + (_i - bvirt);\r\n    _i = _0 - t1;\r\n    bvirt = _0 - _i;\r\n    B[1] = _0 - (_i + bvirt) + (bvirt - t1);\r\n    u3 = _j + _i;\r\n    bvirt = u3 - _j;\r\n    B[2] = _j - (u3 - bvirt) + (_i - bvirt);\r\n    B[3] = u3;\r\n\r\n    let det = estimate(4, B);\r\n    let errbound = ccwerrboundB * detsum;\r\n    if (det >= errbound || -det >= errbound) {\r\n        return det;\r\n    }\r\n\r\n    bvirt = ax - acx;\r\n    acxtail = ax - (acx + bvirt) + (bvirt - cx);\r\n    bvirt = bx - bcx;\r\n    bcxtail = bx - (bcx + bvirt) + (bvirt - cx);\r\n    bvirt = ay - acy;\r\n    acytail = ay - (acy + bvirt) + (bvirt - cy);\r\n    bvirt = by - bcy;\r\n    bcytail = by - (bcy + bvirt) + (bvirt - cy);\r\n\r\n    if (acxtail === 0 && acytail === 0 && bcxtail === 0 && bcytail === 0) {\r\n        return det;\r\n    }\r\n\r\n    errbound = ccwerrboundC * detsum + resulterrbound * Math.abs(det);\r\n    det += (acx * bcytail + bcy * acxtail) - (acy * bcxtail + bcx * acytail);\r\n    if (det >= errbound || -det >= errbound) return det;\r\n\r\n    s1 = acxtail * bcy;\r\n    c = splitter * acxtail;\r\n    ahi = c - (c - acxtail);\r\n    alo = acxtail - ahi;\r\n    c = splitter * bcy;\r\n    bhi = c - (c - bcy);\r\n    blo = bcy - bhi;\r\n    s0 = alo * blo - (s1 - ahi * bhi - alo * bhi - ahi * blo);\r\n    t1 = acytail * bcx;\r\n    c = splitter * acytail;\r\n    ahi = c - (c - acytail);\r\n    alo = acytail - ahi;\r\n    c = splitter * bcx;\r\n    bhi = c - (c - bcx);\r\n    blo = bcx - bhi;\r\n    t0 = alo * blo - (t1 - ahi * bhi - alo * bhi - ahi * blo);\r\n    _i = s0 - t0;\r\n    bvirt = s0 - _i;\r\n    u[0] = s0 - (_i + bvirt) + (bvirt - t0);\r\n    _j = s1 + _i;\r\n    bvirt = _j - s1;\r\n    _0 = s1 - (_j - bvirt) + (_i - bvirt);\r\n    _i = _0 - t1;\r\n    bvirt = _0 - _i;\r\n    u[1] = _0 - (_i + bvirt) + (bvirt - t1);\r\n    u3 = _j + _i;\r\n    bvirt = u3 - _j;\r\n    u[2] = _j - (u3 - bvirt) + (_i - bvirt);\r\n    u[3] = u3;\r\n    const C1len = sum(4, B, 4, u, C1);\r\n\r\n    s1 = acx * bcytail;\r\n    c = splitter * acx;\r\n    ahi = c - (c - acx);\r\n    alo = acx - ahi;\r\n    c = splitter * bcytail;\r\n    bhi = c - (c - bcytail);\r\n    blo = bcytail - bhi;\r\n    s0 = alo * blo - (s1 - ahi * bhi - alo * bhi - ahi * blo);\r\n    t1 = acy * bcxtail;\r\n    c = splitter * acy;\r\n    ahi = c - (c - acy);\r\n    alo = acy - ahi;\r\n    c = splitter * bcxtail;\r\n    bhi = c - (c - bcxtail);\r\n    blo = bcxtail - bhi;\r\n    t0 = alo * blo - (t1 - ahi * bhi - alo * bhi - ahi * blo);\r\n    _i = s0 - t0;\r\n    bvirt = s0 - _i;\r\n    u[0] = s0 - (_i + bvirt) + (bvirt - t0);\r\n    _j = s1 + _i;\r\n    bvirt = _j - s1;\r\n    _0 = s1 - (_j - bvirt) + (_i - bvirt);\r\n    _i = _0 - t1;\r\n    bvirt = _0 - _i;\r\n    u[1] = _0 - (_i + bvirt) + (bvirt - t1);\r\n    u3 = _j + _i;\r\n    bvirt = u3 - _j;\r\n    u[2] = _j - (u3 - bvirt) + (_i - bvirt);\r\n    u[3] = u3;\r\n    const C2len = sum(C1len, C1, 4, u, C2);\r\n\r\n    s1 = acxtail * bcytail;\r\n    c = splitter * acxtail;\r\n    ahi = c - (c - acxtail);\r\n    alo = acxtail - ahi;\r\n    c = splitter * bcytail;\r\n    bhi = c - (c - bcytail);\r\n    blo = bcytail - bhi;\r\n    s0 = alo * blo - (s1 - ahi * bhi - alo * bhi - ahi * blo);\r\n    t1 = acytail * bcxtail;\r\n    c = splitter * acytail;\r\n    ahi = c - (c - acytail);\r\n    alo = acytail - ahi;\r\n    c = splitter * bcxtail;\r\n    bhi = c - (c - bcxtail);\r\n    blo = bcxtail - bhi;\r\n    t0 = alo * blo - (t1 - ahi * bhi - alo * bhi - ahi * blo);\r\n    _i = s0 - t0;\r\n    bvirt = s0 - _i;\r\n    u[0] = s0 - (_i + bvirt) + (bvirt - t0);\r\n    _j = s1 + _i;\r\n    bvirt = _j - s1;\r\n    _0 = s1 - (_j - bvirt) + (_i - bvirt);\r\n    _i = _0 - t1;\r\n    bvirt = _0 - _i;\r\n    u[1] = _0 - (_i + bvirt) + (bvirt - t1);\r\n    u3 = _j + _i;\r\n    bvirt = u3 - _j;\r\n    u[2] = _j - (u3 - bvirt) + (_i - bvirt);\r\n    u[3] = u3;\r\n    const Dlen = sum(C2len, C2, 4, u, D);\r\n\r\n    return D[Dlen - 1];\r\n}\r\n\r\nfunction orient2d(ax, ay, bx, by, cx, cy) {\r\n    const detleft = (ay - cy) * (bx - cx);\r\n    const detright = (ax - cx) * (by - cy);\r\n    const det = detleft - detright;\r\n\r\n    if (detleft === 0 || detright === 0 || (detleft > 0) !== (detright > 0)) return det;\r\n\r\n    const detsum = Math.abs(detleft + detright);\r\n    if (Math.abs(det) >= ccwerrboundA * detsum) return det;\r\n\r\n    return -orient2dadapt(ax, ay, bx, by, cx, cy, detsum);\r\n}\r\n\r\nconst EPSILON = Math.pow(2, -52);\r\nconst EDGE_STACK = new Uint32Array(512);\r\n\r\nclass Delaunator {\r\n\r\n    static from(points, getX = defaultGetX, getY = defaultGetY) {\r\n        const n = points.length;\r\n        const coords = new Float64Array(n * 2);\r\n\r\n        for (let i = 0; i < n; i++) {\r\n            const p = points[i];\r\n            coords[2 * i] = getX(p);\r\n            coords[2 * i + 1] = getY(p);\r\n        }\r\n\r\n        return new Delaunator(coords);\r\n    }\r\n\r\n    constructor(coords) {\r\n        const n = coords.length >> 1;\r\n        if (n > 0 && typeof coords[0] !== 'number') throw new Error('Expected coords to contain numbers.');\r\n\r\n        this.coords = coords;\r\n\r\n        // arrays that will store the triangulation graph\r\n        const maxTriangles = Math.max(2 * n - 5, 0);\r\n        this._triangles = new Uint32Array(maxTriangles * 3);\r\n        this._halfedges = new Int32Array(maxTriangles * 3);\r\n\r\n        // temporary arrays for tracking the edges of the advancing convex hull\r\n        this._hashSize = Math.ceil(Math.sqrt(n));\r\n        this._hullPrev = new Uint32Array(n); // edge to prev edge\r\n        this._hullNext = new Uint32Array(n); // edge to next edge\r\n        this._hullTri = new Uint32Array(n); // edge to adjacent triangle\r\n        this._hullHash = new Int32Array(this._hashSize).fill(-1); // angular edge hash\r\n\r\n        // temporary arrays for sorting points\r\n        this._ids = new Uint32Array(n);\r\n        this._dists = new Float64Array(n);\r\n\r\n        this.update();\r\n    }\r\n\r\n    update() {\r\n        const {coords, _hullPrev: hullPrev, _hullNext: hullNext, _hullTri: hullTri, _hullHash: hullHash} =  this;\r\n        const n = coords.length >> 1;\r\n\r\n        // populate an array of point indices; calculate input data bbox\r\n        let minX = Infinity;\r\n        let minY = Infinity;\r\n        let maxX = -Infinity;\r\n        let maxY = -Infinity;\r\n\r\n        for (let i = 0; i < n; i++) {\r\n            const x = coords[2 * i];\r\n            const y = coords[2 * i + 1];\r\n            if (x < minX) minX = x;\r\n            if (y < minY) minY = y;\r\n            if (x > maxX) maxX = x;\r\n            if (y > maxY) maxY = y;\r\n            this._ids[i] = i;\r\n        }\r\n        const cx = (minX + maxX) / 2;\r\n        const cy = (minY + maxY) / 2;\r\n\r\n        let minDist = Infinity;\r\n        let i0, i1, i2;\r\n\r\n        // pick a seed point close to the center\r\n        for (let i = 0; i < n; i++) {\r\n            const d = dist(cx, cy, coords[2 * i], coords[2 * i + 1]);\r\n            if (d < minDist) {\r\n                i0 = i;\r\n                minDist = d;\r\n            }\r\n        }\r\n        const i0x = coords[2 * i0];\r\n        const i0y = coords[2 * i0 + 1];\r\n\r\n        minDist = Infinity;\r\n\r\n        // find the point closest to the seed\r\n        for (let i = 0; i < n; i++) {\r\n            if (i === i0) continue;\r\n            const d = dist(i0x, i0y, coords[2 * i], coords[2 * i + 1]);\r\n            if (d < minDist && d > 0) {\r\n                i1 = i;\r\n                minDist = d;\r\n            }\r\n        }\r\n        let i1x = coords[2 * i1];\r\n        let i1y = coords[2 * i1 + 1];\r\n\r\n        let minRadius = Infinity;\r\n\r\n        // find the third point which forms the smallest circumcircle with the first two\r\n        for (let i = 0; i < n; i++) {\r\n            if (i === i0 || i === i1) continue;\r\n            const r = circumradius(i0x, i0y, i1x, i1y, coords[2 * i], coords[2 * i + 1]);\r\n            if (r < minRadius) {\r\n                i2 = i;\r\n                minRadius = r;\r\n            }\r\n        }\r\n        let i2x = coords[2 * i2];\r\n        let i2y = coords[2 * i2 + 1];\r\n\r\n        if (minRadius === Infinity) {\r\n            // order collinear points by dx (or dy if all x are identical)\r\n            // and return the list as a hull\r\n            for (let i = 0; i < n; i++) {\r\n                this._dists[i] = (coords[2 * i] - coords[0]) || (coords[2 * i + 1] - coords[1]);\r\n            }\r\n            quicksort(this._ids, this._dists, 0, n - 1);\r\n            const hull = new Uint32Array(n);\r\n            let j = 0;\r\n            for (let i = 0, d0 = -Infinity; i < n; i++) {\r\n                const id = this._ids[i];\r\n                if (this._dists[id] > d0) {\r\n                    hull[j++] = id;\r\n                    d0 = this._dists[id];\r\n                }\r\n            }\r\n            this.hull = hull.subarray(0, j);\r\n            this.triangles = new Uint32Array(0);\r\n            this.halfedges = new Uint32Array(0);\r\n            return;\r\n        }\r\n\r\n        // swap the order of the seed points for counter-clockwise orientation\r\n        if (orient2d(i0x, i0y, i1x, i1y, i2x, i2y) < 0) {\r\n            const i = i1;\r\n            const x = i1x;\r\n            const y = i1y;\r\n            i1 = i2;\r\n            i1x = i2x;\r\n            i1y = i2y;\r\n            i2 = i;\r\n            i2x = x;\r\n            i2y = y;\r\n        }\r\n\r\n        const center = circumcenter(i0x, i0y, i1x, i1y, i2x, i2y);\r\n        this._cx = center.x;\r\n        this._cy = center.y;\r\n\r\n        for (let i = 0; i < n; i++) {\r\n            this._dists[i] = dist(coords[2 * i], coords[2 * i + 1], center.x, center.y);\r\n        }\r\n\r\n        // sort the points by distance from the seed triangle circumcenter\r\n        quicksort(this._ids, this._dists, 0, n - 1);\r\n\r\n        // set up the seed triangle as the starting hull\r\n        this._hullStart = i0;\r\n        let hullSize = 3;\r\n\r\n        hullNext[i0] = hullPrev[i2] = i1;\r\n        hullNext[i1] = hullPrev[i0] = i2;\r\n        hullNext[i2] = hullPrev[i1] = i0;\r\n\r\n        hullTri[i0] = 0;\r\n        hullTri[i1] = 1;\r\n        hullTri[i2] = 2;\r\n\r\n        hullHash.fill(-1);\r\n        hullHash[this._hashKey(i0x, i0y)] = i0;\r\n        hullHash[this._hashKey(i1x, i1y)] = i1;\r\n        hullHash[this._hashKey(i2x, i2y)] = i2;\r\n\r\n        this.trianglesLen = 0;\r\n        this._addTriangle(i0, i1, i2, -1, -1, -1);\r\n\r\n        for (let k = 0, xp, yp; k < this._ids.length; k++) {\r\n            const i = this._ids[k];\r\n            const x = coords[2 * i];\r\n            const y = coords[2 * i + 1];\r\n\r\n            // skip near-duplicate points\r\n            if (k > 0 && Math.abs(x - xp) <= EPSILON && Math.abs(y - yp) <= EPSILON) continue;\r\n            xp = x;\r\n            yp = y;\r\n\r\n            // skip seed triangle points\r\n            if (i === i0 || i === i1 || i === i2) continue;\r\n\r\n            // find a visible edge on the convex hull using edge hash\r\n            let start = 0;\r\n            for (let j = 0, key = this._hashKey(x, y); j < this._hashSize; j++) {\r\n                start = hullHash[(key + j) % this._hashSize];\r\n                if (start !== -1 && start !== hullNext[start]) break;\r\n            }\r\n\r\n            start = hullPrev[start];\r\n            let e = start, q;\r\n            while (q = hullNext[e], orient2d(x, y, coords[2 * e], coords[2 * e + 1], coords[2 * q], coords[2 * q + 1]) >= 0) {\r\n                e = q;\r\n                if (e === start) {\r\n                    e = -1;\r\n                    break;\r\n                }\r\n            }\r\n            if (e === -1) continue; // likely a near-duplicate point; skip it\r\n\r\n            // add the first triangle from the point\r\n            let t = this._addTriangle(e, i, hullNext[e], -1, -1, hullTri[e]);\r\n\r\n            // recursively flip triangles from the point until they satisfy the Delaunay condition\r\n            hullTri[i] = this._legalize(t + 2);\r\n            hullTri[e] = t; // keep track of boundary triangles on the hull\r\n            hullSize++;\r\n\r\n            // walk forward through the hull, adding more triangles and flipping recursively\r\n            let n = hullNext[e];\r\n            while (q = hullNext[n], orient2d(x, y, coords[2 * n], coords[2 * n + 1], coords[2 * q], coords[2 * q + 1]) < 0) {\r\n                t = this._addTriangle(n, i, q, hullTri[i], -1, hullTri[n]);\r\n                hullTri[i] = this._legalize(t + 2);\r\n                hullNext[n] = n; // mark as removed\r\n                hullSize--;\r\n                n = q;\r\n            }\r\n\r\n            // walk backward from the other side, adding more triangles and flipping\r\n            if (e === start) {\r\n                while (q = hullPrev[e], orient2d(x, y, coords[2 * q], coords[2 * q + 1], coords[2 * e], coords[2 * e + 1]) < 0) {\r\n                    t = this._addTriangle(q, i, e, -1, hullTri[e], hullTri[q]);\r\n                    this._legalize(t + 2);\r\n                    hullTri[q] = t;\r\n                    hullNext[e] = e; // mark as removed\r\n                    hullSize--;\r\n                    e = q;\r\n                }\r\n            }\r\n\r\n            // update the hull indices\r\n            this._hullStart = hullPrev[i] = e;\r\n            hullNext[e] = hullPrev[n] = i;\r\n            hullNext[i] = n;\r\n\r\n            // save the two new edges in the hash table\r\n            hullHash[this._hashKey(x, y)] = i;\r\n            hullHash[this._hashKey(coords[2 * e], coords[2 * e + 1])] = e;\r\n        }\r\n\r\n        this.hull = new Uint32Array(hullSize);\r\n        for (let i = 0, e = this._hullStart; i < hullSize; i++) {\r\n            this.hull[i] = e;\r\n            e = hullNext[e];\r\n        }\r\n\r\n        // trim typed triangle mesh arrays\r\n        this.triangles = this._triangles.subarray(0, this.trianglesLen);\r\n        this.halfedges = this._halfedges.subarray(0, this.trianglesLen);\r\n    }\r\n\r\n    _hashKey(x, y) {\r\n        return Math.floor(pseudoAngle(x - this._cx, y - this._cy) * this._hashSize) % this._hashSize;\r\n    }\r\n\r\n    _legalize(a) {\r\n        const {_triangles: triangles, _halfedges: halfedges, coords} = this;\r\n\r\n        let i = 0;\r\n        let ar = 0;\r\n\r\n        // recursion eliminated with a fixed-size stack\r\n        while (true) {\r\n            const b = halfedges[a];\r\n\r\n            /* if the pair of triangles doesn't satisfy the Delaunay condition\r\n             * (p1 is inside the circumcircle of [p0, pl, pr]), flip them,\r\n             * then do the same check/flip recursively for the new pair of triangles\r\n             *\r\n             *           pl                    pl\r\n             *          /||\\                  /  \\\r\n             *       al/ || \\bl            al/    \\a\r\n             *        /  ||  \\              /      \\\r\n             *       /  a||b  \\    flip    /___ar___\\\r\n             *     p0\\   ||   /p1   =>   p0\\---bl---/p1\r\n             *        \\  ||  /              \\      /\r\n             *       ar\\ || /br             b\\    /br\r\n             *          \\||/                  \\  /\r\n             *           pr                    pr\r\n             */\r\n            const a0 = a - a % 3;\r\n            ar = a0 + (a + 2) % 3;\r\n\r\n            if (b === -1) { // convex hull edge\r\n                if (i === 0) break;\r\n                a = EDGE_STACK[--i];\r\n                continue;\r\n            }\r\n\r\n            const b0 = b - b % 3;\r\n            const al = a0 + (a + 1) % 3;\r\n            const bl = b0 + (b + 2) % 3;\r\n\r\n            const p0 = triangles[ar];\r\n            const pr = triangles[a];\r\n            const pl = triangles[al];\r\n            const p1 = triangles[bl];\r\n\r\n            const illegal = inCircle(\r\n                coords[2 * p0], coords[2 * p0 + 1],\r\n                coords[2 * pr], coords[2 * pr + 1],\r\n                coords[2 * pl], coords[2 * pl + 1],\r\n                coords[2 * p1], coords[2 * p1 + 1]);\r\n\r\n            if (illegal) {\r\n                triangles[a] = p1;\r\n                triangles[b] = p0;\r\n\r\n                const hbl = halfedges[bl];\r\n\r\n                // edge swapped on the other side of the hull (rare); fix the halfedge reference\r\n                if (hbl === -1) {\r\n                    let e = this._hullStart;\r\n                    do {\r\n                        if (this._hullTri[e] === bl) {\r\n                            this._hullTri[e] = a;\r\n                            break;\r\n                        }\r\n                        e = this._hullPrev[e];\r\n                    } while (e !== this._hullStart);\r\n                }\r\n                this._link(a, hbl);\r\n                this._link(b, halfedges[ar]);\r\n                this._link(ar, bl);\r\n\r\n                const br = b0 + (b + 1) % 3;\r\n\r\n                // don't worry about hitting the cap: it can only happen on extremely degenerate input\r\n                if (i < EDGE_STACK.length) {\r\n                    EDGE_STACK[i++] = br;\r\n                }\r\n            } else {\r\n                if (i === 0) break;\r\n                a = EDGE_STACK[--i];\r\n            }\r\n        }\r\n\r\n        return ar;\r\n    }\r\n\r\n    _link(a, b) {\r\n        this._halfedges[a] = b;\r\n        if (b !== -1) this._halfedges[b] = a;\r\n    }\r\n\r\n    // add a new triangle given vertex indices and adjacent half-edge ids\r\n    _addTriangle(i0, i1, i2, a, b, c) {\r\n        const t = this.trianglesLen;\r\n\r\n        this._triangles[t] = i0;\r\n        this._triangles[t + 1] = i1;\r\n        this._triangles[t + 2] = i2;\r\n\r\n        this._link(t, a);\r\n        this._link(t + 1, b);\r\n        this._link(t + 2, c);\r\n\r\n        this.trianglesLen += 3;\r\n\r\n        return t;\r\n    }\r\n}\r\n\r\n// monotonically increases with real angle, but doesn't need expensive trigonometry\r\nfunction pseudoAngle(dx, dy) {\r\n    const p = dx / (Math.abs(dx) + Math.abs(dy));\r\n    return (dy > 0 ? 3 - p : 1 + p) / 4; // [0..1]\r\n}\r\n\r\nfunction dist(ax, ay, bx, by) {\r\n    const dx = ax - bx;\r\n    const dy = ay - by;\r\n    return dx * dx + dy * dy;\r\n}\r\n\r\nfunction inCircle(ax, ay, bx, by, cx, cy, px, py) {\r\n    const dx = ax - px;\r\n    const dy = ay - py;\r\n    const ex = bx - px;\r\n    const ey = by - py;\r\n    const fx = cx - px;\r\n    const fy = cy - py;\r\n\r\n    const ap = dx * dx + dy * dy;\r\n    const bp = ex * ex + ey * ey;\r\n    const cp = fx * fx + fy * fy;\r\n\r\n    return dx * (ey * cp - bp * fy) -\r\n           dy * (ex * cp - bp * fx) +\r\n           ap * (ex * fy - ey * fx) < 0;\r\n}\r\n\r\nfunction circumradius(ax, ay, bx, by, cx, cy) {\r\n    const dx = bx - ax;\r\n    const dy = by - ay;\r\n    const ex = cx - ax;\r\n    const ey = cy - ay;\r\n\r\n    const bl = dx * dx + dy * dy;\r\n    const cl = ex * ex + ey * ey;\r\n    const d = 0.5 / (dx * ey - dy * ex);\r\n\r\n    const x = (ey * bl - dy * cl) * d;\r\n    const y = (dx * cl - ex * bl) * d;\r\n\r\n    return x * x + y * y;\r\n}\r\n\r\nfunction circumcenter(ax, ay, bx, by, cx, cy) {\r\n    const dx = bx - ax;\r\n    const dy = by - ay;\r\n    const ex = cx - ax;\r\n    const ey = cy - ay;\r\n\r\n    const bl = dx * dx + dy * dy;\r\n    const cl = ex * ex + ey * ey;\r\n    const d = 0.5 / (dx * ey - dy * ex);\r\n\r\n    const x = ax + (ey * bl - dy * cl) * d;\r\n    const y = ay + (dx * cl - ex * bl) * d;\r\n\r\n    return {x, y};\r\n}\r\n\r\nfunction quicksort(ids, dists, left, right) {\r\n    if (right - left <= 20) {\r\n        for (let i = left + 1; i <= right; i++) {\r\n            const temp = ids[i];\r\n            const tempDist = dists[temp];\r\n            let j = i - 1;\r\n            while (j >= left && dists[ids[j]] > tempDist) ids[j + 1] = ids[j--];\r\n            ids[j + 1] = temp;\r\n        }\r\n    } else {\r\n        const median = (left + right) >> 1;\r\n        let i = left + 1;\r\n        let j = right;\r\n        swap(ids, median, i);\r\n        if (dists[ids[left]] > dists[ids[right]]) swap(ids, left, right);\r\n        if (dists[ids[i]] > dists[ids[right]]) swap(ids, i, right);\r\n        if (dists[ids[left]] > dists[ids[i]]) swap(ids, left, i);\r\n\r\n        const temp = ids[i];\r\n        const tempDist = dists[temp];\r\n        while (true) {\r\n            do i++; while (dists[ids[i]] < tempDist);\r\n            do j--; while (dists[ids[j]] > tempDist);\r\n            if (j < i) break;\r\n            swap(ids, i, j);\r\n        }\r\n        ids[left + 1] = ids[j];\r\n        ids[j] = temp;\r\n\r\n        if (right - i + 1 >= j - left) {\r\n            quicksort(ids, dists, i, right);\r\n            quicksort(ids, dists, left, j - 1);\r\n        } else {\r\n            quicksort(ids, dists, left, j - 1);\r\n            quicksort(ids, dists, i, right);\r\n        }\r\n    }\r\n}\r\n\r\nfunction swap(arr, i, j) {\r\n    const tmp = arr[i];\r\n    arr[i] = arr[j];\r\n    arr[j] = tmp;\r\n}\r\n\r\nfunction defaultGetX(p) {\r\n    return p[0];\r\n}\r\nfunction defaultGetY(p) {\r\n    return p[1];\r\n}\r\n\r\nconst epsilon = 1e-6;\r\n\r\nclass Path {\r\n  constructor() {\r\n    this._x0 = this._y0 = // start of current subpath\r\n    this._x1 = this._y1 = null; // end of current subpath\r\n    this._ = \"\";\r\n  }\r\n  moveTo(x, y) {\r\n    this._ += `M${this._x0 = this._x1 = +x},${this._y0 = this._y1 = +y}`;\r\n  }\r\n  closePath() {\r\n    if (this._x1 !== null) {\r\n      this._x1 = this._x0, this._y1 = this._y0;\r\n      this._ += \"Z\";\r\n    }\r\n  }\r\n  lineTo(x, y) {\r\n    this._ += `L${this._x1 = +x},${this._y1 = +y}`;\r\n  }\r\n  arc(x, y, r) {\r\n    x = +x, y = +y, r = +r;\r\n    const x0 = x + r;\r\n    const y0 = y;\r\n    if (r < 0) throw new Error(\"negative radius\");\r\n    if (this._x1 === null) this._ += `M${x0},${y0}`;\r\n    else if (Math.abs(this._x1 - x0) > epsilon || Math.abs(this._y1 - y0) > epsilon) this._ += \"L\" + x0 + \",\" + y0;\r\n    if (!r) return;\r\n    this._ += `A${r},${r},0,1,1,${x - r},${y}A${r},${r},0,1,1,${this._x1 = x0},${this._y1 = y0}`;\r\n  }\r\n  rect(x, y, w, h) {\r\n    this._ += `M${this._x0 = this._x1 = +x},${this._y0 = this._y1 = +y}h${+w}v${+h}h${-w}Z`;\r\n  }\r\n  value() {\r\n    return this._ || null;\r\n  }\r\n}\r\n\r\nclass Polygon {\r\n  constructor() {\r\n    this._ = [];\r\n  }\r\n  moveTo(x, y) {\r\n    this._.push([x, y]);\r\n  }\r\n  closePath() {\r\n    this._.push(this._[0].slice());\r\n  }\r\n  lineTo(x, y) {\r\n    this._.push([x, y]);\r\n  }\r\n  value() {\r\n    return this._.length ? this._ : null;\r\n  }\r\n}\r\n\r\nclass Voronoi {\r\n  constructor(delaunay, [xmin, ymin, xmax, ymax] = [0, 0, 960, 500]) {\r\n    if (!((xmax = +xmax) >= (xmin = +xmin)) || !((ymax = +ymax) >= (ymin = +ymin))) throw new Error(\"invalid bounds\");\r\n    this.delaunay = delaunay;\r\n    this._circumcenters = new Float64Array(delaunay.points.length * 2);\r\n    this.vectors = new Float64Array(delaunay.points.length * 2);\r\n    this.xmax = xmax, this.xmin = xmin;\r\n    this.ymax = ymax, this.ymin = ymin;\r\n    this._init();\r\n  }\r\n  update() {\r\n    this.delaunay.update();\r\n    this._init();\r\n    return this;\r\n  }\r\n  _init() {\r\n    const {delaunay: {points, hull, triangles}, vectors} = this;\r\n\r\n    // Compute circumcenters.\r\n    const circumcenters = this.circumcenters = this._circumcenters.subarray(0, triangles.length / 3 * 2);\r\n    for (let i = 0, j = 0, n = triangles.length, x, y; i < n; i += 3, j += 2) {\r\n      const t1 = triangles[i] * 2;\r\n      const t2 = triangles[i + 1] * 2;\r\n      const t3 = triangles[i + 2] * 2;\r\n      const x1 = points[t1];\r\n      const y1 = points[t1 + 1];\r\n      const x2 = points[t2];\r\n      const y2 = points[t2 + 1];\r\n      const x3 = points[t3];\r\n      const y3 = points[t3 + 1];\r\n\r\n      const dx = x2 - x1;\r\n      const dy = y2 - y1;\r\n      const ex = x3 - x1;\r\n      const ey = y3 - y1;\r\n      const ab = (dx * ey - dy * ex) * 2;\r\n\r\n      if (Math.abs(ab) < 1e-9) {\r\n        // degenerate case (collinear diagram)\r\n        // almost equal points (degenerate triangle)\r\n        // the circumcenter is at the infinity, in a\r\n        // direction that is:\r\n        // 1. orthogonal to the halfedge.\r\n        let a = 1e9;\r\n        // 2. points away from the center; since the list of triangles starts\r\n        // in the center, the first point of the first triangle\r\n        // will be our reference\r\n        const r = triangles[0] * 2;\r\n        a *= Math.sign((points[r] - x1) * ey - (points[r + 1] - y1) * ex);\r\n        x = (x1 + x3) / 2 - a * ey;\r\n        y = (y1 + y3) / 2 + a * ex;\r\n      } else {\r\n        const d = 1 / ab;\r\n        const bl = dx * dx + dy * dy;\r\n        const cl = ex * ex + ey * ey;\r\n        x = x1 + (ey * bl - dy * cl) * d;\r\n        y = y1 + (dx * cl - ex * bl) * d;\r\n      }\r\n      circumcenters[j] = x;\r\n      circumcenters[j + 1] = y;\r\n    }\r\n\r\n    // Compute exterior cell rays.\r\n    let h = hull[hull.length - 1];\r\n    let p0, p1 = h * 4;\r\n    let x0, x1 = points[2 * h];\r\n    let y0, y1 = points[2 * h + 1];\r\n    vectors.fill(0);\r\n    for (let i = 0; i < hull.length; ++i) {\r\n      h = hull[i];\r\n      p0 = p1, x0 = x1, y0 = y1;\r\n      p1 = h * 4, x1 = points[2 * h], y1 = points[2 * h + 1];\r\n      vectors[p0 + 2] = vectors[p1] = y0 - y1;\r\n      vectors[p0 + 3] = vectors[p1 + 1] = x1 - x0;\r\n    }\r\n  }\r\n  render(context) {\r\n    const buffer = context == null ? context = new Path : undefined;\r\n    const {delaunay: {halfedges, inedges, hull}, circumcenters, vectors} = this;\r\n    if (hull.length <= 1) return null;\r\n    for (let i = 0, n = halfedges.length; i < n; ++i) {\r\n      const j = halfedges[i];\r\n      if (j < i) continue;\r\n      const ti = Math.floor(i / 3) * 2;\r\n      const tj = Math.floor(j / 3) * 2;\r\n      const xi = circumcenters[ti];\r\n      const yi = circumcenters[ti + 1];\r\n      const xj = circumcenters[tj];\r\n      const yj = circumcenters[tj + 1];\r\n      this._renderSegment(xi, yi, xj, yj, context);\r\n    }\r\n    let h0, h1 = hull[hull.length - 1];\r\n    for (let i = 0; i < hull.length; ++i) {\r\n      h0 = h1, h1 = hull[i];\r\n      const t = Math.floor(inedges[h1] / 3) * 2;\r\n      const x = circumcenters[t];\r\n      const y = circumcenters[t + 1];\r\n      const v = h0 * 4;\r\n      const p = this._project(x, y, vectors[v + 2], vectors[v + 3]);\r\n      if (p) this._renderSegment(x, y, p[0], p[1], context);\r\n    }\r\n    return buffer && buffer.value();\r\n  }\r\n  renderBounds(context) {\r\n    const buffer = context == null ? context = new Path : undefined;\r\n    context.rect(this.xmin, this.ymin, this.xmax - this.xmin, this.ymax - this.ymin);\r\n    return buffer && buffer.value();\r\n  }\r\n  renderCell(i, context) {\r\n    const buffer = context == null ? context = new Path : undefined;\r\n    const points = this._clip(i);\r\n    if (points === null || !points.length) return;\r\n    context.moveTo(points[0], points[1]);\r\n    let n = points.length;\r\n    while (points[0] === points[n-2] && points[1] === points[n-1] && n > 1) n -= 2;\r\n    for (let i = 2; i < n; i += 2) {\r\n      if (points[i] !== points[i-2] || points[i+1] !== points[i-1])\r\n        context.lineTo(points[i], points[i + 1]);\r\n    }\r\n    context.closePath();\r\n    return buffer && buffer.value();\r\n  }\r\n  *cellPolygons() {\r\n    const {delaunay: {points}} = this;\r\n    for (let i = 0, n = points.length / 2; i < n; ++i) {\r\n      const cell = this.cellPolygon(i);\r\n      if (cell) cell.index = i, yield cell;\r\n    }\r\n  }\r\n  cellPolygon(i) {\r\n    const polygon = new Polygon;\r\n    this.renderCell(i, polygon);\r\n    return polygon.value();\r\n  }\r\n  _renderSegment(x0, y0, x1, y1, context) {\r\n    let S;\r\n    const c0 = this._regioncode(x0, y0);\r\n    const c1 = this._regioncode(x1, y1);\r\n    if (c0 === 0 && c1 === 0) {\r\n      context.moveTo(x0, y0);\r\n      context.lineTo(x1, y1);\r\n    } else if (S = this._clipSegment(x0, y0, x1, y1, c0, c1)) {\r\n      context.moveTo(S[0], S[1]);\r\n      context.lineTo(S[2], S[3]);\r\n    }\r\n  }\r\n  contains(i, x, y) {\r\n    if ((x = +x, x !== x) || (y = +y, y !== y)) return false;\r\n    return this.delaunay._step(i, x, y) === i;\r\n  }\r\n  *neighbors(i) {\r\n    const ci = this._clip(i);\r\n    if (ci) for (const j of this.delaunay.neighbors(i)) {\r\n      const cj = this._clip(j);\r\n      // find the common edge\r\n      if (cj) loop: for (let ai = 0, li = ci.length; ai < li; ai += 2) {\r\n        for (let aj = 0, lj = cj.length; aj < lj; aj += 2) {\r\n          if (ci[ai] == cj[aj]\r\n          && ci[ai + 1] == cj[aj + 1]\r\n          && ci[(ai + 2) % li] == cj[(aj + lj - 2) % lj]\r\n          && ci[(ai + 3) % li] == cj[(aj + lj - 1) % lj]\r\n          ) {\r\n            yield j;\r\n            break loop;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  _cell(i) {\r\n    const {circumcenters, delaunay: {inedges, halfedges, triangles}} = this;\r\n    const e0 = inedges[i];\r\n    if (e0 === -1) return null; // coincident point\r\n    const points = [];\r\n    let e = e0;\r\n    do {\r\n      const t = Math.floor(e / 3);\r\n      points.push(circumcenters[t * 2], circumcenters[t * 2 + 1]);\r\n      e = e % 3 === 2 ? e - 2 : e + 1;\r\n      if (triangles[e] !== i) break; // bad triangulation\r\n      e = halfedges[e];\r\n    } while (e !== e0 && e !== -1);\r\n    return points;\r\n  }\r\n  _clip(i) {\r\n    // degenerate case (1 valid point: return the box)\r\n    if (i === 0 && this.delaunay.hull.length === 1) {\r\n      return [this.xmax, this.ymin, this.xmax, this.ymax, this.xmin, this.ymax, this.xmin, this.ymin];\r\n    }\r\n    const points = this._cell(i);\r\n    if (points === null) return null;\r\n    const {vectors: V} = this;\r\n    const v = i * 4;\r\n    return V[v] || V[v + 1]\r\n        ? this._clipInfinite(i, points, V[v], V[v + 1], V[v + 2], V[v + 3])\r\n        : this._clipFinite(i, points);\r\n  }\r\n  _clipFinite(i, points) {\r\n    const n = points.length;\r\n    let P = null;\r\n    let x0, y0, x1 = points[n - 2], y1 = points[n - 1];\r\n    let c0, c1 = this._regioncode(x1, y1);\r\n    let e0, e1 = 0;\r\n    for (let j = 0; j < n; j += 2) {\r\n      x0 = x1, y0 = y1, x1 = points[j], y1 = points[j + 1];\r\n      c0 = c1, c1 = this._regioncode(x1, y1);\r\n      if (c0 === 0 && c1 === 0) {\r\n        e0 = e1, e1 = 0;\r\n        if (P) P.push(x1, y1);\r\n        else P = [x1, y1];\r\n      } else {\r\n        let S, sx0, sy0, sx1, sy1;\r\n        if (c0 === 0) {\r\n          if ((S = this._clipSegment(x0, y0, x1, y1, c0, c1)) === null) continue;\r\n          [sx0, sy0, sx1, sy1] = S;\r\n        } else {\r\n          if ((S = this._clipSegment(x1, y1, x0, y0, c1, c0)) === null) continue;\r\n          [sx1, sy1, sx0, sy0] = S;\r\n          e0 = e1, e1 = this._edgecode(sx0, sy0);\r\n          if (e0 && e1) this._edge(i, e0, e1, P, P.length);\r\n          if (P) P.push(sx0, sy0);\r\n          else P = [sx0, sy0];\r\n        }\r\n        e0 = e1, e1 = this._edgecode(sx1, sy1);\r\n        if (e0 && e1) this._edge(i, e0, e1, P, P.length);\r\n        if (P) P.push(sx1, sy1);\r\n        else P = [sx1, sy1];\r\n      }\r\n    }\r\n    if (P) {\r\n      e0 = e1, e1 = this._edgecode(P[0], P[1]);\r\n      if (e0 && e1) this._edge(i, e0, e1, P, P.length);\r\n    } else if (this.contains(i, (this.xmin + this.xmax) / 2, (this.ymin + this.ymax) / 2)) {\r\n      return [this.xmax, this.ymin, this.xmax, this.ymax, this.xmin, this.ymax, this.xmin, this.ymin];\r\n    }\r\n    return P;\r\n  }\r\n  _clipSegment(x0, y0, x1, y1, c0, c1) {\r\n    while (true) {\r\n      if (c0 === 0 && c1 === 0) return [x0, y0, x1, y1];\r\n      if (c0 & c1) return null;\r\n      let x, y, c = c0 || c1;\r\n      if (c & 0b1000) x = x0 + (x1 - x0) * (this.ymax - y0) / (y1 - y0), y = this.ymax;\r\n      else if (c & 0b0100) x = x0 + (x1 - x0) * (this.ymin - y0) / (y1 - y0), y = this.ymin;\r\n      else if (c & 0b0010) y = y0 + (y1 - y0) * (this.xmax - x0) / (x1 - x0), x = this.xmax;\r\n      else y = y0 + (y1 - y0) * (this.xmin - x0) / (x1 - x0), x = this.xmin;\r\n      if (c0) x0 = x, y0 = y, c0 = this._regioncode(x0, y0);\r\n      else x1 = x, y1 = y, c1 = this._regioncode(x1, y1);\r\n    }\r\n  }\r\n  _clipInfinite(i, points, vx0, vy0, vxn, vyn) {\r\n    let P = Array.from(points), p;\r\n    if (p = this._project(P[0], P[1], vx0, vy0)) P.unshift(p[0], p[1]);\r\n    if (p = this._project(P[P.length - 2], P[P.length - 1], vxn, vyn)) P.push(p[0], p[1]);\r\n    if (P = this._clipFinite(i, P)) {\r\n      for (let j = 0, n = P.length, c0, c1 = this._edgecode(P[n - 2], P[n - 1]); j < n; j += 2) {\r\n        c0 = c1, c1 = this._edgecode(P[j], P[j + 1]);\r\n        if (c0 && c1) j = this._edge(i, c0, c1, P, j), n = P.length;\r\n      }\r\n    } else if (this.contains(i, (this.xmin + this.xmax) / 2, (this.ymin + this.ymax) / 2)) {\r\n      P = [this.xmin, this.ymin, this.xmax, this.ymin, this.xmax, this.ymax, this.xmin, this.ymax];\r\n    }\r\n    return P;\r\n  }\r\n  _edge(i, e0, e1, P, j) {\r\n    while (e0 !== e1) {\r\n      let x, y;\r\n      switch (e0) {\r\n        case 0b0101: e0 = 0b0100; continue; // top-left\r\n        case 0b0100: e0 = 0b0110, x = this.xmax, y = this.ymin; break; // top\r\n        case 0b0110: e0 = 0b0010; continue; // top-right\r\n        case 0b0010: e0 = 0b1010, x = this.xmax, y = this.ymax; break; // right\r\n        case 0b1010: e0 = 0b1000; continue; // bottom-right\r\n        case 0b1000: e0 = 0b1001, x = this.xmin, y = this.ymax; break; // bottom\r\n        case 0b1001: e0 = 0b0001; continue; // bottom-left\r\n        case 0b0001: e0 = 0b0101, x = this.xmin, y = this.ymin; break; // left\r\n      }\r\n      // Note: this implicitly checks for out of bounds: if P[j] or P[j+1] are\r\n      // undefined, the conditional statement will be executed.\r\n      if ((P[j] !== x || P[j + 1] !== y) && this.contains(i, x, y)) {\r\n        P.splice(j, 0, x, y), j += 2;\r\n      }\r\n    }\r\n    if (P.length > 4) {\r\n      for (let i = 0; i < P.length; i+= 2) {\r\n        const j = (i + 2) % P.length, k = (i + 4) % P.length;\r\n        if (P[i] === P[j] && P[j] === P[k]\r\n        || P[i + 1] === P[j + 1] && P[j + 1] === P[k + 1])\r\n          P.splice(j, 2), i -= 2;\r\n      }\r\n    }\r\n    return j;\r\n  }\r\n  _project(x0, y0, vx, vy) {\r\n    let t = Infinity, c, x, y;\r\n    if (vy < 0) { // top\r\n      if (y0 <= this.ymin) return null;\r\n      if ((c = (this.ymin - y0) / vy) < t) y = this.ymin, x = x0 + (t = c) * vx;\r\n    } else if (vy > 0) { // bottom\r\n      if (y0 >= this.ymax) return null;\r\n      if ((c = (this.ymax - y0) / vy) < t) y = this.ymax, x = x0 + (t = c) * vx;\r\n    }\r\n    if (vx > 0) { // right\r\n      if (x0 >= this.xmax) return null;\r\n      if ((c = (this.xmax - x0) / vx) < t) x = this.xmax, y = y0 + (t = c) * vy;\r\n    } else if (vx < 0) { // left\r\n      if (x0 <= this.xmin) return null;\r\n      if ((c = (this.xmin - x0) / vx) < t) x = this.xmin, y = y0 + (t = c) * vy;\r\n    }\r\n    return [x, y];\r\n  }\r\n  _edgecode(x, y) {\r\n    return (x === this.xmin ? 0b0001\r\n        : x === this.xmax ? 0b0010 : 0b0000)\r\n        | (y === this.ymin ? 0b0100\r\n        : y === this.ymax ? 0b1000 : 0b0000);\r\n  }\r\n  _regioncode(x, y) {\r\n    return (x < this.xmin ? 0b0001\r\n        : x > this.xmax ? 0b0010 : 0b0000)\r\n        | (y < this.ymin ? 0b0100\r\n        : y > this.ymax ? 0b1000 : 0b0000);\r\n  }\r\n}\r\n\r\nconst tau = 2 * Math.PI, pow = Math.pow;\r\n\r\nfunction pointX(p) {\r\n  return p[0];\r\n}\r\n\r\nfunction pointY(p) {\r\n  return p[1];\r\n}\r\n\r\n// A triangulation is collinear if all its triangles have a non-null area\r\nfunction collinear(d) {\r\n  const {triangles, coords} = d;\r\n  for (let i = 0; i < triangles.length; i += 3) {\r\n    const a = 2 * triangles[i],\r\n          b = 2 * triangles[i + 1],\r\n          c = 2 * triangles[i + 2],\r\n          cross = (coords[c] - coords[a]) * (coords[b + 1] - coords[a + 1])\r\n                - (coords[b] - coords[a]) * (coords[c + 1] - coords[a + 1]);\r\n    if (cross > 1e-10) return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nfunction jitter(x, y, r) {\r\n  return [x + Math.sin(x + y) * r, y + Math.cos(x - y) * r];\r\n}\r\n\r\nclass Delaunay {\r\n  static from(points, fx = pointX, fy = pointY, that) {\r\n    return new Delaunay(\"length\" in points\r\n        ? flatArray(points, fx, fy, that)\r\n        : Float64Array.from(flatIterable(points, fx, fy, that)));\r\n  }\r\n  constructor(points) {\r\n    this._delaunator = new Delaunator(points);\r\n    this.inedges = new Int32Array(points.length / 2);\r\n    this._hullIndex = new Int32Array(points.length / 2);\r\n    this.points = this._delaunator.coords;\r\n    this._init();\r\n  }\r\n  update() {\r\n    this._delaunator.update();\r\n    this._init();\r\n    return this;\r\n  }\r\n  _init() {\r\n    const d = this._delaunator, points = this.points;\r\n\r\n    // check for collinear\r\n    if (d.hull && d.hull.length > 2 && collinear(d)) {\r\n      this.collinear = Int32Array.from({length: points.length/2}, (_,i) => i)\r\n        .sort((i, j) => points[2 * i] - points[2 * j] || points[2 * i + 1] - points[2 * j + 1]); // for exact neighbors\r\n      const e = this.collinear[0], f = this.collinear[this.collinear.length - 1],\r\n        bounds = [ points[2 * e], points[2 * e + 1], points[2 * f], points[2 * f + 1] ],\r\n        r = 1e-8 * Math.hypot(bounds[3] - bounds[1], bounds[2] - bounds[0]);\r\n      for (let i = 0, n = points.length / 2; i < n; ++i) {\r\n        const p = jitter(points[2 * i], points[2 * i + 1], r);\r\n        points[2 * i] = p[0];\r\n        points[2 * i + 1] = p[1];\r\n      }\r\n      this._delaunator = new Delaunator(points);\r\n    } else {\r\n      delete this.collinear;\r\n    }\r\n\r\n    const halfedges = this.halfedges = this._delaunator.halfedges;\r\n    const hull = this.hull = this._delaunator.hull;\r\n    const triangles = this.triangles = this._delaunator.triangles;\r\n    const inedges = this.inedges.fill(-1);\r\n    const hullIndex = this._hullIndex.fill(-1);\r\n\r\n    // Compute an index from each point to an (arbitrary) incoming halfedge\r\n    // Used to give the first neighbor of each point; for this reason,\r\n    // on the hull we give priority to exterior halfedges\r\n    for (let e = 0, n = halfedges.length; e < n; ++e) {\r\n      const p = triangles[e % 3 === 2 ? e - 2 : e + 1];\r\n      if (halfedges[e] === -1 || inedges[p] === -1) inedges[p] = e;\r\n    }\r\n    for (let i = 0, n = hull.length; i < n; ++i) {\r\n      hullIndex[hull[i]] = i;\r\n    }\r\n\r\n    // degenerate case: 1 or 2 (distinct) points\r\n    if (hull.length <= 2 && hull.length > 0) {\r\n      this.triangles = new Int32Array(3).fill(-1);\r\n      this.halfedges = new Int32Array(3).fill(-1);\r\n      this.triangles[0] = hull[0];\r\n      inedges[hull[0]] = 1;\r\n      if (hull.length === 2) {\r\n        inedges[hull[1]] = 0;\r\n        this.triangles[1] = hull[1];\r\n        this.triangles[2] = hull[1];\r\n      }\r\n    }\r\n  }\r\n  voronoi(bounds) {\r\n    return new Voronoi(this, bounds);\r\n  }\r\n  *neighbors(i) {\r\n    const {inedges, hull, _hullIndex, halfedges, triangles, collinear} = this;\r\n\r\n    // degenerate case with several collinear points\r\n    if (collinear) {\r\n      const l = collinear.indexOf(i);\r\n      if (l > 0) yield collinear[l - 1];\r\n      if (l < collinear.length - 1) yield collinear[l + 1];\r\n      return;\r\n    }\r\n\r\n    const e0 = inedges[i];\r\n    if (e0 === -1) return; // coincident point\r\n    let e = e0, p0 = -1;\r\n    do {\r\n      yield p0 = triangles[e];\r\n      e = e % 3 === 2 ? e - 2 : e + 1;\r\n      if (triangles[e] !== i) return; // bad triangulation\r\n      e = halfedges[e];\r\n      if (e === -1) {\r\n        const p = hull[(_hullIndex[i] + 1) % hull.length];\r\n        if (p !== p0) yield p;\r\n        return;\r\n      }\r\n    } while (e !== e0);\r\n  }\r\n  find(x, y, i = 0) {\r\n    if ((x = +x, x !== x) || (y = +y, y !== y)) return -1;\r\n    const i0 = i;\r\n    let c;\r\n    while ((c = this._step(i, x, y)) >= 0 && c !== i && c !== i0) i = c;\r\n    return c;\r\n  }\r\n  _step(i, x, y) {\r\n    const {inedges, hull, _hullIndex, halfedges, triangles, points} = this;\r\n    if (inedges[i] === -1 || !points.length) return (i + 1) % (points.length >> 1);\r\n    let c = i;\r\n    let dc = pow(x - points[i * 2], 2) + pow(y - points[i * 2 + 1], 2);\r\n    const e0 = inedges[i];\r\n    let e = e0;\r\n    do {\r\n      let t = triangles[e];\r\n      const dt = pow(x - points[t * 2], 2) + pow(y - points[t * 2 + 1], 2);\r\n      if (dt < dc) dc = dt, c = t;\r\n      e = e % 3 === 2 ? e - 2 : e + 1;\r\n      if (triangles[e] !== i) break; // bad triangulation\r\n      e = halfedges[e];\r\n      if (e === -1) {\r\n        e = hull[(_hullIndex[i] + 1) % hull.length];\r\n        if (e !== t) {\r\n          if (pow(x - points[e * 2], 2) + pow(y - points[e * 2 + 1], 2) < dc) return e;\r\n        }\r\n        break;\r\n      }\r\n    } while (e !== e0);\r\n    return c;\r\n  }\r\n  render(context) {\r\n    const buffer = context == null ? context = new Path : undefined;\r\n    const {points, halfedges, triangles} = this;\r\n    for (let i = 0, n = halfedges.length; i < n; ++i) {\r\n      const j = halfedges[i];\r\n      if (j < i) continue;\r\n      const ti = triangles[i] * 2;\r\n      const tj = triangles[j] * 2;\r\n      context.moveTo(points[ti], points[ti + 1]);\r\n      context.lineTo(points[tj], points[tj + 1]);\r\n    }\r\n    this.renderHull(context);\r\n    return buffer && buffer.value();\r\n  }\r\n  renderPoints(context, r) {\r\n    if (r === undefined && (!context || typeof context.moveTo !== \"function\")) r = context, context = null;\r\n    r = r == undefined ? 2 : +r;\r\n    const buffer = context == null ? context = new Path : undefined;\r\n    const {points} = this;\r\n    for (let i = 0, n = points.length; i < n; i += 2) {\r\n      const x = points[i], y = points[i + 1];\r\n      context.moveTo(x + r, y);\r\n      context.arc(x, y, r, 0, tau);\r\n    }\r\n    return buffer && buffer.value();\r\n  }\r\n  renderHull(context) {\r\n    const buffer = context == null ? context = new Path : undefined;\r\n    const {hull, points} = this;\r\n    const h = hull[0] * 2, n = hull.length;\r\n    context.moveTo(points[h], points[h + 1]);\r\n    for (let i = 1; i < n; ++i) {\r\n      const h = 2 * hull[i];\r\n      context.lineTo(points[h], points[h + 1]);\r\n    }\r\n    context.closePath();\r\n    return buffer && buffer.value();\r\n  }\r\n  hullPolygon() {\r\n    const polygon = new Polygon;\r\n    this.renderHull(polygon);\r\n    return polygon.value();\r\n  }\r\n  renderTriangle(i, context) {\r\n    const buffer = context == null ? context = new Path : undefined;\r\n    const {points, triangles} = this;\r\n    const t0 = triangles[i *= 3] * 2;\r\n    const t1 = triangles[i + 1] * 2;\r\n    const t2 = triangles[i + 2] * 2;\r\n    context.moveTo(points[t0], points[t0 + 1]);\r\n    context.lineTo(points[t1], points[t1 + 1]);\r\n    context.lineTo(points[t2], points[t2 + 1]);\r\n    context.closePath();\r\n    return buffer && buffer.value();\r\n  }\r\n  *trianglePolygons() {\r\n    const {triangles} = this;\r\n    for (let i = 0, n = triangles.length / 3; i < n; ++i) {\r\n      yield this.trianglePolygon(i);\r\n    }\r\n  }\r\n  trianglePolygon(i) {\r\n    const polygon = new Polygon;\r\n    this.renderTriangle(i, polygon);\r\n    return polygon.value();\r\n  }\r\n}\r\n\r\nfunction flatArray(points, fx, fy, that) {\r\n  const n = points.length;\r\n  const array = new Float64Array(n * 2);\r\n  for (let i = 0; i < n; ++i) {\r\n    const p = points[i];\r\n    array[i * 2] = fx.call(that, p, i, points);\r\n    array[i * 2 + 1] = fy.call(that, p, i, points);\r\n  }\r\n  return array;\r\n}\r\n\r\nfunction* flatIterable(points, fx, fy, that) {\r\n  let i = 0;\r\n  for (const p of points) {\r\n    yield fx.call(that, p, i, points);\r\n    yield fy.call(that, p, i, points);\r\n    ++i;\r\n  }\r\n}\r\n\r\nexport {Delaunay,Voronoi}","/** @module */\r\n\r\n// d3-voronoi\r\n// d3-select\r\n// d3-range\r\n\r\nimport { Delaunay } from '../../../lib/d3-delaunay.esm.js'\r\n// import { Delaunay } from 'd3-delaunay'\r\n// import { Delaunay } from 'https://cdn.skypack.dev/d3-delaunay@6'\r\n// https://github.com/d3/d3-delaunay\r\n\r\n/**\r\n * Draw Voronoi cells to show votes.\r\n * @param {VoterGroup} voterGroup\r\n * @param {Election} election\r\n * @param {Screen} screen\r\n */\r\nexport default function voronoiGroup(voterGroup, election, screen) {\r\n    const self = this\r\n\r\n    let cans\r\n    let voronoi\r\n\r\n    self.update = function () {\r\n        cans = election.getCandidates()\r\n        const points = cans.map((e) => [e.x, e.y])\r\n        const delaunay = Delaunay.from(points)\r\n        voronoi = delaunay.voronoi([0, 0, screen.width, screen.height])\r\n    }\r\n\r\n    self.render = function () {\r\n        const { ctx } = screen\r\n\r\n        ctx.save()\r\n\r\n        // draw circle clip\r\n\r\n        // http://jsfiddle.net/jimrhoskins/dDUC3/1/\r\n        // https://dustinpfister.github.io/2019/10/08/canvas-clip/\r\n        ctx.beginPath()\r\n        ctx.arc(voterGroup.x, voterGroup.y, voterGroup.r, 0, 2 * Math.PI)\r\n        // ctx.closePath()\r\n        ctx.clip()\r\n\r\n        const n = cans.length\r\n        for (let i = 0; i < n; i++) {\r\n            ctx.beginPath()\r\n            voronoi.renderCell(i, ctx)\r\n            ctx.fillStyle = cans[i].square.color\r\n            ctx.fill()\r\n            ctx.stroke()\r\n        }\r\n\r\n        ctx.beginPath()\r\n        ctx.arc(voterGroup.x, voterGroup.y, voterGroup.r, 0, 2 * Math.PI)\r\n        ctx.stroke()\r\n\r\n        ctx.restore()\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport CircleGraphic from './CircleGraphic.js'\r\nimport VoronoiGroup from './VoronoiGroup.js'\r\n\r\n/**\r\n * VoterCircle class with Handle component to take care of dragging.\r\n * VoronoiGroup component takes care of drawing votes.\r\n * @param {Number} x\r\n * @param {Number} y\r\n * @param {Number} r - radius of circle of candidate positions.\r\n * @param {Screen} screen\r\n * @param {DraggableManager} dragm\r\n * @param {Election} election\r\n */\r\nexport default function VoterCircle(x, y, r, screen, dragm, election) {\r\n    const self = this\r\n\r\n    self.x = x\r\n    self.y = y\r\n    self.r = r\r\n    self.setX = function (x1) {\r\n        self.x = x1\r\n    }\r\n    self.setY = function (y1) {\r\n        self.y = y1\r\n    }\r\n\r\n    const circle = new CircleGraphic(self, 10, '#555', screen)\r\n    self.circle = circle\r\n\r\n    dragm.newCircleHandle(self, circle)\r\n\r\n    election.newVoterGroup(self)\r\n\r\n    const voronoiGroup = new VoronoiGroup(self, election, screen)\r\n\r\n    self.update = function () {\r\n        voronoiGroup.update()\r\n    }\r\n\r\n    // Graphics component\r\n    self.render = function () {\r\n        // circle\r\n        voronoiGroup.render()\r\n        // handle\r\n        circle.render()\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport { Tween } from '../../../lib/tween.esm.js'\r\n\r\n/**\r\n * Square is a graphic.\r\n * It displays itself on a parent object.\r\n * Its parent object stores its x and y.\r\n * It shows a square at the parent object xy coordinates.\r\n * It animates the square when picking up and dropping.\r\n * @param {Object} parent\r\n * @param {Number} parent.x\r\n * @param {Number} parent.y\r\n * @param {Number} w - width of square to draw.\r\n * @param {Number} h - height of square to draw.\r\n * @param {String} color\r\n * @param {Screen} screen\r\n */\r\nexport default function SquareGraphic(parent, w, h, color, screen) {\r\n    const self = this\r\n    self.w = w // display width, because we're going to make animations with it\r\n    self.h = h\r\n    self.trueW = w // true width, because we want to return to this width after animating.\r\n    self.trueH = h\r\n    self.color = color\r\n\r\n    self.pickUp = function () {\r\n        self.tweenSq = new Tween(self)\r\n        self.tweenSq.to({ w: self.trueW + 10, h: self.trueH + 10 }, 100)\r\n        self.tweenSq.start()\r\n    }\r\n    self.drop = function () {\r\n        self.tweenSq = new Tween(self)\r\n        self.tweenSq.to({ w: self.trueW, h: self.trueH }, 100)\r\n        self.tweenSq.start()\r\n    }\r\n\r\n    // Graphics component\r\n    self.render = function () {\r\n        const { ctx } = screen\r\n\r\n        if (self.tweenSq) {\r\n            self.tweenSq.update()\r\n        }\r\n        ctx.beginPath()\r\n        ctx.fillStyle = self.color\r\n        ctx.rect(\r\n            (parent.x - 0.5 * self.w) - 0.5,\r\n            (parent.y - 0.5 * self.h) - 0.5,\r\n            self.w + 1,\r\n            self.h + 1,\r\n        )\r\n        ctx.fill()\r\n        ctx.stroke()\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport SquareGraphic from './SquareGraphic.js'\r\nimport { drawStrokedColor, textPercent } from './graphicsUtilities.js'\r\n\r\n/**\r\n * Candidate class on top of handle.\r\n * Candidate adds candidate behavior on top of a draggable handle handle.\r\n * @param {Number} x\r\n * @param {Number} y\r\n * @param {Number} w\r\n * @param {Number} h\r\n * @param {String} color\r\n * @param {Screen} screen\r\n * @param {DraggableManager} dragm\r\n * @param {Election} election\r\n */\r\nexport default function Candidate(x, y, w, h, color, screen, dragm, election) {\r\n    const self = this\r\n\r\n    self.x = x\r\n    self.y = y\r\n    self.setX = function (x1) {\r\n        self.x = x1\r\n    }\r\n    self.setY = function (y1) {\r\n        self.y = y1\r\n    }\r\n\r\n    const square = new SquareGraphic(self, w, h, color, screen) // square is for rendering\r\n    self.square = square\r\n\r\n    dragm.newSquareHandle(self, square)\r\n\r\n    election.newCandidate(self)\r\n\r\n    self.fraction = 0\r\n    self.setFraction = function (fraction) {\r\n        self.fraction = fraction\r\n    }\r\n\r\n    self.render = function () {\r\n        square.render()\r\n\r\n        drawStrokedColor(textPercent(self.fraction), self.x, self.y - square.h * 0.5 - 2, 20, 2, '#222', screen.ctx)\r\n    }\r\n}\r\n","/**\r\n * Graphics Utilities\r\n * Just a few helpful functions that are self-contained and don't need much context.\r\n * @module */\r\n\r\nexport function drawStrokedColor(text, x, y, textsize, lw, color, ctx, textAlign) {\r\n    ctx.save()\r\n    ctx.textAlign = textAlign || 'center'\r\n    ctx.font = `${textsize}px Sans-serif`\r\n    ctx.lineWidth = lw\r\n    ctx.fillStyle = color\r\n    ctx.fillText(text, x, y)\r\n    ctx.restore()\r\n}\r\n\r\nexport function textPercent(f) {\r\n    const a = (100 * f).toFixed(0)\r\n    return a\r\n}\r\n","/** @module */\r\n\r\nimport VoterCircle from '../entities/VoterCircle.js'\r\nimport Candidate from '../entities/Candidate.js'\r\n\r\n/**\r\n * Simulate one election with\r\n *   candidates in defined positions, and\r\n *   voters in a distribution that will be summed over.\r\n * @param {Screen} screen\r\n * @param {DraggableManager} dragm\r\n * @param {Menu} menu\r\n * @param {Changes} changes\r\n * @param {Election} election\r\n */\r\nexport default function SimOne(screen, dragm, menu, changes, election) {\r\n    const self = this\r\n\r\n    const sq = new Candidate(100, 200, 21, 21, '#e52', screen, dragm, election)\r\n    const sq2 = new Candidate(200, 100, 21, 21, '#5e2', screen, dragm, election)\r\n    const sq3 = new Candidate(600 - 200, 600 - 100, 21, 21, '#25e', screen, dragm, election)\r\n    const ci = new VoterCircle(100, 300, 200, screen, dragm, election)\r\n    const ci2 = new VoterCircle(500, 300, 200, screen, dragm, election)\r\n\r\n    self.update = () => {\r\n        if (changes.checkNone()) return\r\n        // clear changes, reset to []\r\n        changes.clear()\r\n        election.updateTallies()\r\n        ci.update()\r\n        ci2.update()\r\n    }\r\n\r\n    self.render = () => {\r\n        ci.render()\r\n        ci2.render()\r\n        sq.render()\r\n        sq2.render()\r\n        sq3.render()\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport CircleGraphic from './CircleGraphic.js'\r\n\r\n/**\r\n * VoterCircle for simulations of many candidates\r\n * VoterCircle class with Handle component to take care of dragging.\r\n * @param {Number} x\r\n * @param {Number} y\r\n * @param {Number} r - radius of circle of candidate positions.\r\n * @param {Screen} screen\r\n * @param {DraggableManager} dragm\r\n * @param {Election} election\r\n */\r\nexport default function SimVoterCircle(x, y, r, screen, dragm, election) {\r\n    const self = this\r\n\r\n    self.x = x\r\n    self.y = y\r\n    self.r = r\r\n    self.setX = function (x1) {\r\n        self.x = x1\r\n    }\r\n    self.setY = function (y1) {\r\n        self.y = y1\r\n    }\r\n\r\n    const circle = new CircleGraphic(self, 10, '#555', screen)\r\n    self.circle = circle\r\n\r\n    dragm.newCircleHandle(self, circle)\r\n\r\n    election.newVoterGroup(self)\r\n\r\n    self.update = function () {\r\n    }\r\n\r\n    // Graphics component\r\n    self.render = function () {\r\n        const { ctx } = screen\r\n        // circle\r\n        ctx.beginPath()\r\n        // ctx.fillStyle = \"#eee\"\r\n        ctx.arc(self.x, self.y, self.r, 0, 2 * Math.PI)\r\n        // ctx.fill()\r\n        ctx.stroke()\r\n\r\n        // handle\r\n        circle.render()\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport SquareGraphic from './SquareGraphic.js'\r\n\r\n/**\r\n * This represents a spatial distribution of candidates.\r\n * A draggable handle handle provides draggable behavior.\r\n * @param {Number} x\r\n * @param {Number} y\r\n * @param {Number} r\r\n * @param {Screen} screen\r\n * @param {DraggableManager} dragm\r\n * @param {Election} election\r\n */\r\nexport default function CandidateDistribution(x, y, r, screen, dragm, election) {\r\n    const self = this\r\n\r\n    self.x = x\r\n    self.y = y\r\n    self.r = r\r\n    self.setX = function (x1) {\r\n        self.x = x1\r\n    }\r\n    self.setY = function (y1) {\r\n        self.y = y1\r\n    }\r\n\r\n    const square = new SquareGraphic(self, 10, 10, '#ccc', screen) // square is for rendering\r\n    self.square = square\r\n\r\n    dragm.newSquareHandle(self, square)\r\n\r\n    election.newCandidateDistribution(self)\r\n\r\n    self.render = function () {\r\n        const { ctx } = screen\r\n\r\n        ctx.beginPath()\r\n        // ctx.fillStyle = \"grey\"\r\n        ctx.arc(self.x, self.y, self.r, 0, 2 * Math.PI)\r\n        // ctx.fill()\r\n        ctx.stroke()\r\n\r\n        square.render()\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport SimVoterCircle from '../entities/SimVoterCircle.js'\r\nimport CandidateDistribution from '../entities/CandidateDistribution.js'\r\n\r\n/**\r\n * Simulate many elections with\r\n *   candidates in random positions within a distribution, and\r\n *   voters in a distribution that will be summed over.\r\n * @param {Screen} screen\r\n * @param {DraggableManager} dragm\r\n * @param {Menu} menu\r\n * @param {Changes} changes\r\n * @param {SimElection} simElections\r\n */\r\nexport default function SimMany(screen, dragm, menu, changes, simElections) {\r\n    const self = this\r\n\r\n    const cd = new CandidateDistribution(300, 300, 400, screen, dragm, simElections)\r\n    const ci = new SimVoterCircle(100, 300, 200, screen, dragm, simElections)\r\n    const ci2 = new SimVoterCircle(500, 300, 200, screen, dragm, simElections)\r\n\r\n    self.update = () => {\r\n        if (changes.checkNone()) {\r\n            simElections.addSim()\r\n            return\r\n        }\r\n        // clear changes, reset to []\r\n        changes.clear()\r\n        simElections.startSim()\r\n        ci.update()\r\n        ci2.update()\r\n    }\r\n\r\n    self.render = () => {\r\n        simElections.render()\r\n        ci.render()\r\n        ci2.render()\r\n        cd.render()\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport SimOne from './states/SimOne.js'\r\nimport SimMany from './states/SimMany.js'\r\n\r\n/**\r\n * Simulation is the main task we're trying to accomplish in this program.\r\n * There are multiple states that the sim can be in.\r\n * Each state simulates something different.\r\n * Each state has initialization, update, and render procedures.\r\n * This is a state machine.\r\n * @param {Screen} screen\r\n * @param {DraggableManager} dragm\r\n * @param {Menu} menu\r\n * @param {Changes} changes\r\n * @param {Election} election\r\n * @param {SimElections} simElections\r\n * @param {String} initialState\r\n */\r\nexport default function Sim(screen, dragm, menu, changes, election, simElections, initialState) {\r\n    const self = this\r\n\r\n    changes.add(['simType'])\r\n    const sims = {\r\n        one: {},\r\n        many: {},\r\n    }\r\n\r\n    self.state = initialState\r\n    self.typeExit = self.state\r\n    self.update = () => {\r\n        // state change\r\n        if (changes.check(['simType'])) {\r\n            // exit state\r\n            dragm.clear()\r\n            election.clear()\r\n\r\n            // enter state\r\n            if (self.state === 'one') {\r\n                sims[self.state] = new SimOne(screen, dragm, menu, changes, election)\r\n            } else {\r\n                sims[self.state] = new SimMany(screen, dragm, menu, changes, simElections)\r\n            }\r\n        }\r\n\r\n        // state update\r\n        sims[self.state].update()\r\n    }\r\n    self.render = () => { sims[self.state].render() }\r\n\r\n    // -- Menu --\r\n\r\n    // add a menu item to switch between types of sims\r\n    // a list of simulation types\r\n    self.typeList = [\r\n        { name: 'One Election', value: 'one', state: '' },\r\n        { name: 'Many Elections', value: 'many', state: '' },\r\n    ]\r\n    menu.addMenuItem(\r\n        self,\r\n        {\r\n            label: 'Simulation:',\r\n            prop: 'state',\r\n            setProp: (p) => { self.state = p },\r\n            options: self.typeList,\r\n            change: ['simType'],\r\n        },\r\n    )\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Use this to sample a random candidate from a collection of distributions of candidates.\r\n * Sample a point multiple times after the constructor call.\r\n * @param {CandidateDistribution[]} candidateDistributions\r\n */\r\nexport default function CandidateDistributionSampler(candidateDistributions) {\r\n    const self = this\r\n    // cumulative distribution function\r\n    const cdf = getCDF(candidateDistributions)\r\n    self.samplePoint = function () {\r\n        return samplePoint1(candidateDistributions, cdf)\r\n    }\r\n}\r\n\r\nfunction samplePoint1(candidateDistributions, cdf) {\r\n    // pick a voter distribution\r\n    const iDist = randomDistribution(cdf)\r\n    const cd = candidateDistributions[iDist]\r\n    // sample circle\r\n    const point = randomInsideCircle(cd.x, cd.y, cd.r)\r\n    return point\r\n}\r\n\r\nfunction randomDistribution(cdf) {\r\n    // sample from distribution\r\n    // pick a random number from 0 to 1\r\n    const random1 = Math.random()\r\n    const selectDistribution = cdf.findIndex((x) => x >= random1)\r\n    return selectDistribution\r\n}\r\n\r\nfunction getCDF(candidateDistributions) {\r\n    // find the size of the voter distributions\r\n    const areasProportion = candidateDistributions.map((cd) => cd.r ** 2)\r\n\r\n    const sumAreasProportion = areasProportion.reduce((p, c) => p + c)\r\n\r\n    // probability mass function\r\n    const pmf = areasProportion.map((p) => p / sumAreasProportion)\r\n\r\n    // https://stackoverflow.com/a/20477613\r\n    // [5, 10, 3, 2];\r\n    // [5, 15, 18, 20]\r\n    // cumulative distribution function\r\n    const cdf = []\r\n    pmf.reduce((p, c, i) => {\r\n        const a = p + c\r\n        cdf[i] = a\r\n        return a\r\n    }, 0)\r\n\r\n    return cdf\r\n}\r\n\r\nfunction randomInsideCircle(X, Y, R) {\r\n    // https://stackoverflow.com/a/50746409\r\n    const r = R * Math.sqrt(Math.random())\r\n    const theta = Math.random() * 2 * Math.PI\r\n\r\n    // convert to cartesian\r\n\r\n    const x = X + r * Math.cos(theta)\r\n    const y = Y + r * Math.sin(theta)\r\n    return { x, y }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Candidate used for simulation of sampling candidates from a distribution.\r\n * Just a single point (x,y) is needed.\r\n * @param {Number} x\r\n * @param {Number} y\r\n * @param {Election} election\r\n */\r\nexport default function simpleCandidate(x, y, election) {\r\n    election.newCandidate({ x, y })\r\n}\r\n","/** @module */\r\n\r\nimport CandidateDistributionSampler from './CandidateDistributionSampler.js'\r\nimport simpleCandidate from './simpleCandidate.js'\r\n\r\n/**\r\n * Simulate winners from many elections.\r\n * Candidates are sampled from a distribution.\r\n * Winners are drawn as points.\r\n * The simulation is dynamic. More simulations are performed at each frame.\r\n * @param {Screen} screen\r\n * @param {Menu} menu\r\n * @param {Election} election\r\n */\r\nexport default function SimElections(screen, menu, election) {\r\n    const self = this\r\n\r\n    self.points = []\r\n    self.newPoints = []\r\n\r\n    const candidateDistributions = []\r\n\r\n    self.newVoterGroup = function (voterGroup) {\r\n        election.newVoterGroup(voterGroup)\r\n    }\r\n\r\n    self.newCandidateDistribution = function (canDis) {\r\n        candidateDistributions.push(canDis)\r\n    }\r\n\r\n    self.startSim = function () {\r\n        // All the election calculations happen here.\r\n\r\n        self.sampler = new CandidateDistributionSampler(candidateDistributions)\r\n\r\n        self.points = []\r\n\r\n        clearBuffer()\r\n    }\r\n\r\n    self.addSim = function () {\r\n        // add more points\r\n\r\n        if (self.points.length > 5000) return\r\n        // this limit right now is about graphics rendering.\r\n        // todo: render to a buffer\r\n\r\n        // number of sample elections\r\n        const ns = 20\r\n\r\n        for (let i = 0; i < ns; i++) {\r\n            // choose a number of candidates\r\n            let nk\r\n            if (election.method.checkElectionType() === 'singleWinner') {\r\n                nk = 5\r\n            } else if (election.method.checkElectionType() === 'allocation') {\r\n                nk = 10\r\n            }\r\n            for (let k = 0; k < nk; k++) {\r\n                // sample a point from the distribution of candidates\r\n                const point = self.sampler.samplePoint()\r\n\r\n                // make a candidate... could make simpler\r\n                simpleCandidate(point.x, point.y, election)\r\n            }\r\n\r\n            // find winner position\r\n            const results = election.runElection()\r\n\r\n            if (election.method.checkElectionType() === 'singleWinner') {\r\n                const { winner } = results\r\n\r\n                // record point\r\n                const winPoint = { x: winner.x, y: winner.y }\r\n                self.points.push(winPoint)\r\n                self.newPoints.push(winPoint)\r\n            } else {\r\n                const { allocation, candidates } = results\r\n\r\n                const jitterSize = 100\r\n                candidates.forEach(\r\n                    (can, k) => {\r\n                        const numPoints = allocation[k]\r\n                        for (let m = 0; m < numPoints; m++) {\r\n                            let winPoint\r\n                            if (m === 0) {\r\n                                // record point\r\n                                winPoint = { x: can.x, y: can.y }\r\n                            } else {\r\n                                // add jitter\r\n                                winPoint = {\r\n                                    x: can.x + (Math.random() - 0.5) * jitterSize,\r\n                                    y: can.y + (Math.random() - 0.5) * jitterSize,\r\n                                }\r\n                            }\r\n                            // record point\r\n                            self.points.push(winPoint)\r\n                            self.newPoints.push(winPoint)\r\n                        }\r\n                    },\r\n                )\r\n            }\r\n            election.clearCandidates()\r\n        }\r\n        renderToBuffer()\r\n    }\r\n\r\n    // buffer canvas\r\n    const canvas2 = document.createElement('canvas')\r\n    canvas2.width = screen.canvas.width\r\n    canvas2.height = screen.canvas.height\r\n    const context2 = canvas2.getContext('2d')\r\n\r\n    function clearBuffer() {\r\n        context2.clearRect(0, 0, canvas2.width, canvas2.height)\r\n    }\r\n\r\n    function renderToBuffer() {\r\n        const ctx = context2\r\n        renderPoints(ctx, self.newPoints)\r\n        self.newPoints = []\r\n    }\r\n\r\n    self.render = function () {\r\n        if (screen.noBuffers) {\r\n            self.noBufferRender()\r\n        } else {\r\n            self.bufferRender()\r\n        }\r\n    }\r\n\r\n    self.bufferRender = function () {\r\n        const { ctx } = screen\r\n        ctx.drawImage(canvas2, 0, 0)\r\n    }\r\n\r\n    // use this if we want to export to an SVG\r\n    self.noBufferRender = function () {\r\n        const { ctx } = screen\r\n        renderPoints(ctx, self.points)\r\n    }\r\n\r\n    function renderPoints(ctx, points) {\r\n        ctx.fillStyle = 'grey'\r\n        const n = points.length\r\n        for (let i = 0; i < n; i++) {\r\n            const p = points[i]\r\n            // dot\r\n            ctx.beginPath()\r\n            ctx.arc(p.x, p.y, 3, 0, 2 * Math.PI)\r\n            ctx.fill()\r\n        }\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport Changes from './Changes.js'\r\nimport DraggableManager from './DraggableManager.js'\r\nimport Screen from './Screen.js'\r\nimport addSVGOutput from './addSVGOutput.js'\r\nimport Menu from '../menu/Menu.js'\r\nimport Election from '../election/Election.js'\r\nimport Sim from '../sim/Sim.js'\r\nimport SimElections from '../election/SimElections.js'\r\nimport divSandbox from './divSandbox.js'\r\n\r\n/**\r\n * Set up a user interface to run a simulation.\r\n * @param {Object} config\r\n * @param {String} config.idScript - The id of an element.\r\n * We will append the user interface as a sibling.\r\n * @param {String} config.initialState - The game state of the simulation to load initially.\r\n */\r\nexport default function sandbox(config) {\r\n    const { initialState } = config\r\n\r\n    // manage dependent calculations because we only want to do calculations if we need to\r\n    const changes = new Changes()\r\n\r\n    const menu = new Menu(changes)\r\n\r\n    const screen = new Screen(600, 600)\r\n\r\n    const svgUIDiv = addSVGOutput(screen, draw)\r\n\r\n    const dragm = new DraggableManager(screen, changes)\r\n\r\n    const election = new Election(menu)\r\n\r\n    const simElections = new SimElections(screen, menu, election)\r\n\r\n    const sim = new Sim(screen, dragm, menu, changes, election, simElections, initialState)\r\n\r\n    const div = divSandbox(menu, screen, svgUIDiv)\r\n\r\n    window.requestAnimationFrame(gameLoop)\r\n\r\n    return div\r\n\r\n    function gameLoop() {\r\n        update()\r\n        draw()\r\n        window.requestAnimationFrame(gameLoop)\r\n    }\r\n\r\n    function update() {\r\n        sim.update()\r\n    }\r\n\r\n    function draw() {\r\n        screen.clear()\r\n        sim.render()\r\n    }\r\n}\r\n","/**\r\n * Assemble a div containing all the components of a simulation sandbox.\r\n * @param {Menu} menu - Contains buttons for selecting options.\r\n * @param {Screen} screen - Contains a canvas for drawing.\r\n * @param {HTMLElement} svgUIDiv - Contains buttons and a drawing canvas.\r\n * @returns {HTMLElement} - A div containing the whole sandbox.\r\n */\r\nexport default function divSandbox(menu, screen, svgUIDiv) {\r\n    const div = document.createElement('div')\r\n    div.appendChild(menu.divMenu)\r\n    div.appendChild(screen.canvas)\r\n    div.appendChild(svgUIDiv)\r\n    return div\r\n}\r\n","import sandbox from './sandbox.js'\r\n\r\n/** Find all the divs of class \"sandbox\".\r\n * Add the sandbox as a neighbor under the same parent. */\r\nconst targets = Array.from(document.getElementsByClassName('sandbox'))\r\ntargets.forEach((target) => {\r\n    const div = sandbox({ initialState: target.dataset.initialstate })\r\n    const parent = target.parentNode\r\n    parent.appendChild(div)\r\n})\r\n"],"names":["self","this","changes","add","changeList","forEach","c","push","check","n","includes","checkNone","length","clear","splice","screen","drag","draggables","canvas","hitTest","d","m","x","o","y","p","isCircle","r","g","isSquare","w","h","Math","abs","newSquareHandle","newCircleHandle","onmousedown","event","mouse","offsetX","offsetY","nd","i","iDragging","isDragging","offX","offY","pickUp","dataset","cursor","onmouseup","undefined","drop","onmousemove","dragging","setX","setY","width","height","document","createElement","setAttribute","ctx","getContext","noBuffers","pixelRatio","context","backingStore","backingStorePixelRatio","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","window","devicePixelRatio","$705ca8a2f34171f8$var$getPixelRatio","style","scale","clearRect","setCtx","setNoBuffers","$1241477ff5cc3c1e$var$STYLES","$1241477ff5cc3c1e$export$3b0a2f84a08ecd6c","$1241477ff5cc3c1e$var$CanvasGradient","$1241477ff5cc3c1e$var$CanvasPattern","$1241477ff5cc3c1e$var$namedEntities","$1241477ff5cc3c1e$var$format","str","args","keys","Object","replace","RegExp","$1241477ff5cc3c1e$var$randomString","holder","randomstring","Error","chars","floor","random","$1241477ff5cc3c1e$var$getDominantBaseline","textBaseline","mapping","alphabetic","hanging","top","bottom","middle","items","radix","entity","base10","lookup","split","parseInt","$1241477ff5cc3c1e$var$createNamedToNumberedLookup","strokeStyle","svgAttr","svg","apply","fillStyle","lineCap","lineJoin","miterLimit","lineWidth","shadowColor","shadowOffsetX","shadowOffsetY","textAlign","lineDash","gradientNode","__root","__ctx","prototype","addColorStop","offset","color","matches","stop","__createElement","indexOf","exec","b","appendChild","pattern","defaultOptions","enableMirroring","arguments","options","__document","__canvas","__setDefaultStyles","__stack","__getStyleState","__groupStack","createElementNS","setAttributeNS","__ids","__defs","__currentElement","elementName","properties","resetFill","key","element","__applyStyleState","styleState","__applyStyleToCurrentElement","type","__currentElementsToStyle","currentStyleGroup","children","node","value","id","childNodes","getAttribute","currentElement","attr","opacity","globalAlpha","__closestGroupOrSvg","nodeName","parentNode","getSerializedSvg","fixNamedEntities","regexp","serialized","XMLSerializer","serializeToString","test","getSvg","save","group","parent","restore","pop","state","__addTransform","t","__applyCurrentDefaultPath","transform","rotate","angle","degrees","PI","cx","translate","a","e","f","beginPath","path","__currentDefaultPath","__currentPosition","console","error","__addPathCommand","command","moveTo","closePath","lineTo","bezierCurveTo","cp1x","cp1y","cp2x","cp2y","quadraticCurveTo","cpx","cpy","$1241477ff5cc3c1e$var$normalize","vector","len","sqrt","draw","svgUIDiv","button","innerText","onclick","old","svgCtx","svgDiv","innerHTML","hidden","svgHideButton","downloadLink","url","encodeURIComponent","href","outputSVG","download","buttonConfig","onChoose","config","name","nameIsHTML","dom","fixMargin","margin","max","marginRight","realname","onClick","turnOff","isOn","turnOn","config1","data","makeData","buttonConfigs","doMakeData","labelName","label","labelIsHTML","isCheckbox","isCheckboxBool","justButton","buttonHidden","buttonDOMByValue","init","buttons","buttonsByName","labelDOM","conf","$d019958dda7398e8$export$2e2bcd8739ae039","onToggle","i1","selected","updateNames","data2","redraw","configureHidden","buttonName","entries","buttonData","setTimeout","highlight","propName","propValue","ibu","bu","ibu1","theButton","filter","object","prop","setProp","change","list","configure","choose","$4088c71a26df2b7b$export$2e2bcd8739ae039","select","divMenu","addMenuItem","choice","menuItem","$ced2438c3869b330$export$2e2bcd8739ae039","cans","lines","Array","k","c1","c2","$7b2626bce2a28c1d$var$equidistantLine","$7b2626bce2a28c1d$var$findLines","sumArea","voterGroup","area","lineSet","$7b2626bce2a28c1d$var$sumCircle","dx","dy","circle","sum","x1","y1","diff2","half","high","low","line","ay","A","ax","Infinity","y2","min","arcTo","x2","radius","x0","y0","unit_vec_p1_p0","unit_vec_p1_p2","cos","theta","acos","unit_vec_p1_origin","len_p1_origin","sin","x3","y3","unit_vec_origin_start_tangent","unit_vec_origin_end_tangent","getAngle","startAngle","endAngle","arc","stroke","fill","rect","fillRect","strokeRect","__clearCanvas","rootGroup","removeChild","createLinearGradient","grad","gradientUnits","createRadialGradient","r0","r1","cy","fx","fy","__parseFont","fontPart","font","size","family","weight","decoration","__fontHref","__wrapTextLink","__applyText","text","action","textElement","left","right","center","start","end","createTextNode","fillText","strokeText","measureText","pluralityBallot","candidates","voterGroups","summer","$7b2626bce2a28c1d$export$2e2bcd8739ae039","tally","map","index","total","reduce","votes","tallyFractions","nk","huntingtonHill","electionMethodOptions","seats","threshold","populations","nparties","minPopulation","sort","divisorPattern","_","lastSignpost","flat","menu","run","electionResults","checkElectionType","methodResults","$ee120a7268fdcb91$export$2e2bcd8739ae039","electionMethod","allocation","iWinner","electionMethodList","electionMethodListByFunctionName","method","$b860c4c21bb814d1$export$2e2bcd8739ae039","newVoterGroup","newCandidate","can","clearCandidates","getCandidates","runElection","$a0cd9654243cb66c$export$2e2bcd8739ae039","updateTallies","fraction","setFraction","$478baf4512f7400e$var$cachedSetTimeout","$478baf4512f7400e$var$cachedClearTimeout","$478baf4512f7400e$var$process","$478baf4512f7400e$exports","$478baf4512f7400e$var$defaultSetTimout","$478baf4512f7400e$var$defaultClearTimeout","$478baf4512f7400e$var$runTimeout","fun","call","clearTimeout","e1","$478baf4512f7400e$var$currentQueue","$478baf4512f7400e$var$queue","$478baf4512f7400e$var$draining","$478baf4512f7400e$var$queueIndex","$478baf4512f7400e$var$cleanUpNextTick","concat","$478baf4512f7400e$var$drainQueue","timeout","marker","$478baf4512f7400e$var$runClearTimeout","$478baf4512f7400e$var$Item","array","$478baf4512f7400e$var$noop","nextTick","title","browser","env","argv","version","versions","on","addListener","once","off","removeListener","removeAllListeners","emit","prependListener","prependOnceListener","listeners","binding","cwd","chdir","dir","umask","$48c47b1a48ae3b30$export$cea96571ebbff9dd","None","amount","In","Out","InOut","pow","s","Bounce","hrtime","time","performance","now","bind","Date","getTime","$48c47b1a48ae3b30$export$eb2fcfdbd7ba97d4","_tweens","_tweensAddedDuringUpdate","getAll","_this","tweenId","removeAll","tween","getId","remove","update","preserve","$48c47b1a48ae3b30$export$461939dd4422153","tweenIds","autoStart","$48c47b1a48ae3b30$export$b0cc4f9860136880","Linear","v","fn","Utils","pw","bn","Bernstein","CatmullRom","p0","p1","fc","Factorial","p2","p3","v0","v1","t2","$48c47b1a48ae3b30$export$edde1bcb1b2b310e","nextId","_nextId","$48c47b1a48ae3b30$export$208a41d6b4e37b97","_object","_group","$48c47b1a48ae3b30$var$mainGroup","_isPaused","_pauseStart","_valuesStart","_valuesEnd","_valuesStartRepeat","_duration","_initialRepeat","_repeat","_yoyo","_isPlaying","_reversed","_delayTime","_startTime","_easingFunction","_interpolationFunction","_chainedTweens","_onStartCallbackFired","_id","_isChainStopped","_goToEnd","isPlaying","isPaused","to","duration","create","property","_swapEndStartRepeatValues","parseFloat","_setupProperties","startValue","startValueIsArray","isArray","propType","isInterpolationList","endValues","_handleRelativeValue","slice","reverse","stopChainedTweens","_onStopCallback","pause","resume","numChainedTweens","delay","repeat","times","repeatDelay","_repeatDelayTime","yoyo","easing","easingFunction","interpolation","interpolationFunction","chain","tweens","_i","onStart","callback","_onStartCallback","onUpdate","_onUpdateCallback","onRepeat","_onRepeatCallback","onComplete","_onCompleteCallback","onStop","endTime","elapsed","_updateProperties","startIsArray","endIsArray","charAt","tmp","endValue","trueR","render","$e5cd87510cb0735f$var$splitter","$e5cd87510cb0735f$var$sum","elen","flen","Q","Qnew","hh","bvirt","enow","fnow","eindex","findex","hindex","$e5cd87510cb0735f$var$vec","Float64Array","$e5cd87510cb0735f$var$B","$e5cd87510cb0735f$var$C1","$e5cd87510cb0735f$var$C2","$e5cd87510cb0735f$var$D","$e5cd87510cb0735f$var$u","$e5cd87510cb0735f$var$orient2d","bx","by","detleft","detright","det","detsum","acxtail","acytail","bcxtail","bcytail","ahi","alo","bhi","blo","_j","_0","s1","s0","t1","t0","u3","acx","bcx","acy","bcy","$e5cd87510cb0735f$var$estimate","errbound","C1len","C2len","Dlen","$e5cd87510cb0735f$var$orient2dadapt","$e5cd87510cb0735f$var$EPSILON","$e5cd87510cb0735f$var$EDGE_STACK","Uint32Array","$e5cd87510cb0735f$var$Delaunator","points","getX","$e5cd87510cb0735f$var$defaultGetX","getY","$e5cd87510cb0735f$var$defaultGetY","coords","maxTriangles","_triangles","_halfedges","Int32Array","_hashSize","ceil","_hullPrev","_hullNext","_hullTri","_hullHash","_ids","_dists","hullPrev","hullNext","hullTri","hullHash","minX","minY","maxX","maxY","i0","i2","minDist","i3","$e5cd87510cb0735f$var$dist","i0x","i0y","i4","i1x","i1y","minRadius","i5","$e5cd87510cb0735f$var$circumradius","i2x","i2y","$e5cd87510cb0735f$var$quicksort","hull","j","i8","d0","subarray","triangles","halfedges","ex","ey","bl","cl","$e5cd87510cb0735f$var$circumcenter","_cx","_cy","i6","_hullStart","hullSize","_hashKey","trianglesLen","_addTriangle","xp","yp","q","_legalize","i7","$e5cd87510cb0735f$var$pseudoAngle","ar","a0","al","$e5cd87510cb0735f$var$inCircle","pr","pl","hbl","_link","br","b0","px","py","bp","cp","ids","dists","temp","tempDist","$e5cd87510cb0735f$var$swap","arr","$e5cd87510cb0735f$var$epsilon","$e5cd87510cb0735f$var$Path","_x0","_y0","_x1","_y1","$e5cd87510cb0735f$export$20f0351992a349","constructor","delaunay","xmin","ymin","xmax","ymax","_circumcenters","vectors","_init","circumcenters","t3","ab","sign","i9","buffer","inedges","ti","tj","xi","yi","xj","yj","_renderSegment","h0","h1","i10","_project","_clip","i11","cell","cellPolygon","polygon","$e5cd87510cb0735f$var$Polygon","renderCell","S","c0","_regioncode","_clipSegment","_step","ci","neighbors","cj","loop","ai","li","aj","lj","_cell","e0","V","_clipInfinite","_clipFinite","P","sx0","sy0","sx1","sy1","_edgecode","_edge","contains","vx0","vy0","vxn","vyn","from","unshift","i12","vx","vy","$e5cd87510cb0735f$var$tau","$e5cd87510cb0735f$var$pow","$e5cd87510cb0735f$var$pointX","$e5cd87510cb0735f$var$pointY","$e5cd87510cb0735f$var$jitter","static","that","$e5cd87510cb0735f$export$42fc3f3b24093a06","$e5cd87510cb0735f$var$flatArray","$e5cd87510cb0735f$var$flatIterable","_delaunator","$e5cd87510cb0735f$var$collinear","collinear","bounds","hypot","i13","hullIndex","_hullIndex","n1","l","dt","dc","renderHull","trianglePolygon","renderTriangle","election","voronoi","clip","square","dragm","$7e6df0195baf0a28$export$2e2bcd8739ae039","voronoiGroup","$4196ffe27cb15eba$export$2e2bcd8739ae039","trueW","trueH","tweenSq","$2f050392e6e0d7a5$export$2e2bcd8739ae039","textsize","lw","$1c74a930238118e5$export$a2f18a0619b13ed4","toFixed","sq","$ef0738f76f8e8a9b$export$2e2bcd8739ae039","sq2","sq3","$8ec345a8e1f3dd9e$export$2e2bcd8739ae039","ci2","newCandidateDistribution","simElections","cd","$d8f98851c6cbebe3$export$2e2bcd8739ae039","$17c14e9d542a7f08$export$2e2bcd8739ae039","addSim","startSim","initialState","sims","one","many","typeExit","$fb1d46f883a07efa$export$2e2bcd8739ae039","$04b5b09d402c874e$export$2e2bcd8739ae039","typeList","candidateDistributions","cdf","areasProportion","sumAreasProportion","pmf","$cba26d0191240401$var$getCDF","samplePoint","iDist","random1","findIndex","$cba26d0191240401$var$randomDistribution","X","Y","R","$cba26d0191240401$var$randomInsideCircle","$cba26d0191240401$var$samplePoint1","newPoints","canDis","sampler","$cba26d0191240401$export$2e2bcd8739ae039","context2","canvas2","point","$94abc02d6778047b$export$2e2bcd8739ae039","results","winner","winPoint","jitterSize","numPoints","renderPoints","noBufferRender","bufferRender","drawImage","$5b0e6872a2899b94$export$2e2bcd8739ae039","$391ef04f7f5158b8$export$2e2bcd8739ae039","$705ca8a2f34171f8$export$2e2bcd8739ae039","$cc1b5be8d2aed4c2$export$2e2bcd8739ae039","$86d3719043a1dad3$export$2e2bcd8739ae039","$1090428139f5fe20$export$2e2bcd8739ae039","$3a867b251b0042ca$export$2e2bcd8739ae039","sim","$24bbb315554fbe91$export$2e2bcd8739ae039","div","$da2aa8f444e54d1f$export$2e2bcd8739ae039","requestAnimationFrame","gameLoop","getElementsByClassName","target","$c79d11f6216552bb$export$2e2bcd8739ae039","initialstate"],"version":3,"file":"addSandboxes.js.map"}