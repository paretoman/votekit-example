{"mappings":"cAKIA,IAAW,gBAGPC,KAAKC,QAAS,EACdD,KAAKE,WAAa,GAClBF,MAAKD,GAAW,EAGpBI,UAAUC,GACNJ,KAAKC,OAASG,EAGlBC,aAAaC,GACTN,KAAKE,WAAWK,KAAKD,GAGzBE,YAAYC,EAASC,GACbV,KAAKC,SAA4B,IAAlBD,MAAKD,GACpBC,MAAKD,GAAW,EAChBC,KAAKE,WAAWS,SAASC,GAAQA,EAAIC,OAAOJ,KAC5CT,MAAKD,GAAW,GAEhBW,EAAgBG,OAAOJ,GAI/BK,oBAAoBC,EAAUL,GACtBV,KAAKC,SAA4B,IAAlBD,MAAKD,GACpBC,MAAKD,GAAW,EAChBC,KAAKE,WAAWS,SACXC,GAAQA,EAAII,eAAeD,KAEhCf,MAAKD,GAAW,GAEhBW,EAAgBM,eAAeD,GAIvCE,oBAAoBC,EAAWR,GACvBV,KAAKC,SAA4B,IAAlBD,MAAKD,GACpBC,MAAKD,GAAW,EAChBC,KAAKE,WAAWS,SACXC,GAAQA,EAAIO,eAAeD,KAEhClB,MAAKD,GAAW,GAEhBW,EAAgBS,eAAeD,GAIvCE,sBAAsBL,EAAUL,GACxBV,KAAKC,SAA4B,IAAlBD,MAAKD,GACpBC,MAAKD,GAAW,EAChBC,KAAKE,WAAWS,SACXC,GAAQA,EAAIS,iBAAiBN,KAElCf,MAAKD,GAAW,GAEhBW,EAAgBW,iBAAiBN,iBCxDzC,MAAMO,EAAOtB,KAEPuB,EAAU,CAAC,QAEjBD,EAAKE,IAAOC,IACRA,EAAWd,SACNe,GAAMH,EAAQhB,KAAKmB,MAG5BJ,EAAKK,MAASF,IACV,IAAIG,EAAI,EAIR,OAHAH,EAAWd,SACNe,IAAQE,GAAKL,EAAQM,SAASH,GAAK,EAAI,KAErCE,EAAI,GAEfN,EAAKQ,UAAS,IAA6B,IAAnBP,EAAQQ,OAChCT,EAAKU,MAAK,KACNT,EAAQU,OAAO,EAAGV,EAAQQ,sBCf9B,MAAMT,EAAOtB,KAGbsB,EAAKY,SAAW,CACZC,MAAK,OACLC,KAAI,OACJC,IAAG,OACHC,UAAS,OACTC,WAAU,OACVC,SAAQ,QAIZlB,EAAKmB,IAAOC,IACRC,OAAOC,OAAOtB,EAAKY,SAAUQ,eCVNG,EAAGC,EAAGC,GACjC,MAAMzB,EAAOtB,KAEbsB,EAAK0B,MAAQH,EACbvB,EAAK2B,OAASH,EAGdxB,EAAK4B,OAASC,SAASC,cAAc,UACrC9B,EAAK4B,OAAOG,aAAa,QAAS,cAClC/B,EAAKgC,IAAMhC,EAAK4B,OAAOK,WAAW,MAGlCjC,EAAKkC,WAAaL,SAASC,cAAc,UACzC9B,EAAKkC,WAAWH,aAAa,QAAS,cACtC/B,EAAKmC,KAAOnC,EAAKkC,WAAWD,WAAW,MAGvCjC,EAAKoC,QAAUP,SAASC,cAAc,UACtC9B,EAAKoC,QAAQL,aAAa,QAAS,WACnC/B,EAAKqC,KAAOrC,EAAKoC,QAAQH,WAAW,MAEpC,MAAMK,EAAWT,SAASC,cAAc,OACxCL,EAAOc,WAAW,WAAYD,GAC9Bb,EAAOc,WAAW,SAAUvC,EAAK4B,QACjCH,EAAOc,WAAW,aAAcvC,EAAKkC,YACrCT,EAAOc,WAAW,UAAWvC,EAAKoC,SAElCpC,EAAKwC,WAAY,EAIjBxC,EAAKyC,oBAoEcC,GACnB,MAAMC,EAAeD,EAAQE,wBACpBF,EAAQG,8BACRH,EAAQI,2BACRJ,EAAQK,0BACRL,EAAQM,yBACRN,EAAQE,wBAA0B,EAE3C,OAAQK,OAAOC,kBAAoB,GAAKP;;;;;;;;;;;;GA5EtBQ,CAAcnD,EAAKgC,KAErChC,EAAK4B,OAAOF,MAAQH,EAAIvB,EAAKyC,WAC7BzC,EAAK4B,OAAOD,OAASH,EAAIxB,EAAKyC,WAE9BzC,EAAK4B,OAAOwB,MAAM1B,MAAK,GAAMH,MAC7BvB,EAAK4B,OAAOwB,MAAMzB,OAAM,GAAMH,MAE9BxB,EAAKkC,WAAWR,MAAQH,EAAIvB,EAAKyC,WACjCzC,EAAKkC,WAAWP,OAASH,EAAIxB,EAAKyC,WAElCzC,EAAKkC,WAAWkB,MAAM1B,MAAK,GAAMH,MACjCvB,EAAKkC,WAAWkB,MAAMzB,OAAM,GAAMH,MAElC,MAAM6B,EAAKC,KAAKC,MAAM/B,EAAI,GAC1BxB,EAAKoC,QAAQV,MAAQH,EAAIvB,EAAKyC,WAC9BzC,EAAKoC,QAAQT,OAAS0B,EAAKrD,EAAKyC,WAEhCzC,EAAKoC,QAAQgB,MAAM1B,MAAK,GAAMH,MAC9BvB,EAAKoC,QAAQgB,MAAMzB,OAAM,GAAM0B,MAE/BrD,EAAKgC,IAAIwB,MAAMxD,EAAKyC,WAAYzC,EAAKyC,YACrCzC,EAAKmC,KAAKqB,MAAMxD,EAAKyC,WAAYzC,EAAKyC,YACtCzC,EAAKqC,KAAKmB,MAAMxD,EAAKyC,WAAYzC,EAAKyC,YAEtCzC,EAAKU,MAAQ,WACTV,EAAKgC,IAAIyB,UAAU,EAAG,EAAGzD,EAAK4B,OAAOF,MAAO1B,EAAK4B,OAAOD,SAE5D3B,EAAK0D,gBAAkB,WACnB1D,EAAKmC,KAAKsB,UAAU,EAAG,EAAGzD,EAAK4B,OAAOF,MAAO1B,EAAK4B,OAAOD,SAE7D3B,EAAK2D,OAAS,SAAUvD,GACpBJ,EAAKgC,IAAM5B,GAEfJ,EAAK4D,QAAU,SAAUxD,GACrBJ,EAAKmC,KAAO/B,GAEhBJ,EAAK6D,QAAU,SAAUzD,GACrBJ,EAAKqC,KAAOjC,GAEhBJ,EAAK8D,aAAe,SAAUtB,GAC1BxC,EAAKwC,UAAYA,GAErBxC,EAAK+D,YAAW,KACZ/D,EAAKoC,QAAQgB,MAAMY,QAAU,SAEjChE,EAAKiE,YAAW,KACZjE,EAAKoC,QAAQgB,MAAMY,QAAU,QAGjChE,EAAKkE,cAAgB,IAAIC,EACzB,MAAOvD,SAACA,GAAaZ,EAAKkE,cAE1BlE,EAAKkC,WAAWkC,YAAeC,GAAMzD,EAASC,MAAMwD,GACpDrE,EAAKkC,WAAWoC,YAAeD,GAAMzD,EAASE,KAAKuD,GACnDrE,EAAKkC,WAAWqC,UAAaF,GAAMzD,EAASG,IAAIsD,GAChDrE,EAAKkC,WAAWsC,iBAAiB,aAAcH,GAAMzD,EAASI,UAAUqD,KACxErE,EAAKkC,WAAWsC,iBAAiB,cAAeH,GAAMzD,EAASK,WAAWoD,KAC1ErE,EAAKkC,WAAWsC,iBAAiB,YAAaH,GAAMzD,EAASM,SAASmD,KAGtE,MAAMI,EAAU5C,SAAS0C,UACzB1C,SAAS0C,UAAS,KACVE,GAASA,IACbzE,EAAKkC,WAAWqC,iBC7EpBG,EAA6DC,EAAAC,EAAAC,EAAAC,WAEzDC,EAAAC,EAAAC,OACiBC,EAAjBC,EAAA9D,OAAY8D,KAAKF,OACjBC,EAAK,EAACA,EAAMC,EAAI1E,OACZyE,IAAAF,EAAAA,EAAYI,QAAU,IAAKC,OAAM,MAAKF,EAAMD,GAAK,MAAM,MAAMD,EAAAE,EAAAD,KAErE,OAACF,EAIL,SAAmDM,EAAAC,SAC1CC,EAAAN,EACL,IAAKK,EAAQ,MAAE,IAAME,MAAI,iEAAAC,EAAG,sDAC5BF,EAAc,GACd,GAEK,IADkCA,EAAA,GAC9BN,EAAI,EAAGA,EAAA,GAAMA,IAAMM,GAAWE,EAAApC,KAAAqC,MAAArC,KAAAsC,SAAAF,EAAAjF,eACnC8E,EAAYC,WACZA,EAsBR,SAA8EK,EAAAC,GAE9E,IAAAC,EAAA,CA4BwDC,WAAA,aACxDC,QAAA,UACiBC,IAAA,mBACTC,OAAkB,kBAClBC,OAAkB,kBAElBL,EAAgBD,IAAiCC,EAAAC,sBAvDeK,EAAAC,GACpE,IAAApB,EAAOqB,EACPC,EADcC,EAAY,GAM1B,IAJHJ,EAAAA,EAAAK,MAAA,KAE0DJ,EAAAA,GAAA,GAE1BpB,EAAA,EAAAA,EAAAmB,EAAA5F,OAAAyE,GAAA,EACzBqB,EAAO,IAAIF,EAAAnB,EAAA,GAAA,IAAAsB,EAAcG,SAAAN,EAAAnB,GAAAoB,GAAEG,EAAOF,GAAM,KAAAC,EAAA,IAAiD,SAAN,SAAM,SAACC,EAmDxEG,CAAA,+rEAAA,MAEJ,CAClBC,YAAC,CACQC,QAAE,SACPlF,OAAO,UACPmF,IAAA,OACAC,MAAY,UAEhBC,UAAC,CACSH,QAAE,OACRlF,OAAO,UACPmF,IAAA,KACAC,MAAa,QAEjBE,QAAC,CACWJ,QAAA,iBACRlF,OAAO,OACPmF,IAAA,OACAC,MAAO,UAEXG,SAAC,CACUL,QAAC,kBACRlF,OAAO,QACPmF,IAAA,QACAC,MAAO,UAEXI,WAAC,CACYN,QAAA,oBACTlF,OAAO,GACPmF,IAAA,EACAC,MAAO,UAEXK,UAAC,CACKP,QAAE,eACJlF,OAA0E,EAC1EmF,IAAA,EACHC,MAAA,sBAEqB,CACrBF,QAAA,UACclF,OAAA,EACXmF,IAAA,EACHC,MAAA,oBAEG,CAEQpF,OAAA,mBAEZ0F,YAAC,CACU1F,OAAA,WAEX2F,cAAC,CACa3F,OAAA,GAEd4F,cAAC,CACS5F,OAAG,cAEE,CACXA,OAAM,GAEV6F,UAAC,CACJ7F,OAAA,SAQGkE,aAAc,CACVlE,OAAM,cAKX8F,SAAA,CAEKZ,QAAO,mBACPlF,OAAC,GACDmF,IAAK,KACLC,MAAoD,aAGiD,SAAAW,EAAAhD,QACrGiD,OAAKD,EACTjJ,KAACmJ,MACQlD,GAMTC,EAAqBkD,UAAAC,aAAA,SAAAC,EAAAC,GACrB,IAAgBC,EAAZC,EAAMzJ,KAAGmJ,MAAAO,gBAAA,QAChBD,EAAApG,aAAA,SAAAiG,IAUE,IAAAC,EAAAI,QAAA,SAEmCH,EAAL,kEAAeI,KAAAL,GAAEE,EAAApG,aAAkB,aAAKgD,EAAA,mBAAA,CAAGwD,EAAOL,EAAA,GAEdM,EAAAN,EAAA,GAC7DO,EAAAP,EAAU,MAEVC,EAAApG,aAAgB,eAAWmG,EAAA,KAC3BC,EAAQpG,aAAS,aAAWkG,GAChCvJ,KAACkJ,OAAYc,YACFP,MAKW,SAAAQ,EAAAhE,GAElBjG,KAAAkJ,OAAWe,EAGfjK,KAAemJ,MAAAlD,MAaqB,SAAsBiE,SACtDC,EAAiB,CACpBnH,MAAA,IAEGC,OAAC,IACDmH,iBAAY,GAQhB,GAPIC,UAACtI,OAAiB,IAEAuI,EAAAH,GACXnH,MAAQqH,UAAW,GAC1BC,EAAQrH,OAAAoH,UAAsB,IAE7BC,EADOJ,GAAaC,IAEpBnK,gBAAOiG,GACZ,OAAK,IAAMA,EAAmCqE,GAG9CtK,KAAKgD,MAAQsH,EAACtH,OAAAmH,EAAAnH,MAAAhD,KAACiD,OAAAqH,EAAArH,QAAAkH,EAAAlH,OAEfjD,KAAUoK,qBAAAG,IAAAD,EAAAF,gBAAAE,EAAAF,gBAAAD,EAAAC,gBACVpK,KAAKkD,OAASlD,KACdA,KAAKwK,WAAOF,EAAYnH,UAAWA,SAI/BmH,EAAQhH,IAAAtD,KAAAmJ,MAAiBmB,EAAAhH,KAO9BtD,KAAAyK,SAAAzK,KAAAwK,WAAApH,cAAA,UAEKpD,KAAAmJ,MAAOnJ,KAAUyK,SAAgBlH,WACjC,OAGJvD,KAAI0K,qBAEJ1K,KAAI2K,QAAW,CACX3K,KAAyG4K,wBAEzGC,aAAQ,GAEZ7K,KAAMkJ,OAAKlJ,KAAKwK,WAAUM,gBAAK,6BAAA,YAC3B5B,OAAM7F,aAAM,UAAA,UACZ6F,OAAQ7F,aAAa,QAAK,8BAC9BrD,KAACkJ,OAAA6B,eAAA,gCAAA,cAAA,gCACD/K,KAAAkJ,OAAO7F,aAAO,QAAArD,KAAAgD,OACjBhD,KAAAkJ,OAAA7F,aAAA,SAAArD,KAAAiD,QAOGjD,KAA0EgL,MAAA,QAGtEC,OAAUjL,KAAEwK,WAAAM,gBAAA,6BAAA,aACZ5B,OAAQc,YAAIhK,KAAAiL,QAEnBjL,KAAAkL,iBAAAlL,KAAAwK,WAAAM,gBAAA,6BAAA,KAME9K,KAAAkJ,OAAAc,YAAAhK,KAAAkL,oBAME9B,UAAAM,gBAAA,SAAAyB,EAAAC,EAAAC,QACJ,IAAAD,IAAAA,EAAA,IAQG,IAAqB5E,EAAA8E,EAAjBC,EAAGvL,KAAUwK,WAAIM,gBAAA,6BAAAK,GAAA1E,EAAA9D,OAAA8D,KAAA2E,GAKrB,IALwBC,IAEpBE,EAAMlI,aAAM,OAAA,QACZkI,EAAAlI,aAAkB,SAAQ,SAE9BmD,EAAO,EAAAA,EAAAC,EAAU1E,OAAAyE,IACpB8E,EAAA7E,EAAAD,GAME+E,EAAAlI,aAAAiI,EAAAF,EAAAE,IAGC,OAAIC,KAK8BnC,UAAAsB,mBAAA,WAElC,IAAClE,EAAA8E,EAAA7E,EAAA9D,OAAA8D,KAAAT,GAED,IAAIQ,EAAI,EAAGA,EAAAC,EAAO1E,OAAKyE,IAEnBxG,KADCsL,EAAK7E,EAAMD,IACJR,EAAWsF,GAAEpI,UAQgBkG,UAAWoC,kBAAS,SAAAC,OACxBjF,EAAM8E,WAArB7E,KAAGgF,eACD1J,OAAOyE,iBAEdiF,EAAAH,MAM6FlC,UAAAwB,gBAAA,iBAEzDU,IADlC,YACF7E,KAAKT,eACmDjE,OAAAyE,cAEzDxG,KAAUsL,eAIalC,UAAWsC,6BAAA,SAAAC,SAC9B3L,KAAAkL,mBAGJlL,KAAA4L,+BAEGvI,aAAasI,EAAC,MACbE,EAAyBN,UACzBO,SAAWnL,SAAI,SAAOoL,kBAClBJ,EAAA,YAM0BnF,EAAK9B,EAAAtE,EAAA4L,EAAAxC,WAAvC/C,KAAAT,aACHS,EAAA1E,OAAAyE,IAGZ,aADGpG,EAACJ,KAAAyG,EAAAD,IACJ9B,EAAA4D,MAMF,GAAAlI,aAAA+F,EAAA,CAGU,GAAA/F,EAAa+I,MAGX,KAAK/I,EAAA+I,MAAA8B,OAAoBgB,WAAKlK,QAE5CiK,EAAA5L,EAAA+I,MAAA8B,OAAAgB,WAAA,GAAAC,aAAA,MAOElM,KAAAgL,MAAAgB,GAAAA,EAEehM,KAAOiL,OAAAjB,YAAgB5J,EAAA+I,MAAA8B,OAAsBgB,WACvD,IAGCE,EAAA9I,aAAAqB,EAAA4D,MAAAjC,EAAA,aAAA,CACU2F,GAAA5L,EAAU8I,OACrBgD,aAAa,cAIN,GAAO9L,aAAK8F,EACkDiG,EAAA9I,aAAAqB,EAAA4D,MAAAjC,EAAA,aAAA,CAC9D2F,GAAI5L,EAAC8I,OAAKgD,aAAc,cAEtB,IAAG,IAAAxH,EAAA4D,MAAAqB,QAAAgC,IAAcjH,EAAG2D,MAAAjI,EACzB,GAA6B,WAApBsE,EAAI0D,SAAgB,SAAA1D,EAAA0D,UAAA,IAAAhI,EAAAuJ,QAAA,QA0BhC,CACQ,IAAKyC,EAAK1H,EAAA0D,QAC1B,GAAA,gBAAA3B,EAAAD,KAGE4F,EAAAT,EAAA,IAAAjH,EAAA0D,QAEyB+D,EAAKD,aAAgBE,IAAA,SAGnCD,EACN9I,aAAK+I,EAAgBhM,OArCY,CAKpCoJ,EADI,kEACJI,KAAAxJ,GAEM+L,EAAU9I,aAAAqB,EAAA0D,QAAA/B,EAAA,mBAAA,CACpBwD,EAAAL,EAAA,GAMEM,EAAAN,EAAA,GAEmBO,EAAAP,EAAA,MAMF,IAAC6C,EAAA7C,EAAmB,GAClB8C,EAAAtM,KAAmBsM,YACR,MAAXA,IAAWD,GAAAC,GACtBH,EAAiB9I,aAAAqB,EAAA0D,QAAA,WAAAiE,OA2BkBjD,UAAOmD,oBAAwB,SAAIR,SAA2B,YAA3B/L,KAAOkL,4BAAsB,QAAAa,EAAAS,SAAAT,EAAC/L,KAAAuM,oBAAAR,EAAAU,aAQ3GxG,EAACmD,UAAAsD,iBAAA,SAAAC,GAED,IAA8DlG,EAAAD,EAAA8E,EAAAlL,EAAAwM,EAA1DC,GAAY,IAAKC,eAAgBC,kBAAyB/M,KAAAkJ,QAO9D,GAHI,sFAEK8D,KAAKH,KAAAA,EAAAA,EAAAnG,QAAA,oCAAA,8CACViG,EAOA,IANPlG,EAAA9D,OAAA8D,KAAAL,GAMQI,EAAK,EAAAA,EAASC,EACd1E,OAAIyE,IAEJ8E,EAAA7E,EAAcD,GAA8BpG,EAAAgG,EAAAkF,IAAKsB,EAAA,IAAAjG,OAAA2E,EAAA,OAAC0B,KAAAH,KAAAA,EAAAA,EAAAnG,QAAAkG,EAAAxM,IAOvD,OAAIyM,GAC8E5G,EAACmD,UAAA6D,OAAA,WACtF,OAAAjN,KAAAkJ,UAM4DE,UAAA8D,KAAA,WAAA,IAACC,EAAAnN,KAAA0J,gBAAA,KAC7D0D,EAAApN,KAAAuM,sBAIEvM,KAAA6K,aAAAtK,KAAA6M,GAECA,EAAKpD,YAAcmD,QAA6CjC,iBAAEiC,OAAGxC,QAAEpK,KAAAP,KAAA4K,sBAAoBxB,UAAAiE,QAAA,WAAArN,KAACkL,iBAAAlL,KAAA6K,aAAAyC,MAC/FtN,KAAA4L,yBAAA,KAMO5L,KAAMkL,mBAAMlL,KAAAkL,iBAAAlL,KAAAkJ,OAAA+C,WAAA,IAEhB,IAAyFsB,EAAAvN,KAAA2K,QAAA2C,MACzFtN,KAAuFwL,kBAAA+B,IAIlDtH,EAAOmD,UAAAoE,eAAA,SAAAC,GAE5C,IAAAL,EAAOpN,KAAWuM,sBAClB,GAAIa,EAACnB,WAAgBlK,OAAO,EAAA,CAC/B,SAAA/B,KAAAkL,iBAAAsB,WAKExM,KAAA4L,2BAAA5L,KAAA4L,yBAAA,CAEKL,QAAiB6B,EACjBtB,SAAe,KAKtB9L,KAAA4L,yBAAAE,SAAAvL,KAAAP,KAAAkL,kBAKElL,KAAA0N,6BAGK,IAACP,EAAAnN,KAAA0J,gBAA+B,KACvC0D,EAAApD,YAAAmD,GAKEnN,KAAAkL,iBAAAiC,EAMC,IAA6CQ,EAAA3N,KAAAkL,iBAAAgB,aAAA,aACzCyB,EAACA,GAAqB,IAACA,EAAG,MAAMF,EAAAzN,KAACkL,iBAAA7H,aAAA,YAAAsK,IACc1H,EAACmD,UAAAtE,MAAA,SAAA8I,EAAAC,QACvDtD,IAAAsD,IAAAA,EAAAD,GAIE5N,KAAAwN,eAAAnH,EACH,iBAAA,CACQuH,EAAAA,EAGPC,EAAAA,MAMuC5H,EAACmD,UAAA0E,OAAA,SAAAC,GACrC,IAAIC,EAAK,IAAAD,EAAAnJ,KAAqBqJ,QACkBT,eAAEnH,EAAA,4BAAA,CAAE0H,MAAGC,EAACE,GAAA,KAEpD,MAMLjI,EACHmD,UAAA+E,UAAA,SAAIP,EAAAC,GACA7N,KAAKwN,eAAAnH,EAAqB,qBAAA,CAAAuH,EAAGA,EAAGC,EAAGA,QAECzE,UAAAuE,UAAA,SAAAS,EAAArE,EAAArI,EAAA2M,EAAA1I,EAAA2I,QAAEd,eAASnH,EAAA,kCAAA,CAAE+H,EAAEA,EAAGrE,EAAEA,EAAErI,EAAAA,EAC7D2M,EAAAA,EAIE1I,EAAAA,EAEK2I,EAACA,QACyDlF,UAAAmF,UAAA,eAAEC,EAAiBxO,KAACyO,qBAAA,GACrFzO,KAAA0O,kBAAA,GAOGF,EAAOxO,KAAG0J,gBAAkB,OAAI,IAChC,GAAQ1J,KAAQuM,sBAASvC,YAAewE,GAAAxO,KAACkL,iBAAAsD,GAWzCvI,EAAwCmD,UAAAsE,0BAAmB,WAE3D,IAAgDvB,EAAAnM,KAAAkL,iBAChB,SAA5BiB,EAAwBK,SAAWL,EAAiB9I,aAC9C,IAAArD,KAAAyO,sBAGuFE,QAAAC,MAAA,0CAAAzC,EAAAK,WAQjGvG,EAA8DmD,UAAAyF,iBAAA,SAAApO,GAC9DT,KAA4EyO,sBAAA,IAC5EzO,KAAMyO,sBAAwBhO,GAQ9BwF,EAA8DmD,UAAA0F,OAAA,SAAAlB,EAAAC,GACc,SAAA7N,KAAAkL,iBAAAsB,UAAAxM,KAAAuO,iBAC5CG,kBAAO,CAAEd,EAAEA,EAAMC,EAAAA,QACjBgB,iBAAOxI,EAAA,YAAA,CAAEuH,EAAEA,EAAMC,EAAAA,MAMjD5H,EAA0GmD,UAAA2F,UAAA,WACiB/O,KAAAyO,sBAAAzO,KAAA6O,iBAAA,MAK3H5I,EAA+BmD,UAAoB4F,OAAA,SAAoBpB,EAAAC,GACvE7N,KAAI0O,kBAAkB,CAEHd,EAAAA,EACfC,EAAAA,GAEA7N,KAAAyO,qBAAoB9E,QAAc,MAAE,EAAA3J,KAAA6O,iBAAAxI,EAAA,YAAA,CACvCuH,EAAAA,EACGC,EAAAA,KAEA7N,KAAI6O,iBAAkBxI,EAAuB,YAAA,CAEXuH,EAAAA,EACyBC,EAAAA,MAK/D5H,EAAuEmD,UAAA6F,cAAA,SAAAC,EAAAC,EAAAC,EAAAC,EAAAzB,EAAAC,GACvE7N,KAAI0O,kBAAA,CACAd,EAAAA,IACCC,GAEL7N,KAAI6O,iBAAWxI,EAAmB,wCAAA,CAC9B6I,KAAkDA,EAClDC,KAAKA,EACLC,KAAKA,EACLC,KAAKA,MAKRxB,EAAAA,MAQD5H,EAAkEmD,UAAAkG,iBAAA,SAAAC,EAAAC,EAAA5B,EAAAC,GAClE7N,KAAmD0O,kBAAA,CAC/Cd,EAACA,EACRC,EAAAA,GAMG7N,KAAI6O,iBAAKxI,EACD,wBAAkB,CAEtBkJ,IAACA,EACDC,IAACA,EACR5B,EAAAA,EAIEC,EAAAA,MAWA,IAAA4B,EAAA,SACHC,GACI,IAAIC,EAAK/K,KAAAgL,KAAAF,EAAiB,GAAAA,EAAa,GAAMA,EACrC,GAACA,EAAS,IAElB,MAAK,CACDA,EAAO,GAAGC,EACVD,EAAO,GAAGC,eC3vBmBE,EAAQC,EAAM/M,GAC/C,MAAMF,EAAIgN,EAAO7M,MACXF,EAAI+M,EAAO5M,OAEX8M,EAAW5M,SAASC,cAAc,OACxCL,EAAOc,WAAW,WAAYkM,GAG9B,MAAMC,EAAS7M,SAASC,cAAc,UACtC4M,EAAOC,UAAY,UACnBD,EAAOE,UAAY,WACnBF,EAAOG,mBAiDH,MAAMC,EAAMP,EAAOvM,IACb+M,EAAOR,EAAOpM,KACpBoM,EAAO5K,OAAOqL,GACdT,EAAO3K,QAAQoL,GACfT,EAAOzK,cAAa,GACpB0K,eAcAS,EAAcC,QAAS,EAEvB,MAAMnI,EAAMiI,EAAO5D,kBAAiB,GACpC+D,EAAOC,UAAYrI,EACnBoI,EAAOD,QAAS,EAChBG,EAAaH,QAAS,EACtB,MAAMI,EAAG,oCAAuCC,mBAAmBxI,KACnEsI,EAAaG,KAAOF,EApBpBG,GACAlB,EAAO5K,OAAOmL,GACdP,EAAO3K,QAAQmL,GACfR,EAAOzK,cAAa,GAEpB,MAAM4L,EAAOnB,EAAOlM,KACpBkM,EAAO1K,QAAQ8L,GACfnB,eAgBA,MAAMoB,EAAOD,EAAQvE,kBAAiB,GACtCyE,EAAQT,UAAYQ,EACpBC,EAAQX,QAAS,EACjBY,EAAcZ,QAAS,EACvB,MAAMa,EAAI,oCAAuCR,mBAAmBK,KACpEE,EAAcN,KAAOO,EApBrBC,GACAzB,EAAO1K,QAAQ6L,IA/DnBjB,EAAS/F,YAAYgG,GAGrB,MAAMW,EAAexN,SAASC,cAAc,KAC5CuN,EAAaT,UAAY,eACzBS,EAAaY,SAAW,WACxBZ,EAAaH,QAAS,EACtBG,EAAajM,MAAM8M,OAAS,MAC5BzB,EAAS/F,YAAY2G,GAGrB,MAAMS,EAAgBjO,SAASC,cAAc,KAC7CgO,EAAclB,UAAY,sBAC1BkB,EAAcG,SAAW,kBACzBH,EAAcZ,QAAS,EACvBY,EAAc1M,MAAM8M,OAAS,MAC7BzB,EAAS/F,YAAYoH,GAGrB,MAAMb,EAAgBpN,SAASC,cAAc,UAC7CmN,EAAcN,UAAY,UAC1BM,EAAcL,UAAY,WAC1BK,EAAcC,QAAS,EACvBD,EAAcJ,mBA+DVI,EAAcC,QAAS,EAEvBC,EAAOD,QAAS,EAChBG,EAAaH,QAAS,EAEtBW,EAAQX,QAAS,EACjBY,EAAcZ,QAAS,GApE3BT,EAAS/F,YAAYuG,GAGrB,MAAME,EAAStN,SAASC,cAAc,OACtCqN,EAAOpN,aAAa,QAAS,UAC7BoN,EAAO/L,MAAM1B,MAAK,GAAMH,MACxB4N,EAAO/L,MAAMzB,OAAM,GAAMH,MACzB2N,EAAOD,QAAS,EAChBT,EAAS/F,YAAYyG,GAGrB,MAAMU,EAAUhO,SAASC,cAAc,OACvC+N,EAAQ9N,aAAa,QAAS,WAC9B8N,EAAQzM,MAAM1B,MAAK,GAAMH,MACzBsO,EAAQzM,MAAMzB,OAAM,GAAM2B,KAAKC,MAAM/B,EAAI,OACzCqO,EAAQX,QAAS,EACjBT,EAAS/F,YAAYmH,GAErB,MAAMb,EAAS,IAAIrK,EAAIpD,EAAGC,GACpBmO,EAAU,IAAIhL,EAAIpD,EAAG+B,KAAKC,MAAM/B,EAAI,eCzDf2O,EAAcC,GACzC,MAAMpQ,EAAOtB,KAEbsB,EAAKqQ,OAASF,EACdnQ,EAAKsQ,KAAOH,EAAaG,KACzBtQ,EAAKuQ,WAAaJ,EAAaI,aAAc,EAC7CvQ,EAAKwQ,IAAM3O,SAASC,cAAc,OAClC9B,EAAKwQ,IAAIzO,aAAa,QAAS,kBAG/B,IAAI0O,EAAYN,EAAaD,OAC7BO,EAAYA,GAAa,EACzBA,EAAYnN,KAAKoN,IAAID,EAAW,GAChCzQ,EAAKwQ,IAAIpN,MAAMuN,YAAW,GAAMF,MAGhCzQ,EAAKwO,KAAO,WACJxO,EAAKuQ,WACLvQ,EAAKwQ,IAAIpB,UAAYpP,EAAKsQ,KAE1BtQ,EAAKwQ,IAAI5B,UAAY5O,EAAKsQ,MAGlCtQ,EAAKwO,OACLxO,EAAKwQ,IAAIzO,aAAa,QAASoO,EAAaS,UAAY,IACxD5Q,EAAK6Q,QAAU,WACXT,EAASpQ,EAAMmQ,IAEnBnQ,EAAKwQ,IAAI3B,QAAU7O,EAAK6Q,QAExB7Q,EAAK8Q,QAAU,WACX9Q,EAAK+Q,MAAO,EACZ/Q,EAAKqQ,OAAOU,MAAO,EACnB/Q,EAAKwQ,IAAIzO,aAAa,KAAM,OAEhC/B,EAAKgR,OAAS,WACVhR,EAAK+Q,MAAO,EACZ/Q,EAAKqQ,OAAOU,MAAO,EACnB/Q,EAAKwQ,IAAIzO,aAAa,KAAM,QAEhC/B,EAAK8Q,qBCvC2BG,GAChC,MAAMjR,EAAOtB,KACbsB,EAAKqQ,OAASY,OAIMhI,IAAhBgI,EAAOC,OACPD,EAAOC,KAAO,QACUjI,IAApBgI,EAAOE,WACPF,EAAOE,SAAQ,IAAS,IAE5BnR,EAAKmR,SAAWF,EAAOE,SACvBnR,EAAKoR,cAAgBpR,EAAKmR,WAC1BnR,EAAKqR,YAAa,GAEtBrR,EAAKoR,cAAgBH,EAAOC,KAE5BlR,EAAKsR,UAAYL,EAAOM,MACxBvR,EAAKwR,YAAcP,EAAOO,cAAe,EAEzCxR,EAAKoQ,SAAWa,EAAOb,SACvBpQ,EAAKyR,WAAaR,EAAOQ,aAAc,EACvCzR,EAAK0R,eAAiBT,EAAOS,iBAAkB,EAC/C1R,EAAK2R,WAAaV,EAAOU,aAAc,EACvC3R,EAAK4R,aAAeX,EAAOW,cAAgB,GAG3C5R,EAAKwQ,IAAM3O,SAASC,cAAc,OAClC9B,EAAKwQ,IAAIzO,aAAa,QAAS,gBAE/B/B,EAAK6R,iBAAmB,GAExB7R,EAAK8R,KAAO,WACJ9R,EAAKqR,aAAYrR,EAAKoR,cAAgBpR,EAAKmR,YAG/CnR,EAAKwQ,IAAIpB,UAAY,GACrBpP,EAAK+R,QAAU,GACf/R,EAAKgS,cAAgB,GAGrBhS,EAAKiS,SAAWpQ,SAASC,cAAc,OACvC9B,EAAKiS,SAASlQ,aAAa,QAAS,sBACpC/B,EAAKwO,OACLxO,EAAKwQ,IAAI9H,YAAY1I,EAAKiS,UAG1B,IAAK,IAAI/M,EAAI,EAAGA,EAAIlF,EAAKoR,cAAc3Q,OAAQyE,IAAK,CAChD,MAAMgN,EAAOlS,EAAKoR,cAAclM,GAC1BwJ,EAAS,IAAIyD,EAAOD,EAAMlS,EAAKoS,UACrCpS,EAAKgS,cAAcE,EAAK5B,MAAQ5B,EAChCA,EAAO8B,IAAIpN,MAAM1B,MAAK,GAAMuP,EAAOvP,UAC/BwQ,EAAKxQ,QAAOgN,EAAO8B,IAAIpN,MAAM1B,MAAK,GAAMwQ,EAAKxQ,WACjD1B,EAAK+R,QAAQ9S,KAAKyP,GAClB1O,EAAKwQ,IAAI9H,YAAYgG,EAAO8B,KAC5BxQ,EAAK6R,iBAAiBK,EAAKpT,OAAS4P,EAAO8B,IAI/C,IAAK,IAAI6B,EAAI,EAAGA,EAAIrS,EAAK+R,QAAQtR,OAAQ4R,IAAK,CAC1C,MAAM3D,EAAS1O,EAAK+R,QAAQM,GAC5B,GAAI3D,EAAO2B,OAAOiC,SAAU,CACxB5D,EAAOsC,SACP,OAGRhR,EAAKwO,QAETxO,EAAKuS,YAAc,WACf,MAAMC,EAAQxS,EAAKmR,WACnB,IAAK,IAAIjM,EAAI,EAAGA,EAAIlF,EAAKoR,cAAc3Q,OAAQyE,IAC3ClF,EAAKoR,cAAclM,GAAGoL,KAAOkC,EAAMtN,GAAGoL,KACtCtQ,EAAK+R,QAAQ7M,GAAGoL,KAAOtQ,EAAKoR,cAAclM,GAAGoL,MAGrDtQ,EAAKyS,OAAS,WACVzS,EAAKuS,cACLvS,EAAKwO,QAETxO,EAAKwO,KAAO,WACJxO,EAAKwR,YACLxR,EAAKiS,SAAS7C,UAAYpP,EAAKsR,UAE/BtR,EAAKiS,SAASrD,UAAY5O,EAAKsR,UAEnC,IAAK,MAAM5C,KAAU1O,EAAK+R,QACtBrD,EAAOF,QAIfxO,EAAK0S,gBAAkB,WACnB,IAAK,MAAOC,EAAYzD,KAAW7N,OAAOuR,QAAQ5S,EAAK4R,cACnD5R,EAAKgS,cAAcW,GAAYnC,IAAItB,OAASA,GAKpDlP,EAAKoS,SAAW,SAAU1D,EAAQmE,GAC9B,GAAI7S,EAAKyR,YAAczR,EAAK0R,eACpBhD,EAAOqC,KACPrC,EAAOoC,UAEPpC,EAAOsC,aAER,CAEH,IAAK,IAAI9L,EAAI,EAAGA,EAAIlF,EAAK+R,QAAQtR,OAAQyE,IAAKlF,EAAK+R,QAAQ7M,GAAG4L,UAC9DpC,EAAOsC,SACHhR,EAAK2R,YAELmB,YAAU,IAAOpE,EAAOoC,WAAW,KAI3C9Q,EAAKoQ,SAASyC,IAIlB7S,EAAK+S,UAAY,SAAUC,EAAUC,GAEjC,GAA4B,IAAxBjT,EAAK+R,QAAQtR,OAAjB,CAGA,IAAK,IAAIyE,EAAI,EAAGA,EAAIlF,EAAK+R,QAAQtR,OAAQyE,IAAKlF,EAAK+R,QAAQ7M,GAAG4L,UAE9D,GAAI9Q,EAAKyR,WACL,IAAK,MAAMyB,KAAOlT,EAAK+R,QAAS,CAC5B,MAAMoB,EAAKnT,EAAK+R,QAAQmB,GACpBD,EAAU1S,SAAS4S,EAAG9C,OAAO2C,KAC7BG,EAAGnC,cAGR,GAAIhR,EAAK0R,eACZ,IAAK,MAAM0B,KAAOpT,EAAK+R,QAAS,CAC5B,MAAMoB,EAAKnT,EAAK+R,QAAQqB,GAClBT,EAAaQ,EAAG9C,OAAO2C,GAEzBL,KAAcM,GACVA,EAAUN,IACVQ,EAAGnC,aAIZ,CAEH,MAAMqC,EAAYrT,EAAK+R,QAAQuB,QAAQ5E,IACnC,MAAO2B,OAACA,GAAW3B,EACnB,OAAQ2B,EAAO2C,KAAcC,KAC9B,QACehK,IAAdoK,GACAA,EAAUrC,YAKtBhR,EAAK8R,kBC7IwByB,EAAQC,EAAMC,EAASlC,EAAOvI,EAAS0K,EAAQzT,EAASjB,GACrF,MAAMgB,EAAOtB,SAgCL4N,EA/BRtM,EAAK2T,KAAO3K,EACZhJ,EAAKoQ,SAAW,SAAUc,GACtBlS,EAAU4U,GAAG,CAAEtD,KAAMkD,EAAM1U,MAAOoS,EAAKpS,SAE3CkB,EAAK6T,OAAU/U,IACXkB,EAAKmB,IAAIrC,GACTkB,EAAK8T,UAET9U,EAAU+U,UAAUP,EAAMxT,EAAK6T,OAAQN,EAAOC,IAC9CxT,EAAKmB,IAAM,SAAUrC,GAGjB2U,EAAQ3U,GAERkB,EAAKgU,YAEL/T,EAAQC,IAAIwT,IAEhB1T,EAAKiU,OAAS,IAAIC,EAAY,OAC1B3C,EACA7P,OAWI4K,EAXM,GAWO,IAAM,GAAKA,EAAI,IAAMA,EAAI,GAV1C4E,KAAMlR,EAAK2T,KACXvD,SAAUpQ,EAAKoQ,WAEnBpQ,EAAKgU,UAAY,aAEjBhU,EAAK8T,OAAS,WACV9T,EAAKiU,OAAOlB,UAAU,QAASQ,EAAOC,gBCzCjBvT,EAASwB,EAAQzC,GAC1C,MAAMgB,EAAOtB,KACbsB,EAAKmU,QAAUtS,SAASC,cAAc,OACtCL,EAAOc,WAAW,OAAQvC,EAAKmU,SAC/BnU,EAAKoU,YAAc,SAAUb,EAAQc,GACjC,MAAOb,KACHA,EAAIC,QAAEA,EAAOlC,MAAEA,EAAKvI,QAAEA,EAAO0K,OAAEA,GAC/BW,EAGEC,EAAW,IAAIC,EAAShB,EAAQC,EAAMC,EAASlC,EAAOvI,EAAS0K,EAAQzT,EAASjB,GACtFsV,EAASR,SAET9T,EAAKmU,QAAQzL,YAAY4L,EAASL,OAAOzD,iBCjBdgE,GAC/B,MAEMC,WAkBSD,GAEf,MAAMlU,EAAIkU,EAAK/T,OACTgU,EAAQ,IAAIC,MAAMpU,GACxB,IAAK,IAAI4E,EAAI,EAAGA,EAAI5E,EAAG4E,IAAK,CACxBuP,EAAMvP,GAAK,GACX,IAAK,IAAIyP,EAAI,EAAGA,EAAIrU,EAAGqU,IAAK,CAExB,GAAIzP,IAAMyP,EAAG,SAEb,MAAMC,EAAKJ,EAAKtP,GACV2P,EAAKL,EAAKG,GAEhBF,EAAMvP,GAAGjG,KAAK6V,EAAgBF,EAAIC,KAI1C,OAAOJ,EAnCOM,CAAUP,GAFX9V,KAMRsW,QAAU,SAAiBC,GAG5B,MAAM3U,EAAImU,EAAMhU,OACVyU,EAAOR,MAAMpU,GACnB,IAAK,IAAI4E,EAAI,EAAGA,EAAI5E,EAAG4E,IAAK,CACxB,MAAMiQ,EAAUV,EAAMvP,GAEtBgQ,EAAKhQ,GAAKkQ,EAAUH,EAAYE,GAEpC,OAAOD,YAoDNJ,EAAgBF,EAAIC,GAQzB,MAAMQ,EAAKR,EAAGvI,EAAIsI,EAAGtI,EACfgJ,EAAKT,EAAGtI,EAAIqI,EAAGrI,EAkBrB,MAAO,GANG,CAAED,EAAG+I,EAAI9I,EAAG+I,KATK,IAAfV,EAAGtI,EAAIuI,EAAGvI,GAUP+I,EATY,IAAfT,EAAGrI,EAAIsI,EAAGtI,GASG+I,YAQpBF,EAAUG,EAAQJ,GAOvB,IAAIK,EAAM,EACV,MAAMC,EAAKF,EAAOjJ,EACZoJ,EAAKH,EAAOhJ,GACXhE,EAACA,GAAMgN,EAEd,IAAK,IAAIjJ,EAAImJ,EAAKlN,EAAG+D,EAAImJ,EAAKlN,EAAG+D,GANtB,EAM+B,CAMtC,MAAMqJ,EAAQpN,GAAK,GAAK+D,EAAImJ,IAAO,EACnC,IAAIG,EAEAA,EADAD,EAAQ,EACDrS,KAAKgL,KAAKqH,GAEV,EAEX,IAAIE,EAAOH,EAAKE,EACZE,EAAMJ,EAAKE,EASfT,EAAQ9V,SAAS0W,IACb,MAAMC,EAAKD,EAAKE,EAAE1J,EACZ2J,EAAKH,EAAKE,EAAE3J,GACX7D,EAACA,GAAMsN,EACd,GAAW,IAAPC,EACIE,EAAK5J,EAAI7D,IAGTqN,EAAMK,EAAAA,OAGP,CACH,MAAMC,GAAM3N,EAAIyN,EAAK5J,GAAK0J,EACtBA,EAAK,EACLF,EAAMxS,KAAKoN,IAAIoF,EAAKM,GAEpBP,EAAOvS,KAAK+S,IAAIR,EAAMO,OAMlC,MAAMd,EAAKO,EAAOC,EAClB,GAAIR,EAAK,EAAG,CAERE,GAtDG,EAqDUF,GAIrB,OAAOE,ENwmBP7Q,EAAqCmD,UAAAwO,MAAA,SAAAb,EAAAC,EAAAa,EAAAH,EAAAI,OAEjCC,EAAK/X,KAAA0O,mBAAA1O,KAAA0O,kBAAAd,EACLoK,EAAKhY,KAAG0O,mBAAK1O,KAAA0O,kBAAAb,EAEjB,QAAO,IAAAkK,QAAA,IAAAC,EAAP,CAEA,GAAAF,EAAO,EAAA,MAAY,IAAI/Q,MAAA,wCAAA+Q,EAAA,kBAcvB,GAAIC,IAAOhB,GAACiB,IAAAhB,GAAsBD,IAAGc,GAAAb,IAAAU,GAAA,IAAAI,EACjC9X,KAAKgP,OAAA+H,EAAAC,OADT,CAOA,IAAAiB,EAAmBxI,EAAI,CACnBsI,EAAChB,EACDiB,EAAChB,IAQNkB,EAAAzI,EAAA,CAEKoI,EAAAd,EAEAW,EAAAV,IAEJ,GAAKiB,EAAQ,GAAWC,EAAa,IAAQD,EAC3B,GACVC,EAAU,GAFlB,KAmBIC,EAAKF,EAAa,GAAAC,EAAA,GAAAD,EAAA,GAAAC,EAAA,GAClBE,EAAMxT,KAAAyT,KAAAzT,KAAA0T,IAAAH,IAENI,EAAoB9I,EAAmB,CACvCwI,EAAQ,GAAAC,EAAyB,GACjCD,EAAK,GAAAC,EAAA,KAELM,EAAaV,EAAAlT,KAAA6T,IAAAL,EAAA,GACbM,EAAA3B,EAASyB,EAAMD,EAAA,GACfI,EAAI3B,EAAYwB,EAAAD,EAAA,GAGvBK,EAAA,EAKEX,EAAA,GAEKA,EAAY,IAGZY,EAAY,CACZX,EAAY,IACZA,EAAY,IAEbY,EAAK,SAAApJ,GAER,IAAO9B,EAAI8B,EAAA,GAMZ,OALFA,EAAA,IAKE,EAAA9K,KAAAyT,KAAAzK,IAEiBhJ,KAAAyT,KAAAzK,IAEZmL,EAAYD,EAAAF,GACZI,EAAYF,EAAAD,QAEZ7J,OAAO0J,EAAKE,EAAA,GAAAd,EAAAa,EAAAC,EAAA,GAAAd,GAGhB9X,KAAGiZ,IAAKP,EAAAC,EAAAb,EAAAiB,EAAAC,QA1DJhZ,KAACgP,OAAA+H,EAAAC,MAmEN/Q,EAAAmD,UAAA8P,OAAA,WAEU,SAALlZ,KAAKkL,iBAAAsB,UAAAxM,KAAAkL,iBAAA7H,aAAA,cAAA,uBACTrD,KAAI0N,4BACJ1N,KAAI0L,6BAAQ,aAIuBtC,UAAA+P,KAAA,WACK,SAApCnZ,KAAAkL,iBAAuBsB,UAAaxM,KAAAkL,iBAAA7H,aAAA,cAAA,4BACpCqK,4BACJ1N,KAAC0L,6BAAA,SAQDzF,EACqBmD,UAAUgQ,KAAA,SAAAxL,EAAAC,EAAA7K,EAAAC,GAGpB,SAAXjD,KAAOkL,iBAAIsB,UAAAxM,KAAAuO,YACdvO,KAAA8O,OAAAlB,EAAAC,GAQE7N,KAAAgP,OAAApB,EAAA5K,EAAA6K,GAEC7N,KAAIgP,OAAKpB,EAAO5K,EAAA6K,EAAA5K,QACZ+L,OAAQpB,EAAAC,EAAK5K,QACZ+L,OAACpB,EAAAC,QACDkB,aAIR9I,EAAAmD,UAAAiQ,SAAA,SAAAzL,EAAAC,EAAA7K,EAAAC,GASE,IAAAmW,EAECA,EAAIpZ,KAAO0J,gBAAgB,OACvB,CAEIkE,EAAaA,EACbC,EAAWA,EACX7K,MAAYA,EACZC,OAAaA,OAEPjD,KAACuM,sBACJvC,YAAIoP,QACMlO,iBAAEkO,OACI1N,6BAAE,SAgB7BzF,EAAmCmD,UAAAkQ,WAAA,SAAA1L,EAAAC,EAAA7K,EAAAC,GACtC,IAAAmW,EAOEA,EAAApZ,KAAA0J,gBAAA,OAAA,CAEKkE,EAACA,EACRC,EAAAA,EAME7K,MAAAA,EAEKC,OAAOA,IACX,GACHjD,KAAAuM,sBAIEvC,YAAAoP,GAECpZ,KAAwDkL,iBAAAkO,EACxDpZ,KAAI0L,6BACA,WAgBJzF,EAAgDmD,UAAAmQ,cAAA,WAWhD,IAVA,IACqB5L,EAAjB3N,KAAIuM,sBAAaL,aAAA,aAGjBsN,EAAAxZ,KAAgBkJ,OAChB+C,WAAe,KAEHuN,EAAUvN,WAGrBzF,EAAOyF,EAAQlK,OAAM,EAAAyE,GAAA,EAAAA,IAAAyF,EAAAzF,IAAAgT,EAAAC,YAAAxN,EAAAzF,IAC1BxG,KAAKkL,iBAAiBsO,OACN3O,aAAS,GAAE8C,GAAA3N,KAAewN,eAAAG,MAAsEvE,UAAArE,UAAA,SAAA6I,EAAAC,EAAA7K,EAAAC,GAEhH,GAAK,IAAD2K,GAAC,IAAAC,GAAqB7K,IAAAhD,KAAAgD,OAAAC,IAAAjD,KAAAiD,OAA1B,CACH,IAAAmW,EAAAhM,EAAApN,KAAAuM,sBAIE6M,EAAApZ,KAAA0J,gBAAA,OAAA,CAEKkE,EAAAA,EAKAC,EAACA,EACL7K,MAAMA,EACNC,OAASA,EACTkW,KAAS,YAET,GAEA/L,EAAiCpD,YAAAoP,QAnBPpZ,KAAGuZ,iBAuB7BtT,EAAemD,UAAAsQ,qBAAA,SAAA3C,EAAAC,EAAAa,EAAAH,GACf,IAAAiC,EAAM3Z,KAAA0J,gBAAoB,iBAAA,CAEtBsC,GAACpF,EAA2B5G,KAAAgL,OAEnC+L,GAAAA,EAAA,KAMEc,GAAAA,EAAA,KAEoCb,GAAAA,EAAA,KAC/BU,GAAIA,EAAG,KAKPkC,cAAiB,kCAEjB3O,OAAKjB,YAAM2P,GACT,IAAGzT,EAAWyT,EAAA3Z,SAKLoJ,UAAAyQ,qBAAA,SAAA9B,EAAAC,EAAA8B,EAAA/C,EAAAC,EAAA+C,OACXJ,EAAK3Z,KAAM0J,gBAAA,iBAAA,CACXsC,GAAEpF,EAAS5G,KAAAgL,OACXkD,GAAE6I,EAAO,KACTiD,GAAEhD,EAAG,KACLnN,EAAEkQ,EAAG,KACRE,GAAMlC,EAAI,KACPmC,GAAElC,EAAO,KACT4B,cAAW,kCAEX3O,OAAKjB,YAAM2P,GACT,IAAGzT,EAAMyT,EAAA3Z,OAQfiG,EAAiCmD,UAAA+Q,YAAA,WACjC,IACIC,EADJ,sVACIxQ,KAAiC5J,KAAAqa,MACjC7H,EAAK,CACL9N,MAAmF0V,EAAA,IAAA,SACnFE,KAAwEF,EAAA,IAAA,OACxEG,OAAMH,EAAM,IAAS,aACrBI,OAAQJ,EAAA,IAAc,oBACXA,EAAI,IAAY,0BAIP,qCAAiB5H,EAAAiI,WAAY,kBAE7CC,aAAYlI,EAAA1B,KAAY9Q,KAAA0a,iBAYvBtR,UAAAuR,eAAA,SAAAN,EAAA9O,MACL8O,EAACvJ,KAAA,CACJ,IAAM1C,EAAIpO,KAAM0J,gBAAqB,KAGlC,OAFA0E,EAAiBrD,eAAA,+BAAA,aAAAsP,EAAAvJ,MACjB1C,EAAApE,YAAWuB,GACX6C,SAEA7C,KAUCnC,UAAAwR,YAAA,SAAAC,EAAAjN,EAAAC,EAAAsH,OA9jC2DpM,EAE3B1B,EA6jCjCgT,EAAAra,KAASma,cAAwB/M,EAAEpN,KAAAuM,sBAAkBuO,EAAA9a,KAAA0J,gBAAA,OAAA,CACrD,cAAS2Q,EAAAE,OAET,YAAOF,EAAWC,KACrB,aAAAD,EAAA3V,MACJ,cAAA2V,EAAAG,OAIE,kBAAAH,EAAAI,WAEK7M,EAAAA,EAEJC,EAAQA,EACR,eA7kCgE9E,EA6kCvB/I,KAAA+I,UA3kCJ1B,EAAA,CACjC0T,KAAO,QAAIC,MAAY,MAAgBC,OAAS,SAAa9Y,MAAwB,QAAEE,IAAQ,OAAuCgF,EAAA0B,IAAA1B,EAAAlF,OA2kC1I,oBAA6BgF,EAAcnH,KAAAoH,gBACzC,KACQ4C,YAAKhK,KAAWwK,WAAA0Q,eAA4CL,SAClE3P,iBAAwB4P,OACxBpP,6BAA2ByJ,KACxBnL,YAAChK,KAA6C2a,eAAAN,EAAAS,KAQrD7U,EAAWmD,UAAc+R,SAAa,SAAAN,EAAAjN,EAAAC,GACzC7N,KAAA4a,YAAAC,EAAAjN,EAAAC,EAAA,SAcD5H,EAAImD,UAAUgS,WAAe,SAAWP,EAAKjN,EAAAC,GAAC7N,KAAA4a,YAAAC,EAAAjN,EAAAC,EAAA,WAGS5H,EAAAmD,UAAAiS,YAAA,SAAAR,GACZ,OAA3C7a,KAAAmJ,MAAAkR,KAAAra,KAAAqa,KAA2Cra,KAAAmJ,MAAAkS,YAAAR,qqGOxqCN,CAErCS,yBCEwCC,EAAYC,GAChD,MAAMC,EAAS,IAAIC,EAAWH,GAGxB3Z,EAAI2Z,EAAWxZ,OACrB,IAAI4Z,EAAS,IAAI3F,MAAMpU,GAAIuX,KAAK,GAChCqC,EAAY7a,SAAS4V,IACjB,MAAMC,EAAOiF,EAAOnF,QAAQC,GACtBiE,OAAiCjQ,IAAtBgM,EAAWiE,OAAwB,EAAIjE,EAAWiE,OACnEmB,EAAQA,EAAMC,KAAG,CAAExb,EAAOyb,IAAUzb,EAAQoW,EAAKqF,GAASrB,OAE9D,MAAMsB,EAAQH,EAAMI,QAAM,CAAEC,EAAGta,IAAMsa,EAAIta,IAGzC,MADc,gBADSia,EAAMC,KAAKhO,GAAMA,EAAIkO,eChBtB,oBCAQG,GAC9B,MAAMjK,EAAMpN,KAAKoN,OAAOiK,EAAMC,gBAI9B,MADgB,SAFAD,EAAMC,eAAevS,QAAQqI,2BCFZiK,GACjC,MAAME,EAAKF,EAAMC,eAAena,OAGhC,MADgB,SADA6C,KAAKqC,MAAMrC,KAAKsC,SAAWiV,KFFoBC,wBGM5BH,EAAOI,GAC1C,MAAOC,MAACA,EAAKC,UAAEA,GAAcF,EAEvBG,EAAcP,EAAMC,eAAeN,KACpCI,GAAQA,EAAIO,EAAa,EAAIP,IAG5BS,EAAWD,EAAYza,OAG7B,GAAkB,IAAdwa,GAAmBE,EAAWH,EAAO,CAGrC,MAGMI,EAHoB,IAAIF,GAAaG,MAAI,CAC1CvO,EAAGrE,IAAMA,EAAIqE,IAEsBkO,EAAQ,GAQhD,MADgB,YANFL,EAAMC,eAGKN,KACpBI,GAAMA,GAAKU,KAOpB,MAAME,EAAiB5G,MAAMsG,GAAOnD,OAAOyC,KAAG,CACzCiB,EAAGrW,IAAM5B,KAAKgL,KAAMpJ,GAAMA,EAAI,MAoB7BsW,EAVYN,EAAYZ,KACzBI,GAAa,IAANA,EAAUvE,EAAAA,EAAWmF,EAAehB,KAAKvN,GAAMA,EAAI2N,MAC7De,OAIgCA,OAAOJ,MAAI,CACxCvO,EAAGrE,IAAMqE,EAAIrE,IAGmBuS,EAAQ,GA2B7C,MADgB,YATEE,EAAYZ,KACzBI,GAAc,IAANA,EAAW,EAAuD,IAAlD,EAAIpX,KAAKgL,KAAK,EAAI,GAAKoM,EAAIc,IAAiB,MAE5ClB,KACxBI,GAAMpX,KAAKqC,MAAM+U,2BC1EagB,GACnC,MAAM1b,EAAOtB,KAEbsB,EAAK2b,IAAG,CAAI1B,EAAYU,KAOpB,IAAIiB,EACJ,GAAiC,eAA7B5b,EAAK6b,oBAAsC,CAC3C,MAAMd,EAAwB,CAAEC,MAAO,EAAGC,UAAW,IAC/Ca,EAAgBC,EAAgB/b,EAAKgc,gBAAgBrB,EAAOI,IAC3DkB,WAACA,GAAeH,EACvBF,EAAkB,YAAEK,aAAYhC,OAC7B,CACH,MAAM6B,EAAgBC,EAAgB/b,EAAKgc,gBAAgBrB,IACpDuB,QAACA,GAAYJ,EAEpBF,EAAkB,SAAEM,SADLjC,EAAWiC,IAG9B,OAAON,GAMX5b,EAAKmc,mBAAqB,CACtB,CAAE7L,KAAM,kBAAmBxR,MAAO,iBAAkBuL,KAAM,cAC1D,CAAEiG,KAAM,YAAaxR,MAAO,YAAauL,KAAM,gBAC/C,CAAEiG,KAAM,gBAAiBxR,MAAO,eAAgBuL,KAAM,iBAI1DrK,EAAK6b,kBAAiB,IAAS7b,EAAKoc,iCAAiCpc,EAAKgc,gBAAgB3R,KAC1FrK,EAAKoc,iCAAmC,GACxCpc,EAAKmc,mBAAmB9c,SACnBiN,IAAQtM,EAAKoc,iCAAiC9P,EAAExN,OAASwN,KAI9DtM,EAAKgc,eAAiB,YAQlBhc,EAACqc,kBAEAvd,IACGkB,EAAKgc,eAAoBld,KAEzBsV,YAAapU,EAAC,CACduR,MAAO,mBACPiC,KAAM,yBAAmBxT,EAAAqc,kBAAArT,QAAChJ,EAAAmc,mBAC7BzI,OAAA,CAER,+BC5DgCgI,GAC7B,MAAM1b,EAAOtB,KAEbsB,EAAKsc,OAAS,IAAIC,EAAeb,GAEjC1b,EAAKwc,YAAc,SAAUtC,EAAauC,GACtC,MAAM9B,EAAQ+B,EAAU1C,gBAAgByC,EAASvC,GAGjD,MADwB,IADFla,EAAKsc,OAAOX,IAAIc,EAAS9B,SACHA,IAMhD3a,EAAK2c,UAAS,CAAIC,EAAQ3C,KACtB,MAAMC,EAAc0C,EAAOC,iBACrBJ,EAAUxC,EAAW6C,gBAE3B,OADcJ,EAAU1C,gBAAgByC,EAASvC,ICvBzD,MACM6C,EAAW,mBAIRC,EAAIC,EAAM5Y,EAAG6Y,EAAMlQ,EAAGxL,GAC3B,IAAI2b,EAAGC,EAAMC,EAAIC,EACbC,EAAOlZ,EAAE,GACTmZ,EAAOxQ,EAAE,GACTyQ,EAAS,EACTC,EAAS,EACRF,EAAOD,GAAWC,GAAQD,GAC3BJ,EAAII,EACJA,EAAOlZ,IAAIoZ,KAEXN,EAAIK,EACJA,EAAOxQ,IAAI0Q,IAEf,IAAIC,EAAS,EACb,GAAIF,EAASR,GAAQS,EAASR,MACrBM,EAAOD,GAAWC,GAAQD,GAC3BH,EAAOG,EAAOJ,EACdE,EAAKF,GAAKC,EAAOG,GACjBA,EAAOlZ,IAAIoZ,KAEXL,EAAOI,EAAOL,EACdE,EAAKF,GAAKC,EAAOI,GACjBA,EAAOxQ,IAAI0Q,IAEfP,EAAIC,EACO,IAAPC,IACA7b,EAAEmc,KAAYN,GAEXI,EAASR,GAAQS,EAASR,GACxBM,EAAOD,GAAWC,GAAQD,GAC3BH,EAAOD,EAAII,EACXD,EAAQF,EAAOD,EACfE,EAAKF,GAAKC,EAAOE,IAAUC,EAAOD,GAClCC,EAAOlZ,IAAIoZ,KAEXL,EAAOD,EAAIK,EACXF,EAAQF,EAAOD,EACfE,EAAKF,GAAKC,EAAOE,IAAUE,EAAOF,GAClCE,EAAOxQ,IAAI0Q,IAEfP,EAAIC,EACO,IAAPC,IACA7b,EAAEmc,KAAYN,QAInBI,EAASR,GACZG,EAAOD,EAAII,EACXD,EAAQF,EAAOD,EACfE,EAAKF,GAAKC,EAAOE,IAAUC,EAAOD,GAClCC,EAAOlZ,IAAIoZ,GACXN,EAAIC,EACO,IAAPC,IACA7b,EAAEmc,KAAYN,QAGfK,EAASR,GACZE,EAAOD,EAAIK,EACXF,EAAQF,EAAOD,EACfE,EAAKF,GAAKC,EAAOE,IAAUE,EAAOF,GAClCE,EAAOxQ,IAAI0Q,GACXP,EAAIC,EACO,IAAPC,IACA7b,EAAEmc,KAAYN,GAMtB,OAHU,IAANF,GAAsB,IAAXQ,IACXnc,EAAEmc,KAAYR,GAEXQ,WASFC,EAAItd,GACT,OAAO,IAAIud,aAAavd,GAG5B,MAIMwd,EAAIF,EAAI,GACRG,EAAKH,EAAI,GACTI,EAAKJ,EAAI,IACTK,EAAIL,EAAI,IACRM,EAAIN,EAAI,YAgKLO,EAASjI,EAAIF,EAAIoI,EAAIC,EAAIzR,EAAI8L,GAClC,MAAM4F,GAAWtI,EAAK0C,IAAO0F,EAAKxR,GAC5B2R,GAAYrI,EAAKtJ,IAAOyR,EAAK3F,GAC7B8F,EAAMF,EAAUC,EAEtB,GAAgB,IAAZD,GAA8B,IAAbC,GAAmBD,EAAU,GAAQC,EAAW,EAAI,OAAOC,EAEhF,MAAMC,EAASnb,KAAK0T,IAAIsH,EAAUC,GAClC,OAAIjb,KAAK0T,IAAIwH,IAhLC,sBAgLsBC,EAAeD,YAtKhCtI,EAAIF,EAAIoI,EAAIC,EAAIzR,EAAI8L,EAAI+F,GAC3C,IAAIC,EAASC,EAASC,EAASC,EAC3BvB,EAAOld,EAAG0e,EAAKC,EAAKC,EAAKC,EAAKC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAE9D,MAAMC,EAAMxJ,EAAKtJ,EACX+S,EAAMvB,EAAKxR,EACXgT,EAAM5J,EAAK0C,EACXmH,EAAMxB,EAAK3F,EAEjB2G,EAAKK,EAAMG,EACXzf,EAAI2c,EAAW2C,EACfZ,EAAM1e,GAAKA,EAAIsf,GACfX,EAAMW,EAAMZ,EACZ1e,EAAI2c,EAAW8C,EACfb,EAAM5e,GAAKA,EAAIyf,GACfZ,EAAMY,EAAMb,EACZM,EAAKP,EAAME,GAAOI,EAAKP,EAAME,EAAMD,EAAMC,EAAMF,EAAMG,GACrDM,EAAKK,EAAMD,EACXvf,EAAI2c,EAAW6C,EACfd,EAAM1e,GAAKA,EAAIwf,GACfb,EAAMa,EAAMd,EACZ1e,EAAI2c,EAAW4C,EACfX,EAAM5e,GAAKA,EAAIuf,GACfV,EAAMU,EAAMX,EACZQ,EAAKT,EAAME,GAAOM,EAAKT,EAAME,EAAMD,EAAMC,EAAMF,EAAMG,GACrDC,EAAKI,EAAKE,EACVlC,EAAQgC,EAAKJ,EACbpB,EAAE,GAAKwB,GAAMJ,EAAK5B,IAAUA,EAAQkC,GACpCL,EAAKE,EAAKH,EACV5B,EAAQ6B,EAAKE,EACbD,EAAKC,GAAMF,EAAK7B,IAAU4B,EAAK5B,GAC/B4B,EAAKE,EAAKG,EACVjC,EAAQ8B,EAAKF,EACbpB,EAAE,GAAKsB,GAAMF,EAAK5B,IAAUA,EAAQiC,GACpCE,EAAKN,EAAKD,EACV5B,EAAQmC,EAAKN,EACbrB,EAAE,GAAKqB,GAAMM,EAAKnC,IAAU4B,EAAK5B,GACjCQ,EAAE,GAAK2B,EAEP,IAAIjB,WA3DUvB,EAAM5Y,GACpB,IAAI8Y,EAAI9Y,EAAE,GACV,IAAK,IAAIa,EAAI,EAAGA,EAAI+X,EAAM/X,IAAKiY,GAAK9Y,EAAEa,GACtC,OAAOiY,EAwDG2C,CAAS,EAAGhC,GAClBiC,EAjDU,sBAiDgBtB,EAC9B,GAAID,GAAOuB,IAAavB,GAAOuB,EAC3B,OAAOvB,EAYX,GATAlB,EAAQpH,EAAKwJ,EACbhB,EAAUxI,GAAMwJ,EAAMpC,IAAUA,EAAQ1Q,GACxC0Q,EAAQc,EAAKuB,EACbf,EAAUR,GAAMuB,EAAMrC,IAAUA,EAAQ1Q,GACxC0Q,EAAQtH,EAAK4J,EACbjB,EAAU3I,GAAM4J,EAAMtC,IAAUA,EAAQ5E,GACxC4E,EAAQe,EAAKwB,EACbhB,EAAUR,GAAMwB,EAAMvC,IAAUA,EAAQ5E,GAExB,IAAZgG,GAA6B,IAAZC,GAA6B,IAAZC,GAA6B,IAAZC,EACnD,OAAOL,EAKX,GAFAuB,EAlEc,sBAkEYtB,EAzJV,sBAyJoCnb,KAAK0T,IAAIwH,GAC7DA,GAAQkB,EAAMb,EAAUgB,EAAMnB,GAAYkB,EAAMhB,EAAUe,EAAMhB,GAC5DH,GAAOuB,IAAavB,GAAOuB,EAAU,OAAOvB,EAEhDa,EAAKX,EAAUmB,EACfzf,EAAI2c,EAAW2B,EACfI,EAAM1e,GAAKA,EAAIse,GACfK,EAAML,EAAUI,EAChB1e,EAAI2c,EAAW8C,EACfb,EAAM5e,GAAKA,EAAIyf,GACfZ,EAAMY,EAAMb,EACZM,EAAKP,EAAME,GAAOI,EAAKP,EAAME,EAAMD,EAAMC,EAAMF,EAAMG,GACrDM,EAAKZ,EAAUgB,EACfvf,EAAI2c,EAAW4B,EACfG,EAAM1e,GAAKA,EAAIue,GACfI,EAAMJ,EAAUG,EAChB1e,EAAI2c,EAAW4C,EACfX,EAAM5e,GAAKA,EAAIuf,GACfV,EAAMU,EAAMX,EACZQ,EAAKT,EAAME,GAAOM,EAAKT,EAAME,EAAMD,EAAMC,EAAMF,EAAMG,GACrDC,EAAKI,EAAKE,EACVlC,EAAQgC,EAAKJ,EACbhB,EAAE,GAAKoB,GAAMJ,EAAK5B,IAAUA,EAAQkC,GACpCL,EAAKE,EAAKH,EACV5B,EAAQ6B,EAAKE,EACbD,EAAKC,GAAMF,EAAK7B,IAAU4B,EAAK5B,GAC/B4B,EAAKE,EAAKG,EACVjC,EAAQ8B,EAAKF,EACbhB,EAAE,GAAKkB,GAAMF,EAAK5B,IAAUA,EAAQiC,GACpCE,EAAKN,EAAKD,EACV5B,EAAQmC,EAAKN,EACbjB,EAAE,GAAKiB,GAAMM,EAAKnC,IAAU4B,EAAK5B,GACjCY,EAAE,GAAKuB,EACP,MAAMO,EAAQhD,EAAI,EAAGc,EAAG,EAAGI,EAAGH,GAE9BsB,EAAKK,EAAMb,EACXze,EAAI2c,EAAW2C,EACfZ,EAAM1e,GAAKA,EAAIsf,GACfX,EAAMW,EAAMZ,EACZ1e,EAAI2c,EAAW8B,EACfG,EAAM5e,GAAKA,EAAIye,GACfI,EAAMJ,EAAUG,EAChBM,EAAKP,EAAME,GAAOI,EAAKP,EAAME,EAAMD,EAAMC,EAAMF,EAAMG,GACrDM,EAAKK,EAAMhB,EACXxe,EAAI2c,EAAW6C,EACfd,EAAM1e,GAAKA,EAAIwf,GACfb,EAAMa,EAAMd,EACZ1e,EAAI2c,EAAW6B,EACfI,EAAM5e,GAAKA,EAAIwe,GACfK,EAAML,EAAUI,EAChBQ,EAAKT,EAAME,GAAOM,EAAKT,EAAME,EAAMD,EAAMC,EAAMF,EAAMG,GACrDC,EAAKI,EAAKE,EACVlC,EAAQgC,EAAKJ,EACbhB,EAAE,GAAKoB,GAAMJ,EAAK5B,IAAUA,EAAQkC,GACpCL,EAAKE,EAAKH,EACV5B,EAAQ6B,EAAKE,EACbD,EAAKC,GAAMF,EAAK7B,IAAU4B,EAAK5B,GAC/B4B,EAAKE,EAAKG,EACVjC,EAAQ8B,EAAKF,EACbhB,EAAE,GAAKkB,GAAMF,EAAK5B,IAAUA,EAAQiC,GACpCE,EAAKN,EAAKD,EACV5B,EAAQmC,EAAKN,EACbjB,EAAE,GAAKiB,GAAMM,EAAKnC,IAAU4B,EAAK5B,GACjCY,EAAE,GAAKuB,EACP,MAAMQ,EAAQjD,EAAIgD,EAAOjC,EAAI,EAAGG,EAAGF,GAEnCqB,EAAKX,EAAUG,EACfze,EAAI2c,EAAW2B,EACfI,EAAM1e,GAAKA,EAAIse,GACfK,EAAML,EAAUI,EAChB1e,EAAI2c,EAAW8B,EACfG,EAAM5e,GAAKA,EAAIye,GACfI,EAAMJ,EAAUG,EAChBM,EAAKP,EAAME,GAAOI,EAAKP,EAAME,EAAMD,EAAMC,EAAMF,EAAMG,GACrDM,EAAKZ,EAAUC,EACfxe,EAAI2c,EAAW4B,EACfG,EAAM1e,GAAKA,EAAIue,GACfI,EAAMJ,EAAUG,EAChB1e,EAAI2c,EAAW6B,EACfI,EAAM5e,GAAKA,EAAIwe,GACfK,EAAML,EAAUI,EAChBQ,EAAKT,EAAME,GAAOM,EAAKT,EAAME,EAAMD,EAAMC,EAAMF,EAAMG,GACrDC,EAAKI,EAAKE,EACVlC,EAAQgC,EAAKJ,EACbhB,EAAE,GAAKoB,GAAMJ,EAAK5B,IAAUA,EAAQkC,GACpCL,EAAKE,EAAKH,EACV5B,EAAQ6B,EAAKE,EACbD,EAAKC,GAAMF,EAAK7B,IAAU4B,EAAK5B,GAC/B4B,EAAKE,EAAKG,EACVjC,EAAQ8B,EAAKF,EACbhB,EAAE,GAAKkB,GAAMF,EAAK5B,IAAUA,EAAQiC,GACpCE,EAAKN,EAAKD,EACV5B,EAAQmC,EAAKN,EACbjB,EAAE,GAAKiB,GAAMM,EAAKnC,IAAU4B,EAAK5B,GACjCY,EAAE,GAAKuB,EACP,MAAMS,EAAOlD,EAAIiD,EAAOjC,EAAI,EAAGE,EAAGD,GAElC,OAAOA,EAAEiC,EAAO,GAaRC,CAAcjK,EAAIF,EAAIoI,EAAIC,EAAIzR,EAAI8L,EAAI+F,GAGlD,MAAM2B,EAAU9c,KAAK+c,IAAI,GAAG,IACtBC,EAAa,IAAIC,YAAY,WAE7BC,cAEUC,EAAQC,EAAOC,EAAaC,EAAOC,GAC3C,MAAMvgB,EAAImgB,EAAOhgB,OACXqgB,EAAS,IAAIjD,aAAiB,EAAJvd,GAEhC,IAAK,IAAI4E,EAAI,EAAGA,EAAI5E,EAAG4E,IAAK,CACxB,MAAMwV,EAAI+F,EAAOvb,GACjB4b,EAAO,EAAI5b,GAAKwb,EAAKhG,GACrBoG,EAAO,EAAI5b,EAAI,GAAK0b,EAAKlG,GAG7B,OAAO,IAAI8F,EAAWM,eAGdA,GACR,MAAMxgB,EAAIwgB,EAAOrgB,QAAU,EAC3B,GAAIH,EAAI,GAA0B,iBAAdwgB,EAAO,GAAiB,MAAM,IAAIrb,MAAM,uCAE5D/G,KAAKoiB,OAASA,EAGd,MAAMC,EAAezd,KAAKoN,IAAI,EAAIpQ,EAAI,EAAG,GACzC5B,KAAKsiB,WAAa,IAAIT,YAA2B,EAAfQ,GAClCriB,KAAKuiB,WAAa,IAAIC,WAA0B,EAAfH,GAGjCriB,KAAKyiB,UAAY7d,KAAK8d,KAAK9d,KAAKgL,KAAKhO,IACrC5B,KAAK2iB,UAAY,IAAId,YAAYjgB,GACjC5B,KAAK4iB,UAAY,IAAIf,YAAYjgB,GACjC5B,KAAK6iB,SAAW,IAAIhB,YAAYjgB,GAChC5B,KAAK8iB,UAAY,IAAIN,WAAWxiB,KAAKyiB,WAAWtJ,MAAK,GAGrDnZ,KAAK+iB,KAAO,IAAIlB,YAAYjgB,GAC5B5B,KAAKgjB,OAAS,IAAI7D,aAAavd,GAE/B5B,KAAKijB,SAGTA,SACI,MAAOb,OAAAA,EAAQO,UAAWO,EAAUN,UAAWO,EAAUN,SAAUO,EAASN,UAAWO,GAAarjB,KAC9F4B,EAAIwgB,EAAOrgB,QAAU,EAG3B,IAAIuhB,EAAO7L,EAAAA,EACP8L,EAAO9L,EAAAA,EACP+L,GAAQ/L,EAAAA,EACRgM,GAAQhM,EAAAA,EAEZ,IAAK,IAAIjR,EAAI,EAAGA,EAAI5E,EAAG4E,IAAK,CACxB,MAAMoH,EAAIwU,EAAO,EAAI5b,GACfqH,EAAIuU,EAAO,EAAI5b,EAAI,GACrBoH,EAAI0V,IAAMA,EAAO1V,GACjBC,EAAI0V,IAAMA,EAAO1V,GACjBD,EAAI4V,IAAMA,EAAO5V,GACjBC,EAAI4V,IAAMA,EAAO5V,GACrB7N,KAAK+iB,KAAKvc,GAAKA,EAEnB,MAAM0H,GAAMoV,EAAOE,GAAQ,EACrBxJ,GAAMuJ,EAAOE,GAAQ,EAE3B,IACIC,EAAI/P,EAAIgQ,EADRC,EAAUnM,EAAAA,EAId,IAAK,IAAIoM,EAAI,EAAGA,EAAIjiB,EAAGiiB,IAAK,CACxB,MAAMxV,EAAIyV,EAAK5V,EAAI8L,EAAIoI,EAAO,EAAIyB,GAAIzB,EAAO,EAAIyB,EAAI,IACjDxV,EAAIuV,IACJF,EAAKG,EACLD,EAAUvV,GAGlB,MAAM0V,EAAM3B,EAAO,EAAIsB,GACjBM,EAAM5B,EAAO,EAAIsB,EAAK,GAE5BE,EAAUnM,EAAAA,EAGV,IAAK,IAAIwM,EAAI,EAAGA,EAAIriB,EAAGqiB,IAAK,CACxB,GAAIA,IAAMP,EAAI,SACd,MAAMrV,EAAIyV,EAAKC,EAAKC,EAAK5B,EAAO,EAAI6B,GAAI7B,EAAO,EAAI6B,EAAI,IACnD5V,EAAIuV,GAAWvV,EAAI,IACnBsF,EAAKsQ,EACLL,EAAUvV,GAGlB,IAAI6V,EAAM9B,EAAO,EAAIzO,GACjBwQ,EAAM/B,EAAO,EAAIzO,EAAK,GAEtByQ,EAAY3M,EAAAA,EAGhB,IAAK,IAAI4M,EAAI,EAAGA,EAAIziB,EAAGyiB,IAAK,CACxB,GAAIA,IAAMX,GAAMW,IAAM1Q,EAAI,SAC1B,MAAM9J,EAAIya,EAAaP,EAAKC,EAAKE,EAAKC,EAAK/B,EAAO,EAAIiC,GAAIjC,EAAO,EAAIiC,EAAI,IACrExa,EAAIua,IACJT,EAAKU,EACLD,EAAYva,GAGpB,IAAI0a,EAAMnC,EAAO,EAAIuB,GACjBa,EAAMpC,EAAO,EAAIuB,EAAK,GAE1B,GAAIS,IAAc3M,EAAAA,EAAU,CAGxB,IAAK,IAAIjR,EAAI,EAAGA,EAAI5E,EAAG4E,IACnBxG,KAAKgjB,OAAOxc,GAAM4b,EAAO,EAAI5b,GAAK4b,EAAO,IAAQA,EAAO,EAAI5b,EAAI,GAAK4b,EAAO,GAEhFqC,EAAUzkB,KAAK+iB,KAAM/iB,KAAKgjB,OAAQ,EAAGphB,EAAI,GACzC,MAAM8iB,EAAO,IAAI7C,YAAYjgB,GAC7B,IAAI+iB,EAAI,EACR,IAAK,IAAIC,EAAI,EAAGC,GAAMpN,EAAAA,EAAUmN,EAAIhjB,EAAGgjB,IAAK,CACxC,MAAM5Y,EAAKhM,KAAK+iB,KAAK6B,GACjB5kB,KAAKgjB,OAAOhX,GAAM6Y,IAClBH,EAAKC,KAAO3Y,EACZ6Y,EAAK7kB,KAAKgjB,OAAOhX,IAMzB,OAHAhM,KAAK0kB,KAAOA,EAAKI,SAAS,EAAGH,GAC7B3kB,KAAK+kB,UAAY,IAAIlD,YAAY,QACjC7hB,KAAKglB,UAAY,IAAInD,YAAY,IAKrC,GAAIpC,EAASsE,EAAKC,EAAKE,EAAKC,EAAKI,EAAKC,GAAO,EAAG,CAC5C,MAAMhe,EAAImN,EACJ/F,EAAIsW,EACJrW,EAAIsW,EACVxQ,EAAKgQ,EACLO,EAAMK,EACNJ,EAAMK,EACNb,EAAKnd,EACL+d,EAAM3W,EACN4W,EAAM3W,EAGV,MAAMoN,EA4Rd,SAACzD,EAAAF,EAAAoI,EAAAC,EAAAzR,EAAA8L,SAEQrD,EAAA+I,EAAAlI,EACDZ,EAAK+I,EAAOrI,EAER2N,EAAM/W,EAAIsJ,EACV0N,EAAMlL,EAAA1C,EACN6N,EAAKxO,EAAOA,EAACC,EAAAA,IACLqO,EAAIA,EAAIC,EAAIA,EACpB7W,EAAK,IAAQsI,EAAIuO,EAAAtO,EAAAqO,SAGrB,CACArX,EAHC4J,GAAA0N,EAAAC,EAAAvO,EAAAwO,GAAA/W,EAIDR,EAHIyJ,GAAAX,EAAAyO,EAAAH,EAAAE,GAAA9W,GAvSWgX,CAAatB,EAAKC,EAAKE,EAAKC,EAAKI,EAAKC,GACrDxkB,KAAKslB,IAAMrK,EAAOrN,EAClB5N,KAAKulB,IAAMtK,EAAOpN,EAElB,IAAK,IAAI2X,EAAI,EAAGA,EAAI5jB,EAAG4jB,IACnBxlB,KAAKgjB,OAAOwC,GAAK1B,EAAK1B,EAAO,EAAIoD,GAAIpD,EAAO,EAAIoD,EAAI,GAAIvK,EAAOrN,EAAGqN,EAAOpN,GAI7E4W,EAAUzkB,KAAK+iB,KAAM/iB,KAAKgjB,OAAQ,EAAGphB,EAAI,GAGzC5B,KAAKylB,WAAa/B,EAClB,IAAIgC,EAAW,EAEfvC,EAASO,GAAMR,EAASS,GAAMhQ,EAC9BwP,EAASxP,GAAMuP,EAASQ,GAAMC,EAC9BR,EAASQ,GAAMT,EAASvP,GAAM+P,EAE9BN,EAAQM,GAAM,EACdN,EAAQzP,GAAM,EACdyP,EAAQO,GAAM,EAEdN,EAASlK,MAAK,GACdkK,EAASrjB,KAAK2lB,SAAS5B,EAAKC,IAAQN,EACpCL,EAASrjB,KAAK2lB,SAASzB,EAAKC,IAAQxQ,EACpC0P,EAASrjB,KAAK2lB,SAASpB,EAAKC,IAAQb,EAEpC3jB,KAAK4lB,aAAe,EACpB5lB,KAAK6lB,aAAanC,EAAI/P,EAAIgQ,GAAI,GAAI,GAAI,GAEtC,IAAK,IAAWmC,EAAIC,EAAX9P,EAAI,EAAWA,EAAIjW,KAAK+iB,KAAKhhB,OAAQkU,IAAK,CAC/C,MAAMzP,EAAIxG,KAAK+iB,KAAK9M,GACdrI,EAAIwU,EAAO,EAAI5b,GACfqH,EAAIuU,EAAO,EAAI5b,EAAI,GAGzB,GAAIyP,EAAI,GAAKrR,KAAK0T,IAAI1K,EAAIkY,IAAOpE,GAAW9c,KAAK0T,IAAIzK,EAAIkY,IAAOrE,EAAS,SAKzE,GAJAoE,EAAKlY,EACLmY,EAAKlY,EAGDrH,IAAMkd,GAAMld,IAAMmN,GAAMnN,IAAMmd,EAAI,SAGtC,IAAIxhB,EAAQ,EACZ,IAAK,IAAIwiB,EAAI,EAAGrZ,EAAMtL,KAAK2lB,SAAS/X,EAAGC,GAAI8W,EAAI3kB,KAAKyiB,YAChDtgB,EAAQkhB,GAAU/X,EAAMqZ,GAAK3kB,KAAKyiB,YACpB,IAAVtgB,GAAgBA,IAAUghB,EAAShhB,IAFoBwiB,KAK/DxiB,EAAQ+gB,EAAS/gB,GACjB,IAAe6jB,EAAXrgB,EAAIxD,OACD6jB,EAAI7C,EAASxd,GAAI8Z,EAAS7R,EAAGC,EAAGuU,EAAO,EAAIzc,GAAIyc,EAAO,EAAIzc,EAAI,GAAIyc,EAAO,EAAI4D,GAAI5D,EAAO,EAAI4D,EAAI,KAAO,GAE1G,GADArgB,EAAIqgB,EACArgB,IAAMxD,EAAO,CACbwD,GAAI,EACJ,MAGR,IAAU,IAANA,EAAU,SAGd,IAAI8H,EAAIzN,KAAK6lB,aAAalgB,EAAGa,EAAG2c,EAASxd,IAAI,GAAI,EAAIyd,EAAQzd,IAG7Dyd,EAAQ5c,GAAKxG,KAAKimB,UAAUxY,EAAI,GAChC2V,EAAQzd,GAAK8H,EACbiY,IAGA,IAAI9jB,EAAIuhB,EAASxd,QACVqgB,EAAI7C,EAASvhB,GAAI6d,EAAS7R,EAAGC,EAAGuU,EAAO,EAAIxgB,GAAIwgB,EAAO,EAAIxgB,EAAI,GAAIwgB,EAAO,EAAI4D,GAAI5D,EAAO,EAAI4D,EAAI,IAAM,GACzGvY,EAAIzN,KAAK6lB,aAAajkB,EAAG4E,EAAGwf,EAAG5C,EAAQ5c,IAAI,EAAI4c,EAAQxhB,IACvDwhB,EAAQ5c,GAAKxG,KAAKimB,UAAUxY,EAAI,GAChC0V,EAASvhB,GAAKA,EACd8jB,IACA9jB,EAAIokB,EAIR,GAAIrgB,IAAMxD,EAAK,KACJ6jB,EAAI9C,EAASvd,GAAI8Z,EAAS7R,EAAGC,EAAGuU,EAAO,EAAI4D,GAAI5D,EAAO,EAAI4D,EAAI,GAAI5D,EAAO,EAAIzc,GAAIyc,EAAO,EAAIzc,EAAI,IAAM,GACzG8H,EAAIzN,KAAK6lB,aAAaG,EAAGxf,EAAGb,GAAG,EAAIyd,EAAQzd,GAAIyd,EAAQ4C,IACvDhmB,KAAKimB,UAAUxY,EAAI,GACnB2V,EAAQ4C,GAAKvY,EACb0V,EAASxd,GAAKA,EACd+f,IACA/f,EAAIqgB,EAKZhmB,KAAKylB,WAAavC,EAAS1c,GAAKb,EAChCwd,EAASxd,GAAKud,EAASthB,GAAK4E,EAC5B2c,EAAS3c,GAAK5E,EAGdyhB,EAASrjB,KAAK2lB,SAAS/X,EAAGC,IAAMrH,EAChC6c,EAASrjB,KAAK2lB,SAASvD,EAAO,EAAIzc,GAAIyc,EAAO,EAAIzc,EAAI,KAAOA,EAGhE3F,KAAK0kB,KAAO,IAAI7C,YAAY6D,GAC5B,IAAK,IAAIQ,EAAI,EAAGvgB,EAAI3F,KAAKylB,WAAYS,EAAIR,EAAUQ,IAC/ClmB,KAAK0kB,KAAKwB,GAAKvgB,EACfA,EAAIwd,EAASxd,GAIjB3F,KAAK+kB,UAAY/kB,KAAKsiB,WAAWwC,SAAS,EAAG9kB,KAAK4lB,cAClD5lB,KAAKglB,UAAYhlB,KAAKuiB,WAAWuC,SAAS,EAAG9kB,KAAK4lB,cAGtDD,SAAS/X,EAAGC,GACR,OAAOjJ,KAAKqC,eAgIE0P,EAAAC,GAClB,MAAMoF,EAAErF,GAAQ/R,KAAE0T,IAAA3B,GAAA/R,KAAA0T,IAAA1B,IAElB,OAAQA,EAAK,EAAG,EAAKoF,EAAE,EAAKA,GAAA,EAnINmK,CAAYvY,EAAI5N,KAAKslB,IAAKzX,EAAI7N,KAAKulB,KAAOvlB,KAAKyiB,WAAaziB,KAAKyiB,UAGvFwD,UAAU7X,GACN,MAAOkU,WAAYyC,EAAWxC,WAAYyC,EAAS5C,OAAEA,GAAUpiB,KAE/D,IAAIwG,EAAI,EACJ4f,EAAK,SAGI,CACT,MAAMrc,EAAIib,EAAU5W,GAmCdiY,EAAOjY,EAAGA,EAAA,KAMhBgY,EAAIC,GAAOjY,EAAG,GAAA,GACV,IAAArE,EAAU,CACV,GAAU,IAAVvD,EAAW,MAEX4H,EAAAwT,IAAwBpb,GAExB,iBAEOuD,EAAEA,EAAG,IACLsc,GAACjY,EAAA,GAAA,OACIrE,EAAK,GAAA,MACAqc,OACAhY,OACRkY,OACQnB,MACJoB,EAAqBnE,EAAA,EAAAoE,GAAApE,EAAA,EAAAoE,EAAA,GAAApE,EAAA,EAAAqE,GAAArE,EAAA,EAAAqE,EAAA,GAAArE,EAAA,EAAAsE,GAAAtE,EAAA,EAAAsE,EAAA,GAAAtE,EAAA,EAAAuE,GAAAvE,EAAA,EAAAuE,EAAA,IACjC,CACD5B,EAAU3W,GAAIuY,EACd5B,EAAUhb,GAAIyc,EACd,MAAKI,EAAM5B,EAAMG,GAIjB,IAAsF,IAAAyB,EAAA,CAClF,IAAIjhB,EAAA3F,KAAAylB,WAGJ,EAAA,CACC,GAAMzlB,KAAE6iB,SAAKld,KAAAwf,EAAA,CACdnlB,KAAA6iB,SAAAld,GAAAyI,EACP,MAGIzI,EAAA3F,KAAA2iB,UAAAhd,SACZA,IAAA3F,KAAAylB,YAGQzlB,KAAA6mB,MAAYzY,EAAKwY,GACjB5mB,KAAO6mB,MAAO9c,EAAAib,EAAYoB,IAClCpmB,KAAA6mB,MAAAT,EAAAjB,GAEoE,MAAA2B,EAAAC,GAAAhd,EAAA,GAAA,EAEvDvD,EAAKob,EAAY7f,SAAA6f,EAAApb,KAAAsgB,OAEtB,CACA,GAAY,IAAZtgB,EAAgB,MAChB4H,EAAAwT,IAAsBpb,IAI3B,OAAK4f,QAILhY,EAAArE,GACH/J,KAAAuiB,WAAAnU,GAAArE,iCAKD8b,aAAYnC,EAAI/P,EAAKgQ,EAAIvV,EAAErE,EAAIrI,GAC/B,MAAU+L,EAAIzN,KAAI4lB,aAUlB,OATH5lB,KAAAsiB,WAAA7U,GAAAiW,OAEQpB,WAAA7U,EAAA,GAAAkG,EACL3T,KAAQsiB,WAAU7U,EAAA,GAAAkW,EAClB3jB,KAAQ6mB,MAAKpZ,EAAKW,GAClBpO,KAAS6mB,MAAKpZ,EAAK,EAAG1D,GACzB/J,KAAA6mB,MAAApZ,EAAA,EAAA/L,QAEQkkB,cAAA,EACMnY,YASNqW,EAAuBtM,EAAAF,EAAAoI,EAAAC,GAE5B,MAAMhJ,EAAGa,EAAMkI,EAGlB9I,EAAAU,EAAAqI,SAEQhJ,EAAAA,EAAAC,EAAAA,WAEA2P,EAAa/O,EAAAF,EAAAoI,EAAAC,EAAAzR,EAAA8L,EAAAgN,EAAAC,GAClB,MAAMtQ,EAAKa,EAAKwP,EACVpQ,EAAKU,EAAK2P,EAEVhC,EAAKvF,EAAKsH,EACV9B,EAAKvF,EAAKsH,EACVhN,EAAI/L,EAAG8Y,EAEP9M,EAAKF,EAAKiN,EAGVC,EAAKjC,EAAKA,EAAIC,EAAAA,EACvBiC,EAAAlN,EAAAA,EAAAC,EAAAA,SAEQvD,GAAAuO,EAAAiC,EAAAD,EAAAhN,GAAAtD,GAAaqO,EAAIkC,EAAMD,EAAIjN,IALrBtD,EAAKA,EAAKC,EAAKA,IAKiBqO,EAAA/K,EAAAgL,EAAAjL,GAAA,WAEtCqK,EAAa9M,EAAAF,EAAAoI,EAAAC,EAAAzR,EAAA8L,GAClB,MAAMrD,EAAK+I,EAAKlI,EACVZ,EAAK+I,EAAKrI,EAEV2N,EAAK/W,EAAKsJ,EACV0N,EAAKlL,EAAK1C,EACV6N,EAAIxO,EAAGA,EAAMC,EAAKA,EAElBwO,EAAIH,EAAMA,EAAKC,EAAKA,EACpB7W,EAAI,IAAMsI,EAAKuO,EAAKtO,EAAKqO,GAEzBrX,GAAEsX,EAAAC,EAAAvO,EAAAwO,GAAA/W,KAACsI,EAAAyO,EAAAH,EAAAE,GAAA9W,SAAET,EAACA,EAAAC,EAAAA,WAkBR4W,EAA8B2C,EAAKC,EAAItM,EAAAC,MACvCA,EAAID,GAAU,GAAI,IAAK,IAAKvU,EAAIuU,EAAM,EAAAvU,GAAAwU,EAAAxU,IAAA,CAEtC,MAAM8gB,EAAOF,EAAI5gB,GACX+gB,EAAWF,EAAMC,SAChB9gB,EAAO,UACNuU,GAAAsM,EAAAD,EAAAzC,IAAA4C,GAAAH,EAAAzC,EAAA,GAAAyC,EAAAzC,YAAW2C,WAGf9gB,EAAAuU,EAAA,EACH4J,EAAA3J,EACDwM,EAAqBJ,EAHNrM,EAAKC,GAAA,EAGCxU,GACjB6gB,EAAKD,EAAIrM,IAAAsM,EAAAD,EAAApM,KAAAwM,EAAAJ,EAAArM,EAAAC,GAETqM,EAAKD,EAAI5gB,IAAI6gB,EAAQD,EAAIpM,KAAGwM,EAAAJ,EAAA5gB,EAAAwU,GAC5BqM,EAAAD,EAAArM,IAAAsM,EAAAD,EAAA5gB,KAAUghB,EAAoBJ,EAAArM,EAAAvU,SAC9B8gB,EAAAF,EAAA5gB,GACH+gB,EAAOF,EAAAC,UACJ,CACA,GAAA9gB,UACH6gB,EAAAD,EAAA5gB,IAAA+gB,GACJ,GAAA5C,UACJ0C,EAAAD,EAAAzC,IAAA4C,GAEQ,GAAA5C,EAAAne,EAAA,MACCghB,EAAWJ,EAAA5gB,EAAAme,GAEbyC,EAACrM,EAAO,GAAAqM,EAAAzC,GACfyC,EAAAzC,GAAA2C,EAEQtM,EAAAxU,EAAA,GAAAme,EAAA5J,GACG0J,EAAE2C,EAAAC,EAAA7gB,EAAAwU,GACbyJ,EAAA2C,EAAAC,EAAAtM,EAAA4J,EAAA,KAEWF,EAAE2C,EAAAC,EAAAtM,EAAA4J,EAAA,GACbF,EAAA2C,EAAAC,EAAA7gB,EAAAwU,cAMGwM,EACKC,EAAMjhB,EAAAme,SACX+C,EAAMD,EAAKjhB,GACbihB,EAACjhB,GAAAihB,EAAA9C,GACD8C,EAAA9C,GAAQ+C,WAEPzF,EAAAjG,GACD,OAAAA,EAAS,cAEwBA,YAC7B,SAEH2L,EAAA,WACDC,gBAEC5nB,KAAA6nB,IAAA7nB,KAAA8nB,IAAA9nB,KAAA+nB,IAAA/nB,KAAAgoB,IAAA,KACGhoB,KAAI6c,EAAK,UAEXjP,EAAMC,GACN7N,KAAK6c,GAAG,IAAI7c,KAAA6nB,IAAA7nB,KAAA+nB,KAAAna,KAAA5N,KAAA8nB,IAAA9nB,KAAAgoB,KAAAna,gBAGK,YAARka,MACP/nB,KAAM+nB,IAAM/nB,KAAA6nB,IAAA7nB,KAAAgoB,IAAAhoB,KAAA8nB,IACV9nB,KAAE6c,GAAQ,YAGdjP,EAAMC,GACP7N,KAAA6c,GAAA,IAAA7c,KAAA+nB,KAAAna,KAAA5N,KAAAgoB,KAAAna,QAECD,EAAAC,EAAMhE,YACP+D,GAAAA,IAAA/D,GAAAA,GAGGmO,EAHHnK,GAAAA,SAIc,MAAA,IAAA9G,MAAA,mBACF,OAAP/G,KAAK+nB,IAAE/nB,KAAA6c,GAAA,IAAA9E,KAAAC,KACZpT,KAAA0T,IAAAtY,KAAA+nB,IAAAhQ,GAAA4P,GAAA/iB,KAAA0T,IAAAtY,KAAAgoB,IAAAhQ,GAAA2P,KAAA3nB,KAAA6c,GAAA,IAAA9E,EAAA,IAAAC,GACOnO,IACN7J,KAAK6c,GAAE,IAAMhT,KAAAA,WAAA+D,EAAA/D,KAAAgE,KAAAhE,KAAAA,WAAA7J,KAAA+nB,IAAAhQ,KAAA/X,KAAAgoB,IAAAhQ,YAAGnK,EAAChL,EAAAC,GAAA9C,KAAC6c,GAAA,IAAA7c,KAAA6nB,IAAA7nB,KAAA+nB,KAAAna,KAAA5N,KAAA8nB,IAAA9nB,KAAAgoB,KAAAna,MAAAhL,MAAAC,MAAAD,KAEpBzC,QACE,OAAOJ,KAAK6c,GAAK,iCAGAA,EAAA,GACnB/N,OAAClB,EAAAC,GACD7N,KAAS6c,EAAAtc,KAAA,CACPqN,EACDC,gBAIiD7N,KAAC6c,EAAAtc,KAAAP,KAAA6c,EAAA,GAAAoL,SAAKjZ,OAAGpB,EAAAC,GAAE7N,KAAG6c,EAAAtc,KAAA,CAAIqN,EAChEC,YAIF,OAAK7N,KAAO6c,EAAA9a,OAAW/B,KAAI6c,EAAG,YAG/BqL,EACDC,YAAUC,GAAAC,EAAAC,EAAAC,EAAAC,GAAA,CACR,EACA,EACA,IACD,MAEC,MAAOD,GAAAA,KAAWF,GAAAA,KAAQG,GAAIA,KAAEF,GAASA,IAAC,MAAE,IAAAvhB,MAAQ,kBAEpD/G,KAAyBooB,SAAAA,EACzBpoB,KAAKyoB,eAAiB,IAAItJ,aAAqC,EAApCiJ,EAAqBrG,OAAAhgB,QAChD/B,KAAK0oB,QAAW,IAAIvJ,aAAsC,EAA/BiJ,EAAUrG,OAAYhgB,aAC/CwmB,KAAQA,EAAGvoB,KAAAqoB,KAAeA,OAC1BG,KAAQA,EAAGxoB,KAAAsoB,KAAeA,OAC1BK,6BAGAP,SAAQnF,cACR0F,QACA3oB,mBAIAooB,UAAgBrG,OAAEA,EAAA2C,KAAAA,EAAAK,UAAAA,GAAA2D,QAAAA,GAAA1oB,KAElB4oB,EAAkB5oB,KAAA4oB,cAAA5oB,KAAAyoB,eAAA3D,SAAA,EAAAC,EAAAhjB,OAAA,EAAA,OAClB,IAAkC6L,EAAAC,EAAlCrH,EAAQ,EAAAme,EAAM,EAAG/iB,EAAKmjB,EAAOhjB,OAAKyE,EAAA5E,EAAA4E,GAAA,EAAAme,GAAA,EAAA,CAElC,MAAI9D,EAAe,EAAVkE,EAAUve,GACqBqiB,EAAA,EAAA9D,EAAAve,EAAA,GACMsiB,EAAA,EAAA/D,EAAAve,EAAA,GACAuQ,EAAAgL,EAAAlB,GACvB7J,EAAA+K,EAAAlB,EAAA,GACYhJ,EAAAkK,EAAA8G,GACjCnR,EAAKqK,EAAG8G,EAAG,GAC0DnQ,EAAAqJ,EAAA+G,GACdnQ,EAAAoJ,EAAA+G,EAAA,GAC/BnS,EAAAkB,EAAAd,EACxBH,EAAOc,EAAGV,EACTiO,EAAIvM,EAAK3B,EACTmO,EAAMvM,EAAK3B,EACX+R,EAAyB,GAAnBpS,EAAKuO,EAAKtO,EAAIqO,GACvB,GAACrgB,KAAO0T,IAAAyQ,GAAA,KAAA,CAMP,IAAA3a,EAAA,IAK2B,MAAAvE,EAAA,EAAAkb,EAAA,GACtB3W,GAAKxJ,KAAKokB,MAAMjH,EAAIlY,GAAAkN,GAAAmO,GAAAnD,EAAAlY,EAAA,GAAAmN,GAAAiO,GACpBrX,GAAKmJ,EAAK2B,GAAA,EAAAtK,EAAA8W,EACVrX,GAAKmJ,EAAA2B,GAAW,EAACvK,EAAA6W,MACf,CACF,MAAM5W,EAAA,EAAA0a,EACA5D,EAAGxO,EAAGA,EAAKC,EAAMA,EACpBwO,EAACH,EAAAA,EAAAC,EAAAA,EACRtX,EAAKmJ,GAAOmO,EAAIC,EAAKvO,EAAEwO,GAAA/W,EACvBR,EAAImJ,GAAQL,EAAGyO,EAAOH,EAAKE,GAAK9W,EAElCua,EAAcjE,GAAI/W,EACnBgb,EAAAjE,EAAA,GAAA9W,EAGD,IACA2Y,EACIzO,EACCC,EAHLlV,EAAM4hB,EAAMA,EAAG3iB,OAAW,GACnB4kB,EAAQ,EAAR7jB,EACCiU,EAACgL,EAAW,EAAEjf,GACbkU,EAAK+K,EAAM,EAAAjf,EAAS,KAC3BqW,KAAO,OACP,IAAI8P,EAAK,EAAEA,EAAAvE,EAAQ3iB,SAAAknB,EACnBnmB,EAAA4hB,EAAQuE,GACRzC,EAAKG,EAAG5O,EAAGhB,EAAKiB,EAAOhB,EACvB2P,EAAQ,EAAH7jB,EAAMiU,EAAAgL,EAAa,EAAGjf,GAAAkU,EAAA+K,EAAA,EAAAjf,EAAA,GAC3B4lB,EAAQlC,EAAG,GAAAkC,EAAc/B,GAAM3O,EAAAhB,EAC/B0R,EAAQlC,EAAG,GAAAkC,EAAc/B,EAAE,GAAA5P,EAAAgB,SAG5B/T,GACD,MAAMklB,EAAiB,MAAVllB,EAAoBA,EAAA,IAAA4jB,OAAArd,GACxB6d,UAAQpD,UAAQA,EAAcmE,QAAAA,EAAAzE,KAAAA,GAAAkE,cAAAA,EAAAF,QAAAA,GAAA1oB,QACrC0kB,EAAK3iB,QAAS,EAAI,OAAE,SACpB,IAAAyE,EAAO,EAAG5E,EAAKojB,EAAMjjB,OAAUyE,EAAK5E,IAAK4E,EAAA,CACzC,MAAMme,EAAIK,EAAAxe,GACV,GAAAme,EAAOne,EAAG,SACV,MAAM4iB,EAAU,EAANxkB,KAAMqC,MAAAT,EAAA,GACV6iB,EAAwB,EAApBzkB,KAAKqC,MAAA0d,EAAU,GACpB2E,EAAMV,EAACQ,GACbG,EAAAX,EAAAQ,EAAA,GACMI,EAAMZ,EAAgBS,GAC9BI,EAAAb,EAAAS,EAAA,GACDrpB,KAAa0pB,eAAUJ,EAAAC,EAAAC,EAAAC,EAAAzlB,GAErB,IAAA2lB,EAAQC,EAAKlF,EAAKA,EAAI3iB,OAAO,GAC7B,IAAA,IAAO8nB,EAAM,EAAIA,EAAMnF,EAAC3iB,SAAK8nB,EAAA,CAC9BF,EAAAC,EAAAA,EAAAlF,EAAAmF,GACD,MAAcpc,EAAU,EAAV7I,KAASqC,MAACkiB,EAAAS,GAAA,GAChBhc,EAAMgb,EAAcnb,GACpBI,EAAM+a,EAAenb,EAAA,GACjBqc,EAAS,EAATH,EACF3N,EAAMhc,KAAC+pB,SAAWnc,EAAAC,EAAQ6a,EAAAoB,EAAA,GAAApB,EAAAoB,EAAA,IAC1B9N,GAAAhc,KAAO0pB,eAAM9b,EAAAC,EAAAmO,EAAA,GAAAA,EAAA,GAAAhY,GAErB,OAAQklB,GAAQA,EAAK9oB,qBAKd4D,GACR,MAAAklB,EAAA,MAAAllB,EAAAA,EAAA,IAAA4jB,OAAArd,EAEC,OADDvG,EAAAoV,KAAgBpZ,KAAAqoB,KAAAroB,KAAAsoB,KAAAtoB,KAAAuoB,KAAAvoB,KAAAqoB,KAAAroB,KAAAwoB,KAAAxoB,KAAAsoB,MACRY,GAAQA,EAAG9oB,mBAEhBoG,EAAMxC,SACJklB,EAAkB,MAAVllB,EAAcA,EAAY,IAAA4jB,OAAArd,EACrCwX,EAAA/hB,KAAAgqB,MAAAxjB,GACF,GAAA,OAAAub,IAAAA,EAAAhgB,OAAA,OACDiC,EAAY8K,OAAIiT,EAAA,GAAAA,EAAA,IACd,IAAAngB,EAAMmgB,EAAOhgB,OACb,KAAKggB,EAAA,KAAcA,EAAOngB,EAAA,IAAAmgB,EAAA,KAAAA,EAAAngB,EAAA,IAAAA,EAAA,GAAAA,GAAA,EAC1B,IAAA,IAAOqoB,EAAO,EAACA,EAAKroB,EAAAqoB,GAAA,EAAAlI,EAAAkI,KAAAlI,EAAAkI,EAAA,IAAAlI,EAAAkI,EAAA,KAAAlI,EAAAkI,EAAA,IAAAjmB,EAAAgL,OAAA+S,EAAAkI,GAAAlI,EAAAkI,EAAA,IAEtB,OADCjmB,EAAA+K,YACDma,GAAqBA,EAAM9oB,wBAGzB,MAAQgoB,UAAQrG,OAAYA,IAAM/hB,KAClC,IAAI,IAAEwG,EAAM,EAAA5E,EAAMmgB,EAAQhgB,OAAC,EAAAyE,EAAA5E,IAAA4E,EAAA,CACzB,MAAA0jB,EAAQlqB,KAASmqB,YAAI3jB,GACrB0jB,IAAQA,EAAOrO,MAAMrV,QAAA0jB,gBAGrB1jB,GACF,MAAC4jB,EAAA,IAAAC,EAEH,OADCrqB,KAAAsqB,WAAA9jB,EAAA4jB,GACSA,EAAShqB,uBAEN2X,EAACC,EAAAjB,EAASC,EAAMhT,GAC5B,IAAAumB,EACA,MAASC,EAAKxqB,KAAAyqB,YAAA1S,EAAAC,GACP9B,EAAKlW,KAAKyqB,YAAO1T,EAAAC,GACZ,IAAPwT,GAAgB,IAAPtU,GACXlS,EAAQ8K,OAAOiJ,EAACC,GAChBhU,EAAuBgL,OAAA+H,EAAAC,KACjBuT,EAAEvqB,KAAM0qB,aAAe3S,EAAIC,EAAKjB,EAACC,EAAMwT,EAAItU,QAC1CpH,OAAMyb,EAAG,GAAGA,EAAE,aAMRA,EAAA,GAAAA,EAAA,cAIZ/jB,EAAAoH,EAAAC,GACH,OAACD,GAAAA,IAAAA,IAAAC,GAAAA,IAAAA,GACF7N,KAAAooB,SAAAuC,MAAAnkB,EAAAoH,EAAAC,KAAArH,aAEQA,GACP,MAAMokB,EAAK5qB,KAAAgqB,MAASxjB,GACpB,GAAIokB,EAAE,IAAO,MAAEjG,KAAO3kB,KAAyBooB,SAAAyC,UAAArkB,GAAA,CAC/C,MAAMskB,EAAS9qB,KAAEgqB,MAAArF,GAEb,GAAAmG,EAAAC,EAAA,IAAA,IAAAC,EAAA,EAAAC,EAAAL,EAAA7oB,OAAAipB,EAAAC,EAAAD,GAAA,EACF,IAAO,IAAGE,EAAK,EAAKC,EAAKL,EAAC/oB,OAAAmpB,EAAAC,EAAAD,GAAA,EAAA,GAAAN,EAAAI,IAAAF,EAAAI,IAAAN,EAAAI,EAAA,IAAAF,EAAAI,EAAA,IAAAN,GAAAI,EAAA,GAAAC,IAAAH,GAAAI,EAAAC,EAAA,GAAAA,IAAAP,GAAAI,EAAA,GAAAC,IAAAH,GAAAI,EAAAC,EAAA,GAAAA,GAAA,OACdxG,EACJ,MAAMoG,IAKlBK,MAAC5kB,GACD,MAAUoiB,cAAAA,EAAAR,UAAAe,QAAAA,EAAAnE,UAAAA,EAAAD,UAAAA,IAAA/kB,KAC0CqrB,EAAAlC,EAAA3iB,GAClD,IAAW,IAAP6kB,EAAW,OAAK,WACVtJ,EAAS,OAAEpc,EAAI0lB,KAAkB,MAAK5d,EAAI7I,KAAAqC,MAAAtB,EAAA,GAAwB,GAAtBoc,EAAKxhB,KAAIqoB,EAAA,EAAAnb,GAAAmb,EAAA,EAAAnb,EAAA,IAAE9H,EAAIA,EAAC,GAAI,EAAAA,EAAA,EAAAA,EAAA,EAAMof,EAAKpf,KAAAa,EAAA,MAAEb,EAAIqf,EAAKrf,SAACA,IAAA0lB,IAAA,IAAA1lB,GAEjG,OAAMoc,QAENvb,GAEA,GAAU,IAAVA,GACyB,IADVxG,KAAGooB,SACZ1D,KAAK3iB,OAAiB,MAAM,CAEnC/B,KAAAuoB,KACDvoB,KAAasoB,KACXtoB,KAAOuoB,KACHvoB,KAAIwoB,KACJxoB,KAAIqoB,KACJroB,KAAIwoB,KACJxoB,KAAIqoB,KACHroB,KAAKsoB,YAENvG,EAAS/hB,KAAGorB,MAAK5kB,MACR,OAAXub,EAAgB,OAAQ,WACtB2G,QAAS4C,GAAMtrB,OACV,EAAHwG,eACI8kB,EAAGxB,EAAC,GAAA9pB,KAAAurB,cAAA/kB,EAAAub,EAAAuJ,EAAAxB,GAAAwB,EAAAxB,EAAA,GAAAwB,EAAAxB,EAAA,GAAAwB,EAAAxB,EAAA,IAAA9pB,KAAAwrB,YAAAhlB,EAAAub,4BAAOA,EAAAhgB,aAEjBiW,MADFyT,EAAC,KACK1U,EAAGgL,EAAQngB,EAAK,GAAEoV,EAAG+K,EAAAngB,EAAA,GACzBsU,EAAIlW,KAAEyqB,YAAS1T,EAAAC,KACb,cACC2N,EAAK/iB,EAAG+iB,GAAK,OACf5N,EAAAiB,EAAOhB,EAAAD,EAAAgL,EAAA4C,GAAA3N,EAAA+K,EAAA4C,EAAA,OACNzO,EAAMlW,KAAGyqB,YAAK1T,EAAaC,GAC1B,OAAa,IAARd,IACNwV,EAAKA,EAAI,EACTD,EAAEA,EAAElrB,KAAMwW,EAAIC,GACdyU,EAAK,WAEP,IAAClB,EAAAoB,EAAAC,EAAAC,EAAAC,EACD,GAAW,IAATtB,EAAY,CACV,GAA2C,QAAzCD,EAAMvqB,KAAM0qB,aAAY3S,EAAIC,EAAKjB,EAAEC,EAAMwT,EAAAtU,IAAA,UAC1CyV,EAAIC,EAAKC,EAAKC,GAAGvB,MAChB,CAAI,GAAG,QAAAA,EAAAvqB,KAAA0qB,aAAA3T,EAAAC,EAAAe,EAAAC,EAAA9B,EAAAsU,IAAA,UAAEqB,EAAGC,EAAAH,EAAAC,GAAArB,EAACc,EAAAK,EAAAA,EAAA1rB,KAAA+rB,UAAAJ,EAAAC,GACpBP,GAAAK,GAAA1rB,KAAAgsB,MAAAxlB,EAAA6kB,EAAAK,EAAAD,EAAAA,EAAA1pB,QACF0pB,EAAAA,EAAAlrB,KAAAorB,EAAAC,GACOH,EAAA,CACKE,EACCC,GAEWP,EAAKK,EAAAA,EAAA1rB,KAAA+rB,UAAAF,EAAAC,GAAOT,GAAIK,GAAA1rB,KAAAgsB,MAAAxlB,EAAA6kB,EAAAK,EAAAD,EAAAA,EAAA1pB,QAAO0pB,EAAIA,EAAAlrB,KAAAsrB,EAAAC,GAAWL,EAAA,CAAOI,EAAWC,GAGlF,GAAAL,EACDJ,EAAaK,EAAIA,EAAI1rB,KAAM+rB,UAAUN,EAAC,GAAAA,EAAA,IAC7BJ,GAAOK,GAAA1rB,KAAAgsB,MAAAxlB,EAAA6kB,EAAAK,EAAAD,EAAAA,EAAA1pB,aACV,GAAI/B,KAAMisB,SAAMzlB,GAAMxG,KAAEqoB,KAAQroB,KAAAuoB,MAAA,GAAAvoB,KAAAsoB,KAAAtoB,KAAAwoB,MAAA,GAAA,MAAA,MAAAD,UAAID,UAAIC,UAAIC,KAAExoB,KAACqoB,KACjDroB,KAAIwoB,KACJxoB,KAAKqoB,KACLroB,KAAKsoB,4BAIDvQ,EAAIC,EAAKjB,EAAGC,EAAKwT,EAAGtU,UACjB,CACR,GAAA,IAAAsU,GAAA,IAAAtU,EAAA,MAAA,CACF6B,EACDC,EACUjB,EACAC,GAEJ,GAAIwT,EAAKtU,EAAA,OAAW,KAEpB,IAAEtI,EAAKC,EAAEnM,EAAK8oB,GAAKtU,EACb,EAAFxU,GAAMkM,EAAKmK,GAAGhB,EAAKgB,IAAS/X,KAAMwoB,KAAMxQ,IAAQhB,EAACgB,GAAMnK,EAAA7N,KAAAwoB,MAC5D,EAAA9mB,GAAAkM,EAAAmK,GAAAhB,EAAAgB,IAAA/X,KAAAsoB,KAAAtQ,IAAAhB,EAAAgB,GAAAnK,EAAA7N,KAAAsoB,MACa,EAAD5mB,GAACmM,EAAUmK,GAAGhB,EAAKgB,IAAOhY,KAAKuoB,KAASxQ,IAAQhB,EAAIgB,GAAGnK,EAAK5N,KAAIuoB,OACnE1a,EAAImK,GAAAhB,EAAAgB,IAAAhY,KAAAqoB,KAAAtQ,IAAAhB,EAAAgB,GAAAnK,EAAA5N,KAAAqoB,MAAMmC,GAACzS,EAAInK,EAAAoK,EAAAnK,EAAA2c,EAAAxqB,KAAAyqB,YAAA1S,EAAAC,KAAOjB,EAAInJ,EAAAoJ,EAAAnJ,EAAAqI,EAAAlW,KAAAyqB,YAAA1T,EAAAC,mBAA6BxQ,EAAIub,EAAAmK,EAAAC,EAAAC,EAAAC,OAAWrQ,EAATyP,EAAIzV,MAAKsW,KAAAvK,GAElF,IAFoF/F,EAAIhc,KAAK+pB,SAAA0B,EAAA,GAAAA,EAAA,GAAAS,EAAAC,KAAAV,EAAAc,QAAAvQ,EAAA,GAAAA,EAAA,KAACA,EAAAhc,KAAA+pB,SAAA0B,EAAAA,EAAA1pB,OAAA,GAAA0pB,EAAAA,EAAA1pB,OAAA,GAAAqqB,EAAAC,KAAAZ,EAAAlrB,KAAAyb,EAAA,GAAAA,EAAA,IAE9FyP,EAAQzrB,KAAAwrB,YAAAhlB,EAAAilB,GAAA,IAAA,IAAAjB,EAAA7F,EAAA,EAAA/iB,EAAA6pB,EAAA1pB,OAAAmU,EAAAlW,KAAA+rB,UAAAN,EAAA7pB,EAAA,GAAA6pB,EAAA7pB,EAAA,IAAA+iB,EAAA/iB,EAAA+iB,GAAA,EACT6F,EAAAtU,EAAAA,EAAAlW,KAAA+rB,UAAAN,EAAA9G,GAAA8G,EAAA9G,EAAA,IACU6F,GAAOtU,IAAGyO,EAAG3kB,KAAAgsB,MAAAxlB,EAAAgkB,EAAAtU,EAAAuV,EAAA9G,GAAA/iB,EAAA6pB,EAAA1pB,aAEf/B,KAAGisB,SAAAzlB,GAAAxG,KAAAqoB,KAAAroB,KAAAuoB,MAAA,GAAAvoB,KAAAsoB,KAAAtoB,KAAAwoB,MAAA,KAAAiD,EAAA,CACRzrB,KAAAqoB,UACEC,8BACAC,8BACAC,4BACaiD,EAAE9G,YAAyC+G,GAAA,KACxD9d,EAAAC,iBAA0B,EACtBwd,EAAO,EAAE,cAA2C,EACpDA,EAAO,EAAAzd,EAAA5N,KAAAuoB,KAAA1a,EAAA7N,KAAAsoB,KAAE,WAAa,EACtB+C,EAAO,EAAE,cAA2C,+BAEc,MACf,KAAA,GACjDA,EAAA,EAGT,SACK,KAAM,EAEDA,EAAI,EAACzd,EAAI5N,KAAMqoB,KAAMxa,EAAG7N,KAAKwoB,KAC9B,MAGP,KAAA,EAEK6C,EAAA,EACT,SACU,KAAM,EACPA,EAAQ,EAAGzd,EAAK5N,KAACqoB,KAAAxa,EAAA7N,KAAAsoB,KAKnBmD,EAAE9G,KAAQ/W,GAAK6d,EAAE9G,EAAA,KAAW9W,IAAA7N,KAAAisB,SAAAzlB,EAAAoH,EAAAC,KAAA4d,EAAAxpB,OAAA0iB,EAAA,EAAA/W,EAAAC,GAAA8W,GAAA,GAElC,GAAC8G,EAAA1pB,OAAA,EAAA,IAAA,IAAAyqB,EAAA,EAAAA,EAAAf,EAAA1pB,OAAAyqB,GAAA,EAAA,CACG,MAAM7H,GAAG6H,EAAA,GAAAf,EAAA1pB,OAAAkU,GAAAuW,EAAA,GAAAf,EAAA1pB,QACP0pB,EAAEe,KAASf,EAAA9G,IAAM8G,EAAA9G,KAAW8G,EAAAxV,IAAAwV,EAAAe,EAAA,KAAAf,EAAA9G,EAAA,IAAA8G,EAAA9G,EAAA,KAAA8G,EAAAxV,EAAA,MAAAwV,EAAAxpB,OAAA0iB,EAAA,GAAA6H,GAAA,GAElC,OAAO7H,WAEL5M,EAAKC,EAACyU,EAAIC,GACZ,IAAChrB,EAAAkM,EAAAC,EAAAJ,EAAAgK,EAAAA,EACD,GAAAiV,EAAQ,EAAA,CAAA,GAAC1U,GAAAhY,KAAAsoB,KAAA,OAAA,MAAG5mB,GAAA1B,KAAAsoB,KAAAtQ,GAAA0U,GAAAjf,IAAAI,EAAA7N,KAAAsoB,KAAA1a,EAAAmK,GAAAtK,EAAA/L,GAAA+qB,QAAC,GAAAC,EAAA,EAAA,CACd,GAAA1U,GAAAhY,KAAAwoB,KAAA,OAAA,MACY9mB,GAAI1B,KAAAwoB,KAAAxQ,GAAA0U,GAAAjf,IAAAI,EAAA7N,KAAAwoB,KAAA5a,EAAAmK,GAAAtK,EAAA/L,GAAA+qB,GAKhB,GAAAA,EAAA,EAAA,CACD,GAAY1U,GAAM/X,KAACuoB,KAAA,OAAA,MACR7mB,GAAG1B,KAAKuoB,KAAaxQ,GACpB0U,GAAKhf,IAAIG,EAAS5N,KAASuoB,KAC7B1a,EAAGmK,GAAKvK,EAAO/L,GAChBgrB,QACR,GAAAD,EAAA,EAAA,8BAGG/qB,GAAA1B,KAAAqoB,KAAMtQ,GAAI0U,GAAOhf,IAAEG,EAAA5N,KAAAqoB,KAAAxa,EAAAmK,GAAGvK,EAAG/L,GAAQgrB,GAGrC,MAAU,CACX9e,EAEQC,GAIgEke,UAAAne,EAAAC,UAChED,IAAA5N,KAAAqoB,KAAA,EAAAza,IAAa5N,KAACuoB,KAAA,EAAA,IAAA1a,IAAA7N,KAAAsoB,KAAA,EAAAza,IAAA7N,KAAAwoB,KAAA,EAAA,GAErBiC,YAAa7c,EAAGC,GACd,OAAOD,EAAI5N,KAAGqoB,KAAU,EAClBza,EAAI5N,KAAIuoB,KAAA,EAAW,IACnB1a,EAAI7N,KAAIsoB,KAAA,EAAWza,EAAI7N,KACvBwoB,KAAS,EAAA,UAIjBmE,EAAW,EAAA/nB,KAAAqJ,GAAA2e,EAAAhoB,KAAA+c,IACb,SAACkL,EAAA7Q,UAEQA,EAAA,YACE8Q,EAAsB9Q,UAAGA,EAAG,YAanC+Q,EAA8Bnf,EAACC,EAAAhE,SAC/B,CACD+D,EAAAhJ,KAAA6T,IAAA7K,EAAAC,GAAAhE,EACDgE,EAAMjJ,KAAIuT,IAAAvK,EAAAC,GAAAhE,YAIVmjB,YAACjL,EAAA9H,EAAA4S,EAAA3S,EAAA4S,EAAAG,GACD,OAAS,IAAAC,GAAA,WAAAnL,WAiMyBA,EAAA9H,EAAAC,EAAA+S,SAC9BrrB,EAACmgB,EAAAhgB,OACJorB,EAAA,IAAAhO,aAAA,EAAAvd,GACF,IAAA,IAAA4E,EAAA,EAAAA,EAAA5E,IAAA4E,EAAA,uEApMU4mB,CAAArL,EAAA9H,EAAAC,EAAA+S,GAAA9N,aAAAmN,iGAAAe,CAAAtL,EAAA9H,EAAAC,EAAA+S,iBAGelL,GACtB/hB,KAAKstB,YAAW,IAAKxL,EAAcC,QACjCoH,QAAK,IAAS3G,WAAGT,EAAgBhgB,OAAC,mBAAQ,IAAMygB,WAAST,EAAAhgB,OAAA,QAACggB,OAAM/hB,KAAMstB,YAAAlL,qDAGjDa,yCAErB5U,EAAKrO,KAAKstB,YAAUvL,EAAO/hB,KAAU+hB,kBAE7B1T,EAAEqW,KAAG3iB,OAAQ,YA9BrBsM,SACG0W,UAAWA,EAAO3C,OAAAA,GAAA/T,MACvB,IAAA7H,EAAO,EAAIA,EAAAue,EAAAhjB,OAAAyE,GAAA,EAAA,CAGZ,MAAA4H,EAAA,EAAA2W,EAAAve,GAAAuD,EAAA,EAAAgb,EAAAve,EAAA,GAAA9E,EAAA,EAAAqjB,EAAAve,EAAA,OAAA4b,EAAA1gB,GAAA0gB,EAAAhU,KAAAgU,EAAArY,EAAA,GAAAqY,EAAAhU,EAAA,KAAAgU,EAAArY,GAAAqY,EAAAhU,KAAAgU,EAAA1gB,EAAA,GAAA0gB,EAAAhU,EAAA,IACW,MAAS,OAAA,SAEnB,EAsBuBmf,CAAAlf,GAAA,MACnBmf,UAAWhL,WAAW8J,KAAC,CACxBvqB,OAAAggB,EAAAhgB,OAAA,IACD,CAAI8a,EAACrW,IAAAA,IACNmW,MACC,CAAAnW,EAAOme,IAAK5C,EAAA,EAASvb,GAAAub,EAAA,EAAA4C,IAAA5C,EAAA,EAAAvb,EAAA,GAAAub,EAAA,EAAA4C,EAAA,KAIvB,MAAUhf,EAAG3F,KAAKwtB,UAAW,GAAClf,EAAAtO,KAAYwtB,UAAIxtB,KAAAwtB,UAAAzrB,OAAA,GAAA0rB,EAAA,CACxC1L,EAAS,EAAGpc,GACZoc,EAAO,EAAGpc,EAAK,GACfoc,EAAS,EAAGzT,GAEqDyT,EAAA,EAAAzT,EAAA,IACLzE,EAAA,KAAAjF,KAAA8oB,MAAAD,EAAA,GAAAA,EAAA,GAAAA,EAAA,GAAAA,EAAA,IACb,IAAA,IAAAE,EAAA,EAAA/rB,EAAAmgB,EAAAhgB,OAAA,EAAA4rB,EAAA/rB,IAAA+rB,EAAA,CAC5C,MAAK3R,EAAG+Q,EAA+BhL,EAAG,EAAA4L,GAAA5L,EAAA,EAAA4L,EAAA,GAAA9jB,GACjDkY,EAAU,EAAA4L,GAAW3R,EAAG,GACpB+F,EAAA,EAAW4L,EAAM,GAAE3R,EAAI,GAExBhc,KAAKstB,YAAU,IAAKxL,EACRC,eAG2B/hB,KAAAwtB,UAC5C,MAAIxI,EAAWhlB,KAAKglB,UAAehlB,KAAIstB,YAAGtI,UACxCN,EAAK1kB,KAAS0kB,KAAO1kB,KAAAstB,YAAc5I,KACnCK,EAAc/kB,KAAG+kB,UAAc/kB,KAAIstB,YAAOvI,UAC1CoE,EAAKnpB,KAAWmpB,QAAShQ,MAAC,GAC1ByU,EAAc5tB,KAAK6tB,WAAC1U,MAAA,WAIlBxT,EAAI,EAAC/D,EAAAojB,EAAejjB,OAAM4D,EAAA/D,IAAA+D,EAAA,CAC5B,MAACqW,EAAA+I,EAAApf,EAAA,GAAA,EAAAA,EAAA,EAAAA,EAAA,IACF,IAAAqf,EAAArf,KAAA,IAAAwjB,EAAAnN,KAAAmN,EAAAnN,GAAArW,GAEH,IAAQ,IAAAa,EAAQ,EAACsnB,EAAApJ,EAAA3iB,OAAAyE,EAAAsnB,IAAAtnB,EAAAonB,EAAAlJ,EAAAle,IAAAA,EAEhBke,EAAA3iB,QAAA,GAAA2iB,EAAA3iB,OAAA,IACA/B,KAAW+kB,UAAG,IAAAvC,WAAA,GAAArJ,MAAA,GACbnZ,KAAOglB,UAAA,IAAOxC,WAAE,GAAIrJ,MAAA,GAE4BnZ,KAAA+kB,UAAA,GAAAL,EAAA,GAC5CyE,EAAAzE,EAAY,IAAA,EACM,IAApBA,EAAO3iB,SACHonB,EAAKzE,EAAQ,IAAA,EACb1kB,KAAI+kB,UAAU,GAAML,EAAI,GAC5B1kB,KAAM+kB,UAAA,GAAAL,EAAA,aAKJ+I,UACA,IAAAvF,EAAAloB,KAAAytB,cAEDjnB,SACG2iB,QAASA,EAASzE,KAAEA,EAA4BmJ,WAAAA,EAAA7I,UAAAA,EAAAD,UAAAA,EAAAyI,UAAAA,GAAAxtB,QAEpDwtB,EAAU,OACRO,EAAMP,EAAU7jB,QAAAnD,GAGlB,OAFEunB,EAAI,UAAQP,EAASO,EAAA,SACrBA,EAAAP,EAAMzrB,OAAA,UAAAyrB,EAAAO,EAAA,KAGX,MAAA1C,EAAAlC,EAAA3iB,GACG,IAAY,IAAR6kB,EAAW,OACjB,IAAE1lB,EAAI0lB,EAAK7E,GAAG,EACd,EAAA,CAGA,SAFKA,EAAAzB,EAAApf,KACIA,EAAG,GAAK,EAAMA,EAAI,EAAGA,EAAA,EACtBof,EAAApf,KAAAa,EAAA,OAEH,GADNb,EAAAqf,EAAArf,IACe,IAAJA,EAAI,CACP,MAAAqW,EAAA0I,GAAOmJ,EAAErnB,GAAI,GAAAke,EAAA3iB,QAEZ,YADIia,IAACwK,UAAaxK,WAGlBrW,IAAG0lB,UAEPxd,EAAArH,EAAA,OACFoH,GAAKA,IAAGA,IAAWC,GAAAA,IAAAA,EAAA,OAAA,QACnB6V,EAAMld,MACN9E,QACCA,EAAI1B,KAAI2qB,MAASnkB,EAACoH,EAAIC,KAAQ,GAAAnM,IAAA8E,GAAA9E,IAAAgiB,GAAAld,EAAA9E,SAC7BA,UAEFkM,EAAIC,SACFsb,QAAQA,EAAEzE,KAAYA,EAASmJ,WAAWA,EAAA7I,UAAAA,EAAAD,UAAAA,EAAAhD,OAAAA,GAAA/hB,SAC/B,MAAPwG,KAAUub,EAAAhgB,OAAA,OAAAyE,EAAA,IAAAub,EAAAhgB,QAAA,aAEb6qB,EAAAhf,EAAAmU,EAAA,EAAAvb,GAAA,GAAAomB,EAAA/e,EAAAkU,EAAA,EAAAvb,EAAA,GAAA,WACD2iB,EAAK3iB,OACPb,EAAC0lB,EACH,EAAC,CACD,IAAQ5d,EAAAsX,EAAApf,GACT,MAAAqoB,EAAApB,EAAAhf,EAAAmU,EAAA,EAAAtU,GAAA,GAAAmf,EAAA/e,EAAAkU,EAAA,EAAAtU,EAAA,GAAA,GAGC,GAFKugB,EAAUC,IAAAA,EAAAD,EAAAtsB,EAAA+L,GACf9H,EAAMA,EAAM,GAAG,EAAOA,EAAI,EAAIA,EAAG,EAC1Bof,EAAApf,KAAMa,EAAA,MAEX,GADGb,EAAIqf,EAAQrf,IACL,IAAVA,EAAU,CAEV,GADIA,EAAI+e,GAAGmJ,EAAQrnB,GAAA,GAAAke,EAAA3iB,QACX4D,IAAG8H,GACAmf,EAAgBhf,EAAAmU,EAAA,EAAApc,GAAA,GAAAinB,EAAA/e,EAAAkU,EAAA,EAAApc,EAAA,GAAA,GAAAsoB,EAAA,OAAAtoB,EAE3B,aAEGA,IAAA0lB,GACL,OAAO3pB,EAETwsB,OAAAlqB,GACE,MAAKklB,EAAoB,MAAfllB,EAAsBA,EAAW,IAAA4jB,OAAiCrd,GACvEwX,OAAIA,EAAaiD,UAAKA,EAAAD,UAAAA,GAAA/kB,KAC3B,IAAA,IAAMwG,EAAM,EAAG5E,EAAAojB,EAAWjjB,OAAOyE,EAAO5E,IAAM4E,EAAC,CAC/C,MAAOme,EAAAK,EAAMxe,GACR,GAAIme,EAAIne,EAAG,SACd,MAAM4iB,EAAmB,EAAfrE,EAAWve,GACrB6iB,EAAuB,EAAftE,EAAYJ,GACpB3gB,EAAQ8K,OAAOiT,EAAOqH,GAAErH,EAAAqH,EAAA,IACzBplB,EAAAgL,OAAA+S,EAAAsH,GAAAtH,EAAAsH,EAAA,IAGH,OADCrpB,KAAAmuB,WAAAnqB,GACUklB,GAAUA,EAAA9oB,qBAEZ4D,EAAI6F,QACDU,IAAVV,GAAwB7F,GAAc,mBAAAA,EAAA8K,SAAAjF,EAAA7F,EAAAA,EAAA,MACtC6F,EAAQU,MAARV,EAAqB,GAAKA,EAC1B,MAAKqf,EAAuB,MAAZllB,EAAaA,EAAA,IAAA4jB,OAAArd,GAC3BwX,OAAWA,GAAS/hB,SACpB,IAAAwG,EAAQ,EAAA5E,EAAOmgB,EAAOhgB,OAAIyE,EAAQ5E,EAAG4E,GAAC,EAAA,CACvC,MAAAoH,EAAAmU,EAAAvb,GAAAqH,EAAAkU,EAAAvb,EAAA,GACDxC,EAAQ8K,OAASlB,EAAA/D,EAAAgE,GACjB7J,EAAOiV,IAAMrL,EAAIC,EAAAhE,EAAO,EAAA8iB,GAE1B,OAAWzD,GAAIA,EAAA9oB,mBAER4D,GACL,MAAMklB,EAAc,MAALllB,EAAKA,EAAA,IAAA4jB,OAAArd,GACrBma,KAAAA,EAAA3C,OAAAA,GAAA/hB,KACD8C,EAAkB,EAAJ4hB,EAAI,GAAS9iB,EAAC8iB,EAAA3iB,OAC1BiC,EAAM8K,OAASiT,EAAOjf,GAAIif,EAAOjf,EAAA,IACjC,IAAA,IAAO0D,EAAA,EAAAA,EAAA5E,IAAM4E,EAAA,CACb,MAAQ1D,EAAG,EAAA4hB,EAAWle,GACtBxC,EAAWgL,OAAA+S,EAAejf,GAAIif,EAACjf,EAAA,IAG/B,OADAkB,EAAQ+K,YACDma,GAAQA,EAAS9oB,sBAGxB,MAAMgqB,EAAO,IAAIC,EAElB,OADArqB,KAAAmuB,WAAA/D,GACAA,EAAgBhqB,uBAELoG,EAAIxC,GAGf,MAAAklB,EAAA,MAAAllB,EAAAA,EAAA,IAAA4jB,OAAArd,GACDwX,OAAoBA,EAAAgD,UAAAA,GAAA/kB,KACZ8gB,EAAc,EAAdiE,EAAcve,GAAA,GACfqa,EAAyB,EAAzBkE,EAAgBve,EAAE,GACjBqiB,EAAc,EAAb9D,EAAave,EAAA,GAMtB,OALCxC,EAAA8K,OAAAiT,EAAAjB,GAAAiB,EAAAjB,EAAA,4BAGM9R,OAAA+S,EAAA8G,GAAA9G,EAAU8G,EAAM,IACvB7kB,EAAU+K,YACCma,GAAOA,EAAA9oB,4BAGhB,MAAO2kB,UAAWA,GAAe/kB,KACjC,IAAA,IAAOwG,EAAI,EAAI5E,EAAImjB,EAAQhjB,OAAU,EAAEyE,EAAM5E,IAAA4E,QAAAxG,KAAAouB,gBAAA5nB,GAE/C4nB,gBAAY5nB,GACb,MAAA4jB,EAAA,IAAAC,EAGK,YADIgE,eAAA7nB,EAAA4jB,GACCA,EAAAhqB,qBCv0C0BmW,EAAY1G,GAG7C,IAAIiG,EACAwY,EAHStuB,KAKRijB,OAAS,SAAU1H,GACpBzF,EAAOyF,EAAW6C,gBAClB,MAAM2D,EAASjM,EAAK8F,KAAKjW,GAAM,CAACA,EAAEiI,EAAGjI,EAAEkI,KACjCua,EAAW8E,GAASZ,KAAKvK,GAC/BuM,EAAUlG,EAASkG,QAAQ,CAAC,EAAG,EAAGze,EAAO7M,MAAO6M,EAAO5M,UAT9CjD,KAYRkuB,OAAS,WACV,MAAO5qB,IAACA,GAAQuM,EAEhBvM,EAAI4J,OAMJ5J,EAAIiL,YACJjL,EAAI2V,IAAI1C,EAAW3I,EAAG2I,EAAW1I,EAAG0I,EAAW1M,EAAG,EAAG,EAAIjF,KAAKqJ,IAE9D3K,EAAIirB,OAEJ,MAAM3sB,EAAIkU,EAAK/T,OACf,IAAK,IAAIyE,EAAI,EAAGA,EAAI5E,EAAG4E,IACnBlD,EAAIiL,YACJ+f,EAAQhE,WAAW9jB,EAAGlD,GACtBA,EAAIiF,UAAYuN,EAAKtP,GAAGgoB,OAAOjlB,MAC/BjG,EAAI6V,OACJ7V,EAAI4V,SAGR5V,EAAIiL,YACJjL,EAAI2V,IAAI1C,EAAW3I,EAAG2I,EAAW1I,EAAG0I,EAAW1M,EAAG,EAAG,EAAIjF,KAAKqJ,IAC9D3K,EAAI4V,SAEJ5V,EAAI+J,uBC5CqBohB,EAAaC,GAC1C,MAAMptB,EAAOtB,KACbsB,EAAKqtB,MAAQF,EAEbC,EAAME,gBAAgBH,EAAaA,EAAY5X,QAE/CvV,EAAKutB,iBAAgB,KACjBvtB,EAAKqtB,MAAME,gCCRoBJ,EAAaC,EAAO7e,GACvD,MAAMvO,EAAOtB,KACb8uB,GAASC,KAAKztB,EAAMmtB,EAAaC,GAEjC,MAAMM,EAAe,IAAIC,GAAaR,EAAa5e,GAEnDvO,EAAK2hB,OAAS,SAAU1H,GACpByT,EAAa/L,OAAO1H,IAIxBja,EAAK4sB,OAAS,WAEVc,EAAad,sBCfgBgB,EAAWR,GAC5C,MAAMptB,EAAOtB,KACbsB,EAAK4tB,UAAYA,EAEjBR,EAAMS,gBAAgBD,EAAWA,EAAUV,QAE3CltB,EAAKutB,iBAAgB,KACjBvtB,EAAK4tB,UAAUL,kCCRnB,MAAMvtB,EAAOtB,KAEPovB,EAAU,GAEhB9tB,EAAK+tB,aAAe,SAAUC,GAC1BF,EAAQ7uB,KAAK+uB,IAGjBhuB,EAAKiuB,iBAAgB,IAASH,EAAQxa,QAAQ0a,GAAWA,EAAOJ,UAAUM,SAE1EluB,EAAK8c,cAAa,IACI9c,EAAKiuB,mBACN3T,KAAK0T,GAAWA,EAAOJ,YAG5C5tB,EAAKmuB,sBAAyBC,IACbpuB,EAAK8c,gBACbzd,SAAO,CAAEgvB,EAAK9T,KACf,MAAM+T,EAAWF,EAAU7T,GAC3B8T,EAAIE,YAAYD,OAGxBtuB,EAAKwuB,iBAAoBC,IACRzuB,EAAK8c,gBACbzd,SAAO,CAAEgvB,EAAK9T,KACf,MAAMmU,EAAMD,EAAgBlU,GAC5B8T,EAAIM,QAAQD,OAGpB1uB,EAAKutB,iBAAgB,KACJvtB,EAAK8c,gBACbzd,SAASgvB,GAAQA,EAAId,oCC/B9B,MAAMvtB,EAAOtB,KAEPkwB,EAAY,GAClB5uB,EAAK4uB,UAAYA,EAEjB5uB,EAAK6uB,cAAgB,SAAU5Z,GAC3B2Z,EAAU3vB,KAAKgW,IAGnBjV,EAAK6c,eAAc,IAAS+R,EAAUtb,QAAQkV,GAAMA,EAAE6E,MAAMa,SAAQ5T,KAAKkO,GAAMA,EAAE6E,QACjFrtB,EAAK8uB,kBAAiB,IAASF,EAAUtb,QAAQkV,GAAMA,EAAE6E,MAAMa,SAE/DluB,EAAK2hB,OAAU1H,IACX2U,EAAUvvB,SAASmpB,IAAYA,EAAE6E,MAAMa,QAAQ1F,EAAE7G,OAAO1H,OAE5Dja,EAAK4sB,OAAM,KACPgC,EAAUvvB,SAASmpB,IAAYA,EAAE6E,MAAMa,QAAQ1F,EAAEoE,aAErD5sB,EAAKutB,iBAAgB,KACjBqB,EAAUvvB,SAASmpB,IAAYA,EAAE6E,MAAMa,QAAQ1F,EAAE+E,mCCtBzBH,EAAO7e,GACnC,MAAMvO,EAAOtB,KACbsB,EAAK+uB,MAAK,KACNxgB,EAAOrK,cAAc/C,IAAIisB,EAAMlpB,gBAEnClE,EAAKgvB,KAAI,OACThvB,EAAK2hB,OAAM,OACX3hB,EAAK4sB,OAAM,OACX5sB,EAAKutB,iBAAgB,mBCKMhf,EAAQ6e,EAAO1R,EAAMzb,EAASgvB,EAAaC,GACtE,MAAMlvB,EAAOtB,KAEbywB,GAAQ1B,KAAKztB,EAAMotB,EAAO7e,GAE1B,MAAM6gB,EAAY,IAAIC,GAEhBC,EAAmB,IAAIC,GAE7BvvB,EAAKwvB,gBAAmB5B,IACpB0B,EAAiBvB,aAAa,IAAI0B,GAAa7B,EAAWR,KAG9DptB,EAAK0vB,kBAAqBvC,IACtBiC,EAAUP,cAAc,IAAIc,GAAexC,EAAaC,EAAO7e,KAGnE,MAAMqhB,EAAa5vB,EAAK+uB,MACxB/uB,EAAK+uB,MAAK,KACNa,IACAV,EAAUW,QAGd7vB,EAAKgvB,KAAI,KACLE,EAAUY,QAGd9vB,EAAK2hB,OAAM,KACH1hB,EAAQO,cAEZP,EAAQS,QACRuuB,EAAYc,cAAcX,EAAWE,GACrCF,EAAUzN,OAAO2N,GACjB/gB,EAAO7N,QACPV,EAAK4sB,WAGT5sB,EAAK4sB,OAAM,KACPwC,EAAUxC,UAEd5sB,EAAKutB,iBAAgB,KAEjB6B,EAAU7B,mBACV+B,EAAiB/B,gCCvD4ByC,GACjD,MAEMC,WAuBMD,GAEZ,MAAME,EAAkBF,EAAuB1V,KAAK6V,GAAOA,EAAG5nB,GAAK,IAE7D6nB,EAAqBF,EAAgBzV,QAAM,CAAEC,EAAGta,IAAMsa,EAAIta,IAG1DiwB,EAAMH,EAAgB5V,KAAKI,GAAMA,EAAI0V,IAMrCH,EAAM,GAOZ,OANAI,EAAI5V,QAAM,CAAEC,EAAGta,EAAG8E,KACd,MAAM4H,EAAI4N,EAAIta,EAEd,OADA6vB,EAAI/qB,GAAK4H,EACFA,IACR,GAEImjB,EA3CKK,CAAON,GAFNtxB,KAGR6xB,YAAc,WACf,gBAIcP,EAAwBC,GAE1C,MAAMO,WAOkBP,GAGxB,MAAMQ,EAAUntB,KAAKsC,SAErB,OAD2BqqB,EAAIS,WAAWpkB,GAAMA,GAAKmkB,IAXvCE,CAAmBV,GAC3BE,EAAKH,EAAuBQ,GAGlC,gBAkCwBI,EAAGC,EAAGC,GAE9B,MAAMvoB,EAAIuoB,EAAIxtB,KAAKgL,KAAKhL,KAAKsC,UACvBkR,EAAwB,EAAhBxT,KAAKsC,SAAetC,KAAKqJ,GAIjCL,EAAIskB,EAAIroB,EAAIjF,KAAKuT,IAAIC,GACrBvK,EAAIskB,EAAItoB,EAAIjF,KAAK6T,IAAIL,GAC3B,MAAO,GAAExK,IAAGC,GA5CEwkB,CAAmBZ,EAAG7jB,EAAG6jB,EAAG5jB,EAAG4jB,EAAG5nB,GATrCyoB,CAAahB,EAAwBC,kBCFhD,MAAMjwB,EAAOtB,KAEPuyB,EAAY,GAElBjxB,EAAK+tB,aAAe,SAAUmD,GAC1BD,EAAUhyB,KAAKiyB,IAInBlxB,EAAKmxB,6BAA4B,IACnBF,EAAU3d,QAAQ4d,GAAaA,EAASE,MAAMlD,SAK5DluB,EAAKqxB,0BAAyB,IACNrxB,EAAKmxB,+BACN7W,KAAK4W,GAAaA,EAASE,QAGlDpxB,EAAKsxB,aAAY,KACb,MAAMC,EAASvxB,EAAKqxB,4BACpBrxB,EAAKwxB,QAAU,IAAIC,GAA6BF,IAEpDvxB,EAAK4sB,OAAM,KACQ5sB,EAAKqxB,4BACbhyB,SAAS+xB,GAAUA,EAAMxE,YAEpC5sB,EAAKutB,iBAAgB,KACFvtB,EAAKqxB,4BACbhyB,SAAS+xB,GAAUA,EAAM7D,kCC9BS6D,EAAOhE,GACpD,MAAMptB,EAAOtB,KACbsB,EAAKoxB,MAAQA,EAEbhE,EAAMS,gBAAgBuD,EAAOA,EAAMlE,QAEnCltB,EAAKutB,iBAAgB,KACjBvtB,EAAKoxB,MAAM7D,gCCNuBJ,EAAaC,EAAO7e,GAC1D,MAAMvO,EAAOtB,KACb8uB,GAASC,KAAKztB,EAAMmtB,EAAaC,GAGjCptB,EAAK4sB,OAAS,WACV,MAAO5qB,IAACA,GAAQuM,EAEhBvM,EAAIiL,YAEJ,MAAOX,EAACA,EAACC,EAAEA,EAAChE,EAAEA,GAAMvI,EAAKqtB,MACzBrrB,EAAI2V,IAAIrL,EAAGC,EAAGhE,EAAG,EAAG,EAAIjF,KAAKqJ,IAE7B3K,EAAI4V,sBCLsBrJ,EAAQ6e,EAAO1R,EAAMzb,EAASyxB,EAAiBC,GAC7E,MAAM3xB,EAAOtB,KAEbywB,GAAQ1B,KAAKztB,EAAMotB,EAAO7e,GAE1B,MAAM+gB,EAAmB,IAAIsC,GAE7B5xB,EAAK6xB,4BAA+BT,IAChC9B,EAAiBvB,aAAa,IAAI+D,GAAyBV,EAAOhE,KAGtE,MAAM2E,EAAe,IAAI1C,GAEzBrvB,EAAK0vB,kBAAqBvC,IACtB4E,EAAalD,cAAc,IAAImD,GAAkB7E,EAAaC,EAAO7e,KAGzE,MAAMqhB,EAAa5vB,EAAK+uB,MACxB/uB,EAAK+uB,MAAK,KACNa,IACA+B,EAAY9B,QAGhB7vB,EAAKgvB,KAAI,KACL2C,EAAY7B,QAGhB9vB,EAAK2hB,OAAM,KACP,GAAI1hB,EAAQO,YAAa,CACJkxB,EAAgBO,OAAOF,EAAczC,KAElDrvB,EAAQS,QAER6N,EAAO7N,QACPV,EAAK4sB,eAIT3sB,EAAQS,QACR4uB,EAAiBgC,eACjBI,EAAgBQ,WAChB3jB,EAAO7N,QACPV,EAAK4sB,UAIb5sB,EAAK4sB,OAAM,KACP8E,EAAgB9E,SAChBmF,EAAanF,SACb0C,EAAiB1C,UAErB5sB,EAAKutB,iBAAgB,KACjBwE,EAAaxE,mBACb+B,EAAiB/B,gCC7DaJ,EAAaC,EAAO7e,GACtD,MAAMvO,EAAOtB,KACb8uB,GAASC,KAAKztB,EAAMmtB,EAAaC,GAGjCptB,EAAK4sB,OAAS,WACV,MAAO5qB,IAACA,GAAQuM,EAEhBvM,EAAIiL,YAEJjL,EAAI2V,IAAI3X,EAAKsM,EAAGtM,EAAKuM,EAAGvM,EAAKuI,EAAG,EAAG,EAAIjF,KAAKqJ,IAE5C3K,EAAI4V,UAER5X,EAAKmyB,SAAW,SAAUC,EAAMC,GAC5B,MAAOrwB,IAACA,GAAQuM,EAEhBvM,EAAIiL,YAEJjL,EAAI2V,IAAIya,EAAMC,EAAMryB,EAAKuI,EAAG,EAAG,EAAIjF,KAAKqJ,IAExC3K,EAAI4V,UAER5X,EAAKsyB,eAAiB,SAAUF,EAAMC,GAClC,MAAOrwB,IAACA,GAAQuM,EAEhBvM,EAAIiL,YACJjL,EAAIiF,UAAY,OAChBjF,EAAI2V,IAAIya,EAAMC,EAAM,EAAG,EAAG,EAAI/uB,KAAKqJ,IACnC3K,EAAI6V,QCGJ,MAAE0a,GAAA,IAAAjvB,KAAAgL,KAAA,GAAA,GACNkkB,IAAA,EAAAlvB,KAAAgL,KAAA,IAAA,EAAOmkB,GAAA,EAAA,EACRC,IAAApvB,KAAAgL,KAAA,GAAA,GAAA,EAAGqkB,IAAA,EAAArvB,KAAAgL,KAAA,IAAA,GAAGskB,GAAA,IAAAC,aAAA,CAEP,EAAG,EAAI,GACN,EAAE,EAAG,EACN,GAAG,EAAI,GAAG,GAEZ,EAAgC,EAAG,EAAG,EAAG,GAAI,EAAE,EAAG,EAAG,EAAI,GAAI,GAAE,EAAI,GAAI,EAAE,EAAG,EAAI,EAC9E,GAAG,EAAI,EAAG,EAAG,GAAG,EAAI,GAAG,GAAK,IAAQC,GAAA,IAAAD,aAAA,CAAE,EAAG,EAAG,EAAI,EAAI,EACpD,EAAG,GAAI,EAAE,EAAG,GAAI,EAAE,EAAG,EAAI,GAAI,GAAE,EAAI,GAAI,EAAE,EAAG,EAAI,GAChD,EAAI,GAAI,EAAE,GAAG,GAAK,EAAE,EAAG,GAAI,GAAK,GAAE,EAAI,EAAG,EAAI,EAAG,EAAI,EACpD,EAAG,GAAI,EAAE,EAAG,GAAI,EAAE,EAAG,EAAI,GAAG,GAAK,GAAG,EAAE,EAAG,EAAI,GAAG,EAChD,EAAI,GAAI,GAAG,EAAE,GAAK,EAAE,GAAG,EAAI,GAAI,GAAK,EAAE,EAAG,EAAI,EAAI,EAAG,EACpD,EAAG,GAAI,EAAE,GAAI,EAAE,EAAG,EAAI,GAAI,EAAE,GAAK,GAAG,EAAE,EAAG,EAAI,GAAK,EAClD,EAAI,GAAI,GAAG,GAAE,EAAI,EAAG,GAAK,GAAE,EAAI,GAAK,EAAE,EAAG,EAAI,EAAI,EAAI,EAAE,KAYvD,sBAeC,EAED,4DA6BUE,EAAAzvB,KAAAsC,cACJA,EAAI,mBAAAmtB,EAAAA,2bAAAC,CAAAD,GACPr0B,KAAiDgc,EAqXtD,SAAC9U,8IArXqDqtB,CAAArtB,GAClDlH,KAAkEw0B,KAAA,IAAAC,WAAA,KAClEz0B,KAAoE00B,UAAA,IAAAD,WAAA,KACpE,IAAoB,IAAAjuB,EAAA,EAAAA,EAAA,IAAAA,IACpBxG,KAAQw0B,KAAKhuB,GAAKxG,KAAGgc,EAAA,IAAAxV,GACrBxG,KAAQ00B,UAAUluB,GAAGxG,KAAAw0B,KAAAhuB,GAAA,GAQrBmuB,QAAM/mB,EAAKC,SACT6mB,EAAY10B,KAAA00B,UACVF,EAAMx0B,KAAAw0B,SACRI,EAAK,EACN9G,EAAA,EACG+G,EAAK,QAEPC,GAAMlnB,EAAGC,GAAGgmB,GACVrtB,EAAI5B,KAAEqC,MAAA2G,EAAAknB,GACNnQ,EAAG/f,KAAKqC,MAAM4G,EAAAinB,GACjBrnB,GAAAjH,EAAAme,GAAAmP,GAGC/b,EAAMnK,GAFCpH,EAAMiH,GAGXuK,EAAInK,GAFG8W,EAAXlX,GAKA,IAAmEkG,EAAAohB,EACHhd,EAAAC,GAChErE,EAAW,EACZohB,EAAA,IAUCphB,EAAM,EACNohB,EAAM,GAKN,MAAMhe,EAAIgB,EAAKpE,EAAMmgB,GACf9c,EAAIgB,EAAK+c,EAAMjB,GACfjc,EAAKE,EAAK,EAAI,EAAI+b,GAClBpc,EAAKM,EAAK,EAAiD,EAAA8b,GAE3DkB,EAAS,IAAJxuB,EACLyuB,EAAS,IAAJtQ,EAEX,IAAA7D,EAAQ,GAAO/I,EAAEA,EAAAC,EAAAA,EACjB,GAA0E8I,GAAA,EAAA,CACrC,MAAAoU,EAAA,EAAAR,EAAAM,EAAAR,EAAAS,IACjCnU,GAAMA,EACN8T,EAAI9T,EAAMA,GAA0DoT,GAAAgB,GAAAnd,EAAAmc,GAAAgB,EAAA,GAAAld,OAEtE6I,EAAI,GAAM9J,EAAVA,EAAAC,EAAAA,QACI,EAAG,OACHme,EAAI,EAAAT,EAAAM,EAAArhB,EAAA6gB,EAAAS,EAAAF,OACJlU,IACFA,EAAMA,GAAAqT,GAAAiB,GAAApe,EAAAmd,GAAAiB,EAAA,GAAAne,SAEN,GAAMa,EAAAA,EAAAH,EAAAA,KACPmR,GAAA,EACI,OACDuM,EAAI,EAAAV,EAAAM,EAAA,EAAAR,EAAAS,EAAA,OACJpM,IACFA,EAAMA,GAAAqL,GAAAkB,GAAAvd,EAAAqc,GAAAkB,EAAA,GAAA1d,UAIP,IACIkd,EAAA9G,EAAA+G,GAQNQ,QACIznB,EAAAC,EAAAynB,SACHZ,EAAA10B,KAAA00B,YACO10B,KAACw0B,WACN1G,EAAE+G,EAAIU,UArKP,mBAuKG3nB,EAAIC,EAAAynB,KACJ1wB,KAAIqC,MAAA2G,EAAAknB,KACJlwB,KAAIqC,MAAA4G,EAAAinB,GACP7e,EAAArR,KACQqC,MAAKquB,EAATR,MACDtuB,EAAIme,EAAA1O,GAAA8d,KAIJnmB,GAHApH,EAAIiH,KAIJI,GAHA8W,EAAIlX,GAIP+nB,EACIF,GAJDrf,EAAIxI,SAONsnB,EAAEU,IACFC,EAAEC,KACA3d,EACFA,GAAMwd,GACQ7hB,EAAA,EACjBohB,EAAA,EACsEU,EAAA,EACI9R,EAAA,EACE+R,EAAA,EAClEC,EAAA,GACE5d,GAAQyd,GACb7hB,EAAK,EACLohB,EAAK,EACLU,EAAK,EACL9R,EAAK,EACL+R,EAAK,EACLC,EAAK,IAELhiB,EAAK,EACsDohB,EAAA,EAC3DU,EAAI,EACJ9R,EAAI,EACJ+R,EAAI,EACuCC,EAAA,GAG9C3d,EAAAwd,GACH7hB,EAAS,EACPohB,EAAM,EACNU,EAAK,EACR9R,EAAA,EACK+R,EAAM,EACNC,EAAM,GACP5d,EAAAyd,GACH7hB,EAAS,EACPohB,EAAM,EACNU,EAAK,EACR9R,EAAA,EACK+R,EAAM,EACNC,EAAM,IAEVhiB,EAAS,EACPohB,EAAM,EACNU,EAAK,EACR9R,EAAA,EACK+R,EAAM,EACNC,EAAM,GAOZ,MAAkD5e,EAAAgB,EAAApE,EAAAogB,GAClD/c,EAAWgB,EAAM+c,EAAKhB,GACvB6B,EAAAJ,EAAAC,EAAA1B,GAQElc,EAAAE,EAAA4L,EAAA,kBAEKjM,EAAIM,EAAG0d,EAAK,kBAEZG,EAAIL,EAAMG,EAAI,kBACwDjd,EAAAX,EAAA,EAAA,GACtEY,EAAKX,EAAK,EAAI,GACd8d,EAAIN,EAAK,EAAK,GAEdR,EAAS,IAALxuB,EACJyuB,EAAS,IAALtQ,EACJoR,EAAS,IAAJ9f,EAEX,IAAA6K,EAAQ,GAAO/I,EAACA,EAAAC,EAAAA,EAAAwd,EAAAA,EAChB,GAAA1U,EAAQ,EAAI8T,EAAI,MAChB,CACA,MAAQM,EAAwD,EAAjDR,EAAiDM,EAAAR,EAAAS,EAAAT,EAAAuB,KAChEjV,GAAQA,EACR8T,EAAQ9T,EAAIA,GAAKoT,GAAAgB,GAAAnd,EAAAmc,GAAAgB,EAAA,GAAAld,EAAAkc,GAAAgB,EAAA,GAAAM,GAEjB,IAA2E3U,EAAA,GAAA9J,EAAAA,EAAAC,EAAAA,EAAA4e,EAAAA,EAC3E,GAAsE/U,EAAA,EAAAiN,EAAA,MACb,CACY,MAAAqH,EAAA,EAAAT,EAAAM,EAAArhB,EAAA6gB,EAAAS,EAAAF,EAAAP,EAAAuB,EAAAN,KACI5U,GAAAA,EACrEiN,EAAKjN,EAAIA,GAAAqT,GAAAiB,GAAApe,EAAAmd,GAAAiB,EAAA,GAAAne,EAAAkd,GAAAiB,EAAA,GAAAS,GAEb,IAAI/M,EAAK,GAAIhR,EAAAA,EAAAH,EAAAA,EAAAme,EAAAA,EACb,GAAIhN,EAAK,EAAGgM,EAAC,MACT,OACMO,EAAA,EAAAV,EAAAM,EAAArR,EAAA6Q,EAAAS,EAAAS,EAAAlB,EAAAuB,EAAAJ,KACN9M,GAAKA,IACJA,EAAKA,GAAAqL,GAAAkB,GAAAvd,EAAAqc,GAAAkB,EAAA,GAAA1d,EAAAwc,GAAAkB,EAAA,GAAAS,SAEL,GAAKnd,EAAAA,EAAAC,EAAAA,EAAAmd,EAAAA,EACV,GAAIhN,EAAK,EAAEyM,EAAE,MACR,CACD,MAAKS,EAAS,EAALtB,EAAKM,EAAA,EAAAR,EAAAS,EAAA,EAAAT,EAAAuB,EAAA,QACRjN,EACNyM,EAAKzM,EAAIA,GAAKoL,GAAA8B,GAAAtd,EAAAwb,GAAA8B,EAAA,GAAArd,EAAAub,GAAA8B,EAAA,GAAAF,GAIlB,OAA8E,IAAAlB,EAAA9G,EAAA+G,EAAAU,GAS9EU,QAAQroB,EAAGC,EAAAynB,EAAKzyB,GAChB,MAAM2xB,EAAKx0B,KAAKw0B,KAChB,IAAmDI,EAAA9G,EAAA+G,EAAAU,EAAAW,EAEnD,MAAMpB,GAAKlnB,EAAAC,EAAKynB,EAAKzyB,GAAOmxB,GACtBxtB,EAAE5B,KAAGqC,MAAU2G,EAAIknB,GACnBnQ,EAAE/f,KAAGqC,MAAU4G,EAAIinB,GAE2B7e,EAAArR,KAAAqC,MAAAquB,EAAAR,GAC9C/G,EAAEnpB,KAAGqC,MAAUpE,EAAIiyB,GACnBrnB,GAAKjH,EAAAme,EAAK1O,EAAK8X,GAAOkG,GAKtBlc,EAAKnK,GAJApH,EAAAiH,GAKLuK,EAAKnK,GAJA8W,EAAAlX,GAKL+nB,EAAKF,GAJoErf,EAAAxI,GAKzE0oB,EAAKtzB,GAJAkrB,EAAEtgB,GAUb,IAAA2oB,EAAW,EACXC,EAAW,EACXC,EAAW,EACXC,EAAW,EACXxe,EAAQC,EAAKoe,IACbC,IACmEte,EAAAyd,EAAAY,IACnEE,IACAve,EAAQoe,EAAIC,IACZG,IACAve,EAAQwd,EAAIa,IACuCC,IAC/Cte,EAAKme,EAAGE,IACRE,MACCJ,EAAAG,IACHC,UASE5iB,EAAKyiB,GAAS,EAAA,EAAA,EACjBrB,EAAAsB,GAAA,EAAA,EAAA,EACKZ,EAAGa,GAAW,EAAE,EAAK,EACrBE,EAAID,GAAU,EAAA,EAAA,EAElB5S,EAAMyS,GAAW,EAAG,EAAK,EACvBV,EAAIW,GAAE,EAAA,EAAA,EACNV,EAAKW,GAAS,EAAA,EAAA,EACjBG,EAAAF,GAAA,EAAA,EAAA,EAEK1S,EAAIuS,GAAU,EAAA,EAAA,EACfM,EAAAL,GAAA,EAAA,EAAA,EACHM,EAAML,GAAW,EAAG,EAAK,EACvBM,EAAIL,GAAE,EAAA,EAAA,EAETxf,EAAAgB,EAAApE,EAAAsgB,GACKjd,EAAGgB,EAAM+c,EAAKd,GACd2B,EAAIJ,EAAIC,EAAMxB,GACf4C,EAAAV,EAAAK,EAAAvC,GACHpc,EAAME,EAAO4L,EAAK,EAAEsQ,GAClBvc,EAAIM,EAAE0d,EAAA,EAAAzB,GACN4B,EAAKL,EAAKG,EAAI,EAAA1B,GACjB6C,EAAAX,EAAAM,EAAA,EAAAxC,GACuDvb,EAAAX,EAAA8L,EAAA,EAAAoQ,GACxDtb,EAAWX,EAAM0e,EAAK,EAAKzC,GAC5B6B,EAAAN,EAAAmB,EAAA,EAAA1C,cAEH8C,EAAAhf,EAAA,EAAA,EAAAkc,GAQgB+C,EAAAhf,EAAA,EAAA,EAAAic,GACJgD,EAAIzB,EAAA,EAAU,EAAIvB,GAClBiD,EAAMf,EAAI,EAAK,EACvBlC,GAGMe,EAAK,IAADxuB,EACJyuB,EAAQ,IAALtQ,EACNoR,GAAO,IAAA9f,EACPkhB,GAAO,IAAApJ,EAEZ,IAAQjN,GAAA,GAAA/I,EAAAA,EAAAC,EAAAA,EAAAwd,EAAAA,EAAAW,EAAAA,EACT,GAAArV,GAAA,EAAA8T,EAAA,MAMC,CAEM,MAAIM,EAAAV,EAAAQ,EAAAR,EAAAS,EAAAT,EAAAuB,GAAAvB,EAAA2C,OAAA,GAAA,EACJrW,IAAIA,GACJ8T,EAAI9T,GAAAA,IAAAsT,GAAAc,GAAAnd,EAAAqc,GAAAc,EAAA,GAAAld,EAAAoc,GAAAc,EAAA,GAAAM,EAAApB,GAAAc,EAAA,GAAAiB,GAGV,IAAMtV,GAAO,GAAA9J,EAAAA,EAAAC,EAAAA,EAAA4e,EAAMA,EAAAiB,EAAAA,EACjB,GAAGhW,GAAQ,EAAAiN,EAAA,MACJ,CACJ,MAAQqH,EAAAX,EAAAQ,EAAArhB,EAAA6gB,EAAAS,EAAAF,EAAAP,EAAAuB,GAAAN,EAAAjB,EAAA2C,GAAAX,MAAA,GAAA,EAEP3V,IAAKA,GACLiN,EACJjN,GAAMA,IAACuT,GAAAe,GAAApe,EAAAqd,GAAAe,EAAA,GAAAne,EAAAod,GAAAe,EAAA,GAAAS,EAAAxB,GAAAe,EAAA,GAAA0B,GAGL,IAAEhO,GACJ,GAAOhR,EAAAA,EAAAH,EAAAA,EAAAme,EAAAA,EAAAiB,EAAAA,EAEP,GAAIjO,GAAK,EAAIgM,EAAA,MACN,CAIF,MAAAO,EAAPZ,EAAAQ,EAAArR,EAAA6Q,EAAAS,EAAAS,EAAAlB,EAAAuB,GAAAJ,EAAAnB,EAAA2C,GAAAV,MAAA,GAAA,EACE5N,IAAUA,GACRgM,EAAKhM,GAAAA,IAAAuL,GAAAgB,GAAAvd,EAAAuc,GAAAgB,EAAA,GAAA1d,EAAA0c,GAAAgB,EAAA,GAAAS,EAAAzB,GAAAgB,EAAA,GAAA0B,GAEP,IAAAhO,GAAS,GAAIpQ,EAAKA,EAAOC,EAACA,EAAAmd,EAAAA,EAAAsB,EAAAA,EAC3B,GAAAtO,GAAA,EAAAyM,EAAA,MACF,CAEQ,MAAAS,EAAAxB,EAAAQ,EAAAnR,EAAM2Q,EAAfS,EAAAyB,EAAAlC,EAAAuB,GAAAY,EAAAnC,EAAA2C,GAAAP,MAAA,GAAA,EACU9N,IAAAA,GACDyM,EAAAzM,GAASA,IAAhBsL,GAAA4B,GAAAtd,EAAA0b,GAAA4B,EAAA,GAAArd,EAAAyb,GAAA4B,EAAA,GAAAF,EAAA1B,GAAA4B,EAAA,GAAAoB,GAEE,IAAKC,GAAK,GAAMN,EAAIA,EAAKC,EAAMA,EAAGC,EAAlCA,EAAAC,EAAAA,KACEG,GAAK,EAAAnB,EAAK,MACV,CACA,MAAKoB,EAAM9C,EAAAQ,EAAA,EAAAR,EAAAS,EAAA,EAAAT,EAAAuB,GAAA,EAAAvB,EAAA2C,GAAA,MAAA,GAAA,EACXE,IAAMA,GACNnB,EAAKmB,GAACA,IAAAjD,GAAAkD,GAAAP,EAAA3C,GAAAkD,EAAA,GAAAN,EAAA5C,GAAAkD,EAAA,GAAAL,EAAA7C,GAAAkD,EAAA,GAAAJ,UAGL,IAAQtC,EAAA9G,EAAW+G,EAASU,EAAAW,gBC1dFqB,EAAIC,GACjC,MAAMl2B,EAAOtB,KAEbsB,EAAKm2B,GAAK,GASVn2B,EAAKo2B,SAAQ,KACTp2B,EAAKm2B,YAYgBF,EAAIC,EAAIG,EAAYC,EAAaC,EAAMC,GAChE,MAAMC,EAAW,IAAIC,GAAa,KAC5BC,EAAW,IAAID,GAAa,QAC5Bpc,WA8BK2b,EAAIC,GAEf,OADcxhB,MAAMuhB,GAAIpe,OAAOyC,KAAG,IAAO5F,MAAMwhB,GAAIre,OAAOyC,KAAG,IAAO5F,MAAM,GAAGmD,KAAK,OA/BtE+e,CAAMX,EAAIC,GACtB,IAAIW,EAAO,EACPC,EAAO,EACXC,GAAMd,GAAI52B,SAAS23B,IACfD,GAAMb,GAAI72B,SAAS43B,IAEf,MAAM3qB,EAAK0qB,EAAKf,GAAO,EAAII,GACrB9pB,EAAK0qB,EAAKf,GAAO,EAAII,GACrBY,EAAST,EAASpD,QAAQ/mB,EAAGC,GAC7B4qB,EAASR,EAAStD,QAAQ/mB,EAAGC,GACnC+N,EAAI0c,GAAIC,GAAI,GAAMC,EAAS,GAC3B5c,EAAI0c,GAAIC,GAAI,GAAME,EAAS,GAC3BN,GAAQK,EACRJ,GAAQK,QAIhB,MAAMC,EAAQP,GAAQZ,EAAKC,GAAM,GAC3BmB,EAAQP,GAAQb,EAAKC,GAAM,GASjC,OARA5b,EAAIjb,SAASyN,IACTA,EAAEzN,SAASqb,IAEPA,EAAE,IAAMA,EAAE,GAAK0c,GAASb,EAExB7b,EAAE,IAAMA,EAAE,GAAK2c,GAASb,QAGzBlc,EA1COgd,CAAarB,EAAIC,EATZ,GACC,GAGP,IACA,eAsDRa,GAAMz2B,GACX,MAAO,IAAIoU,MAAMpU,GAAG6E,oBCrEW8wB,EAAIC,EAAI3nB,GACvC,MAAMvO,EAAOtB,KAUDkD,EAAUC,SAAAC,cAAe,UACrCF,EAAMF,MAASu0B,EAEfr0B,EAAKD,OAAUu0B,QACXqB,EAAO31B,EAAKK,WAAK,MAEjBu1B,EAAcD,EAAQE,gBACRxB,EAAIC,UACLC,UACLjlB,KAAUA,GAAUsmB,MACpB,IAAIlrB,EAAG,EAAIA,EAAG2pB,EAAE3pB,IAAK,IAAI,IAAKC,EAAG,EAAGA,EAAA2pB,EAAA3pB,IAAA,CACpC,MAAMhE,EAAI4tB,EAAC7pB,GAAKC,GAAA,GAAQ,GAClB/D,EAAI2tB,EAAC7pB,GAAKC,GAAA,GAAQ,GACxB2E,EAAoB,GAAd5E,EAAIC,EAAI0pB,GAAU,GAAQ,IAAH1tB,EAChC2I,EAAA,GAAA5E,EAAAC,EAAA0pB,GAAA,GAAA,KAAA1tB,EAAAC,GAGL0I,EAAoB,GAAb5E,EAAAC,EAAA0pB,GAAa,GAAe,IAAHztB,EACnC0I,EAAA,GAAA5E,EAAAC,EAAA0pB,GAAA,GAAA,IAGGsB,EAAOG,aAAMF,EAAI,EAAS,iBAIPG,UACXzmB,KAAUA,GAAQsmB,MAClB,IAAIlrB,EAAG,EAAIA,EAAG2pB,EAAE3pB,IAAK,IAAI,IAAKC,EAAA,EAAAA,EAAA2pB,EAAA3pB,IAAA,CAC9B,MAAMtE,EAAQ0vB,EAAOrrB,GAAGC,IACjBhE,EAAGC,EAACC,GAAKR,EAChBiJ,EAAoB,GAAd5E,EAAIC,EAAI0pB,GAAU,GAAK1tB,EAChC2I,EAAA,GAAA5E,EAAAC,EAAA0pB,GAAA,GAAAztB,EAGL0I,EAAoB,GAAb5E,EAAAC,EAAA0pB,GAAa,GAAYxtB,EACnCyI,EAAA,GAAA5E,EAAAC,EAAA0pB,GAAA,GAAA,IAGGsB,EAAOG,aAAMF,EAAU,EAAA,MAEvB5K,OAAK,CAAAgL,EAAAC,KACL,MAAKx1B,KAASA,GAAUkM,EACxBlM,EAAKuJ,OACRvJ,EAAAy1B,uBAAA,EACoBz1B,EAAA01B,UAAAn2B,EAAA,EAAA,EAAAg2B,EAAAC,GACiCx1B,EAAA0J,uBCjElC+c,OACtB,IAEIhc,EAFA5H,GAAI,EACJ5E,EAAIwoB,EAAQroB,OAEZgI,EAAIqgB,EAAQxoB,EAAI,GAChB4U,EAAO,IAEFhQ,EAAI5E,GACXwM,EAAIrE,EACJA,EAAIqgB,EAAQ5jB,GACZgQ,GAAQpI,EAAE,GAAKrE,EAAE,GAAKqE,EAAE,GAAKrE,EAAE,GAGjC,OAAOyM,EAAO,cCbQ4T,OACtB,IAIIhc,EAEA1M,EANA8E,GAAI,EACJ5E,EAAIwoB,EAAQroB,OACZ6L,EAAI,EACJC,EAAI,EAEJ9D,EAAIqgB,EAAQxoB,EAAI,GAEhBqU,EAAI,IAECzP,EAAI5E,GACXwM,EAAIrE,EACJA,EAAIqgB,EAAQ5jB,GACZyP,GAAKvU,EAAI0M,EAAE,GAAKrE,EAAE,GAAKA,EAAE,GAAKqE,EAAE,GAChCR,IAAMQ,EAAE,GAAKrE,EAAE,IAAMrI,EACrBmM,IAAMO,EAAE,GAAKrE,EAAE,IAAMrI,EAGvB,MAAe,CAACkM,GAATqI,GAAK,GAAWpI,EAAIoI,eCHQpT,EAAGC,EAAGlB,EAAG03B,GAC1C,IAEIhL,EACAiL,EAHAC,WAcc32B,EAAGC,EAAGlB,GACxB,OAAOoU,MAAMpU,GAAGuX,OAAOyC,KAAG,IAAO,CAAChX,KAAKsC,SAAWrE,EAAG+B,KAAKsC,SAAWpE,KAfrD22B,CAAa52B,EAAGC,EAAGlB,GAC/B83B,GAAY,EAGhB,MAAMC,EAAML,EAAc10B,KAAK+S,IAAI9U,EAAGC,GACtC,IAAK,IAAI0D,EAAI,EAAGA,EAAI,IAAMA,IAEtB,IADCgzB,EAAWE,EAAWpL,EAASiL,GAAYK,GAAMJ,EAAW32B,EAAGC,EAAG62B,GAC/DD,EAAW,OAAOF,EAE1B,MAAO,CAACA,EAAWlL,EAASiL,YASvBK,GAAM7X,EAAQlf,EAAGC,EAAG62B,GACzB,MACMrL,EADWpB,GAASZ,KAAKvK,GACNuM,QAAQ,CAAC,EAAG,EAAGzrB,EAAGC,IACrCy2B,GAuBK33B,EAvBYmgB,EAAOhgB,OAwBvB,IAAIiU,MAAMpU,GAAG6E,SAxBkBmV,KAAKpV,GAAM8nB,EAAQnE,YAAY3jB,SAuB1D5E,EAtBX,MAAM43B,EAAYD,EAAS3d,IAAIie,IACzBH,EAAY3X,EAAO+X,OAAK,CAAEC,EAAOvzB,KAAMwzB,OAiB9BpsB,EAjBwCmsB,EAiBrClsB,EAjB4C2rB,EAAUhzB,GAkBjEoH,GAAK,EAAIC,GAAK,EAlByD8rB,MAiB/D/rB,EAAGC,KAhBlB,MAAO,CAAC2rB,EAAWE,EAAWpL,EAASiL,YCnC3BU,GAAiBpf,EAAMjN,EAAGC,EAAGqsB,EAAUC,EAAI5wB,EAAOjG,EAAKyF,GACnEzF,EAAI4J,OACJ5J,EAAIyF,UAAYA,GAAa,SAC7BzF,EAAI+W,KAAI,GAAM6f,iBACd52B,EAAIqF,UAAYwxB,EAChB72B,EAAIiF,UAAYgB,EAChBjG,EAAI6X,SAASN,EAAMjN,EAAGC,GACtBvK,EAAI+J,sBCJ4BkhB,EAAM6L,GACtC,MAAMC,EAASC,GAAcF,GACvBx4B,EAAI2sB,EAAKxsB,OAASu4B,GAAc/L,GACtC6L,EAAUA,EAAQnS,QAClB,IAAK,IAA4Ble,EAAGrI,EAAG2M,EAA9B7H,EAAI,EAAG4H,EAAImgB,EAAK3sB,EAAI,GAAa4E,EAAI5E,IAAK4E,EAAG,CAClD,MAAM+zB,EAAQH,EAAQnS,QAChBuS,EAAID,EAAMx4B,OAASs4B,EACzBD,EAAQr4B,OAAS,EACjBgI,EAAIwkB,EAAK/nB,GACT9E,EAAI64B,EAAMC,EAAI,GACd,IAAK,IAAI7V,EAAI,EAAGA,EAAI6V,IAAK7V,EACrBtW,EAAIksB,EAAM5V,GACN8V,GAAWpsB,EAAGD,EAAGrE,IACZ0wB,GAAW/4B,EAAG0M,EAAGrE,IAClBqwB,EAAQ75B,KAAKm6B,GAAch5B,EAAG2M,EAAGD,EAAGrE,IAExCqwB,EAAQ75B,KAAK8N,IACNosB,GAAW/4B,EAAG0M,EAAGrE,IACxBqwB,EAAQ75B,KAAKm6B,GAAch5B,EAAG2M,EAAGD,EAAGrE,IAExCrI,EAAI2M,EAEJgsB,GAAQD,EAAQ75B,KAAK65B,EAAQ,IACjChsB,EAAIrE,EAER,OAAOqwB,EAAQr4B,OAASq4B,EAAU,cAE7BK,IAAYzT,EAAIC,IAAMzP,EAAIF,IAAMoI,EAAIC,IACzC,OAAQD,EAAKlI,IAAOyP,EAAK3P,IAAOqI,EAAKrI,IAAO0P,EAAKxP,YAE5CkjB,IAAeljB,EAAIF,IAAMoI,EAAIC,IAAMzR,EAAI8L,IAAMrD,EAAIC,IACtD,MAAM+jB,EAAMjb,EAAKlI,EAAUojB,EAAMjb,EAAKrI,EAAUujB,EAAMlkB,EAAKzI,EACvD4sB,EAAMlkB,EAAKoD,EACT/D,GAAK0kB,GAAO3gB,EAAK1C,GAAMsjB,GAAO1sB,EAAKsJ,KAAQojB,EAAMC,EAAMF,EAAMG,GACnE,MAAO,CAAC5sB,EAAK+H,EAAI4kB,EAAK7gB,EAAK/D,EAAI6kB,YAE1BR,GAAcvY,GACnB,MAAOvK,EAAIF,GAAMyK,EAAO,IACnBrC,EAAIC,GAAMoC,EAAOA,EAAOhgB,OAAS,GACtC,OAAOyV,IAAOkI,GAAMpI,IAAOqI,WCrCfob,GAAMn5B,GAClB,MAAO,IAAIoU,MAAMpU,GAAG6E,iBCiCfu0B,GAAWptB,EAAGC,GAanB,MANgB,CACZ,CAACD,EAAGC,GACJ,CAACD,EAAGC,EAAI,GACR,CAACD,EAAI,EAAGC,EAAI,GACZ,CAACD,EAAI,EAAGC,gBC3CsBgC,GAClC,MAAMvO,EAAOtB,mHAaTsB,EAAK25B,KAAA,CAAA1D,EAAYC,EAAG0D,sDACpB55B,EAAKi2B,GAAAA,EAELj2B,EAAKk2B,GAAAA,EACRl2B,EAAA45B,GAAAA,EAME55B,EAAA65B,aAAA75B,EAAAi4B,SAAA3d,IAAAwf,IAAAxf,KAAAhO,IAAAA,IAGFtM,EAAA+5B,UAAA9D,EAAAC,EAEGl2B,EAACg6B,gBDxByBC,GAC9B,MAAOL,GACHA,EAAE3D,GAAEA,EAAEC,GAAEA,EAAE+B,SAAEA,GACZgC,EAEED,EAAStlB,MAAMklB,GAAI/hB,OAAOyC,KAAG,IAAO,KAE1C,IAAK,IAAI4f,EAAK,EAAGA,EAAKjE,EAAIiE,IACtB,IAAK,IAAIC,EAAK,EAAGA,EAAKjE,EAAIiE,IAAM,CAC5B,MAAMrB,EAAUY,GAAWQ,EAAIC,GAC/BV,GAAMG,GAAIv6B,SAAS+6B,QDRTttB,ECWN,MAAMutB,EAAUC,IDXVxtB,ECSOmrB,EAASmC,GDR3BG,KAAKC,MAAMD,KAAKE,UAAU3tB,KCSI4tB,UACS5B,GAIlB,OAAZuB,GACAL,EAAOI,GAAWn7B,KAAK,CAACi7B,EAAIC,EAAIL,GAAYO,QAM5D,OAAOL,ECAFW,CAA0C36B,IAiB3CA,EAAK46B,cAAI,CAAAC,EAAAC,KACT96B,EAAK+6B,qBAAqB,EAAG,EAAEF,EAAAC,EAAA,KAAAE,MAE/BC,oBAAmB,CAAA3uB,EAAAC,EAAAsuB,EAAAC,EAAAnD,KACnB33B,EAAK+6B,qBAAoBzuB,EAAAC,EAAAsuB,EAAAC,EAAAnD,OAAA1uB,MAUrB8xB,qBAAW,CAAAzuB,EAAAC,EAAAsuB,EAAAC,EAAAnD,EAAAuD,WACP74B,KAAAA,GAAYkM,+BACpBlM,EAACuJ,OACD,MAAKuvB,EAAON,EAAA5E,EACfmF,EAAAN,EAAA5E,IAEQrpB,UAAAP,EAAAC,GACLlK,EAAKmB,MAAE23B,EAAKC,GACZ,IAAA,IAAOl2B,EAAG,EAAKA,EAAA00B,EAAA10B,IACf7C,EAAM4K,YACiE5K,EAAAwE,YAAA,OACvExE,EAAMgF,UAAY,EAAA8zB,EAClBnO,EAAAhE,WAAA9jB,EAAA7C,GACH,OAAAs1B,IACJt1B,EAAA4E,UAAA0wB,EAAAzyB,kECxEiCqJ,EAAQ8sB,GACtC,MAAMr7B,EAAOtB,KAKb2wB,GAAa5B,KAAKztB,GAUlBA,EAAKi6B,cAAgB,IAAIqB,GAAc/sB,GAGvCvO,EAAKu7B,SAAW,IAAIC,GAPT,GACA,IAOXx7B,EAAKu7B,SAASnF,WAGdp2B,EAAKy7B,WAAa,IAAIC,GAXX,GACA,GAU8BntB,OAcrCotB,EAAK,GACR37B,EAAA47B,gBAAA,KACG57B,EAACi6B,cAAYN,KA3BN,GACA,GAJA,OAgCPkC,aAAK,KACLF,EAAK37B,EAAA8uB,oBACL9uB,EAAK87B,gBACR97B,EAAA+7B,yBAEG/7B,EAACg8B,yBAEDF,cAAK,cAIW3F,GAAOn2B,EAAMu7B,0BACNI,EAAOrhB,KAAG2hB,GAAM9F,EAAA7b,KAAK4hB,GAAAA,EAAA5hB,KAAA6hB,IAC5B,MAAOC,EAACC,GAAAF,GAAK7vB,EAAGA,EAAAC,EAAMA,EAAAhE,EAAAA,GAAA0zB,EAAA5O,YAAK,GAAY/gB,EAAC8vB,EAAE7vB,EAAAA,EAAA8vB,EAE5C9zB,EAAAA,MAERkT,SACTA,SAEIA,UAEDsgB,uBAAoB,KACpB,MAAK/B,OAAAA,GAAqBh6B,EAAGi6B,kBAGjB9D,GAAOn2B,EAAMu7B,iCACE9B,GA3DpB,IA2DuCnf,KAAA8f,GAAAuB,EAAArhB,KAAA2hB,GAAAjC,EAAAI,GAAA9f,KAAA9R,IAClC,MAAO0xB,EAACC,EAACmC,GAAG9zB,GACL4zB,EAACC,GAAAlG,EAAA+D,GAAAC,IACA7tB,EAAGA,EAAAC,EAAMA,EAAAhE,EAAAA,GAAA0zB,EAAA5O,YAAK,GAAY/gB,EAAC8vB,EAAE7vB,EAAGA,EAAE8vB,EACzC9zB,EAAAA,EACEyE,EAAAsvB,eAGlB7gB,YAIGugB,oBAAuB,cAIP7F,GAAOn2B,EAAMu7B,8BACJpF,EAAA7b,KAAG4hB,GAAQA,EAAQ5hB,KAAA6hB,GAAAR,EAAArhB,KAAA2hB,IAC5B,MAAOG,EAACC,GAAAF,GAAK7vB,EAAGA,EAAAC,EAAMA,EAAAhE,EAAAA,GAAA0zB,EAAA5O,YAAK,GAAY/gB,EAAC8vB,EAAE7vB,EAAAA,EAAA8vB,EAE5C9zB,EAAAA,kBAUlB,MAA2BsyB,EAAA,IAEvBC,EAAiB,IACI96B,EAAA4sB,OAAA,0BA4BCvtB,SAAWk9B,eACrB3T,IACJA,EAACvpB,SAAAwM,KAQI,SAAAS,EAAAC,GACb,MAAIvK,IAASA,GAASuM,EACtBvM,EAAIiL,YACJjL,EAAIiF,UAAI,OACXjF,EAAA2V,IAAArL,EAAAC,EAAA,EAAA,EAAA,EAAAjJ,KAAAqJ,IACJ3K,EAAA6V,OAZY2kB,CAAA3wB,EAAAS,EAAAT,EAAAU,YA7BLvM,EAAKy8B,mBACLz8B,EAAK08B,qBACR18B,EAAA28B,sBAC4B38B,EAAA48B,yBAGzBH,iBAAmB,KACtBz8B,EAAAy7B,WAAA7O,OAAAiO,EAAAC,GACuB96B,EAAAi6B,cAAAW,cAAAC,EAAAC,MAGpB4B,mBAAoB,KACvB,MAAAzB,oBAAAA,GAAAj7B,EAAAi6B,cACwBgB,EAAA,IAAA,EAAAJ,EAAAC,EAAAO,EAAAwB,iBAGrBF,oBAAuB,KAC1B,MAAA1B,oBAAAA,GAAAj7B,EAAAi6B,cACGgB,EAAoB,IAAA,EAAUJ,EAAAC,EAAAO,EAAAyB,yCAEjCnB,EAAAt8B,SAAAmpB,GAAAA,EAAAoE,wBCrH6Bre,EAAQ6e,EAAO1R,EAAMzb,EAASo7B,EAAanM,GACzE,MAAMlvB,EAAOtB,KAEbywB,GAAQ1B,KAAKztB,EAAMotB,EAAO7e,GAE1B,MAAMwuB,EAAY,IAAIC,GAAUzuB,EAAQ8sB,GAElC/L,EAAmB,IAAIC,GAE7BvvB,EAAKwvB,gBAAmB5B,IACpB0B,EAAiBvB,aAAa,IAAI0B,GAAa7B,EAAWR,KAG9DptB,EAAK0vB,kBAAqBvC,IACtB4P,EAAUlO,cAAc,IAAIoO,GAAc9P,EAAaC,EAAO7e,KAGlEtO,EAAQC,IAAI,CAAC,cAEb,MAAM0vB,EAAa5vB,EAAK+uB,MACxB/uB,EAAK+uB,MAAK,KACNa,IACArhB,EAAOxK,cACPmrB,EAAUW,QAGd7vB,EAAKgvB,KAAI,KACLzgB,EAAOtK,cACPirB,EAAUY,QAGd9vB,EAAK2hB,OAAM,KACH1hB,EAAQO,cAERP,EAAQI,MAAM,CAAC,YAAa,aAC5B08B,EAAUnB,kBAEd37B,EAAQS,QACRq8B,EAAUlB,eACVR,EAAY6B,YAAYH,EAAWzN,GACnC/gB,EAAO7N,QACPV,EAAK4sB,WAGT5sB,EAAK4sB,OAAM,KACPmQ,EAAUnQ,UAEd5sB,EAAKutB,iBAAgB,KACjB+B,EAAiB/B,mBACjBwP,EAAUxP,wBC7Dd4P,GACAC,SARAC,GAAUC,GAAiB,YAUtBC,KACL,MAAM,IAAI93B,MAAM,4CAEX+3B,KACL,MAAM,IAAI/3B,MAAM,8CAsBXg4B,GAAWC,GAChB,GAAIP,KAAqBrqB,WAErB,OAAOA,WAAW4qB,EAAK,GAG3B,IAAKP,KAAqBI,KAAqBJ,KAAqBrqB,WAEhE,OADAqqB,GAAmBrqB,WACZA,WAAW4qB,EAAK,GAE3B,IAEI,OAAOP,GAAiBO,EAAK,GAC/B,MAAMr5B,GACJ,IAEI,OAAO84B,GAAiB1P,KAAK,KAAMiQ,EAAK,GAC1C,MAAMr5B,GAEJ,OAAO84B,GAAiB1P,KAAK/uB,KAAMg/B,EAAK,iBAtChD,IAEQP,GADsB,mBAAfrqB,WACYA,WAEAyqB,GAEzB,MAAOl5B,GACL84B,GAAmBI,GAEvB,IAEQH,GADwB,mBAAjBO,aACcA,aAEAH,GAE3B,MAAOpT,GACLgT,GAAqBI,OAuD7B,IAEII,GAFAC,GAAQ,GACRC,IAAW,EAEXC,IAAa,WAERC,KACAF,IAAaF,KAGlBE,IAAW,EACPF,GAAan9B,OACbo9B,GAAQD,GAAaK,OAAOJ,IAE5BE,IAAa,EAEbF,GAAMp9B,QACNy9B,eAICA,KACL,IAAIJ,GAAJ,CAGA,IAAIK,EAAUV,GAAWO,IACzBF,IAAW,MAEX,IAAIzvB,EAAMwvB,GAAMp9B,OACV4N,GAAK,KACPuvB,GAAeC,GACfA,GAAQ,KACCE,GAAa1vB,GACduvB,IACAA,GAAaG,IAAYpiB,MAGjCoiB,IAAa,EACb1vB,EAAMwvB,GAAMp9B,OAEhBm9B,GAAe,KACfE,IAAW,WAnEUM,GACrB,GAAIhB,KAAuBO,aAEvB,OAAOA,aAAaS,GAGxB,IAAKhB,KAAuBI,KAAwBJ,KAAuBO,aAEvE,OADAP,GAAqBO,aACdA,aAAaS,GAExB,IAEWhB,GAAmBgB,GAC5B,MAAO/5B,GACL,IAEI,OAAO+4B,GAAmB3P,KAAK,KAAM2Q,GACvC,MAAO/5B,GAGL,OAAO+4B,GAAmB3P,KAAK/uB,KAAM0/B,KAgD7CC,CAAgBF,aAiBXG,GAAKZ,EAAK7R,GACfntB,KAAKg/B,IAAMA,EACXh/B,KAAKmtB,MAAQA,WAYR0S,MA5BTlB,GAAQmB,SAAW,SAAUd,GACzB,IAAIz4B,EAAO,IAAIyP,MAAM3L,UAAUtI,OAAS,GACxC,GAAIsI,UAAUtI,OAAS,EACnB,IAAK,IAAIyE,EAAI,EAAGA,EAAI6D,UAAUtI,OAAQyE,IAClCD,EAAKC,EAAI,GAAK6D,UAAU7D,GAGhC24B,GAAM5+B,KAAK,IAAIq/B,GAAKZ,EAAKz4B,IACJ,IAAjB44B,GAAMp9B,QAAiBq9B,IACvBL,GAAWS,KASnBI,GAAKx2B,UAAU6T,IAAM,WACjBjd,KAAKg/B,IAAI12B,MAAM,KAAMtI,KAAKmtB,QAE9BwR,GAAQoB,MAAQ,UAChBpB,GAAQqB,SAAU,EAClBrB,GAAQsB,IAAM,GACdtB,GAAQuB,KAAO,GACfvB,GAAQwB,QAAU,GAClBxB,GAAQyB,SAAW,GAInBzB,GAAQ0B,GAAKR,GACblB,GAAQ2B,YAAcT,GACtBlB,GAAQ4B,KAAOV,GACflB,GAAQ6B,IAAMX,GACdlB,GAAQ8B,eAAiBZ,GACzBlB,GAAQ+B,mBAAqBb,GAC7BlB,GAAQgC,KAAOd,GACflB,GAAQiC,gBAAkBf,GAC1BlB,GAAQkC,oBAAsBhB,GAE9BlB,GAAQmC,UAAY,SAAUlvB,GAAQ,MAAO,IAE7C+sB,GAAQoC,QAAU,SAAUnvB,GACxB,MAAM,IAAI7K,MAAM,qCAGpB43B,GAAQqC,IAAM,WAAc,MAAO,KACnCrC,GAAQsC,MAAQ,SAAUC,GACtB,MAAM,IAAIn6B,MAAM,mCAEpB43B,GAAQwC,MAAQ,WAAa,OAAO,OCgKvB/yB,GAlVLgzB,GAAyB,QACrB,CACJC,KAAC,SAAAC,GACJ,OAAAA,cAGO,CACJC,GAAC,SAAAD,GACE,OAAEA,EAAgBA,GAErBE,IAAC,SAAAF,GACD,OAAOA,GAAU,EAASA,UAItB,SAAWA,GACd,OAAAA,GAAA,GAAA,EAAA,GAAAA,EAAAA,GACJ,MAAAA,GAAAA,EAAA,GAAA,YAIGC,GAAC,SAAAD,GACE,OAAEA,EAAgBA,EAAGA,GAExBE,IAAC,SAAAF,GACD,QAAOA,EAAgBA,EAAGA,EAAA,SAItB,SAAUA,GACb,OAAAA,GAAA,GAAA,EAAA,GAAAA,EAAAA,EAAAA,EACJ,KAAAA,GAAA,GAAAA,EAAAA,EAAA,aAGO,CACJC,GAAC,SAAAD,GACE,OAAEA,EAAgBA,EAAGA,EAAAA,GAExBE,IAAC,SAAAF,GACD,OAAO,KAAUA,EAASA,EAAAA,EAAAA,SAItB,SAAWA,GACd,OAAAA,GAAA,GAAA,EAAA,GAAAA,EAAAA,EAAAA,EAAAA,GACJ,KAAAA,GAAA,GAAAA,EAAAA,EAAAA,EAAA,aAGO,CACJC,GAAC,SAAAD,GACE,OAAEA,EAAgBA,EAAGA,EAAAA,EAAAA,GAExBE,IAAC,SAAAF,GACD,QAAOA,EAAgBA,EAAGA,EAAAA,EAAAA,EAAA,SAItB,SAAUA,GACb,OAAAA,GAAA,GAAA,EAAA,GAAAA,EAAAA,EAAAA,EAAAA,EAAAA,EACJ,KAAAA,GAAA,GAAAA,EAAAA,EAAAA,EAAAA,EAAA,gBAGO,CACJC,GAAC,SAAAD,GACE,OAAE,EAAU18B,KAAMuT,IAAGmpB,EAAA18B,KAAAqJ,GAAA,IAExBuzB,IAAC,SAAAF,GACD,OAAO18B,KAAU6T,IAAA6oB,EAAS18B,KAAAqJ,GAAA,IAE1BwzB,MAAC,SAAAH,GACJ,MAAA,IAAA,EAAA18B,KAAAuT,IAAAvT,KAAAqJ,GAAAqzB,kBAGO,CACJC,GAAC,SAAAD,GACE,OAAoB,IAAlBA,EAAmB,EAAA18B,KAAA+c,IAAA,KAAA2f,EAAA,IAExBE,IAAC,SAAAF,GACD,OAAuB,IAAhBA,EAAmB,EAAA,EAAA18B,KAAA+c,IAAA,GAAA,GAAA2f,UAIpB,SAAQA,GAGV,OAAe,IAAbA,EACE,EAEW,IAAfA,EAAyB,GAC5BA,GAAA,GAAA,EAAA,GAAA18B,KAAA+c,IAAA,KAAA2f,EAAA,GACJ,IAAA,EAAA18B,KAAA+c,IAAA,GAAA,IAAA2f,EAAA,gBAGO,CACJC,GAAC,SAAAD,GACE,OAAE,EAAU18B,KAAMgL,KAAG,EAAA0xB,EAAAA,IAExBE,IAAC,SAAAF,GACD,OAAO18B,KAAUgL,KAAA,KAAS0xB,EAAAA,UAItB,SAAUA,GACb,OAAAA,GAAA,GAAA,GAAA,IAAA18B,KAAAgL,KAAA,EAAA0xB,EAAAA,GAAA,GACJ,IAAA18B,KAAAgL,KAAA,GAAA0xB,GAAA,GAAAA,GAAA,aAGO,IAGA,SAAIA,GAGJ,OAAa,IAAbA,EAAsB,EACzB,IAAAA,EAAA,GACI18B,KAAU+c,IAAM,EAAG,IAAA2f,EAAA,IAAA18B,KAAA6T,IAAA,GAAA6oB,EAAA,KAAA18B,KAAAqJ,SAIpB,SAAUqzB,GAGV,OAAe,IAAfA,EAAyB,EAC5B,IAAAA,EAAA,EACM18B,KAAU+c,IAAA,GAAQ,GAAC2f,GAAA18B,KAAA6T,IAAA,GAAA6oB,EAAA,IAAA18B,KAAAqJ,IAAA,SAIpB,SAAQqzB,GAGV,OAAW,IAAXA,EAAW,EACG,IAAVA,EACO,GAEXA,GAAU,GACb,GAAA,GAAA18B,KAAA+c,IAAA,EAAA,IAAA2f,EAAA,IAAA18B,KAAA6T,IAAA,GAAA6oB,EAAA,KAAA18B,KAAAqJ,IACJ,GAAArJ,KAAA+c,IAAA,GAAA,IAAA2f,EAAA,IAAA18B,KAAA6T,IAAA,GAAA6oB,EAAA,KAAA18B,KAAAqJ,IAAA,aAIO,SAAOqzB,GACV,IAAAxM,EAAA,QACE,OAAEwM,EAAgBA,IAAGxM,EAAA,GAAAwM,EAAAxM,QAEpB,SAASwM,GACZ,IAAAxM,EAAA,QACD,QAAOwM,EAAgBA,IAAGxM,EAAA,GAAAwM,EAAAxM,GAAA,SAEpB,SAASwM,GAGX,IAAAxM,EAAO,UACV,OAAAwM,GAAA,GAAA,EAAAA,EAAAA,IAAAxM,EAAA,GAAAwM,EAAAxM,GAAA,GACJ,KAAAwM,GAAA,GAAAA,IAAAxM,EAAA,GAAAwM,EAAAxM,GAAA,YAGO,CACJyM,GAAC,SAAAD,GACE,OAAE,EAAUF,GAASM,OAAAF,IAAA,EAAAF,iBAIXA,YAGA,EAAM,KACX,OAAOA,EAAUA,EAGjBA,EAAa,EAAI,KAAU,QAAYA,GAAU,IAAG,MAAQA,EAAA,IAEnEA,EAAA,IAAA,KAAA,QAAAA,GAAA,KAAA,MAAAA,EAAA,MACgB,QAASA,GAAA,MAAA,MAAAA,EAAA,eAItB,SAAOA,GACV,OAAAA,EAAA,GAAA,GAAAF,GAAAM,OAAAH,GAAA,EAAAD,GACJ,GAAAF,GAAAM,OAAAF,IAAA,EAAAF,EAAA,GAAA,SAWgB,oBAAAhgC,WAAA,IAAAs9B,IAAAA,GAAA+C,OAAA,WAGb,IAAAC,EAAWhD,GAAuB+C,gBAItB,IAAXC,EAAO,GAAoBA,EAAA,GAAA,KAG7B,oBAAHtgC,WAAqCiJ,IAA1BjJ,KAAYugC,kBAAyBt3B,IAAAjJ,KAAAugC,YAAAC,IAQhDxgC,KAAMugC,YAAaC,IAAAC,KAAAzgC,KAAAugC,kBACGt3B,IAAlBy3B,KAAUF,IAAeE,KAAAF,IAC5B,WAED,OAAA,IAAAE,MAAAC,WAaAC,GAAM,oBACEA,IACJliC,KAAAmiC,QAAc,GAEdniC,KAACoiC,yBAAA,YAGeh5B,UAAAi5B,OAAA,WAAA,IAACC,EAAAtiC,KACpB,OAAA2C,OAAA8D,KAAAzG,KAAAmiC,SAAAvmB,KAAA,SAAA2mB,GACD,OAAAD,EAAAH,QAAAI,OAGAL,EAAC94B,UAAAo5B,UAAA,WACDxiC,KAAAmiC,QAAA,IAGAD,EAAC94B,UAAA5H,IAAA,SAAAihC,GACDziC,KAAAmiC,QAAAM,EAAAC,SAAAD,EACIziC,KAAIoiC,yBAA0BK,EAAAC,SAAAD,KAEEr5B,UAAOu5B,OAAA,SAAAF,UACnCziC,KAAQmiC,QAAOM,EAAMC,gBAG2C1iC,KAAAoiC,yBAAAK,EAAAC,YAEIt5B,UAAA6Z,OAAA,SAAA2e,EAAAgB,QACJ,IAAAhB,IAAAA,EAAAiB,WACrC,IAAAD,IAAAA,GAAA,SACfjgC,OAAM8D,KAAOzG,KAAAmiC,YACpB,IAALW,EAAK/gC,OAAA,OAAwB,OAO5B+gC,EAAA/gC,OAAA,GAAA,CACD/B,KAAAoiC,yBAA4B,GAEhC,IAAO,IAAI57B,EAAA,EAAAA,EAAAs8B,EAAA/gC,OAAAyE,IAAA,CACd,IAAAi8B,EAAAziC,KAAAmiC,QAAAW,EAAAt8B,IACMu8B,GAAAH,EACVH,IAAA,IAAAA,EAAAxf,OAAA2e,EAAAmB,KAAAH,UAAA5iC,KAAAmiC,QAAAW,EAAAt8B,IAMWs8B,EAAWngC,OAAM8D,KAAAzG,KAAAoiC,0BAErB,OAAK,GAEFF,EArDD,GA6DLc,GAAA,CACDC,OAAQ,SAAUnZ,EAAG7T,GACjB,IAAIukB,EAAI1Q,EAAC/nB,OAAA,EACLuM,EAAIksB,EAAEvkB,EACNzP,EAAE5B,KAAOqC,MAAIqH,GACb40B,EAAKF,GAAcG,MAAMF,OAC7B,OAAKhtB,EAAI,EAAQitB,EAAKpZ,EAAE,GACpBA,EAAC,GAAIxb,GAET2H,EAAQ,EAAAitB,EAAApZ,EAAA0Q,GAAA1Q,EAAA0Q,EAAA,GAAAA,EAAAlsB,GACX40B,EAAApZ,EAAAtjB,GAAAsjB,EAAAtjB,EAAA,EAAAg0B,EAAAA,EAAAh0B,EAAA,GAAA8H,EAAA9H,WAEO,SAAMsjB,EAAM7T,OAChB,IAAIlM,EAAI,EACJnI,EAAIkoB,EAAA/nB,OAAW,EACfqhC,EAAKx+B,KAAA+c,IACL0hB,EAAGL,GAAaG,MAAAG,UACZ98B,EAAI,EACJA,GAAI5E,EAAI4E,IAACuD,GAAQq5B,EAAI,EAAIntB,EAACrU,EAAI4E,GAAA48B,EAAAntB,EAAAzP,GAAAsjB,EAAAtjB,GAAA68B,EAAAzhC,EAAA4E,UAElCuD,cAGI,SACA+f,EAAA7T,OAEJukB,EAAI1Q,EAAC/nB,OACD,EAEJuM,EAAAksB,EAAOvkB,EACVzP,EAAA5B,KAAAqC,MAAAqH,GACJ40B,EAAAF,GAAAG,MAAAI,WACD,OAAQzZ,EAAA,KAAAA,EAAA0Q,IACIvkB,EAAA,IAAAzP,EAAY5B,KAAIqC,MAAMqH,EAAAksB,GAAA,EAAAvkB,KACpBitB,EAAIpZ,GAAGtjB,EAAE,EAAKg0B,GAAKA,GAAA1Q,EAAAtjB,GAAAsjB,GAAAtjB,EAAA,GAAAg0B,GAAA1Q,GAAAtjB,EAAA,GAAAg0B,GAAAlsB,EAAA9H,IAE7ByP,EAAW,EAAW6T,EAAG,IAAGoZ,EAAApZ,EAAA,GAAAA,EAAA,GAAAA,EAAA,GAAAA,EAAA,IAAAxb,GAAAwb,EAAA,IACpB7T,EAAE,EAAG6T,EAAA0Q,IAAA0I,EAAApZ,EAAA0Q,GAAA1Q,EAAA0Q,GAAA1Q,EAAA0Q,EAAA,GAAc1Q,EAAA0Q,EAAM,GAAAlsB,EAAAksB,GAAS1Q,EAAA0Q,IAC/B0I,EAAGpZ,EAACtjB,EAAIA,EAAI,EAAI,GAAIsjB,EAAGtjB,GAACsjB,EAAA0Q,EAAAh0B,EAAA,EAAAg0B,EAAAh0B,EAAA,GAAAsjB,EAAA0Q,EAAAh0B,EAAA,EAAAg0B,EAAAh0B,EAAA,GAAA8H,EAAA9H,WAGtBy8B,OAAA,SAACzc,EAAAG,EAAAlZ,GAAA,OAACkZ,EAAAH,GAAA/Y,EAAA+Y,aAEJ,SAAM5kB,EAAA4E,OACTg9B,EAAKR,GACSG,MAAAM,iBAEXD,EAAE5hC,GAAK4hC,EAAIh9B,GAAMg9B,EAAG5hC,EACnB4E,eAIP4H,GAAA,CACJ,GAES,SAASxM,GACX,IAAEkzB,EAAM,EACR,GAAE1mB,GAAIxM,GAAI,OAAAwM,GAAAxM,GACV,IAAE,IAAI4E,EAAK5E,EAAA4E,EAAA,EAAAA,IAAAsuB,GAAAtuB,EAElB,OADG4H,GAAMxM,GAAGkzB,EACZA,IAMNyO,WACH,SAAI/c,EAAAG,EAAA+c,EAAAC,EAAAl2B,OACSm2B,EAAA,IAAAF,EAAAld,GACRqd,EAAA,IAAAF,EAAAhd,GACDkC,EAAApb,EAAAA,EAEC,OAAA,EAAAkZ,EAAA,EAAA+c,EAAAE,EAAAC,IADUp2B,EAAAob,KACV,EAAAlC,EAAA,EAAA+c,EAAA,EAAAE,EAAAC,GAAAhb,EAAA+a,EAAAn2B,EAAAkZ,QAgBQ,oBACDmd,cAEgBC,OAAA,WACpB,OAAKD,EAAiBE,aAEDA,QAAA,EAACF,EANjB,MAOe,IAAA5B,GAOpB+B,GAAsB,oBACjBA,EAAcC,EAAAC,QACJ,IAAXA,IAAeA,EAAAC,IACnBpkC,KAAKkkC,QAAAA,EACLlkC,KAAKmkC,OAAAA,EACLnkC,KAAKqkC,WAAA,EACLrkC,KAAKskC,YAAA,EACLtkC,KAAKukC,aAAM,GAEXvkC,KAAKwkC,WAAW,GAEpBxkC,KAAAykC,mBAAA,GAECzkC,KAAA0kC,UAAA,IACD1kC,KAAA2kC,eAAA,EACI3kC,KAAA4kC,QAAY,EACf5kC,KAAA6kC,OAAA,EACD7kC,KAAA8kC,YAAA,EACI9kC,KAAA+kC,WAAY,EACf/kC,KAAAglC,WAAA,EACDhlC,KAAAilC,WAAA,EACIjlC,KAAuEklC,gBAAA9D,GAAA6B,OAAA5B,KACvErhC,KAAsEmlC,uBAAAnC,GAAAC,OACtEjjC,KAAyBolC,eAAA,GACzBplC,KAA0EqlC,uBAAA,EAC1ErlC,KAAKslC,IAAAxB,GAAqCC,SAC1C/jC,KAAIulC,iBAAa,EAGjBvlC,KAAAwlC,UAAW,EAmXf,OAjXAvB,EAAM76B,UAAUs5B,MAAQ,WACpB,OAAK1iC,KAAAslC,KAETrB,EAAC76B,UAAAq8B,UAAA,WACD,OAAAzlC,KAAA8kC,cAI+B17B,UAAAs8B,SAAA,WAC3B,OAAK1lC,KAAMqkC,aAEUj7B,UAAAu8B,GAAA,SAAAv6B,EAAAw6B,0BAKRjjC,OAAAkjC,OAAAz6B,QACAb,QAAavK,KAAA0kC,UAAiBkB,GACtC5lC,QAEiBoJ,UAAAw8B,SAAA,SAAAv3B,GAEtB,OADArO,KAAK0kC,UAAYr2B,EACZrO,QAE+BoJ,UAAWjH,MAAiB,SAAAy/B,GAChE,GAAI5hC,KAAC8kC,WAAc,OAAK9kC,KAI5B,GAFIA,KAAAmkC,QAAWnkC,KAAAmkC,OAAA3iC,IAAAxB,MACdA,KAAA4kC,QAAA5kC,KAAA2kC,eACD3kC,KAAA+kC,UAIQ,IAAI,IAAAe,KADJ9lC,KAAI+kC,WAAA,EACW/kC,KAAAykC,mBACXzkC,KAAA+lC,0BAAuBD,GAC+C9lC,KAAAukC,aAAAuB,GAAA9lC,KAAAykC,mBAAAqB,eAK1EhB,YAAmD,OACnDT,WAAI,8BACgB,wBACF,uBAGuB95B,IAAAq3B,EAAA,iBAAAA,EAAAiB,KAAAmD,WAAApE,GAAAA,EAAAiB,sBAC5B7iC,KAAGglC,iCACyDhlC,KAAAkkC,QAAAlkC,KAAAukC,aAAAvkC,KAAAwkC,WAAAxkC,KAAAykC,4BACjBr7B,UAAA68B,iBAAA,SAAA/B,EAAAK,EAAAC,EAAAC,OACxD,IAACqB,KAAAtB,EAAA,CACD,IAAoC0B,EAAAhC,EAAA4B,GAClCK,EAAwBnwB,MAAIowB,QAAAF,GAC1BG,EAAAF,EAAyB,eAAsBD,EAAII,GAACH,GAAAnwB,MAAAowB,QAAA5B,EAAAsB,OAI5B,cAApBO,GAAoB,aAAAA,MAGxBC,EAAmB,CAAsC,IAA6DC,EAAA/B,EAAAsB,GACtH,GAA2B,IAAAS,EAAAxkC,OAAA,SAE3BwkC,EAAKA,EAAiB3qB,IAAA5b,KAAAwmC,qBAAyBzE,KAAQ/hC,KAAGkmC,IAG1D1B,EAA0CsB,GAAA,CACtCI,GAGF3G,OAAGgH,MAKD,WAAJF,IACIF,IAA2BD,GAAAI,OAmBD,IAAnB/B,EAAQuB,KAAWvB,EAAAuB,GAAAI,GACjCC,IAEG5B,EAACuB,IACA,GAIbrB,EAAAqB,GAFeQ,EAET9B,EAAUsB,GAAM7d,QAAa+T,UACXuI,EAAAuB,IAAA,MA5BmB,CAOlC,IAAA,IAAAhxB,KANOyvB,EAAoBuB,GAAAK,EAAA,GAAA,GAM3BD,EAER3B,EAAAuB,GAAAhxB,GAAAoxB,EAAApxB,GACD2vB,EAAAqB,GAAMK,EAAiB,GAAQ,GAI1BnmC,KAAAimC,iBAAAC,EAAA3B,EAAAuB,GAAAtB,EAAAsB,GAAArB,EAAAqB,QAkBL7B,EAAM76B,UAAUK,KAAK,WAOjB,OANIzJ,KAAIulC,kBACJvlC,KAAKulC,iBAAkB,EAGvBvlC,KAACymC,qBAEsBzmC,KAAA8kC,YAE3B9kC,KAAAmkC,QAAWnkC,KAAAmkC,OAAAxB,OAAA3iC,MACdA,KAAA8kC,YAAA,EACD9kC,KAAAqkC,WAAA,EACQrkC,KAAI0mC,iBAAmB1mC,KAAG0mC,gBAAA1mC,KAAAkkC,SACzBlkC,MANsBA,QAUIoJ,UAAW/G,IAAA,WAG1C,OAFArC,KAAKwlC,UAAW,EAChBxlC,KAA2BijB,OAAAxL,EAAAA,GACtBzX,MAETikC,EAAC76B,UAAAu9B,MAAA,SAAA/E,GAEG,YADJ,IAAAA,IAAAA,EAAAiB,MACS7iC,KAAKqkC,YAAMrkC,KAAA8kC,aAGhB9kC,KAAAqkC,WAAW,EACdrkC,KAAAskC,YAAA1C,EAEG5hC,KAAKmkC,QAASnkC,KAAKmkC,OAAAxB,OAAA3iC,OANqBA,MAS5CikC,EAAM76B,UAAUw9B,OAAQ,SAAUhF,GAE9B,YADK,IAADA,IAAcA,EAAMiB,MACxB7iC,KAAOqkC,WAAIrkC,KAAA8kC,YACd9kC,KAAAqkC,WAAA,EACDrkC,KAAAilC,YAAArD,EAAA5hC,KAAAskC,YACItkC,KAAKskC,YAAc,EAEnBtkC,KAAAmkC,QAAWnkC,KAAAmkC,OAAA3iC,IAAAxB,MACdA,MANcA,QAQmBoJ,UAAAq9B,kBAAA,WAC9B,IAAA,IAAOjgC,EAAI,EAAAqgC,EAAA7mC,KAAAolC,eAAArjC,OAAAyE,EAAAqgC,EAAArgC,IAAAxG,KAAAolC,eAAA5+B,GAAAiD,OACd,OAAAzJ,QAEoBoJ,UAAA+D,MAAA,SAAAA,GAEpB,OADGnN,KAAAmkC,OAAWh3B,EACdnN,QAEwCoJ,UAAA09B,MAAA,SAAAxF,GAExC,OADGthC,KAAAglC,WAAW1D,EACdthC,QAEiCoJ,UAAA29B,OAAqB,SAAAC,GAGvD,OAFIhnC,KAAA2kC,eAAWqC,EACdhnC,KAAA4kC,QAAAoC,EACDhnC,QAE0CoJ,UAClC69B,YAAa,SAAY3F,GAG7B,OADAthC,KAAKknC,iBAAiB5F,EACfthC,MAEXikC,EAAM76B,UAAU+9B,KAAO,SAAGA,GAEtB,OADAnnC,KAAK6kC,MAAAsC,EACEnnC,MAEXikC,EAAM76B,UAAUg+B,OAAQ,SAAGC,GAEvB,OADArnC,KAAKklC,gBAAiBmC,EACfrnC,MAEXikC,EAAM76B,UAAUk+B,cAAW,SAAUC,GAEjC,OADAvnC,KAAKmlC,uBAAoBoC,EAClBvnC,MAEXikC,EAAM76B,UAAUo+B,MAAA,WAEZ,IADA,IAAIC,EAAC,GACEjnB,EAAI,EAAAA,EAAAnW,UAAAtI,OAAAye,IAAAinB,EAAAjnB,GAAAnW,UAAAmW,GAEf,OADCxgB,KAAAolC,eAAAqC,EACDznC,QAEeoJ,UAAAs+B,QAAA,SAAAC,GAMZ,OALF3nC,KAAA4nC,iBAAAD,EAKE3nC,QAGyCoJ,UAAIy+B,SAAA,SAAAF,GAG5C,OAFA3nC,KAAI8nC,kBACAH,EACA3nC,QAEiCoJ,UAAS2+B,SAAA,SAAAJ,UAC9C3nC,KAAKgoC,kBAAkBL,EACjB3nC,QAILoJ,UAAA6+B,WAAA,SAAAN,GAED,OADA3nC,KAAKkoC,oBAAgBP,EACjB3nC,QAKSoJ,UAAA++B,OAAqB,SAAQR,GAG1C,YADIjB,gBAAKiB,EACR3nC,MAMDikC,EACS76B,UAAkB6Z,OAAK,SAAS2e,EAAOmB,WAErC,IAAPnB,IAAaA,EAAAiB,WACJ,IAATE,IAAsBA,GAAC,QACnBsB,UAAY,OAAM,YAKZrkC,KAAGilC,WAAcjlC,KAAM0kC,8BAGG1kC,KAAA8kC,WAAA,MACpBsD,EAAK,OAAA,KAETpoC,KAAKmC,MACLy/B,qBAGP,IACC5hC,KAAMilC,WACA,OAAC,GAEgB,SAAzBI,6BAIIuC,kBAAkB5nC,KAAI4nC,iBAAkB5nC,KAAAkkC,cAE5CmB,uBAAS,MAKRzD,EAAC5hC,KAAAilC,YAAAjlC,KAAA0kC,YACO,IAAP1kC,KAAE0kC,WAAK2D,EACA,EAAA,EAAAA,QAEJroC,KAAKklC,gBAAMmD,6BAGProC,KAAekkC,QAASlkC,KAAKukC,aAAavkC,KAAKwkC,WAASpkC,QAEjE0nC,mBAAkB9nC,KAAK8nC,kBAAA9nC,KAAAkkC,QAAAmE,GAChB,MAAA,CACX,GAACroC,KAAA4kC,QAAA,EAAA,CAGR,IAAAkB,4CAAA9lC,KAAAykC,mBACDzkC,KAAA6kC,OAAoC,iBAA9B7kC,KAAAwkC,WAAUsB,KAA8B9lC,KAAAykC,mBAAuBqB,GAEI9lC,KAAAykC,mBAAAqB,GAAAE,WAAAhmC,KAAAwkC,WAAAsB,KAC7D9lC,KAAa6kC,OAAA7kC,KAAQ+lC,0BACbD,GAER9lC,KAAQukC,aAAauB,GAAa9lC,KAACykC,mBAAAqB,UAEnC9lC,KAAA6kC,QAAe7kC,KAAM+kC,WAAQ/kC,KAAQ+kC,gBACPx6B,IAA9BvK,KAAAknC,iBAA8BlnC,KAAAilC,WAAArD,EAAA5hC,KAAAknC,iBAC9BlnC,KAAAilC,WAAuBrD,EAAA5hC,KAAYglC,WACnChlC,KAAAgoC,mBACOhoC,KAACgoC,kBAAiBhoC,KAAAkkC,UAEpB,EAGAlkC,KAAAkoC,qBAA0BloC,KAAQkoC,oBAAoBloC,KAAAkkC,aAEzD,IAAA19B,EAAA,EAAAqgC,EAAA7mC,KAAAolC,eAAArjC,OAAAyE,EAAAqgC,EAAArgC,IAEFxG,KAAGolC,eAAQ5+B,GAAArE,MAAAnC,KAAqBilC,WAAUjlC,KAAA0kC,WAE1C,OADA1kC,KAA0C8kC,YAAA,GACtC,SAKP,GAETb,EAAC76B,UAAAk/B,kBAAA,SAAApE,EAAAK,EAAAC,EAAApkC,GACD,IAAA,IAAA0lC,KAAAtB,EAIQ,QAA6Bj6B,IAAzBg6B,EAAQuB,GAAZ,KAIA3jC,EAAOoiC,EAAcuB,IAAA,EAE5BzjC,EAAAmiC,EAAAsB,GACDyC,EAAAvyB,MAAAowB,QAAKlC,EAAC4B,IACK0C,EAAQxyB,MAAAowB,QAAmB/jC,IACHkmC,GAAQC,EACPtE,EAC5B4B,GAAK9lC,KAAAmlC,uBAAoC9iC,EAAAjC,GAGlB,iBAAlBiC,GAA2BA,EAGvCrC,KAAAsoC,kBAAApE,EAAA4B,GAAA3jC,EAAAE,EAAAjC,GAoBF,iBAhBCiC,EAAArC,KAAAwmC,qBAAUrkC,EAAQE,MAmBkD6hC,EAAA4B,GAAA3jC,GAAAE,EAAAF,GAAA/B,KAIpE6jC,EAAS76B,UAAGo9B,qBAAM,SAAUrkC,EAAKE,GACjC,MAAA,iBAAAA,EAAAA,EACA,MAAAA,EAAAomC,OAAA,IAAS,MAATpmC,EAAAomC,OAAS,GAAAtmC,EAAK6jC,WAAQ3jC,GACtB2jC,WAAA3jC,IAEA4hC,EAAQ76B,UAAM28B,0BAAA,SAAAD,GACd,IAAOpe,EAAA1nB,KAAAykC,mBAAAqB,GACP4C,EAAe1oC,KAAAwkC,WAAAsB,GACV9lC,KAAAykC,mBAAKqB,GAAL,iBAAA4C,EAAK1oC,KAAAykC,mBAAAqB,GAAAE,WAAA0C,GACA1oC,KAAAwkC,WAAQsB,GAClB9lC,KAAQwkC,WAAAsB,GAAApe,GAEDuc,EAhZmB,gICxXQ72B,EAAQvD,EAAGN,EAAOsG,GACpD,MAAMvO,EAAOtB,KAEbsB,EAAKuI,EAAIA,EACTvI,EAAKqnC,MAAQ9+B,EAEbvI,EAAKsnC,OAAS,WACVtnC,EAAKmhC,MAAQ,IAAIwB,GAAM3iC,GACvBA,EAAKmhC,MAAMkD,GAAG,CAAE97B,EAAgB,EAAbvI,EAAKqnC,OAAa,KACrCrnC,EAAKmhC,MAAMtgC,SAEfb,EAAKunC,KAAO,WACRvnC,EAAKmhC,MAAQ,IAAIwB,GAAM3iC,GACvBA,EAAKmhC,MAAMkD,GAAG,CAAE97B,EAAGvI,EAAKqnC,OAAS,KACjCrnC,EAAKmhC,MAAMtgC,SAIfb,EAAK4sB,OAAS,WACV,MAAOzqB,KAACA,GAASoM,EAEbvO,EAAKmhC,OACLnhC,EAAKmhC,MAAMxf,SAKfxf,EAAK8K,YACL9K,EAAK8E,UAAYgB,EACjB9F,EAAKwV,IAAI7L,EAAOQ,EAAGR,EAAOS,EAAGvM,EAAKuI,EAAG,EAAG,EAAIjF,KAAKqJ,IACjDxK,EAAK0V,OACL1V,EAAKyV,sBC9BTtL,EACAC,EACAhE,EACAgG,EACAi5B,EACAxoC,EACAiB,EACAwnC,EACAC,GAEA,MAAM1nC,EAAOtB,KAIPgM,EAAK88B,EAAeG,IAAI3nC,GAK9BA,EAAK4nC,YAAW,KAMZ,MAAMnoC,EAAW,CACbioC,EAAeG,eAAe1oC,QAAQuL,EAAI,EAAG,GAC7Cg9B,EAAeI,gBAAgB3oC,QAAQuL,EAAI,GAAE4B,IAAGC,GAAK,GAAED,IAAGC,IAC1Dm7B,EAAeK,eAAe5oC,QAAQuL,EAAInC,EAAGA,IAI7Ck/B,EACAzoC,EAAUgpC,aAAavoC,GAEvBT,EAAUipC,WAAWxoC,IAI7BO,EAAKkoC,WAAc7jC,IACfrE,EAAKkuB,OAAS7pB,EACdpE,EAAQC,IAAI,CAAC,gBAEjBF,EAAKmoC,KAAQ9jC,IACT,MAAM+jC,EAAMV,EAAeG,eAAeQ,gBAAgB39B,GAC1Dg9B,EAAeG,eAAeS,GAAG59B,EAAIrG,EAAG+jC,IAG5CpoC,EAAKuoC,YAAe7tB,IAChB1a,EAAKsM,EAAIoO,EAAEpO,EACXtM,EAAKuM,EAAImO,EAAEnO,EACXtM,EAAQC,IAAI,CAAC,gBAEjBF,EAAKwoC,MAAS9tB,IACV,MAAM0tB,EAAMV,EAAeI,gBAAgBO,gBAAgB39B,GAC3Dg9B,EAAeI,gBAAgBQ,GAAG59B,EAAIgQ,EAAG0tB,IAG7CpoC,EAAKyoC,WAAcC,IACf1oC,EAAKuI,EAAImgC,EACTzoC,EAAQC,IAAI,CAAC,YAEjBF,EAAK2oC,KAAQD,IACT,MAAMN,EAAMV,EAAeK,eAAeM,gBAAgB39B,GAC1Dg9B,EAAeK,eAAeO,GAAG59B,EAAIg+B,EAAMN,IAG/CpoC,EAAK4nC,cAIL,MAAMryB,EAAS,IAAIqzB,GAAc5oC,EAAM,GAAI,OAAQuO,GACnDvO,EAAKuV,OAASA,EAIdvV,EAAKutB,iBAAgB,KAEjBhY,EAAOqX,sBC7EuB9gB,EAAQvK,EAAGC,EAAGyG,EAAOsG,GACvD,MAAMvO,EAAOtB,KACbsB,EAAKuB,EAAIA,EACTvB,EAAKwB,EAAIA,EACTxB,EAAK6oC,MAAQtnC,EACbvB,EAAK8oC,MAAQtnC,EACbxB,EAAKiI,MAAQA,EAEbjI,EAAKsnC,OAAS,WACVtnC,EAAK+oC,QAAU,IAAIpG,GAAM3iC,GACzBA,EAAK+oC,QAAQ1E,GAAG,CAAE9iC,EAAGvB,EAAK6oC,MAAQ,GAAIrnC,EAAGxB,EAAK8oC,MAAQ,IAAM,KAC5D9oC,EAAK+oC,QAAQloC,SAEjBb,EAAKunC,KAAO,WACRvnC,EAAK+oC,QAAU,IAAIpG,GAAM3iC,GACzBA,EAAK+oC,QAAQ1E,GAAG,CAAE9iC,EAAGvB,EAAK6oC,MAAOrnC,EAAGxB,EAAK8oC,OAAS,KAClD9oC,EAAK+oC,QAAQloC,SAIjBb,EAAK4sB,OAAS,WACV,MAAOzqB,KAACA,GAASoM,EAEbvO,EAAK+oC,SACL/oC,EAAK+oC,QAAQpnB,SAEjBxf,EAAK8K,YACL9K,EAAK8E,UAAYjH,EAAKiI,MACtB9F,EAAK2V,KACAhM,EAAOQ,EAAI,GAAMtM,EAAKuB,EAAK,GAC3BuK,EAAOS,EAAI,GAAMvM,EAAKwB,EAAK,GAC5BxB,EAAKuB,EAAI,EACTvB,EAAKwB,EAAI,GAEbW,EAAK0V,OACL1V,EAAKyV,sBCjCTtL,EACAC,EACAhL,EACAC,EACAyG,EACAsG,EACAy6B,EACAhqC,EACAiB,EACAwnC,EACAwB,GAEA,MAAMjpC,EAAOtB,KAEPgM,EAAKs+B,EAAmBrB,IAAI3nC,GAKlCA,EAAK4nC,YAAW,KAKZ,MAAMnoC,EAAW,CAEbwpC,EAAmBpB,eAAe1oC,QAAQuL,EAAI,EAAG,GACjDu+B,EAAmBnB,gBAAgB3oC,QAAQuL,EAAI,GAAE4B,IAAGC,GAAK,GAAED,IAAGC,KAI9Dk7B,EACAzoC,EAAUgpC,aAAavoC,GAEvBT,EAAUipC,WAAWxoC,IAG7BO,EAAKkoC,WAAc7jC,IACfrE,EAAKkuB,OAAS7pB,EACdpE,EAAQC,IAAI,CAAC,gBAEjBF,EAAKmoC,KAAQ9jC,IACT,MAAM+jC,EAAMa,EAAmBpB,eAAeQ,gBAAgB39B,GAC9Du+B,EAAmBpB,eAAeS,GAAG59B,EAAIrG,EAAG+jC,IAGhDpoC,EAAKuoC,YAAe7tB,IAChB1a,EAAKsM,EAAIoO,EAAEpO,EACXtM,EAAKuM,EAAImO,EAAEnO,EACXtM,EAAQC,IAAI,CAAC,gBAEjBF,EAAKwoC,MAAS9tB,IACV,MAAM0tB,EAAMa,EAAmBnB,gBAAgBO,gBAAgB39B,GAC/Du+B,EAAmBnB,gBAAgBQ,GAAG59B,EAAIgQ,EAAG0tB,IAGjDpoC,EAAK4nC,cAEL,MAAM1a,EAAS,IAAIgc,GAAclpC,EAAMuB,EAAGC,EAAGyG,EAAOsG,GACpDvO,EAAKktB,OAASA,EAEdltB,EAAKsuB,SAAW,EAChBtuB,EAAKuuB,YAAc,SAAUD,GACzBtuB,EAAKsuB,SAAWA,GAGpBtuB,EAAK2uB,QAAWwa,IACZnpC,EAAKmpC,KAAOA,GAGhBnpC,EAAKutB,iBAAmB,WACpBL,EAAON,SAEP+L,IZ9EO,IY8EsB34B,EAAKsuB,UZ9ElB8a,QAAQ,GY8EqBppC,EAAKsM,EAAGtM,EAAKuM,EAAe,GAAX2gB,EAAO1rB,EAAU,EAAG,GAAI,EAAG,OAAQ+M,EAAOpM,WAEtF8G,IAAdjJ,EAAKmpC,MACLxQ,GAAiB34B,EAAKmpC,KAAMnpC,EAAKsM,EAAGtM,EAAKuM,EAAe,GAAX2gB,EAAO1rB,EAAU,GAAK,EAAG,GAAI,EAAG,OAAQ+M,EAAOpM,mBC/EpGmK,EACAC,EACAhE,EACAgG,EACA86B,EACArqC,EACAiB,EACAwnC,EACA6B,GAEA,MAAMtpC,EAAOtB,KAEPgM,EAAK2+B,EAAqB1B,IAAI3nC,GAKpCA,EAAK4nC,YAAW,KAIZ,MAAMnoC,EAAW,CACb6pC,EAAqBzB,eAAe1oC,QAAQuL,EAAI,EAAG,GACnD4+B,EAAqBxB,gBAAgB3oC,QAAQuL,EAAI,GAAE4B,IAAGC,GAAK,GAAED,IAAGC,IAChE+8B,EAAqBvB,eAAe5oC,QAAQuL,EAAInC,EAAGA,IAInDk/B,EACAzoC,EAAUgpC,aAAavoC,GAEvBT,EAAUipC,WAAWxoC,IAI7BO,EAAKkoC,WAAc7jC,IACfrE,EAAKkuB,OAAS7pB,EACdpE,EAAQC,IAAI,CAAC,gBAEjBF,EAAKmoC,KAAQ9jC,IACT,MAAM+jC,EAAMkB,EAAqBzB,eAAeQ,gBAAgB39B,GAChE4+B,EAAqBzB,eAAeS,GAAG59B,EAAIrG,EAAG+jC,IAGlDpoC,EAAKuoC,YAAe7tB,IAChB1a,EAAKsM,EAAIoO,EAAEpO,EACXtM,EAAKuM,EAAImO,EAAEnO,EACXtM,EAAQC,IAAI,CAAC,gBAEjBF,EAAKwoC,MAAS9tB,IACV,MAAM0tB,EAAMkB,EAAqBxB,gBAAgBO,gBAAgB39B,GACjE4+B,EAAqBxB,gBAAgBQ,GAAG59B,EAAIgQ,EAAG0tB,IAGnDpoC,EAAKyoC,WAAcC,IACf1oC,EAAKuI,EAAImgC,EACTzoC,EAAQC,IAAI,CAAC,YAEjBF,EAAK2oC,KAAQD,IACT,MAAMN,EAAMkB,EAAqBvB,eAAeM,gBAAgB39B,GAChE4+B,EAAqBvB,eAAeO,GAAG59B,EAAIg+B,EAAMN,IAGrDpoC,EAAK4nC,cAEL,MAAM1a,EAAS,IAAIgc,GAAclpC,EAAM,GAAI,GAAI,OAAQuO,GACvDvO,EAAKktB,OAASA,EAEdltB,EAAK4sB,OAAS,WACV,MAAO5qB,IAACA,GAAQuM,EAEhBvM,EAAIiL,YAEJjL,EAAI2V,IAAI3X,EAAKsM,EAAGtM,EAAKuM,EAAGvM,EAAKuI,EAAG,EAAG,EAAIjF,KAAKqJ,IAE5C3K,EAAI4V,UAER5X,EAAKutB,iBAAgB,KACjBL,EAAON,wBCzFX,MAAM5sB,EAAOtB,KAEP6qC,EAAW,GACjB,IAAIC,EAAS,EAEbxpC,EAAK2nC,IAAM,SAAUphC,GACjBgjC,EAAStqC,KAAKsH,GACd,MAAMmE,EAAK8+B,EAEX,OADAA,GAAU,EACH9+B,GAEX1K,EAAKypC,IAAG,IAASD,EACjBxpC,EAAK0pC,IAAOh/B,GAAO6+B,EAAS7+B,eCTS6D,EAAQtO,GAC7C,MAAMD,EAAOtB,KAGb,IAAIirC,EAAO,GACX,MAAMC,EAAa,GAEbhoC,EAAS2M,EAAOrM,WAGtBlC,EAAK6tB,gBAAkB,SAAUjlB,EAAGJ,GAGhCohC,EAAW3qC,KAAK,GAAE2J,IAAGJ,IADX,CAAEqhC,UAAU,MAG1B7pC,EAAKstB,gBAAkB,SAAU1kB,EAAGJ,GAEhCohC,EAAW3qC,KAAK,GAAE2J,IAAGJ,IADX,CAAEshC,UAAU,MAO1B,MAAMjpC,EAAQ,SAAUkpC,GACpB,MAAMC,EAAQ,GACdA,EAAM19B,EAAIy9B,EAAME,QAChBD,EAAMz9B,EAAIw9B,EAAMG,QAChB,MAAMC,EAASJ,EAAMK,QAAW,GAAK,EAC/BxQ,EAAKgQ,EAAWnpC,OACtB,IAAK,IAAIyE,EAAI,EAAGA,EAAI00B,EAAI10B,IAAK,CACzB,MAAM6H,EAAI68B,EAAW1kC,GACrB,GAAI6H,EAAEnE,EAAEslB,QAAUmc,EAAQt9B,EAAGi9B,EAAOG,GAAQ,CACpCJ,EAAMK,UACNL,EAAMO,iBACNP,EAAMQ,mBAEVZ,EAAKa,UAAYtlC,EACjBykC,EAAKc,YAAa,EAClBd,EAAKe,KAAO39B,EAAEnE,EAAE0D,EAAI09B,EAAM19B,EAC1Bq9B,EAAKgB,KAAO59B,EAAEnE,EAAE2D,EAAIy9B,EAAMz9B,EAC1BQ,EAAEvE,EAAE8+B,SACJ1lC,EAAOgpC,QAAQC,OAAS,WACxB,SAKN9pC,EAAM,WACR,QAAuBkI,IAAnB0gC,EAAKa,UAAyB,CACbZ,EAAWD,EAAKa,WACxBhiC,EAAE++B,OAEfoC,EAAO,IAGL7oC,EAAO,SAAUipC,GACnB,MAAMC,EAAQ,GAGd,GAFAA,EAAM19B,EAAIy9B,EAAME,QAChBD,EAAMz9B,EAAIw9B,EAAMG,QACZP,EAAKc,WAAY,CACbV,EAAMK,UACNL,EAAMO,iBACNP,EAAMQ,mBAEOX,EAAWD,EAAKa,WACxB5hC,EAAE4/B,MAAM,CAAEl8B,EAAG09B,EAAM19B,EAAIq9B,EAAKe,KAAMn+B,EAAGy9B,EAAMz9B,EAAIo9B,EAAKgB,OAC7D1qC,EAAQC,IAAI,CAAC,mBACV,CAGH,MAAM05B,EAAKgQ,EAAWnpC,OACtB,IAAK,IAAIyE,EAAI,EAAGA,EAAI00B,EAAI10B,IAAK,CACzB,MAAM6H,EAAI68B,EAAW1kC,GACrB,GAAI6H,EAAEnE,EAAEslB,QAAUmc,EAAQt9B,EAAGi9B,EAAO,GAEhC,YADApoC,EAAOgpC,QAAQC,OAAS,QAIhCjpC,EAAOgpC,QAAQC,OAAS,KA+B5B,SAASC,EAACzmC,GACV,MAAKyT,EAAKzT,EAAA0mC,OAAAC,wBACLzpC,EAAI8C,EAAG0mC,OAAIE,YACXzpC,EAAI6C,EAAG0mC,OAAIG,aAChB,IAAI5+B,EAAIjI,EAAC8mC,eAAO,GAAAC,QAAAtzB,EAAA2B,KACZlN,EAAIlI,EAAC8mC,eAAO,GAAAE,QAAAvzB,EAAA5R,IAChBoG,EAAM,IAAIA,EAAI,GAACC,EAAA,IAAOA,EAAG,GAAED,EAAA/K,IAAO+K,EAAG/K,GAAEgL,EAAA/K,IAAO+K,EAAE/K,GAAK,MAAC8pC,EAAA,CACtDrB,QAAa39B,EACb49B,QAAQ39B,EACX69B,SAAA,GAWG,OADA/oC,OAAwCC,OAAA+C,EAAAinC,GACjCjnC,WAOEgmC,EAAIt9B,EAAAmsB,EAAGiR,SAEZ79B,EAAMS,EAACnE,EAAG0D,EAAA4sB,EAAA5sB,EACbC,EAAAQ,EAAAnE,EAAA2D,EAAA2sB,EAAA3sB,EACD,GAAAQ,EAAM2N,EAACovB,SAAK,CACf,MAAAvhC,EAAAA,GAAAwE,EAAAvE,SACJ8D,EAAAA,EAAAC,EAAAA,GAAAhE,EAAA4hC,IAAA5hC,EAAA4hC,8FA9CGnqC,EAAKkE,cAAgB,OACjBrD,OAAOC,MAAMC,YAdEsD,IACf,MAAMinC,EAAOR,EAAUzmC,GACvBvD,EAAKwqC,eAEWjnC,IAChB,MAAMinC,EAAOR,EAAUzmC,GACvBxD,EAAMyqC,aAEQjnC,IACDymC,EAAUzmC,GACvBtD,kBChGmCU,EAAQ8pC,GAC/C,MAEMC,EAAqB3pC,SAASC,cAAc,UAElD0pC,EAAmB78B,UAAY,UAC/B68B,EAAmB58B,UAAY,gBAE/B48B,EAAmB38B,QAAO,KACtB08B,EAAIE,uBAGRhqC,EAAOc,WAAW,eAAgBipC,GAXrB9sC,KAaRmxB,KAAI,KACL2b,EAAmBt8B,QAAS,GAdnBxQ,KAgBRoxB,KAAI,KACL0b,EAAmBt8B,QAAS,eClBmBzN,EAAQ8pC,GAC3D,MACMG,EAAiC7pC,SAASC,cAAc,UAE9D4pC,EAA+B/8B,UAAY,UAC3C+8B,EAA+B98B,UAAY,6BAE3C88B,EAA+B78B,QAAO,KAClC08B,EAAII,mCAGRlqC,EAAOc,WAAW,2BAA4BmpC,GAVjChtC,KAYRmxB,KAAI,KACL6b,EAA+Bx8B,QAAS,GAb/BxQ,KAeRoxB,KAAI,KACL4b,EAA+Bx8B,QAAS,eCdL85B,EAAoBhqC,EAAWusC,GACtE,MAAMvrC,EAAOtB,KAEPktC,EAAS,aAEf5rC,EAAK6nC,eAAiB7oC,EAAU6sC,cAAc,CAC1Ch4B,OAAM,CAAGnJ,EAAIrG,KACS2kC,EAAmBU,IAAIh/B,GAC/Bw9B,WAAW7jC,IAEzBiM,KAAI,GAAKs7B,WAGb5rC,EAAK8nC,gBAAkB9oC,EAAU6sC,cAAc,CAC3Ch4B,OAAM,CAAGnJ,EAAIgQ,KACSsuB,EAAmBU,IAAIh/B,GAC/B69B,YAAY7tB,IAE1BpK,KAAI,GAAKs7B,UACTE,MAAO,CAAEC,SAAS,KAQtB/rC,EAAKgsC,0BAA4BhtC,EAAUitC,UAAU,CACjDp4B,OAAS41B,IACL8B,EAAIW,0BAA0BzC,IAElC0C,aAAc,EACd77B,KAAI,GAAKs7B,qBACTE,MAAO,CAAEM,eAAe,KAE5BpsC,EAAKqsC,oBAAuB5C,IACxBzqC,EAAUgpC,aAAa,CAAChoC,EAAKgsC,0BAA0B7sC,QAAQsqC,kBCpC1BJ,EAAsBrqC,EAAWusC,GAC1E,MAAMvrC,EAAOtB,KAEPktC,EAAS,eAEf5rC,EAAK6nC,eAAiB7oC,EAAU6sC,cAAc,CAC1Ch4B,OAAM,CAAGnJ,EAAIrG,KACWglC,EAAqBK,IAAIh/B,GACjCw9B,WAAW7jC,IAE3BiM,KAAI,GAAKs7B,WAGb5rC,EAAK8nC,gBAAkB9oC,EAAU6sC,cAAc,CAC3Ch4B,OAAM,CAAGnJ,EAAIgQ,KACW2uB,EAAqBK,IAAIh/B,GACjC69B,YAAY7tB,IAE5BpK,KAAI,GAAKs7B,UACTE,MAAO,CAAEC,SAAS,KAGtB/rC,EAAK+nC,eAAiB/oC,EAAU6sC,cAAc,CAC1Ch4B,OAAM,CAAGnJ,EAAInC,KACW8gC,EAAqBK,IAAIh/B,GACjC+9B,WAAWlgC,IAE3B+H,KAAI,GAAKs7B,WAOb5rC,EAAKssC,4BAA8BttC,EAAUitC,UAAU,CACnDp4B,OAAS41B,IACL8B,EAAIgB,4BAA4B9C,IAEpC0C,aAAc,EACd77B,KAAI,GAAKs7B,qBACTE,MAAO,CAAEM,eAAe,KAE5BpsC,EAAKwsC,sBAAyB/C,IAC1BzqC,EAAUgpC,aAAa,CAAChoC,EAAKssC,4BAA4BntC,QAAQsqC,kBC3C5BjC,EAAgBxoC,EAAWusC,GACpE,MAAMvrC,EAAOtB,KAIbsB,EAAK6nC,eAAiB7oC,EAAU6sC,cAAc,CAC1Ch4B,OAAM,CAAGnJ,EAAIrG,KACKmjC,EAAekC,IAAIh/B,GAC3Bw9B,WAAW7jC,IAErBiM,KAAI,gBAGRtQ,EAAK8nC,gBAAkB9oC,EAAU6sC,cAAc,CAC3Ch4B,OAAM,CAAGnJ,EAAIgQ,KACK8sB,EAAekC,IAAIh/B,GAC3B69B,YAAY7tB,IAEtBpK,KAAI,eACJw7B,MAAO,CAAEC,SAAS,KAGtB/rC,EAAK+nC,eAAiB/oC,EAAU6sC,cAAc,CAC1Ch4B,OAAM,CAAGnJ,EAAInC,KACKi/B,EAAekC,IAAIh/B,GAC3B+9B,WAAWlgC,IAErB+H,KAAI,gBAORtQ,EAAKysC,sBAAwBztC,EAAUitC,UAAU,CAC7Cp4B,OAAS41B,GAAQ8B,EAAImB,sBAAsBjD,GAC3C0C,aAAc,EACd77B,KAAI,0BACJw7B,MAAO,CAAEM,eAAe,KAE5BpsC,EAAK2sC,gBAAmBlD,IACpBzqC,EAAUgpC,aAAa,CAAChoC,EAAKysC,sBAAsBttC,QAAQsqC,kBCjB/Dl7B,EACAmN,EACAzb,EACAgvB,EACAyC,EACA2J,EACAr8B,EACAyC,GAEA,MAAMzB,EAAOtB,KAIP6S,EAAQ1P,SAASC,cAAc,OACrCyP,EAAMxP,aAAa,QAAS,sBAC5BwP,EAAM3C,UAAY,gBAClBnN,EAAOc,WAAW,mBAAoBgP,YC3CH9P,EAAQ8pC,GAC3C,MAAMqB,EAAiB/qC,SAASC,cAAc,UAE9C8qC,EAAeh+B,UAAY,YAC3Bg+B,EAAej+B,UAAY,UAE3Bi+B,EAAe/9B,QAAO,KAClB08B,EAAIsB,mBAGRprC,EAAOc,WAAW,WAAYqqC,GDmC9BE,CAAerrC,EAAQzB,GACvB,MAAMkvB,EAAY,IAAI6d,GAAmBtrC,EAAQzB,GAC3C2xB,EAAc,IAAIqb,GAA+BvrC,EAAQzB,GAIzDwnC,EAAiB,IAAIyF,GACrBjE,EAAqB,IAAIiE,GACzB5D,EAAuB,IAAI4D,GAE3BC,EAAS,CACXC,IAAK,IAAIC,GAAiB7+B,EAAQtO,GAClCotC,OAAQ,IAAID,GAAiB7+B,EAAQtO,GACrCqtC,OAAQ,IAAIF,GAAiB7+B,EAAQtO,IAEnCstC,EAAO,CACTJ,IAAK,IAAIK,GAAOj/B,EAAQ2+B,EAAOC,IAAKzxB,EAAMzb,EAASgvB,EAAaC,GAEhEme,OAAQ,IAAII,GAAUl/B,EAAQ2+B,EAAOG,OAAQ3xB,EAAMzb,EAASyxB,EAAiBC,GAC7E2b,OAAQ,IAAII,GAAUn/B,EAAQ2+B,EAAOI,OAAQ5xB,EAAMzb,EAASo7B,EAAanM,IAKvE+Z,EAAqB,IAAI0E,GAAmB3E,EAAoBhqC,EAAWgB,GAC3EspC,EAAuB,IAAIsE,GAAqBvE,EAAsBrqC,EAAWgB,GACjF0nC,EAAiB,IAAImG,GAAqBrG,EAAgBxoC,EAAWgB,GAE3EA,EAAKyrC,oBAAmB,KAEpB,MAAMhC,EAAMT,EAAmBS,MAAQ,EACvCR,EAAmBoD,oBAAoB5C,IAE3CzpC,EAAKksC,0BAA6BzC,SACvBT,EAAmBS,MAAQA,GAC9BzpC,EAAK8tC,aAAa,GAAI,GAAI,UAAU,IAI5C9tC,EAAK2rC,gCAA+B,KAChC,MAAMlC,EAAMJ,EAAqBI,MAAQ,EACzCH,EAAqBkD,sBAAsB/C,IAE/CzpC,EAAKusC,4BAA+B9C,SACzBJ,EAAqBI,MAAQA,GAChCzpC,EAAK+tC,yBAAyB,GAAI,GAAI,KAAK,IAInD/tC,EAAK8tC,aAAY,CAAIxhC,EAAGC,EAAGnM,EAAGqnC,KAE1B,MAAM7Z,EAAY,IAAIogB,GAAU1hC,EAAGC,EAAG,GAAI,GAAInM,EAAGmO,EAAQy6B,EAAoBhqC,EAAWiB,EAASwnC,EAAQwB,GACzGsE,EAAKJ,IAAI3d,gBAAgB5B,GACzB2f,EAAKD,OAAO9d,gBAAgB5B,GAE5B,MAAM6b,EAAMT,EAAmBS,MAC/BR,EAAmBoD,oBAAoB5C,IAE3CzpC,EAAK+tC,yBAAwB,CAAIzhC,EAAGC,EAAGhE,EAAGk/B,KAEtC,MAAMwG,EAAwB,IAAIC,GAAsB5hC,EAAGC,EAAGhE,EAAGgG,EAAQ86B,EAAsBrqC,EAAWiB,EAASwnC,EAAQ6B,GAC3HiE,EAAKF,OAAOxb,4BAA4Boc,GAExC,MAAMxE,EAAMJ,EAAqBI,MACjCH,EAAqBkD,sBAAsB/C,IAG/CzpC,EAAK6sC,gBAAe,KAChB,MAAMpD,EAAMjC,EAAeiC,MAAQ,EACnC/B,EAAeiF,gBAAgBlD,IAEnCzpC,EAAK0sC,sBAAyBjD,SACnBjC,EAAeiC,MAAQA,GAC1BzpC,EAAKmuC,eAAe,GAAI,GAAI,KAAK,IAIzCnuC,EAAKmuC,eAAc,CAAI7hC,EAAGC,EAAGhE,EAAGk/B,KAE5B,MAAMta,EAAc,IAAIihB,GAAY9hC,EAAGC,EAAGhE,EAAGgG,EAAQi5B,EAAgBxoC,EAAWiB,EAASwnC,EAAQC,GAEjG6F,EAAKJ,IAAIzd,kBAAkBvC,GAC3BogB,EAAKD,OAAO5d,kBAAkBvC,GAC9BogB,EAAKF,OAAO3d,kBAAkBvC,GAE9B,MAAMsc,EAAMjC,EAAeiC,MAC3B/B,EAAeiF,gBAAgBlD,IAGnCzpC,EAAK8tC,aAAa,GAAI,IAAK,QAAQ,GACnC9tC,EAAK8tC,aAAa,IAAK,GAAI,QAAQ,GACnC9tC,EAAK8tC,aAAa,IAAW,IAAU,QAAQ,GAC/C9tC,EAAK+tC,yBAAyB,IAAK,IAAK,KAAK,GAC7C/tC,EAAKmuC,eAAe,GAAI,IAAK,KAAK,GAClCnuC,EAAKmuC,eAAe,IAAK,IAAK,KAAK,GAInCnuC,EAAKiM,MAAQ,MAEbhM,EAAQC,IAAI,CAAC,YAEbF,EAAK2hB,OAAM,KAEH1hB,EAAQI,MAAM,CAAC,cAEfgB,OAAO8D,KAAKooC,GAAMluC,SAASsV,GAAM44B,EAAK54B,GAAGqa,SAEzCue,EAAKvtC,EAAKiM,OAAO8iB,SAIrBwe,EAAKvtC,EAAKiM,OAAO0V,UAErB3hB,EAAKutB,iBAAgB,KAAWggB,EAAKvtC,EAAKiM,OAAOshB,oBACjDvtB,EAAK4sB,OAAM,KAAW2gB,EAAKvtC,EAAKiM,OAAO2gB,UAMvC5sB,EAAKquC,SAAW,CACZ,CAAE/9B,KAAM,eAAgBxR,MAAO,MAAOmN,MAAO,IAC7C,CAAEqE,KAAM,mBAAoBxR,MAAO,SAAUmN,MAAO,IACpD,CAAEqE,KAAM,eAAgBxR,MAAO,SAAUmN,MAAO,KAEpDyP,EAAKtH,YACDpU,EACA,CACIuR,MAAO,cACPiC,KAAM,QACNC,QAAUiH,IAAQ1a,EAAKiM,MAAQyO,GAC/B1R,QAAShJ,EAAKquC,SACd36B,OAAQ,CAAC,yBE7KmBnF,EAAQmN,EAAM4yB,GAClD,MAAMtuC,EAAOtB,KAEbsB,EAAKygB,OAAS,GACdzgB,EAAKuuC,UAAY,GAEjBvuC,EAAKkyB,SAAW,WACZlyB,EAAKygB,OAAS,GAiFd+tB,EAAS/qC,UAAU,EAAG,EAAGgrC,EAAQ/sC,MAAO+sC,EAAQ9sC,SA7EpD3B,EAAKiyB,OAAS,SAAUF,EAAc2c,GAGlC,GAAI1uC,EAAKygB,OAAOhgB,OAAS,IAAM,OAAO,EAKtC,MAEMyZ,EAAc6X,EAAalV,iBAEjC,IAAK,IAAI3X,EAAI,EAAGA,EAJL,GAIaA,IAAK,CAEzB,IAAI2V,EACwC,iBAAxCyzB,EAAShyB,OAAOT,oBAChBhB,EAAK,EAC0C,eAAxCyzB,EAAShyB,OAAOT,sBACvBhB,EAAK,IAET,MAAM4B,EAAU,GAChB,IAAK,IAAI9H,EAAI,EAAGA,EAAIkG,EAAIlG,IAAK,CAEzB,MAAM8jB,EAAQiW,EAAiBld,QAAQjB,cAGvC9T,EAAQxd,KAAKw5B,GAIjB,MAAMkW,EAAUL,EAAS9xB,YAAYtC,EAAauC,GAElD,GAA4C,iBAAxC6xB,EAAShyB,OAAOT,oBAAwC,CACxD,MAAO+yB,OAACA,GAAWD,EAGbE,EAAW,CAAEviC,EAAGsiC,EAAOtiC,EAAGC,EAAGqiC,EAAOriC,GAC1CvM,EAAKygB,OAAOxhB,KAAK4vC,GACjB7uC,EAAKuuC,UAAUtvC,KAAK4vC,OACjB,CACH,MAAO5yB,WAACA,GAAe0yB,EAEjBG,EAAa,GACnBryB,EAAQpd,SAAO,CACVgvB,EAAK1Z,KACF,MAAMo6B,EAAY9yB,EAAWtH,GAC7B,IAAK,IAAIukB,EAAI,EAAGA,EAAI6V,EAAW7V,IAAK,CAChC,IAAI2V,EAGAA,EAFM,IAAN3V,EAEW,CAAE5sB,EAAG+hB,EAAI/hB,EAAGC,EAAG8hB,EAAI9hB,GAGnB,CACPD,EAAG+hB,EAAI/hB,GAAKhJ,KAAKsC,SAAW,IAAOkpC,EACnCviC,EAAG8hB,EAAI9hB,GAAKjJ,KAAKsC,SAAW,IAAOkpC,GAI3C9uC,EAAKygB,OAAOxhB,KAAK4vC,GACjB7uC,EAAKuuC,UAAUtvC,KAAK4vC,QAOxC,OAeAG,EADYR,EACMxuC,EAAKuuC,WACvBvuC,EAAKuuC,UAAY,GAhBV,GAIX,MAAME,EAAU5sC,SAASC,cAAc,UACvC2sC,EAAQ/sC,MAAQ6M,EAAO3M,OAAOF,MAC9B+sC,EAAQ9sC,OAAS4M,EAAO3M,OAAOD,OAC/B,MAAM6sC,EAAWC,EAAQxsC,WAAW,eA+B3B+sC,EAAahtC,EAAKye,GACvBze,EAAIiF,UAAY,OAChB,MAAM3G,EAAImgB,EAAOhgB,OACjB,IAAK,IAAIyE,EAAI,EAAGA,EAAI5E,EAAG4E,IAAK,CACxB,MAAMwV,EAAI+F,EAAOvb,GAEjBlD,EAAIiL,YACJjL,EAAI2V,IAAI+C,EAAEpO,EAAGoO,EAAEnO,EAAG,EAAG,EAAG,EAAIjJ,KAAKqJ,IACjC3K,EAAI6V,QA3BZ7X,EAAK4sB,OAAS,WACNre,EAAO/L,UACPxC,EAAKivC,iBAELjvC,EAAKkvC,gBAIblvC,EAAKkvC,aAAe,WAChB,MAAOltC,IAACA,GAAQuM,EAChBvM,EAAI+1B,UAAU0W,EAAS,EAAG,IAI9BzuC,EAAKivC,eAAiB,WAClB,MAAOjtC,IAACA,GAAQuM,EAChBygC,EAAahtC,EAAKhC,EAAKygB,SC1H/B,MAAM0uB,GAAI7rC,KAAKC,eAEC6rC,GAAOriC,GACnB,MAAM0f,EAAI1f,EAAEtM,OACN4uC,EAAO36B,MAAM,GAAGmD,OAetB,MAdoC,QAAhC9K,EAAE4Z,MAAM,EAAG,GAAG2oB,eACdviC,EAAIA,EAAE3H,QAAQ,IAAK,IAAIsB,MAAM,KAC7B2oC,EAAK,GAAK1oC,SAASoG,EAAE,GAAG4Z,MAA6B,MAAvB5Z,EAAE,GAAGuiC,cAAwB,EAAI,GAAI,IACnED,EAAK,GAAK1oC,SAASoG,EAAE,GAAI,IACzBsiC,EAAK,GAAK1oC,SAASoG,EAAE,GAAI,IACzBsiC,EAAK,GAAKtiC,EAAE,GAAK23B,WAAW33B,EAAE,KAAM,IAEzBA,EAAP0f,EAAI,EAAO9lB,SAAS4oC,OAAOxiC,EAAE,IAAMA,EAAE,GAAKA,EAAE,GAAKA,EAAE,GAAKA,EAAE,GAAKA,EAAE,IAAM0f,EAAI,EAAI8iB,OAAOxiC,EAAE,IAAMA,EAAE,GAAK,IAAK,IACrGpG,SAASoG,EAAE4Z,MAAM,GAAI,IAC9B0oB,EAAK,GAAMtiC,GAAK,GAAM,IACtBsiC,EAAK,GAAMtiC,GAAK,EAAK,IACrBsiC,EAAK,GAAS,IAAJtiC,EACVsiC,EAAK,GAAW,IAAN5iB,GAAiB,IAANA,EAAU0iB,IAAKpiC,GAAK,GAAM,KAAO,IAAO,KAAS,KAAQ,GAE3EsiC,WAGKG,GAAMxkB,EAAMqZ,EAAI3pB,EAAI,IAChCsQ,EAAOA,EAAKykB,OACZpL,EAAKA,EAAGoL,OAER/0B,EADUA,EAAI,GACF,EAAJA,EAASA,EACjB,MAAM1N,EAAIoiC,GAAOpkB,GACX7e,EAAIijC,GAAO/K,GAEjB,MAAc,MAAVA,EAAG,GACG,MAAiB,MAAVA,EAAG,GAAa,KAAO,MACjC8K,IAAIhjC,EAAE,GAAKa,EAAE,IAAM0N,EAAK1N,EAAE,OACzBmiC,IAAIhjC,EAAE,GAAKa,EAAE,IAAM0N,EAAK1N,EAAE,OAC1BmiC,IAAIhjC,EAAE,GAAKa,EAAE,IAAM0N,EAAK1N,EAAE,MAC3BA,EAAE,GAAK,GAAKb,EAAE,GAAK,EAAI,GAAE,IACxBa,EAAE,IAAK,GAAMb,EAAE,IAAK,EACdgjC,GAAiC,MAA5BhjC,EAAE,GAAKa,EAAE,IAAM0N,EAAK1N,EAAE,KAAe,IAC1Cb,EAAE,GAAK,EAAIa,EAAE,GAAKb,EAAE,QAG5B,KAAM,WAIR,UAHAa,EAAE,IAAK,GAAMb,EAAE,IAAK,EACdgjC,GAAiC,MAA5BhjC,EAAE,GAAKa,EAAE,IAAM0N,EAAK1N,EAAE,KAC3Bb,EAAE,IAAK,EAAKgjC,GAAS,IAAPhjC,EAAE,IAAYa,EAAE,IAAK,EAAKmiC,GAAS,IAAPniC,EAAE,IAAY,KAE/B,MAAhCmiC,IAAIhjC,EAAE,GAAKa,EAAE,IAAM0N,EAAK1N,EAAE,IACU,IAAhCmiC,IAAIhjC,EAAE,GAAKa,EAAE,IAAM0N,EAAK1N,EAAE,IAC3BmiC,IAAIhjC,EAAE,GAAKa,EAAE,IAAM0N,EAAK1N,EAAE,KAC9B0iC,SAAS,IAAI/oB,MAAM3Z,EAAE,IAAK,GAAMb,EAAE,IAAK,EAAK,EAAI,iBCxCnBa,EAAG2qB,GAClC,MAAMgY,EAAaC,GAAK5iC,EAAE,GAAIA,EAAE,IAC1B6iC,EAAUL,GAAM7X,EAAO,GAAIA,EAAO,GAAIgY,GACtCG,EAAcF,GAAK5iC,EAAE,GAAIA,EAAE,GAAKA,EAAE,IAExC,OADiBwiC,GAAMK,EAASlY,EAAO,GAAImY,YAItCF,GAAKG,EAAOC,GACjB,OAAOD,GAASA,EAAQC,eCPQzhC,EAAQmN,EAAM4yB,GAC9C,MAAMtuC,EAAOtB,KAEbsB,EAAKk9B,YAAW,CAAIH,EAAW9iB,KAC3Bja,EAAKiwC,uBAAuBlT,EAAW9iB,GACvCja,EAAKkwC,iBAAiBnT,EAAW9iB,GACjCja,EAAKmwC,qBAAqBpT,EAAW9iB,GACrCja,EAAKowC,gBAAgBn2B,GACrBja,EAAKqwC,uBAAuBp2B,GAC5Bja,EAAKswC,WAAWr2B,IAQhBja,EAAKiwC,uBAAG,SAAclT,EAAK9iB,GAC3B,MAAMwC,EAAAxC,EAAkB6C,iBACjByzB,eAACA,GAAmBxT,EAC3BnhB,EAAW0yB,EAAsB9xB,YAAA+zB,EAAc9zB,IAClD7B,eAAAA,GAAAgB,EAAAjB,MAIEV,EAAAkU,sBAAAvT,IAMC5a,EAAKkwC,iBAAW,SAAWnT,EAAa9iB,8BAS5Bu2B,mBAAAA,GAAAzT,EACN0T,EAAWD,EAAyBl2B,KAAOiiB,GAAKA,EAAAjiB,KAAAJ,GAAAo0B,EAAA9xB,YAAAtC,EAAAuC,SAKpCA,EAAQnC,KAAA+T,GAAAA,EAAAnB,OAAAjlB,QAEjByoC,EAAAD,EAAAn2B,KAAAiiB,GAAAA,EAAAjiB,KAAAq0B,oCAKZ,OADwBS,GAAoBuB,GAAA/1B,EAAAg2B,SAMzC7T,EAAgBtB,WAAAoV,WAAAH,IAGR1wC,EAAAmwC,qBAAmC,CAAApT,EAAA9iB,KAK9C,MAAAwC,EAAAxC,EAAA6C,iBACIg0B,sBAA6BA,GAAM/T,EACpC/8B,EAA8B+wC,kBAAAD,EAAAx2B,KAAAJ,GAAAo0B,EAAA9xB,YAAAtC,EAAAuC,wBAGtBxC,OAEsC,iBAA1Cq0B,EAAMhyB,OAAQT,oBAAwC7b,EAAA68B,aAAA78B,EAAA+wC,kBAAAz2B,KAAAq0B,GAAAA,EAAAC,OAAA1hB,OAAAjlB,YACtD,OAGQ2oC,EADO32B,EAAC6C,gBACIxC,KAAW+T,GAASA,EAAGnB,OAAUjlB,UAC7C40B,aAAe78B,EAAG+wC,kBAAuBz2B,KAAGq0B,0BACtCn5B,EAAKyG,EAAGxB,QAAA,CAAAC,EAAAta,IAAAsa,EAAAta,IAOsB,OAFnDuwC,GAHY10B,EAAA3B,KAAAhO,GAAAA,EAAAkJ,IAGZo7B,UAOGN,WAAM,SAAiBr2B,WAEbA,EAAgB6C,uBACtBk0B,EAASt8B,MAASu8B,GAAap5B,KAAA,MACJ,mBAAvByE,OAAUT,oBAAa,CAC1B7b,EAAA+wC,kBAAAz2B,KAAAq0B,GAAAA,EAAAzyB,UAIc7c,SAAA6c,IACF80B,EAAS90B,IAAM,UAMhClc,EAAW+wC,kBAAiB1xC,SAASsvC,IACxC,MAAA1yB,WAAAA,GAAA0yB,EAIE,IAAA,IAAAzpC,EAAA,EAAAA,EAAA+rC,EAAA/rC,IAAA8rC,EAAA9rC,IAAA+W,EAAA/W,QAGYspB,iBAACwiB,MAGRX,uBAAcp2B,MACd6iB,YAAY98B,EAAA+wC,kBAAAz2B,KAAAq0B,IACf,MAAA/zB,eAAAA,GAAA+zB,EAAAh0B,kBACJV,EAAA6C,gBACJxC,KAAA+T,GAAAA,EAAAnB,OAAAjlB,yBC9H8BipC,GAC3B,MAEMC,EAAa,GACbC,EAAY,GAHL1yC,KAqBV6D,WAAA,CAAA+N,EAAA+gC,KAECH,EAAM3wC,SAAS+P,GAAS6gC,EAAa7gC,GAAM+gC,EACtCD,EAAUnyC,KAAIoyC,IAxBV3yC,KA+BL4yC,cAAO,KACX,MAACxlC,EAAAjK,SAAAC,cAAA,cACDovC,EAAM7xC,SAAOiR,IAChB,MAAA+gC,EAAAF,EAAA7gC,QACJrH,IAAAooC,GAAAvlC,EAAApD,YAAA2oC,wDCpCmC9iC,EAAQmN,EAAM4yB,GACjC5vC,KAERqxB,cAAgB,SAAUX,EAAWnV,GAMtC,MAAMU,EAAQ2zB,EAAS3xB,UAAUyS,EAAWnV,GAC5CA,EAAWkU,sBAAsBxT,EAAMC,6BCGb22B,GAC9B,MAAMvxC,EAAOtB,KAGP8yC,EAAU,GAChB,IAAIC,GAAO,EAEXzxC,EAAK0xC,aAAY,KACbF,EAAQ7wC,OAAO,EAAG6wC,EAAQ/wC,QAC1BgxC,GAAO,GAIX,MAAMphC,EAAS,GAGTshC,EAAU,GAEVC,EAAe,GAErBL,EAAaxyC,aAAaiB,GAkBtBA,EAAC+T,UAAa,CAAIzD,EAAMuD,EAAAs4B,EAAAL,UAEpB7iC,IADJ6iC,GACQA,EAAEM,gBAAMwF,EAAEthC,IAAY,GAG9BqhC,EAAKrhC,GAAUuD,EACfxD,EAAMC,GAAO67B,yBAAqC77B,KAAAA,EAAAuD,OAAAA,EAAAs4B,aAAAA,EAAAL,MAAAA,GAAA7mC,uBAClD,MAAM9F,EAAWL,IAAU,QACrBA,MAASA,QAAEgtC,IAmBlB,MAXA,CAEC3sC,QAAYA,EACZmpC,GAVOxpC,GAAMkB,EAAA4T,GAAAzU,EAAAL,sBA0BM,CAAAwR,EAAAuD,UAAEA,WAKrB7T,EAAC6rC,cAAA5mC,IACD,MAAMqL,KAAAA,EAAeuD,OAAMA,EAAYi4B,MAAQA,GAAA7mC,uBAC/C,MAAM9F,EAAU,CAAAuL,EAAA5L,EAAAqtC,KAAA,MACZ77B,EAAS5F,GAAEA,kBACdyhC,aAAAA,IAqBJ,MANkB,CACXhtC,QAAQA,KATb,CAAAuL,EAAA5L,EAAAqtC,IAAAnsC,EAAA4T,GAAAzU,EAAAuL,EAAA5L,EAAAqtC,oBAGwB,CAAAzhC,EAAIyhC,KACvB97B,EAAMC,GAAA5F,GAAAyhC,GAQN9D,gBANoB39B,GAAG2F,EAAAC,GAAA5F,KAmB3B,MAAAmnC,EAAa1yC,IAChB,MAAAmR,KAAAA,EAAA5F,GAAAA,EAAA5L,MAAAA,GAAAK,EAQE0U,EAAA89B,EAAArhC,GAECuD,SAEsD5K,IAAAyB,GAClDmJ,EAAAnJ,EAAY5L,GACVuR,EAAKC,GAAS5F,GAChB5L,IAK6B+U,EAAA/U,GAC3BuR,EAAAC,GAAexR,KAMrBkB,EAAA4T,GAAQzU,IAERoyC,EAAyBryC,YAAAC,EAAAa,iBACVP,0BAAQA,EAAAO,IASxBA,EAAAT,OAAAJ,IAEC,MAAMmR,KAAAA,EAAe5F,GAACA,EAAAohC,MAAAA,GAAA3sC,MAGlBgtC,oBAEsDhtC,EAAAgtC,mBAEpD2F,EAAS,MAGPxhC,EAGJ5F,GAAiCA,EACjC5L,MAAMqtC,aAELxrC,OAAA8wC,EAAA,EAAAD,EAAA/wC,QAAAgxC,EAAA,MAGDxyC,KAAA,YAAyC6yC,YAAAA,KAI7CL,GAAC,EAGDI,EAAkE1yC,IAMrEa,EAAAN,eAAAD,IAEmF,MAAAsyC,EAAA,GACpFtyC,EAAMJ,SAAeF,IACgB,MAAUmR,KAAAA,EAAA5F,GAAAA,EAAAohC,MAAAA,GAAA3sC,EAK3C,IAAMgtC,EACkBA,OAAVljC,IAATyB,EAAmB2F,EAAAC,GAAcnR,EAAWgtC,aAE7C,MAA+B2F,EAAA,QAEyCpnC,GAAAA,EACrE5L,MAAAqtC,EACHL,MAAWA,GAGfiG,EAAM9yC,KAAc,CAChBE,QAAYA,EAC4C2yC,YAAAA,IAGxDD,EAAO1yC,MAKXqyC,EAAQ7wC,OAAK8wC,EAAQ,EAAAD,EAAY/wC,QAAuBgxC,EAAA,IAGxDD,EAAKvyC,KAAO8yC,aAKZC,EAAOl/B,YAAC,IAAO,MAD6D,MAG5Em/B,KAAI,KACJ,IAAa,IAATR,EAAS,OACb,MAAMS,EAAAV,EAAWC,GACjBS,EAAI7yC,SAAS8yC,IACTN,EAAwDM,EAAAL,mBAExD,EAGP,MAAAA,YAAAA,GAAAI,EAAA,GAEG,QAAwBjpC,IAAvB6oC,EAAchG,MAAe,OAC9B,IAAiC,IAAjCgG,EAAahG,MAAAC,QAAoB,OACpC,IAAA,IAAA0F,EAAA,OAEsBD,EAASC,GAAM,GACYK,YAAAxhC,OAAAwhC,EAAAxhC,OAGjDqtB,aAAAqU,GAEIA,EAAAl/B,WAAsB9S,EAAAiyC,KAxBqD,QA2B5EG,KAAM,QACFX,IAA+DD,EAAA/wC,OAAA,EAAA,aAC/D4xC,EAAMb,EAASC,EAAA,KACfpyC,SAAI8yC,GAAaN,EAAKM,EAAIhzC,cAO0C,QAI5DA,QAAuCA,GAAAkzC,EAAA,WAC1BppC,MAAb6iC,MAAiB,WAAK,YAAJC,QAAI,gBAAItrC,OAAA,EAAA,SAAOgxC,EAAA,GAAA,GAAEtyC,QAAAmR,OAAAnR,EAAAmR,oBAGnC0hC,KACEl/B,WAAQ9S,EAAAoyC,KA9CsD,yBA+CrCzyC,oBAAAC,EAAAI,qBAElCJ,IAERI,EAAAsyC,mBAAA1yC,EAAA,QAEGI,EAACsyC,mBAAgB1yC,EAAc,QAEnCI,EAACsyC,mBAAA,CAAA1yC,EAAA2yC,KAEgDlxC,OAAA8D,KAAAvF,GAC7CP,SAASiR,IAER,MAAAkiC,OAAAvpC,IAAA2oC,EAAAthC,GACJ,GAAA,QAAAiiC,GAAAC,EAAA,OAEI,GAAkB,SAAlBD,IAAiCC,EAAO,OAChD,MAAAC,EAAA7yC,EAAA0Q,qPChT2C7O,EAAQzC,EAAW0zC,GAC3D,MAAMhkC,EAAS7M,SAASC,cAAc,UACtC4M,EAAOC,UAAY,UACnBD,EAAOE,UAAY,YAEnB,MAAM+jC,EAAU9wC,SAASC,cAAc,UACvC6wC,EAAQhkC,UAAY,UACpBgkC,EAAQ/jC,UAAY,yBAEpB,MAAM2K,EAAO1X,SAASC,cAAc,qBAU3B8wC,IACL,MAAMviC,EAASrR,EAAU6zC,YACnBC,EAAgBvjC,mBAAmBgrB,KAAKE,UAAUpqB,IAIxD,MADU,cAIV,MAAM0iC,EAAKlxC,SAASmxC,SAASxjC,KAAK9I,MAAM,KAClCusC,EAAKF,EAAGpsB,MAAM,EAAGosB,EAAGtyC,OAAS,GAEnC,OADewyC,EAAGC,KAAK,KAREC,MAEWT,OAAgBI,IAbxDpkC,EAAOG,QAAO,KACV,MAAMukC,EAAOR,IACbr5B,EAAKza,MAAQs0C,GAEjBT,EAAQ9jC,QAAO,KACX,MAAMukC,EAAOR,IACbS,UAAUC,UAAUC,UAAUH,IAiBlC,MAAM9wC,EAAWT,SAASC,cAAc,OAElCuvC,EAAMxvC,SAASC,cAAc,OACnCuvC,EAAI3oC,YAAYgG,GAChB2iC,EAAI3oC,YAAYiqC,GAChBtB,EAAI3oC,YAAYpG,GAChB+uC,EAAI3oC,YAAY6Q,GAEhB9X,EAAOc,WAAW,mBAAoB8uC,eC3BVhhC,EAAQkhC,EAAcmB,GAElD,MAAMzyC,EAAU,IAAIuzC,EAEd/xC,EAAS,IAAIgyC,GAAO,CACtB,OACA,mBACA,WACA,eACA,2BACA,OACA,OACA,WACA,SACA,aACA,UACA,mBACA,mBACA,iBACA,aAGEz0C,EAAY,IAAI00C,GAAUnC,GAE1B71B,EAAO,IAAIi4B,EAAK1zC,EAASwB,EAAQzC,aCvCXyC,EAAQzC,GACpC,MAAM40C,EAAa/xC,SAASC,cAAc,UACpC+xC,EAAahyC,SAASC,cAAc,UAE1C8xC,EAAWjlC,UAAY,UACvBklC,EAAWllC,UAAY,UAEvBilC,EAAWhlC,UAAY,OACvBilC,EAAWjlC,UAAY,OAEvBglC,EAAW/kC,QAAU7P,EAAUizC,KAC/B4B,EAAWhlC,QAAU7P,EAAUozC,KAE/B3wC,EAAOc,WAAW,OAAQqxC,GAC1BnyC,EAAOc,WAAW,OAAQsxC,GD2B1BC,CAAQryC,EAAQzC,GAEhB+0C,GAAoBtyC,EAAQzC,EAAW0zC,YE3CCjxC,EAAQzC,GAChD,MAAM0P,EAAS7M,SAASC,cAAc,UAEtC4M,EAAOC,UAAY,UAEnBD,EAAOE,UAAY,sBAEnB,MAAM2K,EAAO1X,SAASC,cAAc,YAEpC4M,EAAOG,QAAO,KACV,MAAMwB,EAASrR,EAAU6zC,YACzBt5B,EAAKza,MAAQy7B,KAAKE,UAAUpqB,IAGhC,MAAM/N,EAAWT,SAASC,cAAc,OAElCuvC,EAAMxvC,SAASC,cAAc,OACnCuvC,EAAI3oC,YAAYgG,GAChB2iC,EAAI3oC,YAAYpG,GAChB+uC,EAAI3oC,YAAY6Q,GAEhB9X,EAAOc,WAAW,mBAAoB8uC,GFwBtC2C,CAAoBvyC,EAAQzC,YG7CUyC,EAAQzC,GAC9C,MAAM0P,EAAS7M,SAASC,cAAc,UAEtC4M,EAAOC,UAAY,UAEnBD,EAAOE,UAAY,mBAEnB,MAAM2K,EAAO1X,SAASC,cAAc,YAEpC4M,EAAOG,QAAO,KACV,GAAmB,KAAf0K,EAAKza,MAAc,OACvB,MAAMuR,EAASkqB,KAAKC,MAAMjhB,EAAKza,OAC/BE,EAAUi1C,WAAW5jC,IAGzB,MAAM/N,EAAWT,SAASC,cAAc,OAElCuvC,EAAMxvC,SAASC,cAAc,OACnCuvC,EAAI3oC,YAAYgG,GAChB2iC,EAAI3oC,YAAYpG,GAChB+uC,EAAI3oC,YAAY6Q,GAEhB9X,EAAOc,WAAW,iBAAkB8uC,GHyBpC6C,CAAkBzyC,EAAQzC,GAE1B,MAAMuP,EAAS,IAAI4lC,EAAO,IAAK,IAAK1yC,GAEpC2yC,EAAa7lC,cAsCTA,EAAO7N,QACP6qC,EAAI3e,SACJ2e,EAAIhe,qBAxCmB9rB,GAE3B,MAAM6sC,EAAW,IAAI+F,EAAS34B,GAExBuT,EAAc,IAAIqlB,GAAY/lC,EAAQmN,EAAM4yB,GAE5C5c,EAAkB,IAAI6iB,GAAgBhmC,EAAQmN,EAAM4yB,GAEpDjT,EAAc,IAAImZ,GAAYjmC,EAAQmN,EAAM4yB,GAG5C/C,EAAM,IAAIkJ,GAAIlmC,EAAQmN,EAAMzb,EAASgvB,EAAayC,EAAiB2J,EAAar8B,EAAWyC,GAEjGzC,EAAUi1C,WAAW5jC,GACrBrR,EAAU0yC,eAEV,MAAML,EAAM5vC,EAAO6vC,gBAInB,OAFAruC,OAAOyxC,gCAIEC,IAOLpJ,EAAI5pB,SAIJpT,EAAO7K,kBACP6nC,EAAIhe,mBATJtqB,OAAOyxC,sBAAsBC,MAL1BtD,EIrEkB38B,MAAAsW,KAAAnpB,SAAA+yC,uBAAA,YACAv1C,SAAQ0rC,IACjC,MAAyE8J,OAA3B5rC,IAA5B8hC,EAAIH,QAAav6B,OAAsCkqB,KAAAC,MAAAuQ,EAAAH,QAAAv6B,QAAA,GAEnEykC,aCNN,MAAMC,EAAY,IAAIC,gBAAgB/xC,OAAO+vC,SAASiC,QAEhDC,EAAMH,EAAUI,IAAI,KAI1B,MAAO,KAAED,SAFMA,EAAM3a,KAAKC,MAAMua,EAAUrL,IAAI,MAAQ,IDEhD0L,GAEA/kC,EAAAykC,EAAAI,IAAgBJ,EAAAzkC,OAAcwkC,EAG9BnC,OAF4CzpC,IAA/B8hC,EAAAH,QAAgByK,WAEVtK,EAAAH,QAAAyK,WAAA,GAEnBhE,EAAMiE,GAAoBjlC,EADpB,IAAAklC,EACoB7C,GACzB3H,EAAe5/B,WACzBzC,YAAA2oC","sources":["src/ui/ComMessenger.js","src/ui/Changes.js","src/ui/EventHandlers.js","src/ui/Screen.js","lib/canvas2svg.esm.js","src/ui/addSVGOutput.js","src/menu/Button.js","src/menu/ButtonGroup.js","src/menu/MenuItem.js","src/menu/Menu.js","src/castVotes/AreaSummer.js","src/castVotes/castVotes.js","src/castVotes/pluralityBallot.js","src/electionMethods/electionMethods.js","src/electionMethods/plurality.js","src/electionMethods/randomWinner.js","src/electionMethods/huntingtonHill.js","src/election/ElectionMethod.js","src/election/Election.js","lib/d3-delaunay.esm.js","src/voters/VoronoiGroup.js","src/voters/SimVoter.js","src/voters/OneVoterCircle.js","src/candidates/SimCandidate.js","src/candidates/SimCandidateList.js","src/voters/SimVoterList.js","src/sim/states/SimBase.js","src/sim/states/SimOne.js","src/election/CandidateDistributionSampler.js","src/candidates/SimCandidateDistributionList.js","src/candidates/SimCandidateDistribution.js","src/voters/SampleVoterCircle.js","src/sim/states/SimSample.js","src/voters/GeoVoterBasis.js","lib/simplex-noise/simplex-noise.ts","src/voters/geoNoise.js","src/voters/NoiseImage.js","lib/d3-polygon/src/area.js","lib/d3-polygon/src/centroid.js","src/voters/lloydVoronoi.js","src/utilities/graphicsUtilities.js","lib/polygonClip.js","src/utilities/jsHelpers.js","src/voters/geoCensus.js","src/voters/DistrictMaker.js","src/voters/GeoVoters.js","src/sim/states/SimGeoOne.js","../node_modules/process/browser.js","lib/tween.esm.js","src/voters/CircleGraphic.js","src/voters/VoterCircle.js","src/candidates/SquareGraphic.js","src/candidates/Candidate.js","src/candidates/CandidateDistribution.js","src/sim/Registrar.js","src/ui/DraggableManager.js","src/ui/CreateAddCandidate.js","src/ui/CreateAddCandidateDistribution.js","src/candidates/CandidateCommander.js","src/candidates/CandidateDnCommander.js","src/voters/VoterCircleCommander.js","src/sim/Sim.js","src/ui/createAddVoter.js","src/election/SampleElections.js","lib/colorBlendScript.js","src/election/colorBlend.js","src/election/GeoElection.js","src/ui/Layout.js","src/election/OneElection.js","src/ui/Commander.js","src/ui/addSaveConfigToLink.js","src/ui/sandbox.js","src/ui/addUndo.js","src/ui/addSaveConfigToText.js","src/ui/loadConfigText.js","src/ui/addSandboxes.js","src/ui/checkURL.js"],"sourcesContent":["/** @module */\r\n\r\n/** Connect two sandboxes by passing messages between their commanders. */\r\nexport default class ComMessenger {\r\n    /** Make sure broadcasted commands don't trigger broadcasts */\r\n    #protect = false\r\n\r\n    constructor() {\r\n        this.linked = true\r\n        this.commanders = []\r\n        this.#protect = false\r\n    }\r\n\r\n    setLinked(value) {\r\n        this.linked = value\r\n    }\r\n\r\n    addCommander(commander) {\r\n        this.commanders.push(commander)\r\n    }\r\n\r\n    broadcastDo(command, originCommander) {\r\n        if (this.linked && this.#protect === false) {\r\n            this.#protect = true\r\n            this.commanders.forEach((com) => com.passDo(command))\r\n            this.#protect = false\r\n        } else {\r\n            originCommander.passDo(command)\r\n        }\r\n    }\r\n\r\n    broadcastDoCommands(commands, originCommander) {\r\n        if (this.linked && this.#protect === false) {\r\n            this.#protect = true\r\n            this.commanders.forEach(\r\n                (com) => com.passDoCommands(commands),\r\n            )\r\n            this.#protect = false\r\n        } else {\r\n            originCommander.passDoCommands(commands)\r\n        }\r\n    }\r\n\r\n    broadcastLoadConfig(newConfig, originCommander) {\r\n        if (this.linked && this.#protect === false) {\r\n            this.#protect = true\r\n            this.commanders.forEach(\r\n                (com) => com.passLoadConfig(newConfig),\r\n            )\r\n            this.#protect = false\r\n        } else {\r\n            originCommander.passLoadConfig(newConfig)\r\n        }\r\n    }\r\n\r\n    broadCastLoadCommands(commands, originCommander) {\r\n        if (this.linked && this.#protect === false) {\r\n            this.#protect = true\r\n            this.commanders.forEach(\r\n                (com) => com.passLoadCommands(commands),\r\n            )\r\n            this.#protect = false\r\n        } else {\r\n            originCommander.passLoadCommands(commands)\r\n        }\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * keep track of changes that occur to a simulation's configuration.\r\n * @constructor\r\n */\r\nexport default function Changes() {\r\n    const self = this\r\n\r\n    const changes = ['init']\r\n\r\n    self.add = (changeList) => {\r\n        changeList.forEach(\r\n            (c) => changes.push(c),\r\n        )\r\n    }\r\n    self.check = (changeList) => {\r\n        let n = 0\r\n        changeList.forEach(\r\n            (c) => { n += changes.includes(c) ? 1 : 0 },\r\n        )\r\n        return n > 0\r\n    }\r\n    self.checkNone = () => (changes.length === 0)\r\n    self.clear = () => {\r\n        changes.splice(0, changes.length)\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Set event handlers for a screen.foreground.\r\n * We want to set the handlers once for the canvas,\r\n * and use this class to change the functions that the handlers call.\r\n * Then allow sims to set the functions called by the handlers.\r\n * @constructor\r\n */\r\nexport default function EventHandlers() {\r\n    const self = this\r\n\r\n    // Event Handlers - well, at least they handle the event handlers//\r\n    self.handlers = {\r\n        start: () => {},\r\n        move: () => {},\r\n        end: () => {},\r\n        touchmove: () => {},\r\n        touchstart: () => {},\r\n        touchend: () => {},\r\n    }\r\n\r\n    // overwrite event handlers\r\n    self.set = (eHandlers) => {\r\n        Object.assign(self.handlers, eHandlers)\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport EventHandlers from './EventHandlers.js'\r\n\r\n/**\r\n * Set up a screen to view some objects.\r\n * A detail here is that we have browser pixels and device pixels.\r\n * Broswer pixels feel about the same size on any device (visual arc length).\r\n * Device pixels can be much smaller for high-dpi devices.\r\n * @param {Number} w - width in browser pixels of the canvas.\r\n * @param {Number} h - height in browser pixels of the canvas.\r\n * @param {Layout} layout\r\n * @constructor\r\n */\r\nexport default function Screen(w, h, layout) {\r\n    const self = this\r\n\r\n    self.width = w // measured in browser pixels\r\n    self.height = h\r\n\r\n    // canvas\r\n    self.canvas = document.createElement('canvas')\r\n    self.canvas.setAttribute('class', 'background')\r\n    self.ctx = self.canvas.getContext('2d')\r\n\r\n    // foreground\r\n    self.foreground = document.createElement('canvas')\r\n    self.foreground.setAttribute('class', 'foreground')\r\n    self.fctx = self.foreground.getContext('2d')\r\n\r\n    // geoMaps\r\n    self.geoMaps = document.createElement('canvas')\r\n    self.geoMaps.setAttribute('class', 'geoMaps')\r\n    self.gctx = self.geoMaps.getContext('2d')\r\n\r\n    const clearDiv = document.createElement('div')\r\n    layout.newElement('clearDiv', clearDiv)\r\n    layout.newElement('screen', self.canvas)\r\n    layout.newElement('foreground', self.foreground)\r\n    layout.newElement('geoMaps', self.geoMaps)\r\n\r\n    self.noBuffers = false\r\n\r\n    // use scaling for high DPI devices instead of multiplying every time inside draw calls\r\n    // https://www.html5rocks.com/en/tutorials/canvas/hidpi/\r\n    self.pixelRatio = getPixelRatio(self.ctx)\r\n\r\n    self.canvas.width = w * self.pixelRatio // measured in device pixels\r\n    self.canvas.height = h * self.pixelRatio\r\n\r\n    self.canvas.style.width = `${w}px`\r\n    self.canvas.style.height = `${h}px`\r\n\r\n    self.foreground.width = w * self.pixelRatio // measured in device pixels\r\n    self.foreground.height = h * self.pixelRatio\r\n\r\n    self.foreground.style.width = `${w}px`\r\n    self.foreground.style.height = `${h}px`\r\n\r\n    const h3 = Math.round(h / 3)\r\n    self.geoMaps.width = w * self.pixelRatio // measured in device pixels\r\n    self.geoMaps.height = h3 * self.pixelRatio\r\n\r\n    self.geoMaps.style.width = `${w}px`\r\n    self.geoMaps.style.height = `${h3}px`\r\n\r\n    self.ctx.scale(self.pixelRatio, self.pixelRatio)\r\n    self.fctx.scale(self.pixelRatio, self.pixelRatio)\r\n    self.gctx.scale(self.pixelRatio, self.pixelRatio)\r\n\r\n    self.clear = function () {\r\n        self.ctx.clearRect(0, 0, self.canvas.width, self.canvas.height)\r\n    }\r\n    self.clearForeground = function () {\r\n        self.fctx.clearRect(0, 0, self.canvas.width, self.canvas.height)\r\n    }\r\n    self.setCtx = function (c) {\r\n        self.ctx = c\r\n    }\r\n    self.setFCtx = function (c) {\r\n        self.fctx = c\r\n    }\r\n    self.setGCtx = function (c) {\r\n        self.gctx = c\r\n    }\r\n    self.setNoBuffers = function (noBuffers) {\r\n        self.noBuffers = noBuffers\r\n    }\r\n    self.showGeoMaps = () => {\r\n        self.geoMaps.style.display = 'block'\r\n    }\r\n    self.hideGeoMaps = () => {\r\n        self.geoMaps.style.display = 'none'\r\n    }\r\n\r\n    self.eventHandlers = new EventHandlers()\r\n    const { handlers } = self.eventHandlers\r\n\r\n    self.foreground.onmousedown = (e) => handlers.start(e)\r\n    self.foreground.onmousemove = (e) => handlers.move(e)\r\n    self.foreground.onmouseup = (e) => handlers.end(e)\r\n    self.foreground.addEventListener('touchmove', (e) => handlers.touchmove(e))\r\n    self.foreground.addEventListener('touchstart', (e) => handlers.touchstart(e))\r\n    self.foreground.addEventListener('touchend', (e) => handlers.touchend(e))\r\n\r\n    // mouse up outside of canvas\r\n    const current = document.onmouseup\r\n    document.onmouseup = () => {\r\n        if (current) current()\r\n        self.foreground.onmouseup()\r\n    }\r\n}\r\n\r\nfunction getPixelRatio(context) {\r\n    const backingStore = context.backingStorePixelRatio\r\n          || context.webkitBackingStorePixelRatio\r\n          || context.mozBackingStorePixelRatio\r\n          || context.msBackingStorePixelRatio\r\n          || context.oBackingStorePixelRatio\r\n          || context.backingStorePixelRatio || 1\r\n\r\n    return (window.devicePixelRatio || 1) / backingStore\r\n}\r\n","/*!!\r\n *  Canvas 2 Svg v1.0.19\r\n *  A low level canvas to SVG converter. Uses a mock canvas context to build an SVG document.\r\n *\r\n *  Licensed under the MIT license:\r\n *  http://www.opensource.org/licenses/mit-license.php\r\n *\r\n *  Author:\r\n *  Kerry Liu\r\n *\r\n *  Copyright (c) 2014 Gliffy Inc.\r\n */\r\n\r\n// Altered to make into an ES2015 module.\r\n\r\nvar STYLES, ctx, CanvasGradient, CanvasPattern, namedEntities;\r\n\r\n//helper function to format a string\r\nfunction format(str, args) {\r\n    var keys = Object.keys(args), i;\r\n    for (i=0; i<keys.length; i++) {\r\n        str = str.replace(new RegExp(\"\\\\{\" + keys[i] + \"\\\\}\", \"gi\"), args[keys[i]]);\r\n    }\r\n    return str;\r\n}\r\n\r\n//helper function that generates a random string\r\nfunction randomString(holder) {\r\n    var chars, randomstring, i;\r\n    if (!holder) {\r\n        throw new Error(\"cannot create a random attribute name for an undefined object\");\r\n    }\r\n    chars = \"ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz\";\r\n    randomstring = \"\";\r\n    do {\r\n        randomstring = \"\";\r\n        for (i = 0; i < 12; i++) {\r\n            randomstring += chars[Math.floor(Math.random() * chars.length)];\r\n        }\r\n    } while (holder[randomstring]);\r\n    return randomstring;\r\n}\r\n\r\n//helper function to map named to numbered entities\r\nfunction createNamedToNumberedLookup(items, radix) {\r\n    var i, entity, lookup = {}, base10, base16;\r\n    items = items.split(',');\r\n    radix = radix || 10;\r\n    // Map from named to numbered entities.\r\n    for (i = 0; i < items.length; i += 2) {\r\n        entity = '&' + items[i + 1] + ';';\r\n        base10 = parseInt(items[i], radix);\r\n        lookup[entity] = '&#'+base10+';';\r\n    }\r\n    //FF and IE need to create a regex from hex values ie &nbsp; == \\xa0\r\n    lookup[\"\\\\xa0\"] = '&#160;';\r\n    return lookup;\r\n}\r\n\r\n//helper function to map canvas-textAlign to svg-textAnchor\r\nfunction getTextAnchor(textAlign) {\r\n    //TODO: support rtl languages\r\n    var mapping = {\"left\":\"start\", \"right\":\"end\", \"center\":\"middle\", \"start\":\"start\", \"end\":\"end\"};\r\n    return mapping[textAlign] || mapping.start;\r\n}\r\n\r\n//helper function to map canvas-textBaseline to svg-dominantBaseline\r\nfunction getDominantBaseline(textBaseline) {\r\n    //INFO: not supported in all browsers\r\n    var mapping = {\"alphabetic\": \"alphabetic\", \"hanging\": \"hanging\", \"top\":\"text-before-edge\", \"bottom\":\"text-after-edge\", \"middle\":\"central\"};\r\n    return mapping[textBaseline] || mapping.alphabetic;\r\n}\r\n\r\n// Unpack entities lookup where the numbers are in radix 32 to reduce the size\r\n// entity mapping courtesy of tinymce\r\nnamedEntities = createNamedToNumberedLookup(\r\n    '50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,' +\r\n        '5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,' +\r\n        '5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,' +\r\n        '5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,' +\r\n        '68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,' +\r\n        '6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,' +\r\n        '6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,' +\r\n        '75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,' +\r\n        '7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,' +\r\n        '7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,' +\r\n        'sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,' +\r\n        'st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,' +\r\n        't9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,' +\r\n        'tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,' +\r\n        'u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,' +\r\n        '81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,' +\r\n        '8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,' +\r\n        '8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,' +\r\n        '8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,' +\r\n        '8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,' +\r\n        'nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,' +\r\n        'rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,' +\r\n        'Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,' +\r\n        '80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,' +\r\n        '811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro', 32);\r\n\r\n\r\n//Some basic mappings for attributes and default values.\r\nSTYLES = {\r\n    \"strokeStyle\":{\r\n        svgAttr : \"stroke\", //corresponding svg attribute\r\n        canvas : \"#000000\", //canvas default\r\n        svg : \"none\",       //svg default\r\n        apply : \"stroke\"    //apply on stroke() or fill()\r\n    },\r\n    \"fillStyle\":{\r\n        svgAttr : \"fill\",\r\n        canvas : \"#000000\",\r\n        svg : null, //svg default is black, but we need to special case this to handle canvas stroke without fill\r\n        apply : \"fill\"\r\n    },\r\n    \"lineCap\":{\r\n        svgAttr : \"stroke-linecap\",\r\n        canvas : \"butt\",\r\n        svg : \"butt\",\r\n        apply : \"stroke\"\r\n    },\r\n    \"lineJoin\":{\r\n        svgAttr : \"stroke-linejoin\",\r\n        canvas : \"miter\",\r\n        svg : \"miter\",\r\n        apply : \"stroke\"\r\n    },\r\n    \"miterLimit\":{\r\n        svgAttr : \"stroke-miterlimit\",\r\n        canvas : 10,\r\n        svg : 4,\r\n        apply : \"stroke\"\r\n    },\r\n    \"lineWidth\":{\r\n        svgAttr : \"stroke-width\",\r\n        canvas : 1,\r\n        svg : 1,\r\n        apply : \"stroke\"\r\n    },\r\n    \"globalAlpha\": {\r\n        svgAttr : \"opacity\",\r\n        canvas : 1,\r\n        svg : 1,\r\n        apply :  \"fill stroke\"\r\n    },\r\n    \"font\":{\r\n        //font converts to multiple svg attributes, there is custom logic for this\r\n        canvas : \"10px sans-serif\"\r\n    },\r\n    \"shadowColor\":{\r\n        canvas : \"#000000\"\r\n    },\r\n    \"shadowOffsetX\":{\r\n        canvas : 0\r\n    },\r\n    \"shadowOffsetY\":{\r\n        canvas : 0\r\n    },\r\n    \"shadowBlur\":{\r\n        canvas : 0\r\n    },\r\n    \"textAlign\":{\r\n        canvas : \"start\"\r\n    },\r\n    \"textBaseline\":{\r\n        canvas : \"alphabetic\"\r\n    },\r\n    \"lineDash\" : {\r\n        svgAttr : \"stroke-dasharray\",\r\n        canvas : [],\r\n        svg : null,\r\n        apply : \"stroke\"\r\n    }\r\n};\r\n\r\n/**\r\n *\r\n * @param gradientNode - reference to the gradient\r\n * @constructor\r\n */\r\nCanvasGradient = function (gradientNode, ctx) {\r\n    this.__root = gradientNode;\r\n    this.__ctx = ctx;\r\n};\r\n\r\n/**\r\n * Adds a color stop to the gradient root\r\n */\r\nCanvasGradient.prototype.addColorStop = function (offset, color) {\r\n    var stop = this.__ctx.__createElement(\"stop\"), regex, matches;\r\n    stop.setAttribute(\"offset\", offset);\r\n    if (color.indexOf(\"rgba\") !== -1) {\r\n        //separate alpha value, since webkit can't handle it\r\n        regex = /rgba\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d?\\.?\\d*)\\s*\\)/gi;\r\n        matches = regex.exec(color);\r\n        stop.setAttribute(\"stop-color\", format(\"rgb({r},{g},{b})\", {r:matches[1], g:matches[2], b:matches[3]}));\r\n        stop.setAttribute(\"stop-opacity\", matches[4]);\r\n    } else {\r\n        stop.setAttribute(\"stop-color\", color);\r\n    }\r\n    this.__root.appendChild(stop);\r\n};\r\n\r\nCanvasPattern = function (pattern, ctx) {\r\n    this.__root = pattern;\r\n    this.__ctx = ctx;\r\n};\r\n\r\n/**\r\n * The mock canvas context\r\n * @param o - options include:\r\n * ctx - existing Context2D to wrap around\r\n * width - width of your canvas (defaults to 500)\r\n * height - height of your canvas (defaults to 500)\r\n * enableMirroring - enables canvas mirroring (get image data) (defaults to false)\r\n * document - the document object (defaults to the current document)\r\n */\r\nctx = function (o) {\r\n    var defaultOptions = { width:500, height:500, enableMirroring : false}, options;\r\n\r\n    //keep support for this way of calling C2S: new C2S(width,height)\r\n    if (arguments.length > 1) {\r\n        options = defaultOptions;\r\n        options.width = arguments[0];\r\n        options.height = arguments[1];\r\n    } else if ( !o ) {\r\n        options = defaultOptions;\r\n    } else {\r\n        options = o;\r\n    }\r\n\r\n    if (!(this instanceof ctx)) {\r\n        //did someone call this without new?\r\n        return new ctx(options);\r\n    }\r\n\r\n    //setup options\r\n    this.width = options.width || defaultOptions.width;\r\n    this.height = options.height || defaultOptions.height;\r\n    this.enableMirroring = options.enableMirroring !== undefined ? options.enableMirroring : defaultOptions.enableMirroring;\r\n\r\n    this.canvas = this;   ///point back to this instance!\r\n    this.__document = options.document || document;\r\n\r\n    // allow passing in an existing context to wrap around\r\n    // if a context is passed in, we know a canvas already exist\r\n    if (options.ctx) {\r\n        this.__ctx = options.ctx;\r\n    } else {\r\n        this.__canvas = this.__document.createElement(\"canvas\");\r\n        this.__ctx = this.__canvas.getContext(\"2d\");\r\n    }\r\n\r\n    this.__setDefaultStyles();\r\n    this.__stack = [this.__getStyleState()];\r\n    this.__groupStack = [];\r\n\r\n    //the root svg element\r\n    this.__root = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\r\n    this.__root.setAttribute(\"version\", 1.1);\r\n    this.__root.setAttribute(\"xmlns\", \"http://www.w3.org/2000/svg\");\r\n    this.__root.setAttributeNS(\"http://www.w3.org/2000/xmlns/\", \"xmlns:xlink\", \"http://www.w3.org/1999/xlink\");\r\n    this.__root.setAttribute(\"width\", this.width);\r\n    this.__root.setAttribute(\"height\", this.height);\r\n\r\n    //make sure we don't generate the same ids in defs\r\n    this.__ids = {};\r\n\r\n    //defs tag\r\n    this.__defs = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"defs\");\r\n    this.__root.appendChild(this.__defs);\r\n\r\n    //also add a group child. the svg element can't use the transform attribute\r\n    this.__currentElement = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\");\r\n    this.__root.appendChild(this.__currentElement);\r\n};\r\n\r\n\r\n/**\r\n * Creates the specified svg element\r\n * @private\r\n */\r\nctx.prototype.__createElement = function (elementName, properties, resetFill) {\r\n    if (typeof properties === \"undefined\") {\r\n        properties = {};\r\n    }\r\n\r\n    var element = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", elementName),\r\n        keys = Object.keys(properties), i, key;\r\n    if (resetFill) {\r\n        //if fill or stroke is not specified, the svg element should not display. By default SVG's fill is black.\r\n        element.setAttribute(\"fill\", \"none\");\r\n        element.setAttribute(\"stroke\", \"none\");\r\n    }\r\n    for (i=0; i<keys.length; i++) {\r\n        key = keys[i];\r\n        element.setAttribute(key, properties[key]);\r\n    }\r\n    return element;\r\n};\r\n\r\n/**\r\n * Applies default canvas styles to the context\r\n * @private\r\n */\r\nctx.prototype.__setDefaultStyles = function () {\r\n    //default 2d canvas context properties see:http://www.w3.org/TR/2dcontext/\r\n    var keys = Object.keys(STYLES), i, key;\r\n    for (i=0; i<keys.length; i++) {\r\n        key = keys[i];\r\n        this[key] = STYLES[key].canvas;\r\n    }\r\n};\r\n\r\n/**\r\n * Applies styles on restore\r\n * @param styleState\r\n * @private\r\n */\r\nctx.prototype.__applyStyleState = function (styleState) {\r\n    var keys = Object.keys(styleState), i, key;\r\n    for (i=0; i<keys.length; i++) {\r\n        key = keys[i];\r\n        this[key] = styleState[key];\r\n    }\r\n};\r\n\r\n/**\r\n * Gets the current style state\r\n * @return {Object}\r\n * @private\r\n */\r\nctx.prototype.__getStyleState = function () {\r\n    var i, styleState = {}, keys = Object.keys(STYLES), key;\r\n    for (i=0; i<keys.length; i++) {\r\n        key = keys[i];\r\n        styleState[key] = this[key];\r\n    }\r\n    return styleState;\r\n};\r\n\r\n/**\r\n * Apples the current styles to the current SVG element. On \"ctx.fill\" or \"ctx.stroke\"\r\n * @param type\r\n * @private\r\n */\r\nctx.prototype.__applyStyleToCurrentElement = function (type) {\r\n    var currentElement = this.__currentElement;\r\n    var currentStyleGroup = this.__currentElementsToStyle;\r\n    if (currentStyleGroup) {\r\n        currentElement.setAttribute(type, \"\");\r\n        currentElement = currentStyleGroup.element;\r\n        currentStyleGroup.children.forEach(function (node) {\r\n            node.setAttribute(type, \"\");\r\n        })\r\n    }\r\n\r\n    var keys = Object.keys(STYLES), i, style, value, id, regex, matches;\r\n    for (i = 0; i < keys.length; i++) {\r\n        style = STYLES[keys[i]];\r\n        value = this[keys[i]];\r\n        if (style.apply) {\r\n            //is this a gradient or pattern?\r\n            if (value instanceof CanvasPattern) {\r\n                //pattern\r\n                if (value.__ctx) {\r\n                    //copy over defs\r\n                    while(value.__ctx.__defs.childNodes.length) {\r\n                        id = value.__ctx.__defs.childNodes[0].getAttribute(\"id\");\r\n                        this.__ids[id] = id;\r\n                        this.__defs.appendChild(value.__ctx.__defs.childNodes[0]);\r\n                    }\r\n                }\r\n                currentElement.setAttribute(style.apply, format(\"url(#{id})\", {id:value.__root.getAttribute(\"id\")}));\r\n            }\r\n            else if (value instanceof CanvasGradient) {\r\n                //gradient\r\n                currentElement.setAttribute(style.apply, format(\"url(#{id})\", {id:value.__root.getAttribute(\"id\")}));\r\n            } else if (style.apply.indexOf(type)!==-1 && style.svg !== value) {\r\n                if ((style.svgAttr === \"stroke\" || style.svgAttr === \"fill\") && value.indexOf(\"rgba\") !== -1) {\r\n                    //separate alpha value, since illustrator can't handle it\r\n                    regex = /rgba\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d?\\.?\\d*)\\s*\\)/gi;\r\n                    matches = regex.exec(value);\r\n                    currentElement.setAttribute(style.svgAttr, format(\"rgb({r},{g},{b})\", {r:matches[1], g:matches[2], b:matches[3]}));\r\n                    //should take globalAlpha here\r\n                    var opacity = matches[4];\r\n                    var globalAlpha = this.globalAlpha;\r\n                    if (globalAlpha != null) {\r\n                        opacity *= globalAlpha;\r\n                    }\r\n                    currentElement.setAttribute(style.svgAttr+\"-opacity\", opacity);\r\n                } else {\r\n                    var attr = style.svgAttr;\r\n                    if (keys[i] === 'globalAlpha') {\r\n                        attr = type+'-'+style.svgAttr;\r\n                        if (currentElement.getAttribute(attr)) {\r\n                                //fill-opacity or stroke-opacity has already been set by stroke or fill.\r\n                            continue;\r\n                        }\r\n                    }\r\n                    //otherwise only update attribute if right type, and not svg default\r\n                    currentElement.setAttribute(attr, value);\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * Will return the closest group or svg node. May return the current element.\r\n * @private\r\n */\r\nctx.prototype.__closestGroupOrSvg = function (node) {\r\n    node = node || this.__currentElement;\r\n    if (node.nodeName === \"g\" || node.nodeName === \"svg\") {\r\n        return node;\r\n    } else {\r\n        return this.__closestGroupOrSvg(node.parentNode);\r\n    }\r\n};\r\n\r\n/**\r\n * Returns the serialized value of the svg so far\r\n * @param fixNamedEntities - Standalone SVG doesn't support named entities, which document.createTextNode encodes.\r\n *                           If true, we attempt to find all named entities and encode it as a numeric entity.\r\n * @return serialized svg\r\n */\r\nctx.prototype.getSerializedSvg = function (fixNamedEntities) {\r\n    var serialized = new XMLSerializer().serializeToString(this.__root),\r\n        keys, i, key, value, regexp, xmlns;\r\n\r\n    //IE search for a duplicate xmnls because they didn't implement setAttributeNS correctly\r\n    xmlns = /xmlns=\"http:\\/\\/www\\.w3\\.org\\/2000\\/svg\".+xmlns=\"http:\\/\\/www\\.w3\\.org\\/2000\\/svg/gi;\r\n    if (xmlns.test(serialized)) {\r\n        serialized = serialized.replace('xmlns=\"http://www.w3.org/2000/svg','xmlns:xlink=\"http://www.w3.org/1999/xlink');\r\n    }\r\n\r\n    if (fixNamedEntities) {\r\n        keys = Object.keys(namedEntities);\r\n        //loop over each named entity and replace with the proper equivalent.\r\n        for (i=0; i<keys.length; i++) {\r\n            key = keys[i];\r\n            value = namedEntities[key];\r\n            regexp = new RegExp(key, \"gi\");\r\n            if (regexp.test(serialized)) {\r\n                serialized = serialized.replace(regexp, value);\r\n            }\r\n        }\r\n    }\r\n\r\n    return serialized;\r\n};\r\n\r\n\r\n/**\r\n * Returns the root svg\r\n * @return\r\n */\r\nctx.prototype.getSvg = function () {\r\n    return this.__root;\r\n};\r\n/**\r\n * Will generate a group tag.\r\n */\r\nctx.prototype.save = function () {\r\n    var group = this.__createElement(\"g\");\r\n    var parent = this.__closestGroupOrSvg();\r\n    this.__groupStack.push(parent);\r\n    parent.appendChild(group);\r\n    this.__currentElement = group;\r\n    this.__stack.push(this.__getStyleState());\r\n};\r\n/**\r\n * Sets current element to parent, or just root if already root\r\n */\r\nctx.prototype.restore = function () {\r\n    this.__currentElement = this.__groupStack.pop();\r\n    this.__currentElementsToStyle = null;\r\n    //Clearing canvas will make the poped group invalid, currentElement is set to the root group node.\r\n    if (!this.__currentElement) {\r\n        this.__currentElement = this.__root.childNodes[1];\r\n    }\r\n    var state = this.__stack.pop();\r\n    this.__applyStyleState(state);\r\n};\r\n\r\n/**\r\n * Helper method to add transform\r\n * @private\r\n */\r\nctx.prototype.__addTransform = function (t) {\r\n    //if the current element has siblings, add another group\r\n    var parent = this.__closestGroupOrSvg();\r\n    if (parent.childNodes.length > 0) {\r\n        if (this.__currentElement.nodeName === \"path\") {\r\n            if (!this.__currentElementsToStyle) this.__currentElementsToStyle = {element: parent, children: []};\r\n            this.__currentElementsToStyle.children.push(this.__currentElement)\r\n            this.__applyCurrentDefaultPath();\r\n        }\r\n\r\n        var group = this.__createElement(\"g\");\r\n        parent.appendChild(group);\r\n        this.__currentElement = group;\r\n    }\r\n\r\n    var transform = this.__currentElement.getAttribute(\"transform\");\r\n    if (transform) {\r\n        transform += \" \";\r\n    } else {\r\n        transform = \"\";\r\n    }\r\n    transform += t;\r\n    this.__currentElement.setAttribute(\"transform\", transform);\r\n};\r\n\r\n/**\r\n *  scales the current element\r\n */\r\nctx.prototype.scale = function (x, y) {\r\n    if (y === undefined) {\r\n        y = x;\r\n    }\r\n    this.__addTransform(format(\"scale({x},{y})\", {x:x, y:y}));\r\n};\r\n\r\n/**\r\n * rotates the current element\r\n */\r\nctx.prototype.rotate = function (angle) {\r\n    var degrees = (angle * 180 / Math.PI);\r\n    this.__addTransform(format(\"rotate({angle},{cx},{cy})\", {angle:degrees, cx:0, cy:0}));\r\n};\r\n\r\n/**\r\n * translates the current element\r\n */\r\nctx.prototype.translate = function (x, y) {\r\n    this.__addTransform(format(\"translate({x},{y})\", {x:x,y:y}));\r\n};\r\n\r\n/**\r\n * applies a transform to the current element\r\n */\r\nctx.prototype.transform = function (a, b, c, d, e, f) {\r\n    this.__addTransform(format(\"matrix({a},{b},{c},{d},{e},{f})\", {a:a, b:b, c:c, d:d, e:e, f:f}));\r\n};\r\n\r\n/**\r\n * Create a new Path Element\r\n */\r\nctx.prototype.beginPath = function () {\r\n    var path, parent;\r\n\r\n    // Note that there is only one current default path, it is not part of the drawing state.\r\n    // See also: https://html.spec.whatwg.org/multipage/scripting.html#current-default-path\r\n    this.__currentDefaultPath = \"\";\r\n    this.__currentPosition = {};\r\n\r\n    path = this.__createElement(\"path\", {}, true);\r\n    parent = this.__closestGroupOrSvg();\r\n    parent.appendChild(path);\r\n    this.__currentElement = path;\r\n};\r\n\r\n/**\r\n * Helper function to apply currentDefaultPath to current path element\r\n * @private\r\n */\r\nctx.prototype.__applyCurrentDefaultPath = function () {\r\n    var currentElement = this.__currentElement;\r\n    if (currentElement.nodeName === \"path\") {\r\n        currentElement.setAttribute(\"d\", this.__currentDefaultPath);\r\n    } else {\r\n        console.error(\"Attempted to apply path command to node\", currentElement.nodeName);\r\n    }\r\n};\r\n\r\n/**\r\n * Helper function to add path command\r\n * @private\r\n */\r\nctx.prototype.__addPathCommand = function (command) {\r\n    this.__currentDefaultPath += \" \";\r\n    this.__currentDefaultPath += command;\r\n};\r\n\r\n/**\r\n * Adds the move command to the current path element,\r\n * if the currentPathElement is not empty create a new path element\r\n */\r\nctx.prototype.moveTo = function (x,y) {\r\n    if (this.__currentElement.nodeName !== \"path\") {\r\n        this.beginPath();\r\n    }\r\n\r\n    // creates a new subpath with the given point\r\n    this.__currentPosition = {x: x, y: y};\r\n    this.__addPathCommand(format(\"M {x} {y}\", {x:x, y:y}));\r\n};\r\n\r\n/**\r\n * Closes the current path\r\n */\r\nctx.prototype.closePath = function () {\r\n    if (this.__currentDefaultPath) {\r\n        this.__addPathCommand(\"Z\");\r\n    }\r\n};\r\n\r\n/**\r\n * Adds a line to command\r\n */\r\nctx.prototype.lineTo = function (x, y) {\r\n    this.__currentPosition = {x: x, y: y};\r\n    if (this.__currentDefaultPath.indexOf('M') > -1) {\r\n        this.__addPathCommand(format(\"L {x} {y}\", {x:x, y:y}));\r\n    } else {\r\n        this.__addPathCommand(format(\"M {x} {y}\", {x:x, y:y}));\r\n    }\r\n};\r\n\r\n/**\r\n * Add a bezier command\r\n */\r\nctx.prototype.bezierCurveTo = function (cp1x, cp1y, cp2x, cp2y, x, y) {\r\n    this.__currentPosition = {x: x, y: y};\r\n    this.__addPathCommand(format(\"C {cp1x} {cp1y} {cp2x} {cp2y} {x} {y}\",\r\n        {cp1x:cp1x, cp1y:cp1y, cp2x:cp2x, cp2y:cp2y, x:x, y:y}));\r\n};\r\n\r\n/**\r\n * Adds a quadratic curve to command\r\n */\r\nctx.prototype.quadraticCurveTo = function (cpx, cpy, x, y) {\r\n    this.__currentPosition = {x: x, y: y};\r\n    this.__addPathCommand(format(\"Q {cpx} {cpy} {x} {y}\", {cpx:cpx, cpy:cpy, x:x, y:y}));\r\n};\r\n\r\n\r\n/**\r\n * Return a new normalized vector of given vector\r\n */\r\nvar normalize = function (vector) {\r\n    var len = Math.sqrt(vector[0] * vector[0] + vector[1] * vector[1]);\r\n    return [vector[0] / len, vector[1] / len];\r\n};\r\n\r\n/**\r\n * Adds the arcTo to the current path\r\n *\r\n * @see http://www.w3.org/TR/2015/WD-2dcontext-20150514/#dom-context-2d-arcto\r\n */\r\nctx.prototype.arcTo = function (x1, y1, x2, y2, radius) {\r\n    // Let the point (x0, y0) be the last point in the subpath.\r\n    var x0 = this.__currentPosition && this.__currentPosition.x;\r\n    var y0 = this.__currentPosition && this.__currentPosition.y;\r\n\r\n    // First ensure there is a subpath for (x1, y1).\r\n    if (typeof x0 == \"undefined\" || typeof y0 == \"undefined\") {\r\n        return;\r\n    }\r\n\r\n    // Negative values for radius must cause the implementation to throw an IndexSizeError exception.\r\n    if (radius < 0) {\r\n        throw new Error(\"IndexSizeError: The radius provided (\" + radius + \") is negative.\");\r\n    }\r\n\r\n    // If the point (x0, y0) is equal to the point (x1, y1),\r\n    // or if the point (x1, y1) is equal to the point (x2, y2),\r\n    // or if the radius radius is zero,\r\n    // then the method must add the point (x1, y1) to the subpath,\r\n    // and connect that point to the previous point (x0, y0) by a straight line.\r\n    if (((x0 === x1) && (y0 === y1))\r\n        || ((x1 === x2) && (y1 === y2))\r\n        || (radius === 0)) {\r\n        this.lineTo(x1, y1);\r\n        return;\r\n    }\r\n\r\n    // Otherwise, if the points (x0, y0), (x1, y1), and (x2, y2) all lie on a single straight line,\r\n    // then the method must add the point (x1, y1) to the subpath,\r\n    // and connect that point to the previous point (x0, y0) by a straight line.\r\n    var unit_vec_p1_p0 = normalize([x0 - x1, y0 - y1]);\r\n    var unit_vec_p1_p2 = normalize([x2 - x1, y2 - y1]);\r\n    if (unit_vec_p1_p0[0] * unit_vec_p1_p2[1] === unit_vec_p1_p0[1] * unit_vec_p1_p2[0]) {\r\n        this.lineTo(x1, y1);\r\n        return;\r\n    }\r\n\r\n    // Otherwise, let The Arc be the shortest arc given by circumference of the circle that has radius radius,\r\n    // and that has one point tangent to the half-infinite line that crosses the point (x0, y0) and ends at the point (x1, y1),\r\n    // and that has a different point tangent to the half-infinite line that ends at the point (x1, y1), and crosses the point (x2, y2).\r\n    // The points at which this circle touches these two lines are called the start and end tangent points respectively.\r\n\r\n    // note that both vectors are unit vectors, so the length is 1\r\n    var cos = (unit_vec_p1_p0[0] * unit_vec_p1_p2[0] + unit_vec_p1_p0[1] * unit_vec_p1_p2[1]);\r\n    var theta = Math.acos(Math.abs(cos));\r\n\r\n    // Calculate origin\r\n    var unit_vec_p1_origin = normalize([\r\n        unit_vec_p1_p0[0] + unit_vec_p1_p2[0],\r\n        unit_vec_p1_p0[1] + unit_vec_p1_p2[1]\r\n    ]);\r\n    var len_p1_origin = radius / Math.sin(theta / 2);\r\n    var x = x1 + len_p1_origin * unit_vec_p1_origin[0];\r\n    var y = y1 + len_p1_origin * unit_vec_p1_origin[1];\r\n\r\n    // Calculate start angle and end angle\r\n    // rotate 90deg clockwise (note that y axis points to its down)\r\n    var unit_vec_origin_start_tangent = [\r\n        -unit_vec_p1_p0[1],\r\n        unit_vec_p1_p0[0]\r\n    ];\r\n    // rotate 90deg counter clockwise (note that y axis points to its down)\r\n    var unit_vec_origin_end_tangent = [\r\n        unit_vec_p1_p2[1],\r\n        -unit_vec_p1_p2[0]\r\n    ];\r\n    var getAngle = function (vector) {\r\n        // get angle (clockwise) between vector and (1, 0)\r\n        var x = vector[0];\r\n        var y = vector[1];\r\n        if (y >= 0) { // note that y axis points to its down\r\n            return Math.acos(x);\r\n        } else {\r\n            return -Math.acos(x);\r\n        }\r\n    };\r\n    var startAngle = getAngle(unit_vec_origin_start_tangent);\r\n    var endAngle = getAngle(unit_vec_origin_end_tangent);\r\n\r\n    // Connect the point (x0, y0) to the start tangent point by a straight line\r\n    this.lineTo(x + unit_vec_origin_start_tangent[0] * radius,\r\n                y + unit_vec_origin_start_tangent[1] * radius);\r\n\r\n    // Connect the start tangent point to the end tangent point by arc\r\n    // and adding the end tangent point to the subpath.\r\n    this.arc(x, y, radius, startAngle, endAngle);\r\n};\r\n\r\n/**\r\n * Sets the stroke property on the current element\r\n */\r\nctx.prototype.stroke = function () {\r\n    if (this.__currentElement.nodeName === \"path\") {\r\n        this.__currentElement.setAttribute(\"paint-order\", \"fill stroke markers\");\r\n    }\r\n    this.__applyCurrentDefaultPath();\r\n    this.__applyStyleToCurrentElement(\"stroke\");\r\n};\r\n\r\n/**\r\n * Sets fill properties on the current element\r\n */\r\nctx.prototype.fill = function () {\r\n    if (this.__currentElement.nodeName === \"path\") {\r\n        this.__currentElement.setAttribute(\"paint-order\", \"stroke fill markers\");\r\n    }\r\n    this.__applyCurrentDefaultPath();\r\n    this.__applyStyleToCurrentElement(\"fill\");\r\n};\r\n\r\n/**\r\n *  Adds a rectangle to the path.\r\n */\r\nctx.prototype.rect = function (x, y, width, height) {\r\n    if (this.__currentElement.nodeName !== \"path\") {\r\n        this.beginPath();\r\n    }\r\n    this.moveTo(x, y);\r\n    this.lineTo(x+width, y);\r\n    this.lineTo(x+width, y+height);\r\n    this.lineTo(x, y+height);\r\n    this.lineTo(x, y);\r\n    this.closePath();\r\n};\r\n\r\n\r\n/**\r\n * adds a rectangle element\r\n */\r\nctx.prototype.fillRect = function (x, y, width, height) {\r\n    var rect, parent;\r\n    rect = this.__createElement(\"rect\", {\r\n        x : x,\r\n        y : y,\r\n        width : width,\r\n        height : height\r\n    }, true);\r\n    parent = this.__closestGroupOrSvg();\r\n    parent.appendChild(rect);\r\n    this.__currentElement = rect;\r\n    this.__applyStyleToCurrentElement(\"fill\");\r\n};\r\n\r\n/**\r\n * Draws a rectangle with no fill\r\n * @param x\r\n * @param y\r\n * @param width\r\n * @param height\r\n */\r\nctx.prototype.strokeRect = function (x, y, width, height) {\r\n    var rect, parent;\r\n    rect = this.__createElement(\"rect\", {\r\n        x : x,\r\n        y : y,\r\n        width : width,\r\n        height : height\r\n    }, true);\r\n    parent = this.__closestGroupOrSvg();\r\n    parent.appendChild(rect);\r\n    this.__currentElement = rect;\r\n    this.__applyStyleToCurrentElement(\"stroke\");\r\n};\r\n\r\n\r\n/**\r\n * Clear entire canvas:\r\n * 1. save current transforms\r\n * 2. remove all the childNodes of the root g element\r\n */\r\nctx.prototype.__clearCanvas = function () {\r\n    var current = this.__closestGroupOrSvg(),\r\n        transform = current.getAttribute(\"transform\");\r\n    var rootGroup = this.__root.childNodes[1];\r\n    var childNodes = rootGroup.childNodes;\r\n    for (var i = childNodes.length - 1; i >= 0; i--) {\r\n        if (childNodes[i]) {\r\n            rootGroup.removeChild(childNodes[i]);\r\n        }\r\n    }\r\n    this.__currentElement = rootGroup;\r\n    //reset __groupStack as all the child group nodes are all removed.\r\n    this.__groupStack = [];\r\n    if (transform) {\r\n        this.__addTransform(transform);\r\n    }\r\n};\r\n\r\n/**\r\n * \"Clears\" a canvas by just drawing a white rectangle in the current group.\r\n */\r\nctx.prototype.clearRect = function (x, y, width, height) {\r\n    //clear entire canvas\r\n    if (x === 0 && y === 0 && width === this.width && height === this.height) {\r\n        this.__clearCanvas();\r\n        return;\r\n    }\r\n    var rect, parent = this.__closestGroupOrSvg();\r\n    rect = this.__createElement(\"rect\", {\r\n        x : x,\r\n        y : y,\r\n        width : width,\r\n        height : height,\r\n        fill : \"#FFFFFF\"\r\n    }, true);\r\n    parent.appendChild(rect);\r\n};\r\n\r\n/**\r\n * Adds a linear gradient to a defs tag.\r\n * Returns a canvas gradient object that has a reference to it's parent def\r\n */\r\nctx.prototype.createLinearGradient = function (x1, y1, x2, y2) {\r\n    var grad = this.__createElement(\"linearGradient\", {\r\n        id : randomString(this.__ids),\r\n        x1 : x1+\"px\",\r\n        x2 : x2+\"px\",\r\n        y1 : y1+\"px\",\r\n        y2 : y2+\"px\",\r\n        \"gradientUnits\" : \"userSpaceOnUse\"\r\n    }, false);\r\n    this.__defs.appendChild(grad);\r\n    return new CanvasGradient(grad, this);\r\n};\r\n\r\n/**\r\n * Adds a radial gradient to a defs tag.\r\n * Returns a canvas gradient object that has a reference to it's parent def\r\n */\r\nctx.prototype.createRadialGradient = function (x0, y0, r0, x1, y1, r1) {\r\n    var grad = this.__createElement(\"radialGradient\", {\r\n        id : randomString(this.__ids),\r\n        cx : x1+\"px\",\r\n        cy : y1+\"px\",\r\n        r  : r1+\"px\",\r\n        fx : x0+\"px\",\r\n        fy : y0+\"px\",\r\n        \"gradientUnits\" : \"userSpaceOnUse\"\r\n    }, false);\r\n    this.__defs.appendChild(grad);\r\n    return new CanvasGradient(grad, this);\r\n\r\n};\r\n\r\n/**\r\n * Parses the font string and returns svg mapping\r\n * @private\r\n */\r\nctx.prototype.__parseFont = function () {\r\n    var regex = /^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))(?:\\s*\\/\\s*(normal|[.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])))?\\s*([-,\\'\\\"\\sa-z0-9]+?)\\s*$/i;\r\n    var fontPart = regex.exec( this.font );\r\n    var data = {\r\n        style : fontPart[1] || 'normal',\r\n        size : fontPart[4] || '10px',\r\n        family : fontPart[6] || 'sans-serif',\r\n        weight: fontPart[3] || 'normal',\r\n        decoration : fontPart[2] || 'normal',\r\n        href : null\r\n    };\r\n\r\n    //canvas doesn't support underline natively, but we can pass this attribute\r\n    if (this.__fontUnderline === \"underline\") {\r\n        data.decoration = \"underline\";\r\n    }\r\n\r\n    //canvas also doesn't support linking, but we can pass this as well\r\n    if (this.__fontHref) {\r\n        data.href = this.__fontHref;\r\n    }\r\n\r\n    return data;\r\n};\r\n\r\n/**\r\n * Helper to link text fragments\r\n * @param font\r\n * @param element\r\n * @return {*}\r\n * @private\r\n */\r\nctx.prototype.__wrapTextLink = function (font, element) {\r\n    if (font.href) {\r\n        var a = this.__createElement(\"a\");\r\n        a.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"xlink:href\", font.href);\r\n        a.appendChild(element);\r\n        return a;\r\n    }\r\n    return element;\r\n};\r\n\r\n/**\r\n * Fills or strokes text\r\n * @param text\r\n * @param x\r\n * @param y\r\n * @param action - stroke or fill\r\n * @private\r\n */\r\nctx.prototype.__applyText = function (text, x, y, action) {\r\n    var font = this.__parseFont(),\r\n        parent = this.__closestGroupOrSvg(),\r\n        textElement = this.__createElement(\"text\", {\r\n            \"font-family\" : font.family,\r\n            \"font-size\" : font.size,\r\n            \"font-style\" : font.style,\r\n            \"font-weight\" : font.weight,\r\n            \"text-decoration\" : font.decoration,\r\n            \"x\" : x,\r\n            \"y\" : y,\r\n            \"text-anchor\": getTextAnchor(this.textAlign),\r\n            \"dominant-baseline\": getDominantBaseline(this.textBaseline)\r\n        }, true);\r\n\r\n    textElement.appendChild(this.__document.createTextNode(text));\r\n    this.__currentElement = textElement;\r\n    this.__applyStyleToCurrentElement(action);\r\n    parent.appendChild(this.__wrapTextLink(font,textElement));\r\n};\r\n\r\n/**\r\n * Creates a text element\r\n * @param text\r\n * @param x\r\n * @param y\r\n */\r\nctx.prototype.fillText = function (text, x, y) {\r\n    this.__applyText(text, x, y, \"fill\");\r\n};\r\n\r\n/**\r\n * Strokes text\r\n * @param text\r\n * @param x\r\n * @param y\r\n */\r\nctx.prototype.strokeText = function (text, x, y) {\r\n    this.__applyText(text, x, y, \"stroke\");\r\n};\r\n\r\n/**\r\n * No need to implement this for svg.\r\n * @param text\r\n * @return {TextMetrics}\r\n */\r\nctx.prototype.measureText = function (text) {\r\n    this.__ctx.font = this.font;\r\n    return this.__ctx.measureText(text);\r\n};\r\n\r\n/**\r\n *  Arc command!\r\n */\r\nctx.prototype.arc = function (x, y, radius, startAngle, endAngle, counterClockwise) {\r\n    // in canvas no circle is drawn if no angle is provided.\r\n    if (startAngle === endAngle) {\r\n        return;\r\n    }\r\n    startAngle = startAngle % (2*Math.PI);\r\n    endAngle = endAngle % (2*Math.PI);\r\n    if (startAngle === endAngle) {\r\n        //circle time! subtract some of the angle so svg is happy (svg elliptical arc can't draw a full circle)\r\n        endAngle = ((endAngle + (2*Math.PI)) - 0.001 * (counterClockwise ? -1 : 1)) % (2*Math.PI);\r\n    }\r\n    var endX = x+radius*Math.cos(endAngle),\r\n        endY = y+radius*Math.sin(endAngle),\r\n        startX = x+radius*Math.cos(startAngle),\r\n        startY = y+radius*Math.sin(startAngle),\r\n        sweepFlag = counterClockwise ? 0 : 1,\r\n        largeArcFlag = 0,\r\n        diff = endAngle - startAngle;\r\n\r\n    // https://github.com/gliffy/canvas2svg/issues/4\r\n    if (diff < 0) {\r\n        diff += 2*Math.PI;\r\n    }\r\n\r\n    if (counterClockwise) {\r\n        largeArcFlag = diff > Math.PI ? 0 : 1;\r\n    } else {\r\n        largeArcFlag = diff > Math.PI ? 1 : 0;\r\n    }\r\n\r\n    this.lineTo(startX, startY);\r\n    this.__addPathCommand(format(\"A {rx} {ry} {xAxisRotation} {largeArcFlag} {sweepFlag} {endX} {endY}\",\r\n        {rx:radius, ry:radius, xAxisRotation:0, largeArcFlag:largeArcFlag, sweepFlag:sweepFlag, endX:endX, endY:endY}));\r\n\r\n    this.__currentPosition = {x: endX, y: endY};\r\n};\r\n\r\n/**\r\n * Generates a ClipPath from the clip command.\r\n */\r\nctx.prototype.clip = function () {\r\n    var group = this.__closestGroupOrSvg(),\r\n        clipPath = this.__createElement(\"clipPath\"),\r\n        id =  randomString(this.__ids),\r\n        newGroup = this.__createElement(\"g\");\r\n\r\n    this.__applyCurrentDefaultPath();\r\n    group.removeChild(this.__currentElement);\r\n    clipPath.setAttribute(\"id\", id);\r\n    clipPath.appendChild(this.__currentElement);\r\n\r\n    this.__defs.appendChild(clipPath);\r\n\r\n    //set the clip path to this group\r\n    group.setAttribute(\"clip-path\", format(\"url(#{id})\", {id:id}));\r\n\r\n    //clip paths can be scaled and transformed, we need to add another wrapper group to avoid later transformations\r\n    // to this path\r\n    group.appendChild(newGroup);\r\n\r\n    this.__currentElement = newGroup;\r\n\r\n};\r\n\r\n/**\r\n * Draws a canvas, image or mock context to this canvas.\r\n * Note that all svg dom manipulation uses node.childNodes rather than node.children for IE support.\r\n * http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#dom-context-2d-drawimage\r\n */\r\nctx.prototype.drawImage = function () {\r\n    //convert arguments to a real array\r\n    var args = Array.prototype.slice.call(arguments),\r\n        image=args[0],\r\n        dx, dy, dw, dh, sx=0, sy=0, sw, sh, parent, svg, defs, group,\r\n        currentElement, svgImage, canvas, context, id;\r\n\r\n    if (args.length === 3) {\r\n        dx = args[1];\r\n        dy = args[2];\r\n        sw = image.width;\r\n        sh = image.height;\r\n        dw = sw;\r\n        dh = sh;\r\n    } else if (args.length === 5) {\r\n        dx = args[1];\r\n        dy = args[2];\r\n        dw = args[3];\r\n        dh = args[4];\r\n        sw = image.width;\r\n        sh = image.height;\r\n    } else if (args.length === 9) {\r\n        sx = args[1];\r\n        sy = args[2];\r\n        sw = args[3];\r\n        sh = args[4];\r\n        dx = args[5];\r\n        dy = args[6];\r\n        dw = args[7];\r\n        dh = args[8];\r\n    } else {\r\n        throw new Error(\"Invalid number of arguments passed to drawImage: \" + arguments.length);\r\n    }\r\n\r\n    parent = this.__closestGroupOrSvg();\r\n    currentElement = this.__currentElement;\r\n    var translateDirective = \"translate(\" + dx + \", \" + dy + \")\";\r\n    if (image instanceof ctx) {\r\n        //canvas2svg mock canvas context. In the future we may want to clone nodes instead.\r\n        //also I'm currently ignoring dw, dh, sw, sh, sx, sy for a mock context.\r\n        svg = image.getSvg().cloneNode(true);\r\n        if (svg.childNodes && svg.childNodes.length > 1) {\r\n            defs = svg.childNodes[0];\r\n            while(defs.childNodes.length) {\r\n                id = defs.childNodes[0].getAttribute(\"id\");\r\n                this.__ids[id] = id;\r\n                this.__defs.appendChild(defs.childNodes[0]);\r\n            }\r\n            group = svg.childNodes[1];\r\n            if (group) {\r\n                //save original transform\r\n                var originTransform = group.getAttribute(\"transform\");\r\n                var transformDirective;\r\n                if (originTransform) {\r\n                    transformDirective = originTransform+\" \"+translateDirective;\r\n                } else {\r\n                    transformDirective = translateDirective;\r\n                }\r\n                group.setAttribute(\"transform\", transformDirective);\r\n                parent.appendChild(group);\r\n            }\r\n        }\r\n    } else if (image.nodeName === \"CANVAS\" || image.nodeName === \"IMG\") {\r\n        //canvas or image\r\n        svgImage = this.__createElement(\"image\");\r\n        svgImage.setAttribute(\"width\", dw);\r\n        svgImage.setAttribute(\"height\", dh);\r\n        svgImage.setAttribute(\"preserveAspectRatio\", \"none\");\r\n\r\n        if (sx || sy || sw !== image.width || sh !== image.height) {\r\n            //crop the image using a temporary canvas\r\n            canvas = this.__document.createElement(\"canvas\");\r\n            canvas.width = dw;\r\n            canvas.height = dh;\r\n            context = canvas.getContext(\"2d\");\r\n            context.drawImage(image, sx, sy, sw, sh, 0, 0, dw, dh);\r\n            image = canvas;\r\n        }\r\n        svgImage.setAttribute(\"transform\", translateDirective);\r\n        svgImage.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"xlink:href\",\r\n            image.nodeName === \"CANVAS\" ? image.toDataURL() : image.getAttribute(\"src\"));\r\n        parent.appendChild(svgImage);\r\n    }\r\n};\r\n\r\n/**\r\n * Generates a pattern tag\r\n */\r\nctx.prototype.createPattern = function (image, repetition) {\r\n    var pattern = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"pattern\"), id = randomString(this.__ids),\r\n        img;\r\n    pattern.setAttribute(\"id\", id);\r\n    pattern.setAttribute(\"width\", image.width);\r\n    pattern.setAttribute(\"height\", image.height);\r\n    if (image.nodeName === \"CANVAS\" || image.nodeName === \"IMG\") {\r\n        img = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"image\");\r\n        img.setAttribute(\"width\", image.width);\r\n        img.setAttribute(\"height\", image.height);\r\n        img.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"xlink:href\",\r\n            image.nodeName === \"CANVAS\" ? image.toDataURL() : image.getAttribute(\"src\"));\r\n        pattern.appendChild(img);\r\n        this.__defs.appendChild(pattern);\r\n    } else if (image instanceof ctx) {\r\n        pattern.appendChild(image.__root.childNodes[1]);\r\n        this.__defs.appendChild(pattern);\r\n    }\r\n    return new CanvasPattern(pattern, this);\r\n};\r\n\r\nctx.prototype.setLineDash = function (dashArray) {\r\n    if (dashArray && dashArray.length > 0) {\r\n        this.lineDash = dashArray.join(\",\");\r\n    } else {\r\n        this.lineDash = null;\r\n    }\r\n};\r\n\r\n/**\r\n * Not yet implemented\r\n */\r\nctx.prototype.drawFocusRing = function () {};\r\nctx.prototype.createImageData = function () {};\r\nctx.prototype.getImageData = function () {};\r\nctx.prototype.putImageData = function () {};\r\nctx.prototype.globalCompositeOperation = function () {};\r\nctx.prototype.setTransform = function () {};\r\n\r\nexport {ctx as C2S}","/** @module */\r\n\r\nimport { C2S } from '../../lib/canvas2svg.esm.js'\r\n/**\r\n * add a button so that we can generate an SVG of what is being rendered\r\n * @param {Object} screen the screen where the drawing context is.\r\n * We will temporarily change the drawing context.\r\n * @param {Object} draw the drawing function that renders drawings to the context.\r\n * @param {Layout} layout\r\n */\r\nexport default function addSVGOutput(screen, draw, layout) {\r\n    const w = screen.width\r\n    const h = screen.height\r\n\r\n    const svgUIDiv = document.createElement('div')\r\n    layout.newElement('svgUIDiv', svgUIDiv)\r\n\r\n    // svg output button\r\n    const button = document.createElement('button')\r\n    button.className = 'button2'\r\n    button.innerText = 'Make SVG'\r\n    button.onclick = makeSVG\r\n    svgUIDiv.appendChild(button)\r\n\r\n    // svg download link\r\n    const downloadLink = document.createElement('a')\r\n    downloadLink.innerText = 'Download SVG'\r\n    downloadLink.download = 'vote.svg'\r\n    downloadLink.hidden = true\r\n    downloadLink.style.margin = '4px'\r\n    svgUIDiv.appendChild(downloadLink)\r\n\r\n    // svg download link for geoMaps\r\n    const gDownloadLink = document.createElement('a')\r\n    gDownloadLink.innerText = 'Download geoMap SVG'\r\n    gDownloadLink.download = 'vote_geoMap.svg'\r\n    gDownloadLink.hidden = true\r\n    gDownloadLink.style.margin = '4px'\r\n    svgUIDiv.appendChild(gDownloadLink)\r\n\r\n    // svg hide button\r\n    const svgHideButton = document.createElement('button')\r\n    svgHideButton.className = 'button2'\r\n    svgHideButton.innerText = 'Hide SVG'\r\n    svgHideButton.hidden = true\r\n    svgHideButton.onclick = hideSVG\r\n    svgUIDiv.appendChild(svgHideButton)\r\n\r\n    // hidden svg output div\r\n    const svgDiv = document.createElement('div')\r\n    svgDiv.setAttribute('class', 'svgDiv')\r\n    svgDiv.style.width = `${w}px`\r\n    svgDiv.style.height = `${h}px`\r\n    svgDiv.hidden = true\r\n    svgUIDiv.appendChild(svgDiv)\r\n\r\n    // hidden svg output div for geoMaps\r\n    const gSvgDiv = document.createElement('div')\r\n    gSvgDiv.setAttribute('class', 'gSvgDiv')\r\n    gSvgDiv.style.width = `${w}px`\r\n    gSvgDiv.style.height = `${Math.round(h / 3)}px`\r\n    gSvgDiv.hidden = true\r\n    svgUIDiv.appendChild(gSvgDiv)\r\n\r\n    const svgCtx = new C2S(w, h)\r\n    const svgGCtx = new C2S(w, Math.round(h / 3))\r\n\r\n    function makeSVG() {\r\n        // temporarily swap drawing context, render SVG,\r\n        // then output SVG to div and to a download link\r\n        const old = screen.ctx\r\n        const oldF = screen.fctx\r\n        screen.setCtx(svgCtx)\r\n        screen.setFCtx(svgCtx)\r\n        screen.setNoBuffers(true)\r\n        draw()\r\n        outputSVG()\r\n        screen.setCtx(old)\r\n        screen.setFCtx(oldF)\r\n        screen.setNoBuffers(false)\r\n\r\n        const oldG = screen.gctx\r\n        screen.setGCtx(svgGCtx)\r\n        draw()\r\n        outputGSVG()\r\n        screen.setGCtx(oldG)\r\n    }\r\n\r\n    function outputSVG() {\r\n        svgHideButton.hidden = false\r\n\r\n        const svg = svgCtx.getSerializedSvg(true)\r\n        svgDiv.innerHTML = svg\r\n        svgDiv.hidden = false\r\n        downloadLink.hidden = false\r\n        const url = `data:image/svg+xml;charset=utf-8,${encodeURIComponent(svg)}`\r\n        downloadLink.href = url\r\n    }\r\n    function outputGSVG() {\r\n        const gSvg = svgGCtx.getSerializedSvg(true)\r\n        gSvgDiv.innerHTML = gSvg\r\n        gSvgDiv.hidden = false\r\n        gDownloadLink.hidden = false\r\n        const gUrl = `data:image/svg+xml;charset=utf-8,${encodeURIComponent(gSvg)}`\r\n        gDownloadLink.href = gUrl\r\n    }\r\n\r\n    function hideSVG() {\r\n        svgHideButton.hidden = true\r\n\r\n        svgDiv.hidden = true\r\n        downloadLink.hidden = true\r\n\r\n        gSvgDiv.hidden = true\r\n        gDownloadLink.hidden = true\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Class for a single button.\r\n * @param {*} buttonConfig\r\n * @param {*} onChoose\r\n * @constructor\r\n */\r\nexport default function Button(buttonConfig, onChoose) {\r\n    const self = this\r\n\r\n    self.config = buttonConfig\r\n    self.name = buttonConfig.name\r\n    self.nameIsHTML = buttonConfig.nameIsHTML || false\r\n    self.dom = document.createElement('div')\r\n    self.dom.setAttribute('class', 'button button2')\r\n\r\n    // overwrite margins.  The old way was not working.\r\n    let fixMargin = buttonConfig.margin\r\n    fixMargin = fixMargin || 0\r\n    fixMargin = Math.max(fixMargin, 4)\r\n    self.dom.style.marginRight = `${fixMargin}px`\r\n\r\n    // Click!\r\n    self.draw = function () {\r\n        if (self.nameIsHTML) {\r\n            self.dom.innerHTML = self.name\r\n        } else {\r\n            self.dom.innerText = self.name\r\n        }\r\n    }\r\n    self.draw()\r\n    self.dom.setAttribute('title', buttonConfig.realname || '')\r\n    self.onClick = function () {\r\n        onChoose(self, buttonConfig)\r\n    }\r\n    self.dom.onclick = self.onClick\r\n    // Turn on or off!\r\n    self.turnOff = function () {\r\n        self.isOn = false\r\n        self.config.isOn = false\r\n        self.dom.setAttribute('on', 'no')\r\n    }\r\n    self.turnOn = function () {\r\n        self.isOn = true\r\n        self.config.isOn = true\r\n        self.dom.setAttribute('on', 'yes')\r\n    }\r\n    self.turnOff()\r\n}\r\n","/** @module */\r\n\r\nimport Button from './Button.js'\r\n\r\n/**\r\n * Create a group of buttons.\r\n * @param {*} config\r\n * @constructor\r\n */\r\nexport default function ButtonGroup(config) {\r\n    const self = this\r\n    self.config = config\r\n\r\n    // check if there is a function to make the data\r\n    // this function can be used later to update the buttons\r\n    if (config.data === undefined) {\r\n        config.data = []\r\n        if (config.makeData === undefined) {\r\n            config.makeData = () => []\r\n        }\r\n        self.makeData = config.makeData\r\n        self.buttonConfigs = self.makeData()\r\n        self.doMakeData = true\r\n    }\r\n    self.buttonConfigs = config.data\r\n\r\n    self.labelName = config.label\r\n    self.labelIsHTML = config.labelIsHTML || false\r\n\r\n    self.onChoose = config.onChoose\r\n    self.isCheckbox = config.isCheckbox || false\r\n    self.isCheckboxBool = config.isCheckboxBool || false\r\n    self.justButton = config.justButton || false\r\n    self.buttonHidden = config.buttonHidden || {}\r\n\r\n    // DOM!\r\n    self.dom = document.createElement('div')\r\n    self.dom.setAttribute('class', 'button-group')\r\n\r\n    self.buttonDOMByValue = []\r\n\r\n    self.init = function () {\r\n        if (self.doMakeData) self.buttonConfigs = self.makeData()\r\n\r\n        // clear\r\n        self.dom.innerHTML = ''\r\n        self.buttons = []\r\n        self.buttonsByName = {}\r\n\r\n        // Label!\r\n        self.labelDOM = document.createElement('div')\r\n        self.labelDOM.setAttribute('class', 'button-group-label')\r\n        self.draw()\r\n        self.dom.appendChild(self.labelDOM)\r\n\r\n        // Create & place buttons!\r\n        for (let i = 0; i < self.buttonConfigs.length; i++) {\r\n            const conf = self.buttonConfigs[i]\r\n            const button = new Button(conf, self.onToggle)\r\n            self.buttonsByName[conf.name] = button\r\n            button.dom.style.width = `${config.width}px` // whatever\r\n            if (conf.width) button.dom.style.width = `${conf.width}px` // whatever\r\n            self.buttons.push(button)\r\n            self.dom.appendChild(button.dom)\r\n            self.buttonDOMByValue[conf.value] = button.dom\r\n        }\r\n\r\n        // And then select the one that says \"selected\"! Fake a click.\r\n        for (let i = 0; i < self.buttons.length; i++) {\r\n            const button = self.buttons[i]\r\n            if (button.config.selected) {\r\n                button.turnOn()\r\n                break\r\n            }\r\n        }\r\n        self.draw()\r\n    }\r\n    self.updateNames = function () {\r\n        const data2 = self.makeData()\r\n        for (let i = 0; i < self.buttonConfigs.length; i++) {\r\n            self.buttonConfigs[i].name = data2[i].name\r\n            self.buttons[i].name = self.buttonConfigs[i].name\r\n        }\r\n    }\r\n    self.redraw = function () {\r\n        self.updateNames()\r\n        self.draw()\r\n    }\r\n    self.draw = function () {\r\n        if (self.labelIsHTML) {\r\n            self.labelDOM.innerHTML = self.labelName\r\n        } else {\r\n            self.labelDOM.innerText = self.labelName\r\n        }\r\n        for (const button of self.buttons) {\r\n            button.draw()\r\n        }\r\n    }\r\n\r\n    self.configureHidden = function () {\r\n        for (const [buttonName, hidden] of Object.entries(self.buttonHidden)) {\r\n            self.buttonsByName[buttonName].dom.hidden = hidden\r\n        }\r\n    }\r\n\r\n    // Toggle buttons\r\n    self.onToggle = function (button, buttonData) {\r\n        if (self.isCheckbox || self.isCheckboxBool) {\r\n            if (button.isOn) {\r\n                button.turnOff()\r\n            } else {\r\n                button.turnOn()\r\n            }\r\n        } else { // justButton means it doesn't get selected\r\n            // Turn all off\r\n            for (let i = 0; i < self.buttons.length; i++) self.buttons[i].turnOff()\r\n            button.turnOn() // except one\r\n            if (self.justButton) {\r\n                // turn on for a little while, then off\r\n                setTimeout(() => button.turnOff(), 800)\r\n            }\r\n        }\r\n        // And send the data up\r\n        self.onChoose(buttonData)\r\n    }\r\n\r\n    // Highlight based on data...\r\n    self.highlight = function (propName, propValue) {\r\n        // if we haven't set up the buttons yet, then don't do anything yet\r\n        if (self.buttons.length === 0) return\r\n\r\n        // Turn all off\r\n        for (let i = 0; i < self.buttons.length; i++) self.buttons[i].turnOff()\r\n\r\n        if (self.isCheckbox) {\r\n            for (const ibu in self.buttons) {\r\n                const bu = self.buttons[ibu]\r\n                if (propValue.includes(bu.config[propName])) { // the propValue is an array of values\r\n                    bu.turnOn()\r\n                }\r\n            }\r\n        } else if (self.isCheckboxBool) {\r\n            for (const ibu in self.buttons) {\r\n                const bu = self.buttons[ibu]\r\n                const buttonName = bu.config[propName]\r\n                // if (Object.keys(propValue).includes(buttonName)) { // the propValue is an array of values\r\n                if (buttonName in propValue) {\r\n                    if (propValue[buttonName]) {\r\n                        bu.turnOn()\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            // Find the one...\r\n            const theButton = self.buttons.filter((button) => {\r\n                const { config } = button\r\n                return (config[propName] === propValue)\r\n            })[0]\r\n            if (theButton !== undefined) {\r\n                theButton.turnOn()\r\n            }\r\n        }\r\n    }\r\n\r\n    self.init()\r\n}\r\n","/** @module */\r\n\r\nimport ButtonGroup from './ButtonGroup.js'\r\n\r\n/**\r\n * Make a selection that determines a single property's value.\r\n * Defer handling dependent calculations to the next update step,\r\n * where we will look at a dependency tree to determine what else needs updating.\r\n * Functionality here is called from button presses.\r\n * Functionality here is also called from a command pattern (commander).\r\n * @param {Object.<string>} object\r\n * @param {(String|Number|Boolean)} object.prop - The property being selected in the menu.\r\n * @param {String} prop - Name of prop\r\n * @param {MenuItem~setProp} setProp - The action that is performed as part of onclick.\r\n * @param {String} label - The prompt presented to the user.\r\n * @param {Object[]} options - the list of options that the UI presents to the user.\r\n * @param {(String|Number|Boolean)} options[].value - Value to pass to setProp\r\n * @param {String[]} change - list of changes made when pressing a button.\r\n * @param {Changes} changes\r\n * @param {Commander} commander - Follows command pattern.\r\n * @constructor\r\n */\r\n// eslint-disable-next-line max-len\r\nexport default function MenuItem(object, prop, setProp, label, options, change, changes, commander) {\r\n    const self = this\r\n    self.list = options\r\n    self.onChoose = function (data) {\r\n        commander.do({ name: prop, value: data.value })\r\n    }\r\n    self.action = (value) => {\r\n        self.set(value)\r\n        self.select()\r\n    }\r\n    commander.addAction(prop, self.action, object[prop])\r\n    self.set = function (value) {\r\n        // LOAD INPUT\r\n\r\n        setProp(value)\r\n        // CONFIGURE\r\n        self.configure()\r\n        // UPDATE\r\n        changes.add(change)\r\n    }\r\n    self.choose = new ButtonGroup({\r\n        label,\r\n        width: bw(2),\r\n        data: self.list,\r\n        onChoose: self.onChoose,\r\n    })\r\n    self.configure = function () {\r\n    }\r\n    self.select = function () {\r\n        self.choose.highlight('value', object[prop])\r\n    }\r\n}\r\n\r\nfunction bw(x) { return (220 - 4 * (x - 1)) / x - 2 }\r\n","/** @module */\r\n\r\nimport MenuItem from './MenuItem.js'\r\n\r\n/**\r\n * Make a menu.\r\n * @param {Changes} changes\r\n * @param {Layout} layout\r\n * @param {Commander} commander - Follows command pattern.\r\n * @constructor\r\n */\r\nexport default function Menu(changes, layout, commander) {\r\n    const self = this\r\n    self.divMenu = document.createElement('div')\r\n    layout.newElement('menu', self.divMenu)\r\n    self.addMenuItem = function (object, choice) {\r\n        const {\r\n            prop, setProp, label, options, change,\r\n        } = choice\r\n\r\n        // eslint-disable-next-line max-len\r\n        const menuItem = new MenuItem(object, prop, setProp, label, options, change, changes, commander)\r\n        menuItem.select()\r\n\r\n        self.divMenu.appendChild(menuItem.choose.dom)\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Sum area of voter distributions to tally the votes.\r\n * @param {Candidate[]} cans\r\n * @constructor\r\n */\r\nexport default function AreaSummer(cans) {\r\n    const self = this\r\n\r\n    const lines = findLines(cans)\r\n\r\n    // todo: figure out if this is really just a function rather than a class.\r\n\r\n    self.sumArea = function sumArea(voterGroup) {\r\n        // draw lines across shape of voterGroup\r\n\r\n        const n = lines.length\r\n        const area = Array(n)\r\n        for (let i = 0; i < n; i++) {\r\n            const lineSet = lines[i]\r\n            // return area for each candidate\r\n            area[i] = sumCircle(voterGroup, lineSet)\r\n        }\r\n        return area\r\n    }\r\n}\r\n\r\nfunction findLines(cans) {\r\n    // find all lines\r\n    const n = cans.length\r\n    const lines = new Array(n) // each candidate has a set of lines for themselves\r\n    for (let i = 0; i < n; i++) {\r\n        lines[i] = []\r\n        for (let k = 0; k < n; k++) {\r\n            // skip sames\r\n            if (i === k) continue\r\n            // find equation for a line\r\n            const c1 = cans[i]\r\n            const c2 = cans[k]\r\n            // lines[i][k] = equidistantLine(c1,c2) // problem when i === k\r\n            lines[i].push(equidistantLine(c1, c2))\r\n        }\r\n    }\r\n\r\n    return lines\r\n}\r\n\r\n/**\r\n * Test for the function equidistantLine, which finds a line equidistant from two points.\r\n * @param {Function} eq - assertion function for equality\r\n * @param {Function} assert - assertion function for true\r\n * @returns {Object[]} an array of test objects, each with a label and a test function.\r\n */\r\nexport function testEquidistantLine(eq, assert) {\r\n    // Takes an assertion function.\r\n    // Returns a test function.\r\n\r\n    return [{\r\n        label: 'Finds line equation equidistant from two points.',\r\n        test: () => {\r\n            const m = equidistantLine({ x: 0, y: 0 }, { x: 1, y: 1 })\r\n            const e = { A: { x: 1, y: 1 }, b: 1 }\r\n            eq(e.A.x / e.b, m.A.x / m.b)\r\n            eq(e.A.y / e.b, m.A.y / m.b)\r\n        },\r\n    }, {\r\n        label: 'The first point satisfies Ac < b. A[0,0] < b. ',\r\n        test: () => {\r\n            const m = equidistantLine({ x: 0, y: 0 }, { x: 1, y: 1 })\r\n            assert(m.b > 0)\r\n        },\r\n    },\r\n    ]\r\n}\r\n\r\nfunction equidistantLine(c1, c2) {\r\n    // Ac < b\r\n    // this is the condition that x counts for a candidate.\r\n\r\n    // line equidistant from two points\r\n    // https://math.stackexchange.com/a/771773\r\n\r\n    // difference between points\r\n    const dx = c2.x - c1.x\r\n    const dy = c2.y - c1.y\r\n\r\n    // midpoint between points\r\n    const mx = (c1.x + c2.x) * 0.5\r\n    const my = (c1.y + c2.y) * 0.5\r\n\r\n    // equation for line\r\n    // (y-my) / (x-mx) = - dx / dy\r\n    // implies y * dy - my * dy = - x * dx + mx * dx\r\n    // implies dx * x + dy * y = mx * dx + my * dy\r\n    // rename to A = [dx;dy]\r\n    //           b = mx * dx + my * dy\r\n    const A = { x: dx, y: dy }\r\n    const b = mx * dx + my * dy\r\n\r\n    // is c1 or c2 closer?\r\n    // c1 is closer is equivalent to Ac < b\r\n\r\n    return { A, b }\r\n}\r\n\r\nfunction sumCircle(circle, lineSet) {\r\n    // integrate inside\r\n    //   Need a direction for \"inside\" for each line.\r\n    //   Then do a 1D consideration of what is inside.\r\n\r\n    // for each x coordinate,\r\n    const dx = 2\r\n    let sum = 0\r\n    const x1 = circle.x\r\n    const y1 = circle.y\r\n    const { r } = circle\r\n    // x only goes from x1-r to x1+r\r\n    for (let x = x1 - r; x < x1 + r; x += dx) {\r\n        // find bounds\r\n\r\n        // find equation for circle\r\n\r\n        // (y - y1)**2 + (x-x1)**2 < r**2\r\n        const diff2 = r ** 2 - (x - x1) ** 2\r\n        let half\r\n        if (diff2 > 0) {\r\n            half = Math.sqrt(diff2)\r\n        } else {\r\n            half = 0\r\n        }\r\n        let high = y1 + half\r\n        let low = y1 - half\r\n\r\n        // for each of the constraints, figure out if it is an upper or lower bound,\r\n        // then adjust the bound.\r\n        // The y coefficient tells us whether this is an upper or lower bound.\r\n        // Imagine infinite +y.\r\n        // If the y coefficient is negative, then Ac < b, and Ac = b is a lower bound.\r\n        // A.x * x + A.y * y = b\r\n        // y = (b - A.x * x) / A.y\r\n        lineSet.forEach((line) => {\r\n            const ay = line.A.y\r\n            const ax = line.A.x\r\n            const { b } = line\r\n            if (ay === 0) {\r\n                if (ax * x < b) {\r\n                    // no bounds\r\n                } else {\r\n                    low = Infinity // bounded by x\r\n                }\r\n                // not handling 0,0 case\r\n            } else {\r\n                const y2 = (b - ax * x) / ay\r\n                if (ay < 0) {\r\n                    low = Math.max(low, y2)\r\n                } else {\r\n                    high = Math.min(high, y2)\r\n                }\r\n            }\r\n        })\r\n\r\n        // count area inside lines\r\n        const dy = high - low\r\n        if (dy > 0) {\r\n            const area = dy * dx\r\n            sum += area\r\n        }\r\n    }\r\n    return sum\r\n}\r\n","/** @module */\r\n\r\nimport pluralityBallot from './pluralityBallot.js'\r\n\r\n/**\r\n * a collection of ways to cast votes\r\n */\r\n\r\nconst castVotes = { pluralityBallot }\r\n\r\nexport default castVotes\r\n","/** @module */\r\n\r\nimport AreaSummer from './AreaSummer.js'\r\n\r\n/**\r\n * Vote for one.\r\n * Voters cast votes for candidates.\r\n * There is also a separate graphical representation in VoronoiGroup.js.\r\n * @param {*} candidates - an array of objects with x and y attributes.\r\n * @param {*} voterGroups - an array of objects with x,y, and r attributes.\r\n * @returns votes, an object\r\n */\r\nexport default function pluralityBallot(candidates, voterGroups) {\r\n    const summer = new AreaSummer(candidates)\r\n\r\n    // get fraction of votes for each candidate so we can summarize results\r\n    const n = candidates.length\r\n    let tally = (new Array(n)).fill(0)\r\n    voterGroups.forEach((voterGroup) => {\r\n        const area = summer.sumArea(voterGroup)\r\n        const weight = ((voterGroup.weight === undefined) ? 1 : voterGroup.weight)\r\n        tally = tally.map((value, index) => value + area[index] * weight)\r\n    })\r\n    const total = tally.reduce((p, c) => p + c)\r\n    const tallyFractions = tally.map((x) => x / total)\r\n    const votes = { tallyFractions }\r\n    return votes\r\n}\r\n","/** @module */\r\n\r\nimport plurality from './plurality.js'\r\nimport randomWinner from './randomWinner.js'\r\nimport huntingtonHill from './huntingtonHill.js'\r\n\r\n/** a collection of election methods\r\n *  */\r\nconst electionMethods = { plurality, randomWinner, huntingtonHill }\r\n\r\nexport default electionMethods\r\n","/** @module */\r\n\r\n/**\r\n * the candidate with the highest tally wins\r\n * @param {Object} votes\r\n * @param {Number[]} votes.tallyFractions\r\n * @returns {results}\r\n */\r\nexport default function plurality(votes) {\r\n    const max = Math.max(...votes.tallyFractions)\r\n    const iWinner = votes.tallyFractions.indexOf(max)\r\n\r\n    const results = { iWinner }\r\n    return results\r\n}\r\n/**\r\n * @typedef {Object} results\r\n * @property {Number} iWinner - Index of winner. Indexing according to votes[].\r\n */\r\n","/** @module */\r\n\r\n/**\r\n * pick a random candidate as the winner\r\n * @param {Object} votes\r\n * @param {Number} votes.tallyFractions.length - Number of candidates.\r\n * @returns {results}\r\n */\r\nexport default function randomWinner(votes) {\r\n    const nk = votes.tallyFractions.length\r\n    const iWinner = Math.floor(Math.random() * nk)\r\n    const results = { iWinner }\r\n    return results\r\n}\r\n/**\r\n * @typedef {Object} results\r\n * @property {Number} iWinner - Index of winner. Indexing according to votes[].\r\n */\r\n","/** @module */\r\n\r\n/**\r\n * Run the Huntington-Hill method of apportionment and return an allocation of seats.\r\n * @param {Object} votes\r\n * @param {number[]} votes.tallyFractions - tallies for each party as a fraction of 1.\r\n * @param {Object} electionMethodOptions\r\n * @param {number} electionMethodOptions.seats - The number of seats to fill.\r\n * @param {number} electionMethodOptions.threshold - The minimum fraction of voters\r\n * that a party needs to be eligible for a seat.\r\n * @returns {{allocation:number[]}} - results, with property allocation.\r\n * Allocation is an array of integers that say how many representatives each party gets.\r\n */\r\n\r\nexport default function huntingtonHill(votes, electionMethodOptions) {\r\n    const { seats, threshold } = electionMethodOptions\r\n\r\n    const populations = votes.tallyFractions.map(\r\n        (p) => ((p < threshold) ? 0 : p),\r\n    )\r\n\r\n    const nparties = populations.length\r\n\r\n    // When the threshold is 0, we have to give each party a seat.\r\n    if (threshold === 0 && nparties > seats) {\r\n        // sort parties by population\r\n        // sort decreasing\r\n        const populationsSorted = [...populations].sort(\r\n            (a, b) => b - a,\r\n        )\r\n        const minPopulation = populationsSorted[seats - 1]\r\n        const pops2 = votes.tallyFractions\r\n\r\n        // todo: consider ties\r\n        const allocation = pops2.map(\r\n            (p) => p >= minPopulation,\r\n        )\r\n        const results = { allocation }\r\n        return results\r\n    }\r\n\r\n    // make a list of break points / divisors, independent of vote totals\r\n    const divisorPattern = Array(seats).fill().map(\r\n        (_, i) => Math.sqrt((i) * (i + 1)),\r\n    )\r\n\r\n    // Scale the divisor pattern for each party.\r\n    // Call them signposts, like Balinski and Young.\r\n    // Ref: Balinski and Young 1982, pages 60-66, Chapter 7, Overview of Methods.\r\n    // Really, these are the divisors for each party.\r\n    // They are also a ratio of the representatives to the population\r\n    // except that the divisorPattern is used to substitute a slightly different number\r\n    // than the number of respresentatives.\r\n    const signposts = populations.map(\r\n        (p) => (p === 0 ? Infinity : divisorPattern.map((d) => d / p)),\r\n    ).flat()\r\n\r\n    // find last signpost to fill all seats\r\n    // sort increasing\r\n    const sortedSignposts = signposts.flat().sort(\r\n        (a, b) => a - b,\r\n    )\r\n\r\n    const lastSignpost = sortedSignposts[seats - 1]\r\n\r\n    // In the jargon:\r\n    //   Divide by populations by the divisors to get the quotients.\r\n    // Or, more clearly:\r\n    //   Count how many signposts each party has passed.\r\n\r\n    // lastSignpost = d/p\r\n    // d = p * lastSignpost\r\n    // sqrt(i*(i+1)) = d\r\n    // i=0 is one seat\r\n    // n = i + 1\r\n    // sqrt(n*(n-1)) = d\r\n    // n**2 - n = d**2\r\n    // n = (-b + sqrt(b-4ac) ) / 2a\r\n    // a = 1, b = -1, c = -d**2\r\n    // n = (1 + sqrt(1+4d**2) ) / 2\r\n    const quotients = populations.map(\r\n        (p) => ((p === 0) ? 0 : (1 + Math.sqrt(1 + 4 * (p * lastSignpost) ** 2)) * 0.5),\r\n    )\r\n    const allocation = quotients.map(\r\n        (p) => Math.floor(p),\r\n    )\r\n\r\n    // Todo: consider if there is a tie.\r\n    // Right now, we give extra seats to all the tied parties if there is a tie.\r\n    const results = { allocation }\r\n    return results\r\n}\r\n","/** @module */\r\n\r\nimport electionMethods from '../electionMethods/electionMethods.js'\r\n\r\n/**\r\n * Store settings and functions that deal with the election method.\r\n * @param {Candidate[]} candidates\r\n * @param {Menu} menu\r\n * @constructor\r\n */\r\nexport default function ElectionMethod(menu) {\r\n    const self = this\r\n\r\n    self.run = (candidates, votes) => {\r\n        // why have two different kinds of results?\r\n        // methodResults, the smaller one,\r\n        //   is in the context of the election method,\r\n        //   which has tallies go in and analysis come out\r\n        // electionResults, the larger one,\r\n        //   is in the context of candidate objects and voter objects.\r\n        let electionResults\r\n        if (self.checkElectionType() === 'allocation') {\r\n            const electionMethodOptions = { seats: 5, threshold: 0.2 }\r\n            const methodResults = electionMethods[self.electionMethod](votes, electionMethodOptions)\r\n            const { allocation } = methodResults\r\n            electionResults = { allocation, candidates }\r\n        } else {\r\n            const methodResults = electionMethods[self.electionMethod](votes)\r\n            const { iWinner } = methodResults\r\n            const winner = candidates[iWinner]\r\n            electionResults = { iWinner, winner }\r\n        }\r\n        return electionResults\r\n    }\r\n\r\n    // -- Menu --\r\n\r\n    // a list of election methods\r\n    self.electionMethodList = [\r\n        { name: 'Huntington Hill', value: 'huntingtonHill', type: 'allocation' },\r\n        { name: 'Plurality', value: 'plurality', type: 'singleWinner' },\r\n        { name: 'Random Winner', value: 'randomWinner', type: 'singleWinner' },\r\n    ]\r\n\r\n    // utilities for looking up this list\r\n    self.checkElectionType = () => self.electionMethodListByFunctionName[self.electionMethod].type\r\n    self.electionMethodListByFunctionName = []\r\n    self.electionMethodList.forEach(\r\n        (x) => { self.electionMethodListByFunctionName[x.value] = x },\r\n    )\r\n\r\n    // add a menu item to switch between types of elections\r\n    self.electionMethod = 'plurality'\r\n\r\n    /**\r\n     * Called in onclick.\r\n     * @param {(String|Number|Boolean)} value\r\n     */\r\n    self.setElectionMethod = (value) => { self.electionMethod = value }\r\n\r\n    menu.addMenuItem(\r\n        self,\r\n        {\r\n            label: 'Election Method:',\r\n            prop: 'electionMethod',\r\n            setProp: self.setElectionMethod,\r\n            options: self.electionMethodList,\r\n            change: ['electionMethod'],\r\n        },\r\n    )\r\n}\r\n","/** @module */\r\n\r\nimport castVotes from '../castVotes/castVotes.js'\r\nimport ElectionMethod from './ElectionMethod.js'\r\n\r\n/**\r\n * Here we are in the context of a single election with voter objects and candidate jects.\r\n * @param {Menu} menu\r\n * @constructor\r\n */\r\nexport default function Election(menu) {\r\n    const self = this\r\n\r\n    self.method = new ElectionMethod(menu)\r\n\r\n    self.runElection = function (voterGroups, canList) {\r\n        const votes = castVotes.pluralityBallot(canList, voterGroups)\r\n        const methodResults = self.method.run(canList, votes)\r\n        const electionResults = { ...methodResults, votes }\r\n        return electionResults\r\n    }\r\n\r\n    // Voters cast votes for candidates.\r\n    // There is also a separate graphical representation in VoronoiGroup.js\r\n    self.castVotes = (voters, candidates) => {\r\n        const voterGroups = voters.getVoterGroups()\r\n        const canList = candidates.getCandidates()\r\n        const votes = castVotes.pluralityBallot(canList, voterGroups)\r\n        return votes\r\n    }\r\n}\r\n","// https://github.com/d3/d3-delaunay v6.0.2 Copyright 2018-2021 Observable, Inc., 2021 Mapbox\r\n\r\n// Altered to make into an ES2015 module.\r\n\r\nconst epsilon$1 = 1.1102230246251565e-16;\r\nconst splitter = 134217729;\r\nconst resulterrbound = (3 + 8 * epsilon$1) * epsilon$1;\r\n\r\n// fast_expansion_sum_zeroelim routine from oritinal code\r\nfunction sum(elen, e, flen, f, h) {\r\n    let Q, Qnew, hh, bvirt;\r\n    let enow = e[0];\r\n    let fnow = f[0];\r\n    let eindex = 0;\r\n    let findex = 0;\r\n    if ((fnow > enow) === (fnow > -enow)) {\r\n        Q = enow;\r\n        enow = e[++eindex];\r\n    } else {\r\n        Q = fnow;\r\n        fnow = f[++findex];\r\n    }\r\n    let hindex = 0;\r\n    if (eindex < elen && findex < flen) {\r\n        if ((fnow > enow) === (fnow > -enow)) {\r\n            Qnew = enow + Q;\r\n            hh = Q - (Qnew - enow);\r\n            enow = e[++eindex];\r\n        } else {\r\n            Qnew = fnow + Q;\r\n            hh = Q - (Qnew - fnow);\r\n            fnow = f[++findex];\r\n        }\r\n        Q = Qnew;\r\n        if (hh !== 0) {\r\n            h[hindex++] = hh;\r\n        }\r\n        while (eindex < elen && findex < flen) {\r\n            if ((fnow > enow) === (fnow > -enow)) {\r\n                Qnew = Q + enow;\r\n                bvirt = Qnew - Q;\r\n                hh = Q - (Qnew - bvirt) + (enow - bvirt);\r\n                enow = e[++eindex];\r\n            } else {\r\n                Qnew = Q + fnow;\r\n                bvirt = Qnew - Q;\r\n                hh = Q - (Qnew - bvirt) + (fnow - bvirt);\r\n                fnow = f[++findex];\r\n            }\r\n            Q = Qnew;\r\n            if (hh !== 0) {\r\n                h[hindex++] = hh;\r\n            }\r\n        }\r\n    }\r\n    while (eindex < elen) {\r\n        Qnew = Q + enow;\r\n        bvirt = Qnew - Q;\r\n        hh = Q - (Qnew - bvirt) + (enow - bvirt);\r\n        enow = e[++eindex];\r\n        Q = Qnew;\r\n        if (hh !== 0) {\r\n            h[hindex++] = hh;\r\n        }\r\n    }\r\n    while (findex < flen) {\r\n        Qnew = Q + fnow;\r\n        bvirt = Qnew - Q;\r\n        hh = Q - (Qnew - bvirt) + (fnow - bvirt);\r\n        fnow = f[++findex];\r\n        Q = Qnew;\r\n        if (hh !== 0) {\r\n            h[hindex++] = hh;\r\n        }\r\n    }\r\n    if (Q !== 0 || hindex === 0) {\r\n        h[hindex++] = Q;\r\n    }\r\n    return hindex;\r\n}\r\n\r\nfunction estimate(elen, e) {\r\n    let Q = e[0];\r\n    for (let i = 1; i < elen; i++) Q += e[i];\r\n    return Q;\r\n}\r\n\r\nfunction vec(n) {\r\n    return new Float64Array(n);\r\n}\r\n\r\nconst ccwerrboundA = (3 + 16 * epsilon$1) * epsilon$1;\r\nconst ccwerrboundB = (2 + 12 * epsilon$1) * epsilon$1;\r\nconst ccwerrboundC = (9 + 64 * epsilon$1) * epsilon$1 * epsilon$1;\r\n\r\nconst B = vec(4);\r\nconst C1 = vec(8);\r\nconst C2 = vec(12);\r\nconst D = vec(16);\r\nconst u = vec(4);\r\n\r\nfunction orient2dadapt(ax, ay, bx, by, cx, cy, detsum) {\r\n    let acxtail, acytail, bcxtail, bcytail;\r\n    let bvirt, c, ahi, alo, bhi, blo, _i, _j, _0, s1, s0, t1, t0, u3;\r\n\r\n    const acx = ax - cx;\r\n    const bcx = bx - cx;\r\n    const acy = ay - cy;\r\n    const bcy = by - cy;\r\n\r\n    s1 = acx * bcy;\r\n    c = splitter * acx;\r\n    ahi = c - (c - acx);\r\n    alo = acx - ahi;\r\n    c = splitter * bcy;\r\n    bhi = c - (c - bcy);\r\n    blo = bcy - bhi;\r\n    s0 = alo * blo - (s1 - ahi * bhi - alo * bhi - ahi * blo);\r\n    t1 = acy * bcx;\r\n    c = splitter * acy;\r\n    ahi = c - (c - acy);\r\n    alo = acy - ahi;\r\n    c = splitter * bcx;\r\n    bhi = c - (c - bcx);\r\n    blo = bcx - bhi;\r\n    t0 = alo * blo - (t1 - ahi * bhi - alo * bhi - ahi * blo);\r\n    _i = s0 - t0;\r\n    bvirt = s0 - _i;\r\n    B[0] = s0 - (_i + bvirt) + (bvirt - t0);\r\n    _j = s1 + _i;\r\n    bvirt = _j - s1;\r\n    _0 = s1 - (_j - bvirt) + (_i - bvirt);\r\n    _i = _0 - t1;\r\n    bvirt = _0 - _i;\r\n    B[1] = _0 - (_i + bvirt) + (bvirt - t1);\r\n    u3 = _j + _i;\r\n    bvirt = u3 - _j;\r\n    B[2] = _j - (u3 - bvirt) + (_i - bvirt);\r\n    B[3] = u3;\r\n\r\n    let det = estimate(4, B);\r\n    let errbound = ccwerrboundB * detsum;\r\n    if (det >= errbound || -det >= errbound) {\r\n        return det;\r\n    }\r\n\r\n    bvirt = ax - acx;\r\n    acxtail = ax - (acx + bvirt) + (bvirt - cx);\r\n    bvirt = bx - bcx;\r\n    bcxtail = bx - (bcx + bvirt) + (bvirt - cx);\r\n    bvirt = ay - acy;\r\n    acytail = ay - (acy + bvirt) + (bvirt - cy);\r\n    bvirt = by - bcy;\r\n    bcytail = by - (bcy + bvirt) + (bvirt - cy);\r\n\r\n    if (acxtail === 0 && acytail === 0 && bcxtail === 0 && bcytail === 0) {\r\n        return det;\r\n    }\r\n\r\n    errbound = ccwerrboundC * detsum + resulterrbound * Math.abs(det);\r\n    det += (acx * bcytail + bcy * acxtail) - (acy * bcxtail + bcx * acytail);\r\n    if (det >= errbound || -det >= errbound) return det;\r\n\r\n    s1 = acxtail * bcy;\r\n    c = splitter * acxtail;\r\n    ahi = c - (c - acxtail);\r\n    alo = acxtail - ahi;\r\n    c = splitter * bcy;\r\n    bhi = c - (c - bcy);\r\n    blo = bcy - bhi;\r\n    s0 = alo * blo - (s1 - ahi * bhi - alo * bhi - ahi * blo);\r\n    t1 = acytail * bcx;\r\n    c = splitter * acytail;\r\n    ahi = c - (c - acytail);\r\n    alo = acytail - ahi;\r\n    c = splitter * bcx;\r\n    bhi = c - (c - bcx);\r\n    blo = bcx - bhi;\r\n    t0 = alo * blo - (t1 - ahi * bhi - alo * bhi - ahi * blo);\r\n    _i = s0 - t0;\r\n    bvirt = s0 - _i;\r\n    u[0] = s0 - (_i + bvirt) + (bvirt - t0);\r\n    _j = s1 + _i;\r\n    bvirt = _j - s1;\r\n    _0 = s1 - (_j - bvirt) + (_i - bvirt);\r\n    _i = _0 - t1;\r\n    bvirt = _0 - _i;\r\n    u[1] = _0 - (_i + bvirt) + (bvirt - t1);\r\n    u3 = _j + _i;\r\n    bvirt = u3 - _j;\r\n    u[2] = _j - (u3 - bvirt) + (_i - bvirt);\r\n    u[3] = u3;\r\n    const C1len = sum(4, B, 4, u, C1);\r\n\r\n    s1 = acx * bcytail;\r\n    c = splitter * acx;\r\n    ahi = c - (c - acx);\r\n    alo = acx - ahi;\r\n    c = splitter * bcytail;\r\n    bhi = c - (c - bcytail);\r\n    blo = bcytail - bhi;\r\n    s0 = alo * blo - (s1 - ahi * bhi - alo * bhi - ahi * blo);\r\n    t1 = acy * bcxtail;\r\n    c = splitter * acy;\r\n    ahi = c - (c - acy);\r\n    alo = acy - ahi;\r\n    c = splitter * bcxtail;\r\n    bhi = c - (c - bcxtail);\r\n    blo = bcxtail - bhi;\r\n    t0 = alo * blo - (t1 - ahi * bhi - alo * bhi - ahi * blo);\r\n    _i = s0 - t0;\r\n    bvirt = s0 - _i;\r\n    u[0] = s0 - (_i + bvirt) + (bvirt - t0);\r\n    _j = s1 + _i;\r\n    bvirt = _j - s1;\r\n    _0 = s1 - (_j - bvirt) + (_i - bvirt);\r\n    _i = _0 - t1;\r\n    bvirt = _0 - _i;\r\n    u[1] = _0 - (_i + bvirt) + (bvirt - t1);\r\n    u3 = _j + _i;\r\n    bvirt = u3 - _j;\r\n    u[2] = _j - (u3 - bvirt) + (_i - bvirt);\r\n    u[3] = u3;\r\n    const C2len = sum(C1len, C1, 4, u, C2);\r\n\r\n    s1 = acxtail * bcytail;\r\n    c = splitter * acxtail;\r\n    ahi = c - (c - acxtail);\r\n    alo = acxtail - ahi;\r\n    c = splitter * bcytail;\r\n    bhi = c - (c - bcytail);\r\n    blo = bcytail - bhi;\r\n    s0 = alo * blo - (s1 - ahi * bhi - alo * bhi - ahi * blo);\r\n    t1 = acytail * bcxtail;\r\n    c = splitter * acytail;\r\n    ahi = c - (c - acytail);\r\n    alo = acytail - ahi;\r\n    c = splitter * bcxtail;\r\n    bhi = c - (c - bcxtail);\r\n    blo = bcxtail - bhi;\r\n    t0 = alo * blo - (t1 - ahi * bhi - alo * bhi - ahi * blo);\r\n    _i = s0 - t0;\r\n    bvirt = s0 - _i;\r\n    u[0] = s0 - (_i + bvirt) + (bvirt - t0);\r\n    _j = s1 + _i;\r\n    bvirt = _j - s1;\r\n    _0 = s1 - (_j - bvirt) + (_i - bvirt);\r\n    _i = _0 - t1;\r\n    bvirt = _0 - _i;\r\n    u[1] = _0 - (_i + bvirt) + (bvirt - t1);\r\n    u3 = _j + _i;\r\n    bvirt = u3 - _j;\r\n    u[2] = _j - (u3 - bvirt) + (_i - bvirt);\r\n    u[3] = u3;\r\n    const Dlen = sum(C2len, C2, 4, u, D);\r\n\r\n    return D[Dlen - 1];\r\n}\r\n\r\nfunction orient2d(ax, ay, bx, by, cx, cy) {\r\n    const detleft = (ay - cy) * (bx - cx);\r\n    const detright = (ax - cx) * (by - cy);\r\n    const det = detleft - detright;\r\n\r\n    if (detleft === 0 || detright === 0 || (detleft > 0) !== (detright > 0)) return det;\r\n\r\n    const detsum = Math.abs(detleft + detright);\r\n    if (Math.abs(det) >= ccwerrboundA * detsum) return det;\r\n\r\n    return -orient2dadapt(ax, ay, bx, by, cx, cy, detsum);\r\n}\r\n\r\nconst EPSILON = Math.pow(2, -52);\r\nconst EDGE_STACK = new Uint32Array(512);\r\n\r\nclass Delaunator {\r\n\r\n    static from(points, getX = defaultGetX, getY = defaultGetY) {\r\n        const n = points.length;\r\n        const coords = new Float64Array(n * 2);\r\n\r\n        for (let i = 0; i < n; i++) {\r\n            const p = points[i];\r\n            coords[2 * i] = getX(p);\r\n            coords[2 * i + 1] = getY(p);\r\n        }\r\n\r\n        return new Delaunator(coords);\r\n    }\r\n\r\n    constructor(coords) {\r\n        const n = coords.length >> 1;\r\n        if (n > 0 && typeof coords[0] !== 'number') throw new Error('Expected coords to contain numbers.');\r\n\r\n        this.coords = coords;\r\n\r\n        // arrays that will store the triangulation graph\r\n        const maxTriangles = Math.max(2 * n - 5, 0);\r\n        this._triangles = new Uint32Array(maxTriangles * 3);\r\n        this._halfedges = new Int32Array(maxTriangles * 3);\r\n\r\n        // temporary arrays for tracking the edges of the advancing convex hull\r\n        this._hashSize = Math.ceil(Math.sqrt(n));\r\n        this._hullPrev = new Uint32Array(n); // edge to prev edge\r\n        this._hullNext = new Uint32Array(n); // edge to next edge\r\n        this._hullTri = new Uint32Array(n); // edge to adjacent triangle\r\n        this._hullHash = new Int32Array(this._hashSize).fill(-1); // angular edge hash\r\n\r\n        // temporary arrays for sorting points\r\n        this._ids = new Uint32Array(n);\r\n        this._dists = new Float64Array(n);\r\n\r\n        this.update();\r\n    }\r\n\r\n    update() {\r\n        const {coords, _hullPrev: hullPrev, _hullNext: hullNext, _hullTri: hullTri, _hullHash: hullHash} =  this;\r\n        const n = coords.length >> 1;\r\n\r\n        // populate an array of point indices; calculate input data bbox\r\n        let minX = Infinity;\r\n        let minY = Infinity;\r\n        let maxX = -Infinity;\r\n        let maxY = -Infinity;\r\n\r\n        for (let i = 0; i < n; i++) {\r\n            const x = coords[2 * i];\r\n            const y = coords[2 * i + 1];\r\n            if (x < minX) minX = x;\r\n            if (y < minY) minY = y;\r\n            if (x > maxX) maxX = x;\r\n            if (y > maxY) maxY = y;\r\n            this._ids[i] = i;\r\n        }\r\n        const cx = (minX + maxX) / 2;\r\n        const cy = (minY + maxY) / 2;\r\n\r\n        let minDist = Infinity;\r\n        let i0, i1, i2;\r\n\r\n        // pick a seed point close to the center\r\n        for (let i = 0; i < n; i++) {\r\n            const d = dist(cx, cy, coords[2 * i], coords[2 * i + 1]);\r\n            if (d < minDist) {\r\n                i0 = i;\r\n                minDist = d;\r\n            }\r\n        }\r\n        const i0x = coords[2 * i0];\r\n        const i0y = coords[2 * i0 + 1];\r\n\r\n        minDist = Infinity;\r\n\r\n        // find the point closest to the seed\r\n        for (let i = 0; i < n; i++) {\r\n            if (i === i0) continue;\r\n            const d = dist(i0x, i0y, coords[2 * i], coords[2 * i + 1]);\r\n            if (d < minDist && d > 0) {\r\n                i1 = i;\r\n                minDist = d;\r\n            }\r\n        }\r\n        let i1x = coords[2 * i1];\r\n        let i1y = coords[2 * i1 + 1];\r\n\r\n        let minRadius = Infinity;\r\n\r\n        // find the third point which forms the smallest circumcircle with the first two\r\n        for (let i = 0; i < n; i++) {\r\n            if (i === i0 || i === i1) continue;\r\n            const r = circumradius(i0x, i0y, i1x, i1y, coords[2 * i], coords[2 * i + 1]);\r\n            if (r < minRadius) {\r\n                i2 = i;\r\n                minRadius = r;\r\n            }\r\n        }\r\n        let i2x = coords[2 * i2];\r\n        let i2y = coords[2 * i2 + 1];\r\n\r\n        if (minRadius === Infinity) {\r\n            // order collinear points by dx (or dy if all x are identical)\r\n            // and return the list as a hull\r\n            for (let i = 0; i < n; i++) {\r\n                this._dists[i] = (coords[2 * i] - coords[0]) || (coords[2 * i + 1] - coords[1]);\r\n            }\r\n            quicksort(this._ids, this._dists, 0, n - 1);\r\n            const hull = new Uint32Array(n);\r\n            let j = 0;\r\n            for (let i = 0, d0 = -Infinity; i < n; i++) {\r\n                const id = this._ids[i];\r\n                if (this._dists[id] > d0) {\r\n                    hull[j++] = id;\r\n                    d0 = this._dists[id];\r\n                }\r\n            }\r\n            this.hull = hull.subarray(0, j);\r\n            this.triangles = new Uint32Array(0);\r\n            this.halfedges = new Uint32Array(0);\r\n            return;\r\n        }\r\n\r\n        // swap the order of the seed points for counter-clockwise orientation\r\n        if (orient2d(i0x, i0y, i1x, i1y, i2x, i2y) < 0) {\r\n            const i = i1;\r\n            const x = i1x;\r\n            const y = i1y;\r\n            i1 = i2;\r\n            i1x = i2x;\r\n            i1y = i2y;\r\n            i2 = i;\r\n            i2x = x;\r\n            i2y = y;\r\n        }\r\n\r\n        const center = circumcenter(i0x, i0y, i1x, i1y, i2x, i2y);\r\n        this._cx = center.x;\r\n        this._cy = center.y;\r\n\r\n        for (let i = 0; i < n; i++) {\r\n            this._dists[i] = dist(coords[2 * i], coords[2 * i + 1], center.x, center.y);\r\n        }\r\n\r\n        // sort the points by distance from the seed triangle circumcenter\r\n        quicksort(this._ids, this._dists, 0, n - 1);\r\n\r\n        // set up the seed triangle as the starting hull\r\n        this._hullStart = i0;\r\n        let hullSize = 3;\r\n\r\n        hullNext[i0] = hullPrev[i2] = i1;\r\n        hullNext[i1] = hullPrev[i0] = i2;\r\n        hullNext[i2] = hullPrev[i1] = i0;\r\n\r\n        hullTri[i0] = 0;\r\n        hullTri[i1] = 1;\r\n        hullTri[i2] = 2;\r\n\r\n        hullHash.fill(-1);\r\n        hullHash[this._hashKey(i0x, i0y)] = i0;\r\n        hullHash[this._hashKey(i1x, i1y)] = i1;\r\n        hullHash[this._hashKey(i2x, i2y)] = i2;\r\n\r\n        this.trianglesLen = 0;\r\n        this._addTriangle(i0, i1, i2, -1, -1, -1);\r\n\r\n        for (let k = 0, xp, yp; k < this._ids.length; k++) {\r\n            const i = this._ids[k];\r\n            const x = coords[2 * i];\r\n            const y = coords[2 * i + 1];\r\n\r\n            // skip near-duplicate points\r\n            if (k > 0 && Math.abs(x - xp) <= EPSILON && Math.abs(y - yp) <= EPSILON) continue;\r\n            xp = x;\r\n            yp = y;\r\n\r\n            // skip seed triangle points\r\n            if (i === i0 || i === i1 || i === i2) continue;\r\n\r\n            // find a visible edge on the convex hull using edge hash\r\n            let start = 0;\r\n            for (let j = 0, key = this._hashKey(x, y); j < this._hashSize; j++) {\r\n                start = hullHash[(key + j) % this._hashSize];\r\n                if (start !== -1 && start !== hullNext[start]) break;\r\n            }\r\n\r\n            start = hullPrev[start];\r\n            let e = start, q;\r\n            while (q = hullNext[e], orient2d(x, y, coords[2 * e], coords[2 * e + 1], coords[2 * q], coords[2 * q + 1]) >= 0) {\r\n                e = q;\r\n                if (e === start) {\r\n                    e = -1;\r\n                    break;\r\n                }\r\n            }\r\n            if (e === -1) continue; // likely a near-duplicate point; skip it\r\n\r\n            // add the first triangle from the point\r\n            let t = this._addTriangle(e, i, hullNext[e], -1, -1, hullTri[e]);\r\n\r\n            // recursively flip triangles from the point until they satisfy the Delaunay condition\r\n            hullTri[i] = this._legalize(t + 2);\r\n            hullTri[e] = t; // keep track of boundary triangles on the hull\r\n            hullSize++;\r\n\r\n            // walk forward through the hull, adding more triangles and flipping recursively\r\n            let n = hullNext[e];\r\n            while (q = hullNext[n], orient2d(x, y, coords[2 * n], coords[2 * n + 1], coords[2 * q], coords[2 * q + 1]) < 0) {\r\n                t = this._addTriangle(n, i, q, hullTri[i], -1, hullTri[n]);\r\n                hullTri[i] = this._legalize(t + 2);\r\n                hullNext[n] = n; // mark as removed\r\n                hullSize--;\r\n                n = q;\r\n            }\r\n\r\n            // walk backward from the other side, adding more triangles and flipping\r\n            if (e === start) {\r\n                while (q = hullPrev[e], orient2d(x, y, coords[2 * q], coords[2 * q + 1], coords[2 * e], coords[2 * e + 1]) < 0) {\r\n                    t = this._addTriangle(q, i, e, -1, hullTri[e], hullTri[q]);\r\n                    this._legalize(t + 2);\r\n                    hullTri[q] = t;\r\n                    hullNext[e] = e; // mark as removed\r\n                    hullSize--;\r\n                    e = q;\r\n                }\r\n            }\r\n\r\n            // update the hull indices\r\n            this._hullStart = hullPrev[i] = e;\r\n            hullNext[e] = hullPrev[n] = i;\r\n            hullNext[i] = n;\r\n\r\n            // save the two new edges in the hash table\r\n            hullHash[this._hashKey(x, y)] = i;\r\n            hullHash[this._hashKey(coords[2 * e], coords[2 * e + 1])] = e;\r\n        }\r\n\r\n        this.hull = new Uint32Array(hullSize);\r\n        for (let i = 0, e = this._hullStart; i < hullSize; i++) {\r\n            this.hull[i] = e;\r\n            e = hullNext[e];\r\n        }\r\n\r\n        // trim typed triangle mesh arrays\r\n        this.triangles = this._triangles.subarray(0, this.trianglesLen);\r\n        this.halfedges = this._halfedges.subarray(0, this.trianglesLen);\r\n    }\r\n\r\n    _hashKey(x, y) {\r\n        return Math.floor(pseudoAngle(x - this._cx, y - this._cy) * this._hashSize) % this._hashSize;\r\n    }\r\n\r\n    _legalize(a) {\r\n        const {_triangles: triangles, _halfedges: halfedges, coords} = this;\r\n\r\n        let i = 0;\r\n        let ar = 0;\r\n\r\n        // recursion eliminated with a fixed-size stack\r\n        while (true) {\r\n            const b = halfedges[a];\r\n\r\n            /* if the pair of triangles doesn't satisfy the Delaunay condition\r\n             * (p1 is inside the circumcircle of [p0, pl, pr]), flip them,\r\n             * then do the same check/flip recursively for the new pair of triangles\r\n             *\r\n             *           pl                    pl\r\n             *          /||\\                  /  \\\r\n             *       al/ || \\bl            al/    \\a\r\n             *        /  ||  \\              /      \\\r\n             *       /  a||b  \\    flip    /___ar___\\\r\n             *     p0\\   ||   /p1   =>   p0\\---bl---/p1\r\n             *        \\  ||  /              \\      /\r\n             *       ar\\ || /br             b\\    /br\r\n             *          \\||/                  \\  /\r\n             *           pr                    pr\r\n             */\r\n            const a0 = a - a % 3;\r\n            ar = a0 + (a + 2) % 3;\r\n\r\n            if (b === -1) { // convex hull edge\r\n                if (i === 0) break;\r\n                a = EDGE_STACK[--i];\r\n                continue;\r\n            }\r\n\r\n            const b0 = b - b % 3;\r\n            const al = a0 + (a + 1) % 3;\r\n            const bl = b0 + (b + 2) % 3;\r\n\r\n            const p0 = triangles[ar];\r\n            const pr = triangles[a];\r\n            const pl = triangles[al];\r\n            const p1 = triangles[bl];\r\n\r\n            const illegal = inCircle(\r\n                coords[2 * p0], coords[2 * p0 + 1],\r\n                coords[2 * pr], coords[2 * pr + 1],\r\n                coords[2 * pl], coords[2 * pl + 1],\r\n                coords[2 * p1], coords[2 * p1 + 1]);\r\n\r\n            if (illegal) {\r\n                triangles[a] = p1;\r\n                triangles[b] = p0;\r\n\r\n                const hbl = halfedges[bl];\r\n\r\n                // edge swapped on the other side of the hull (rare); fix the halfedge reference\r\n                if (hbl === -1) {\r\n                    let e = this._hullStart;\r\n                    do {\r\n                        if (this._hullTri[e] === bl) {\r\n                            this._hullTri[e] = a;\r\n                            break;\r\n                        }\r\n                        e = this._hullPrev[e];\r\n                    } while (e !== this._hullStart);\r\n                }\r\n                this._link(a, hbl);\r\n                this._link(b, halfedges[ar]);\r\n                this._link(ar, bl);\r\n\r\n                const br = b0 + (b + 1) % 3;\r\n\r\n                // don't worry about hitting the cap: it can only happen on extremely degenerate input\r\n                if (i < EDGE_STACK.length) {\r\n                    EDGE_STACK[i++] = br;\r\n                }\r\n            } else {\r\n                if (i === 0) break;\r\n                a = EDGE_STACK[--i];\r\n            }\r\n        }\r\n\r\n        return ar;\r\n    }\r\n\r\n    _link(a, b) {\r\n        this._halfedges[a] = b;\r\n        if (b !== -1) this._halfedges[b] = a;\r\n    }\r\n\r\n    // add a new triangle given vertex indices and adjacent half-edge ids\r\n    _addTriangle(i0, i1, i2, a, b, c) {\r\n        const t = this.trianglesLen;\r\n\r\n        this._triangles[t] = i0;\r\n        this._triangles[t + 1] = i1;\r\n        this._triangles[t + 2] = i2;\r\n\r\n        this._link(t, a);\r\n        this._link(t + 1, b);\r\n        this._link(t + 2, c);\r\n\r\n        this.trianglesLen += 3;\r\n\r\n        return t;\r\n    }\r\n}\r\n\r\n// monotonically increases with real angle, but doesn't need expensive trigonometry\r\nfunction pseudoAngle(dx, dy) {\r\n    const p = dx / (Math.abs(dx) + Math.abs(dy));\r\n    return (dy > 0 ? 3 - p : 1 + p) / 4; // [0..1]\r\n}\r\n\r\nfunction dist(ax, ay, bx, by) {\r\n    const dx = ax - bx;\r\n    const dy = ay - by;\r\n    return dx * dx + dy * dy;\r\n}\r\n\r\nfunction inCircle(ax, ay, bx, by, cx, cy, px, py) {\r\n    const dx = ax - px;\r\n    const dy = ay - py;\r\n    const ex = bx - px;\r\n    const ey = by - py;\r\n    const fx = cx - px;\r\n    const fy = cy - py;\r\n\r\n    const ap = dx * dx + dy * dy;\r\n    const bp = ex * ex + ey * ey;\r\n    const cp = fx * fx + fy * fy;\r\n\r\n    return dx * (ey * cp - bp * fy) -\r\n           dy * (ex * cp - bp * fx) +\r\n           ap * (ex * fy - ey * fx) < 0;\r\n}\r\n\r\nfunction circumradius(ax, ay, bx, by, cx, cy) {\r\n    const dx = bx - ax;\r\n    const dy = by - ay;\r\n    const ex = cx - ax;\r\n    const ey = cy - ay;\r\n\r\n    const bl = dx * dx + dy * dy;\r\n    const cl = ex * ex + ey * ey;\r\n    const d = 0.5 / (dx * ey - dy * ex);\r\n\r\n    const x = (ey * bl - dy * cl) * d;\r\n    const y = (dx * cl - ex * bl) * d;\r\n\r\n    return x * x + y * y;\r\n}\r\n\r\nfunction circumcenter(ax, ay, bx, by, cx, cy) {\r\n    const dx = bx - ax;\r\n    const dy = by - ay;\r\n    const ex = cx - ax;\r\n    const ey = cy - ay;\r\n\r\n    const bl = dx * dx + dy * dy;\r\n    const cl = ex * ex + ey * ey;\r\n    const d = 0.5 / (dx * ey - dy * ex);\r\n\r\n    const x = ax + (ey * bl - dy * cl) * d;\r\n    const y = ay + (dx * cl - ex * bl) * d;\r\n\r\n    return {x, y};\r\n}\r\n\r\nfunction quicksort(ids, dists, left, right) {\r\n    if (right - left <= 20) {\r\n        for (let i = left + 1; i <= right; i++) {\r\n            const temp = ids[i];\r\n            const tempDist = dists[temp];\r\n            let j = i - 1;\r\n            while (j >= left && dists[ids[j]] > tempDist) ids[j + 1] = ids[j--];\r\n            ids[j + 1] = temp;\r\n        }\r\n    } else {\r\n        const median = (left + right) >> 1;\r\n        let i = left + 1;\r\n        let j = right;\r\n        swap(ids, median, i);\r\n        if (dists[ids[left]] > dists[ids[right]]) swap(ids, left, right);\r\n        if (dists[ids[i]] > dists[ids[right]]) swap(ids, i, right);\r\n        if (dists[ids[left]] > dists[ids[i]]) swap(ids, left, i);\r\n\r\n        const temp = ids[i];\r\n        const tempDist = dists[temp];\r\n        while (true) {\r\n            do i++; while (dists[ids[i]] < tempDist);\r\n            do j--; while (dists[ids[j]] > tempDist);\r\n            if (j < i) break;\r\n            swap(ids, i, j);\r\n        }\r\n        ids[left + 1] = ids[j];\r\n        ids[j] = temp;\r\n\r\n        if (right - i + 1 >= j - left) {\r\n            quicksort(ids, dists, i, right);\r\n            quicksort(ids, dists, left, j - 1);\r\n        } else {\r\n            quicksort(ids, dists, left, j - 1);\r\n            quicksort(ids, dists, i, right);\r\n        }\r\n    }\r\n}\r\n\r\nfunction swap(arr, i, j) {\r\n    const tmp = arr[i];\r\n    arr[i] = arr[j];\r\n    arr[j] = tmp;\r\n}\r\n\r\nfunction defaultGetX(p) {\r\n    return p[0];\r\n}\r\nfunction defaultGetY(p) {\r\n    return p[1];\r\n}\r\n\r\nconst epsilon = 1e-6;\r\n\r\nclass Path {\r\n  constructor() {\r\n    this._x0 = this._y0 = // start of current subpath\r\n    this._x1 = this._y1 = null; // end of current subpath\r\n    this._ = \"\";\r\n  }\r\n  moveTo(x, y) {\r\n    this._ += `M${this._x0 = this._x1 = +x},${this._y0 = this._y1 = +y}`;\r\n  }\r\n  closePath() {\r\n    if (this._x1 !== null) {\r\n      this._x1 = this._x0, this._y1 = this._y0;\r\n      this._ += \"Z\";\r\n    }\r\n  }\r\n  lineTo(x, y) {\r\n    this._ += `L${this._x1 = +x},${this._y1 = +y}`;\r\n  }\r\n  arc(x, y, r) {\r\n    x = +x, y = +y, r = +r;\r\n    const x0 = x + r;\r\n    const y0 = y;\r\n    if (r < 0) throw new Error(\"negative radius\");\r\n    if (this._x1 === null) this._ += `M${x0},${y0}`;\r\n    else if (Math.abs(this._x1 - x0) > epsilon || Math.abs(this._y1 - y0) > epsilon) this._ += \"L\" + x0 + \",\" + y0;\r\n    if (!r) return;\r\n    this._ += `A${r},${r},0,1,1,${x - r},${y}A${r},${r},0,1,1,${this._x1 = x0},${this._y1 = y0}`;\r\n  }\r\n  rect(x, y, w, h) {\r\n    this._ += `M${this._x0 = this._x1 = +x},${this._y0 = this._y1 = +y}h${+w}v${+h}h${-w}Z`;\r\n  }\r\n  value() {\r\n    return this._ || null;\r\n  }\r\n}\r\n\r\nclass Polygon {\r\n  constructor() {\r\n    this._ = [];\r\n  }\r\n  moveTo(x, y) {\r\n    this._.push([x, y]);\r\n  }\r\n  closePath() {\r\n    this._.push(this._[0].slice());\r\n  }\r\n  lineTo(x, y) {\r\n    this._.push([x, y]);\r\n  }\r\n  value() {\r\n    return this._.length ? this._ : null;\r\n  }\r\n}\r\n\r\nclass Voronoi {\r\n  constructor(delaunay, [xmin, ymin, xmax, ymax] = [0, 0, 960, 500]) {\r\n    if (!((xmax = +xmax) >= (xmin = +xmin)) || !((ymax = +ymax) >= (ymin = +ymin))) throw new Error(\"invalid bounds\");\r\n    this.delaunay = delaunay;\r\n    this._circumcenters = new Float64Array(delaunay.points.length * 2);\r\n    this.vectors = new Float64Array(delaunay.points.length * 2);\r\n    this.xmax = xmax, this.xmin = xmin;\r\n    this.ymax = ymax, this.ymin = ymin;\r\n    this._init();\r\n  }\r\n  update() {\r\n    this.delaunay.update();\r\n    this._init();\r\n    return this;\r\n  }\r\n  _init() {\r\n    const {delaunay: {points, hull, triangles}, vectors} = this;\r\n\r\n    // Compute circumcenters.\r\n    const circumcenters = this.circumcenters = this._circumcenters.subarray(0, triangles.length / 3 * 2);\r\n    for (let i = 0, j = 0, n = triangles.length, x, y; i < n; i += 3, j += 2) {\r\n      const t1 = triangles[i] * 2;\r\n      const t2 = triangles[i + 1] * 2;\r\n      const t3 = triangles[i + 2] * 2;\r\n      const x1 = points[t1];\r\n      const y1 = points[t1 + 1];\r\n      const x2 = points[t2];\r\n      const y2 = points[t2 + 1];\r\n      const x3 = points[t3];\r\n      const y3 = points[t3 + 1];\r\n\r\n      const dx = x2 - x1;\r\n      const dy = y2 - y1;\r\n      const ex = x3 - x1;\r\n      const ey = y3 - y1;\r\n      const ab = (dx * ey - dy * ex) * 2;\r\n\r\n      if (Math.abs(ab) < 1e-9) {\r\n        // degenerate case (collinear diagram)\r\n        // almost equal points (degenerate triangle)\r\n        // the circumcenter is at the infinity, in a\r\n        // direction that is:\r\n        // 1. orthogonal to the halfedge.\r\n        let a = 1e9;\r\n        // 2. points away from the center; since the list of triangles starts\r\n        // in the center, the first point of the first triangle\r\n        // will be our reference\r\n        const r = triangles[0] * 2;\r\n        a *= Math.sign((points[r] - x1) * ey - (points[r + 1] - y1) * ex);\r\n        x = (x1 + x3) / 2 - a * ey;\r\n        y = (y1 + y3) / 2 + a * ex;\r\n      } else {\r\n        const d = 1 / ab;\r\n        const bl = dx * dx + dy * dy;\r\n        const cl = ex * ex + ey * ey;\r\n        x = x1 + (ey * bl - dy * cl) * d;\r\n        y = y1 + (dx * cl - ex * bl) * d;\r\n      }\r\n      circumcenters[j] = x;\r\n      circumcenters[j + 1] = y;\r\n    }\r\n\r\n    // Compute exterior cell rays.\r\n    let h = hull[hull.length - 1];\r\n    let p0, p1 = h * 4;\r\n    let x0, x1 = points[2 * h];\r\n    let y0, y1 = points[2 * h + 1];\r\n    vectors.fill(0);\r\n    for (let i = 0; i < hull.length; ++i) {\r\n      h = hull[i];\r\n      p0 = p1, x0 = x1, y0 = y1;\r\n      p1 = h * 4, x1 = points[2 * h], y1 = points[2 * h + 1];\r\n      vectors[p0 + 2] = vectors[p1] = y0 - y1;\r\n      vectors[p0 + 3] = vectors[p1 + 1] = x1 - x0;\r\n    }\r\n  }\r\n  render(context) {\r\n    const buffer = context == null ? context = new Path : undefined;\r\n    const {delaunay: {halfedges, inedges, hull}, circumcenters, vectors} = this;\r\n    if (hull.length <= 1) return null;\r\n    for (let i = 0, n = halfedges.length; i < n; ++i) {\r\n      const j = halfedges[i];\r\n      if (j < i) continue;\r\n      const ti = Math.floor(i / 3) * 2;\r\n      const tj = Math.floor(j / 3) * 2;\r\n      const xi = circumcenters[ti];\r\n      const yi = circumcenters[ti + 1];\r\n      const xj = circumcenters[tj];\r\n      const yj = circumcenters[tj + 1];\r\n      this._renderSegment(xi, yi, xj, yj, context);\r\n    }\r\n    let h0, h1 = hull[hull.length - 1];\r\n    for (let i = 0; i < hull.length; ++i) {\r\n      h0 = h1, h1 = hull[i];\r\n      const t = Math.floor(inedges[h1] / 3) * 2;\r\n      const x = circumcenters[t];\r\n      const y = circumcenters[t + 1];\r\n      const v = h0 * 4;\r\n      const p = this._project(x, y, vectors[v + 2], vectors[v + 3]);\r\n      if (p) this._renderSegment(x, y, p[0], p[1], context);\r\n    }\r\n    return buffer && buffer.value();\r\n  }\r\n  renderBounds(context) {\r\n    const buffer = context == null ? context = new Path : undefined;\r\n    context.rect(this.xmin, this.ymin, this.xmax - this.xmin, this.ymax - this.ymin);\r\n    return buffer && buffer.value();\r\n  }\r\n  renderCell(i, context) {\r\n    const buffer = context == null ? context = new Path : undefined;\r\n    const points = this._clip(i);\r\n    if (points === null || !points.length) return;\r\n    context.moveTo(points[0], points[1]);\r\n    let n = points.length;\r\n    while (points[0] === points[n-2] && points[1] === points[n-1] && n > 1) n -= 2;\r\n    for (let i = 2; i < n; i += 2) {\r\n      if (points[i] !== points[i-2] || points[i+1] !== points[i-1])\r\n        context.lineTo(points[i], points[i + 1]);\r\n    }\r\n    context.closePath();\r\n    return buffer && buffer.value();\r\n  }\r\n  *cellPolygons() {\r\n    const {delaunay: {points}} = this;\r\n    for (let i = 0, n = points.length / 2; i < n; ++i) {\r\n      const cell = this.cellPolygon(i);\r\n      if (cell) cell.index = i, yield cell;\r\n    }\r\n  }\r\n  cellPolygon(i) {\r\n    const polygon = new Polygon;\r\n    this.renderCell(i, polygon);\r\n    return polygon.value();\r\n  }\r\n  _renderSegment(x0, y0, x1, y1, context) {\r\n    let S;\r\n    const c0 = this._regioncode(x0, y0);\r\n    const c1 = this._regioncode(x1, y1);\r\n    if (c0 === 0 && c1 === 0) {\r\n      context.moveTo(x0, y0);\r\n      context.lineTo(x1, y1);\r\n    } else if (S = this._clipSegment(x0, y0, x1, y1, c0, c1)) {\r\n      context.moveTo(S[0], S[1]);\r\n      context.lineTo(S[2], S[3]);\r\n    }\r\n  }\r\n  contains(i, x, y) {\r\n    if ((x = +x, x !== x) || (y = +y, y !== y)) return false;\r\n    return this.delaunay._step(i, x, y) === i;\r\n  }\r\n  *neighbors(i) {\r\n    const ci = this._clip(i);\r\n    if (ci) for (const j of this.delaunay.neighbors(i)) {\r\n      const cj = this._clip(j);\r\n      // find the common edge\r\n      if (cj) loop: for (let ai = 0, li = ci.length; ai < li; ai += 2) {\r\n        for (let aj = 0, lj = cj.length; aj < lj; aj += 2) {\r\n          if (ci[ai] == cj[aj]\r\n          && ci[ai + 1] == cj[aj + 1]\r\n          && ci[(ai + 2) % li] == cj[(aj + lj - 2) % lj]\r\n          && ci[(ai + 3) % li] == cj[(aj + lj - 1) % lj]\r\n          ) {\r\n            yield j;\r\n            break loop;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  _cell(i) {\r\n    const {circumcenters, delaunay: {inedges, halfedges, triangles}} = this;\r\n    const e0 = inedges[i];\r\n    if (e0 === -1) return null; // coincident point\r\n    const points = [];\r\n    let e = e0;\r\n    do {\r\n      const t = Math.floor(e / 3);\r\n      points.push(circumcenters[t * 2], circumcenters[t * 2 + 1]);\r\n      e = e % 3 === 2 ? e - 2 : e + 1;\r\n      if (triangles[e] !== i) break; // bad triangulation\r\n      e = halfedges[e];\r\n    } while (e !== e0 && e !== -1);\r\n    return points;\r\n  }\r\n  _clip(i) {\r\n    // degenerate case (1 valid point: return the box)\r\n    if (i === 0 && this.delaunay.hull.length === 1) {\r\n      return [this.xmax, this.ymin, this.xmax, this.ymax, this.xmin, this.ymax, this.xmin, this.ymin];\r\n    }\r\n    const points = this._cell(i);\r\n    if (points === null) return null;\r\n    const {vectors: V} = this;\r\n    const v = i * 4;\r\n    return V[v] || V[v + 1]\r\n        ? this._clipInfinite(i, points, V[v], V[v + 1], V[v + 2], V[v + 3])\r\n        : this._clipFinite(i, points);\r\n  }\r\n  _clipFinite(i, points) {\r\n    const n = points.length;\r\n    let P = null;\r\n    let x0, y0, x1 = points[n - 2], y1 = points[n - 1];\r\n    let c0, c1 = this._regioncode(x1, y1);\r\n    let e0, e1 = 0;\r\n    for (let j = 0; j < n; j += 2) {\r\n      x0 = x1, y0 = y1, x1 = points[j], y1 = points[j + 1];\r\n      c0 = c1, c1 = this._regioncode(x1, y1);\r\n      if (c0 === 0 && c1 === 0) {\r\n        e0 = e1, e1 = 0;\r\n        if (P) P.push(x1, y1);\r\n        else P = [x1, y1];\r\n      } else {\r\n        let S, sx0, sy0, sx1, sy1;\r\n        if (c0 === 0) {\r\n          if ((S = this._clipSegment(x0, y0, x1, y1, c0, c1)) === null) continue;\r\n          [sx0, sy0, sx1, sy1] = S;\r\n        } else {\r\n          if ((S = this._clipSegment(x1, y1, x0, y0, c1, c0)) === null) continue;\r\n          [sx1, sy1, sx0, sy0] = S;\r\n          e0 = e1, e1 = this._edgecode(sx0, sy0);\r\n          if (e0 && e1) this._edge(i, e0, e1, P, P.length);\r\n          if (P) P.push(sx0, sy0);\r\n          else P = [sx0, sy0];\r\n        }\r\n        e0 = e1, e1 = this._edgecode(sx1, sy1);\r\n        if (e0 && e1) this._edge(i, e0, e1, P, P.length);\r\n        if (P) P.push(sx1, sy1);\r\n        else P = [sx1, sy1];\r\n      }\r\n    }\r\n    if (P) {\r\n      e0 = e1, e1 = this._edgecode(P[0], P[1]);\r\n      if (e0 && e1) this._edge(i, e0, e1, P, P.length);\r\n    } else if (this.contains(i, (this.xmin + this.xmax) / 2, (this.ymin + this.ymax) / 2)) {\r\n      return [this.xmax, this.ymin, this.xmax, this.ymax, this.xmin, this.ymax, this.xmin, this.ymin];\r\n    }\r\n    return P;\r\n  }\r\n  _clipSegment(x0, y0, x1, y1, c0, c1) {\r\n    while (true) {\r\n      if (c0 === 0 && c1 === 0) return [x0, y0, x1, y1];\r\n      if (c0 & c1) return null;\r\n      let x, y, c = c0 || c1;\r\n      if (c & 0b1000) x = x0 + (x1 - x0) * (this.ymax - y0) / (y1 - y0), y = this.ymax;\r\n      else if (c & 0b0100) x = x0 + (x1 - x0) * (this.ymin - y0) / (y1 - y0), y = this.ymin;\r\n      else if (c & 0b0010) y = y0 + (y1 - y0) * (this.xmax - x0) / (x1 - x0), x = this.xmax;\r\n      else y = y0 + (y1 - y0) * (this.xmin - x0) / (x1 - x0), x = this.xmin;\r\n      if (c0) x0 = x, y0 = y, c0 = this._regioncode(x0, y0);\r\n      else x1 = x, y1 = y, c1 = this._regioncode(x1, y1);\r\n    }\r\n  }\r\n  _clipInfinite(i, points, vx0, vy0, vxn, vyn) {\r\n    let P = Array.from(points), p;\r\n    if (p = this._project(P[0], P[1], vx0, vy0)) P.unshift(p[0], p[1]);\r\n    if (p = this._project(P[P.length - 2], P[P.length - 1], vxn, vyn)) P.push(p[0], p[1]);\r\n    if (P = this._clipFinite(i, P)) {\r\n      for (let j = 0, n = P.length, c0, c1 = this._edgecode(P[n - 2], P[n - 1]); j < n; j += 2) {\r\n        c0 = c1, c1 = this._edgecode(P[j], P[j + 1]);\r\n        if (c0 && c1) j = this._edge(i, c0, c1, P, j), n = P.length;\r\n      }\r\n    } else if (this.contains(i, (this.xmin + this.xmax) / 2, (this.ymin + this.ymax) / 2)) {\r\n      P = [this.xmin, this.ymin, this.xmax, this.ymin, this.xmax, this.ymax, this.xmin, this.ymax];\r\n    }\r\n    return P;\r\n  }\r\n  _edge(i, e0, e1, P, j) {\r\n    while (e0 !== e1) {\r\n      let x, y;\r\n      switch (e0) {\r\n        case 0b0101: e0 = 0b0100; continue; // top-left\r\n        case 0b0100: e0 = 0b0110, x = this.xmax, y = this.ymin; break; // top\r\n        case 0b0110: e0 = 0b0010; continue; // top-right\r\n        case 0b0010: e0 = 0b1010, x = this.xmax, y = this.ymax; break; // right\r\n        case 0b1010: e0 = 0b1000; continue; // bottom-right\r\n        case 0b1000: e0 = 0b1001, x = this.xmin, y = this.ymax; break; // bottom\r\n        case 0b1001: e0 = 0b0001; continue; // bottom-left\r\n        case 0b0001: e0 = 0b0101, x = this.xmin, y = this.ymin; break; // left\r\n      }\r\n      // Note: this implicitly checks for out of bounds: if P[j] or P[j+1] are\r\n      // undefined, the conditional statement will be executed.\r\n      if ((P[j] !== x || P[j + 1] !== y) && this.contains(i, x, y)) {\r\n        P.splice(j, 0, x, y), j += 2;\r\n      }\r\n    }\r\n    if (P.length > 4) {\r\n      for (let i = 0; i < P.length; i+= 2) {\r\n        const j = (i + 2) % P.length, k = (i + 4) % P.length;\r\n        if (P[i] === P[j] && P[j] === P[k]\r\n        || P[i + 1] === P[j + 1] && P[j + 1] === P[k + 1])\r\n          P.splice(j, 2), i -= 2;\r\n      }\r\n    }\r\n    return j;\r\n  }\r\n  _project(x0, y0, vx, vy) {\r\n    let t = Infinity, c, x, y;\r\n    if (vy < 0) { // top\r\n      if (y0 <= this.ymin) return null;\r\n      if ((c = (this.ymin - y0) / vy) < t) y = this.ymin, x = x0 + (t = c) * vx;\r\n    } else if (vy > 0) { // bottom\r\n      if (y0 >= this.ymax) return null;\r\n      if ((c = (this.ymax - y0) / vy) < t) y = this.ymax, x = x0 + (t = c) * vx;\r\n    }\r\n    if (vx > 0) { // right\r\n      if (x0 >= this.xmax) return null;\r\n      if ((c = (this.xmax - x0) / vx) < t) x = this.xmax, y = y0 + (t = c) * vy;\r\n    } else if (vx < 0) { // left\r\n      if (x0 <= this.xmin) return null;\r\n      if ((c = (this.xmin - x0) / vx) < t) x = this.xmin, y = y0 + (t = c) * vy;\r\n    }\r\n    return [x, y];\r\n  }\r\n  _edgecode(x, y) {\r\n    return (x === this.xmin ? 0b0001\r\n        : x === this.xmax ? 0b0010 : 0b0000)\r\n        | (y === this.ymin ? 0b0100\r\n        : y === this.ymax ? 0b1000 : 0b0000);\r\n  }\r\n  _regioncode(x, y) {\r\n    return (x < this.xmin ? 0b0001\r\n        : x > this.xmax ? 0b0010 : 0b0000)\r\n        | (y < this.ymin ? 0b0100\r\n        : y > this.ymax ? 0b1000 : 0b0000);\r\n  }\r\n}\r\n\r\nconst tau = 2 * Math.PI, pow = Math.pow;\r\n\r\nfunction pointX(p) {\r\n  return p[0];\r\n}\r\n\r\nfunction pointY(p) {\r\n  return p[1];\r\n}\r\n\r\n// A triangulation is collinear if all its triangles have a non-null area\r\nfunction collinear(d) {\r\n  const {triangles, coords} = d;\r\n  for (let i = 0; i < triangles.length; i += 3) {\r\n    const a = 2 * triangles[i],\r\n          b = 2 * triangles[i + 1],\r\n          c = 2 * triangles[i + 2],\r\n          cross = (coords[c] - coords[a]) * (coords[b + 1] - coords[a + 1])\r\n                - (coords[b] - coords[a]) * (coords[c + 1] - coords[a + 1]);\r\n    if (cross > 1e-10) return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nfunction jitter(x, y, r) {\r\n  return [x + Math.sin(x + y) * r, y + Math.cos(x - y) * r];\r\n}\r\n\r\nclass Delaunay {\r\n  static from(points, fx = pointX, fy = pointY, that) {\r\n    return new Delaunay(\"length\" in points\r\n        ? flatArray(points, fx, fy, that)\r\n        : Float64Array.from(flatIterable(points, fx, fy, that)));\r\n  }\r\n  constructor(points) {\r\n    this._delaunator = new Delaunator(points);\r\n    this.inedges = new Int32Array(points.length / 2);\r\n    this._hullIndex = new Int32Array(points.length / 2);\r\n    this.points = this._delaunator.coords;\r\n    this._init();\r\n  }\r\n  update() {\r\n    this._delaunator.update();\r\n    this._init();\r\n    return this;\r\n  }\r\n  _init() {\r\n    const d = this._delaunator, points = this.points;\r\n\r\n    // check for collinear\r\n    if (d.hull && d.hull.length > 2 && collinear(d)) {\r\n      this.collinear = Int32Array.from({length: points.length/2}, (_,i) => i)\r\n        .sort((i, j) => points[2 * i] - points[2 * j] || points[2 * i + 1] - points[2 * j + 1]); // for exact neighbors\r\n      const e = this.collinear[0], f = this.collinear[this.collinear.length - 1],\r\n        bounds = [ points[2 * e], points[2 * e + 1], points[2 * f], points[2 * f + 1] ],\r\n        r = 1e-8 * Math.hypot(bounds[3] - bounds[1], bounds[2] - bounds[0]);\r\n      for (let i = 0, n = points.length / 2; i < n; ++i) {\r\n        const p = jitter(points[2 * i], points[2 * i + 1], r);\r\n        points[2 * i] = p[0];\r\n        points[2 * i + 1] = p[1];\r\n      }\r\n      this._delaunator = new Delaunator(points);\r\n    } else {\r\n      delete this.collinear;\r\n    }\r\n\r\n    const halfedges = this.halfedges = this._delaunator.halfedges;\r\n    const hull = this.hull = this._delaunator.hull;\r\n    const triangles = this.triangles = this._delaunator.triangles;\r\n    const inedges = this.inedges.fill(-1);\r\n    const hullIndex = this._hullIndex.fill(-1);\r\n\r\n    // Compute an index from each point to an (arbitrary) incoming halfedge\r\n    // Used to give the first neighbor of each point; for this reason,\r\n    // on the hull we give priority to exterior halfedges\r\n    for (let e = 0, n = halfedges.length; e < n; ++e) {\r\n      const p = triangles[e % 3 === 2 ? e - 2 : e + 1];\r\n      if (halfedges[e] === -1 || inedges[p] === -1) inedges[p] = e;\r\n    }\r\n    for (let i = 0, n = hull.length; i < n; ++i) {\r\n      hullIndex[hull[i]] = i;\r\n    }\r\n\r\n    // degenerate case: 1 or 2 (distinct) points\r\n    if (hull.length <= 2 && hull.length > 0) {\r\n      this.triangles = new Int32Array(3).fill(-1);\r\n      this.halfedges = new Int32Array(3).fill(-1);\r\n      this.triangles[0] = hull[0];\r\n      inedges[hull[0]] = 1;\r\n      if (hull.length === 2) {\r\n        inedges[hull[1]] = 0;\r\n        this.triangles[1] = hull[1];\r\n        this.triangles[2] = hull[1];\r\n      }\r\n    }\r\n  }\r\n  voronoi(bounds) {\r\n    return new Voronoi(this, bounds);\r\n  }\r\n  *neighbors(i) {\r\n    const {inedges, hull, _hullIndex, halfedges, triangles, collinear} = this;\r\n\r\n    // degenerate case with several collinear points\r\n    if (collinear) {\r\n      const l = collinear.indexOf(i);\r\n      if (l > 0) yield collinear[l - 1];\r\n      if (l < collinear.length - 1) yield collinear[l + 1];\r\n      return;\r\n    }\r\n\r\n    const e0 = inedges[i];\r\n    if (e0 === -1) return; // coincident point\r\n    let e = e0, p0 = -1;\r\n    do {\r\n      yield p0 = triangles[e];\r\n      e = e % 3 === 2 ? e - 2 : e + 1;\r\n      if (triangles[e] !== i) return; // bad triangulation\r\n      e = halfedges[e];\r\n      if (e === -1) {\r\n        const p = hull[(_hullIndex[i] + 1) % hull.length];\r\n        if (p !== p0) yield p;\r\n        return;\r\n      }\r\n    } while (e !== e0);\r\n  }\r\n  find(x, y, i = 0) {\r\n    if ((x = +x, x !== x) || (y = +y, y !== y)) return -1;\r\n    const i0 = i;\r\n    let c;\r\n    while ((c = this._step(i, x, y)) >= 0 && c !== i && c !== i0) i = c;\r\n    return c;\r\n  }\r\n  _step(i, x, y) {\r\n    const {inedges, hull, _hullIndex, halfedges, triangles, points} = this;\r\n    if (inedges[i] === -1 || !points.length) return (i + 1) % (points.length >> 1);\r\n    let c = i;\r\n    let dc = pow(x - points[i * 2], 2) + pow(y - points[i * 2 + 1], 2);\r\n    const e0 = inedges[i];\r\n    let e = e0;\r\n    do {\r\n      let t = triangles[e];\r\n      const dt = pow(x - points[t * 2], 2) + pow(y - points[t * 2 + 1], 2);\r\n      if (dt < dc) dc = dt, c = t;\r\n      e = e % 3 === 2 ? e - 2 : e + 1;\r\n      if (triangles[e] !== i) break; // bad triangulation\r\n      e = halfedges[e];\r\n      if (e === -1) {\r\n        e = hull[(_hullIndex[i] + 1) % hull.length];\r\n        if (e !== t) {\r\n          if (pow(x - points[e * 2], 2) + pow(y - points[e * 2 + 1], 2) < dc) return e;\r\n        }\r\n        break;\r\n      }\r\n    } while (e !== e0);\r\n    return c;\r\n  }\r\n  render(context) {\r\n    const buffer = context == null ? context = new Path : undefined;\r\n    const {points, halfedges, triangles} = this;\r\n    for (let i = 0, n = halfedges.length; i < n; ++i) {\r\n      const j = halfedges[i];\r\n      if (j < i) continue;\r\n      const ti = triangles[i] * 2;\r\n      const tj = triangles[j] * 2;\r\n      context.moveTo(points[ti], points[ti + 1]);\r\n      context.lineTo(points[tj], points[tj + 1]);\r\n    }\r\n    this.renderHull(context);\r\n    return buffer && buffer.value();\r\n  }\r\n  renderPoints(context, r) {\r\n    if (r === undefined && (!context || typeof context.moveTo !== \"function\")) r = context, context = null;\r\n    r = r == undefined ? 2 : +r;\r\n    const buffer = context == null ? context = new Path : undefined;\r\n    const {points} = this;\r\n    for (let i = 0, n = points.length; i < n; i += 2) {\r\n      const x = points[i], y = points[i + 1];\r\n      context.moveTo(x + r, y);\r\n      context.arc(x, y, r, 0, tau);\r\n    }\r\n    return buffer && buffer.value();\r\n  }\r\n  renderHull(context) {\r\n    const buffer = context == null ? context = new Path : undefined;\r\n    const {hull, points} = this;\r\n    const h = hull[0] * 2, n = hull.length;\r\n    context.moveTo(points[h], points[h + 1]);\r\n    for (let i = 1; i < n; ++i) {\r\n      const h = 2 * hull[i];\r\n      context.lineTo(points[h], points[h + 1]);\r\n    }\r\n    context.closePath();\r\n    return buffer && buffer.value();\r\n  }\r\n  hullPolygon() {\r\n    const polygon = new Polygon;\r\n    this.renderHull(polygon);\r\n    return polygon.value();\r\n  }\r\n  renderTriangle(i, context) {\r\n    const buffer = context == null ? context = new Path : undefined;\r\n    const {points, triangles} = this;\r\n    const t0 = triangles[i *= 3] * 2;\r\n    const t1 = triangles[i + 1] * 2;\r\n    const t2 = triangles[i + 2] * 2;\r\n    context.moveTo(points[t0], points[t0 + 1]);\r\n    context.lineTo(points[t1], points[t1 + 1]);\r\n    context.lineTo(points[t2], points[t2 + 1]);\r\n    context.closePath();\r\n    return buffer && buffer.value();\r\n  }\r\n  *trianglePolygons() {\r\n    const {triangles} = this;\r\n    for (let i = 0, n = triangles.length / 3; i < n; ++i) {\r\n      yield this.trianglePolygon(i);\r\n    }\r\n  }\r\n  trianglePolygon(i) {\r\n    const polygon = new Polygon;\r\n    this.renderTriangle(i, polygon);\r\n    return polygon.value();\r\n  }\r\n}\r\n\r\nfunction flatArray(points, fx, fy, that) {\r\n  const n = points.length;\r\n  const array = new Float64Array(n * 2);\r\n  for (let i = 0; i < n; ++i) {\r\n    const p = points[i];\r\n    array[i * 2] = fx.call(that, p, i, points);\r\n    array[i * 2 + 1] = fy.call(that, p, i, points);\r\n  }\r\n  return array;\r\n}\r\n\r\nfunction* flatIterable(points, fx, fy, that) {\r\n  let i = 0;\r\n  for (const p of points) {\r\n    yield fx.call(that, p, i, points);\r\n    yield fy.call(that, p, i, points);\r\n    ++i;\r\n  }\r\n}\r\n\r\nexport {Delaunay,Voronoi}","/** @module */\r\n\r\n// d3-voronoi\r\n// d3-select\r\n// d3-range\r\n\r\nimport { Delaunay } from '../../lib/d3-delaunay.esm.js'\r\n// import { Delaunay } from 'd3-delaunay'\r\n// import { Delaunay } from 'https://cdn.skypack.dev/d3-delaunay@6'\r\n// https://github.com/d3/d3-delaunay\r\n\r\n/**\r\n * Draw Voronoi cells to show votes.\r\n * @param {VoterGroup} voterGroup\r\n * @param {Election} election\r\n * @param {Screen} screen\r\n * @constructor\r\n */\r\nexport default function voronoiGroup(voterGroup, screen) {\r\n    const self = this\r\n\r\n    let cans\r\n    let voronoi\r\n\r\n    self.update = function (candidates) {\r\n        cans = candidates.getCandidates()\r\n        const points = cans.map((e) => [e.x, e.y])\r\n        const delaunay = Delaunay.from(points)\r\n        voronoi = delaunay.voronoi([0, 0, screen.width, screen.height])\r\n    }\r\n\r\n    self.render = function () {\r\n        const { ctx } = screen\r\n\r\n        ctx.save()\r\n\r\n        // draw circle clip\r\n\r\n        // http://jsfiddle.net/jimrhoskins/dDUC3/1/\r\n        // https://dustinpfister.github.io/2019/10/08/canvas-clip/\r\n        ctx.beginPath()\r\n        ctx.arc(voterGroup.x, voterGroup.y, voterGroup.r, 0, 2 * Math.PI)\r\n        // ctx.closePath()\r\n        ctx.clip()\r\n\r\n        const n = cans.length\r\n        for (let i = 0; i < n; i++) {\r\n            ctx.beginPath()\r\n            voronoi.renderCell(i, ctx)\r\n            ctx.fillStyle = cans[i].square.color\r\n            ctx.fill()\r\n            ctx.stroke()\r\n        }\r\n\r\n        ctx.beginPath()\r\n        ctx.arc(voterGroup.x, voterGroup.y, voterGroup.r, 0, 2 * Math.PI)\r\n        ctx.stroke()\r\n\r\n        ctx.restore()\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Super class\r\n * A SimVoter has functionality for a voter that is specific to a simulation.\r\n * Each SimVoter has a voter component.\r\n * The voter component is a VoterCircle, for now.\r\n * This voter component is common to all simulations.\r\n * An example of a SimVoter is a GeoVoterBasis or a OneVoterCircle.\r\n * This is an inheritance structure.\r\n * @param {VoterCircle} voterCircle - a voter component that SimVoter builds upon.\r\n * @param {DraggableManager} dragm\r\n * @constructor\r\n */\r\nexport default function SimVoter(voterCircle, dragm) {\r\n    const self = this\r\n    self.voter = voterCircle\r\n\r\n    dragm.newCircleHandle(voterCircle, voterCircle.circle)\r\n\r\n    self.renderForeground = () => {\r\n        self.voter.renderForeground()\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport VoronoiGroup from './VoronoiGroup.js'\r\n\r\nimport SimVoter from './SimVoter.js'\r\n\r\n/**\r\n * Adds functionality for showing votes\r\n * @param {VoterCircle} voterCircle\r\n * @param {DraggableManager} dragm\r\n * @param {Screen} screen\r\n * @constructor\r\n */\r\nexport default function OneVoterCircle(voterCircle, dragm, screen) {\r\n    const self = this\r\n    SimVoter.call(self, voterCircle, dragm)\r\n\r\n    const voronoiGroup = new VoronoiGroup(voterCircle, screen)\r\n\r\n    self.update = function (candidates) {\r\n        voronoiGroup.update(candidates)\r\n    }\r\n\r\n    // Graphics component\r\n    self.render = function () {\r\n        // circle\r\n        voronoiGroup.render()\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * SimCandidate has functionality for a candidate that is specific to a simulation.\r\n * SimCandidate has a candidate component.\r\n * The candidate component is a Candidate, for now.\r\n\r\n * @param {Candidate} candidate - a candidate component that SimCandidate builds upon.\r\n * @param {DraggableManager} dragm\r\n * @constructor\r\n */\r\nexport default function SimCandidate(candidate, dragm) {\r\n    const self = this\r\n    self.candidate = candidate\r\n\r\n    dragm.newSquareHandle(candidate, candidate.square)\r\n\r\n    self.renderForeground = () => {\r\n        self.candidate.renderForeground()\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n *\r\n * A simple list of simCandidateDistribution instances.\r\n * It really just passes along function calls to each member of the list.\r\n * It also checks if that member exists. Alternatively, it was deleted.\r\n * @constructor\r\n */\r\nexport default function SimCandidateList() {\r\n    const self = this\r\n\r\n    const simCans = []\r\n\r\n    self.newCandidate = function (simCan) {\r\n        simCans.push(simCan)\r\n    }\r\n\r\n    self.getSimCandidates = () => simCans.filter((simCan) => simCan.candidate.exists)\r\n\r\n    self.getCandidates = () => {\r\n        const simCansEx = self.getSimCandidates()\r\n        return simCansEx.map((simCan) => simCan.candidate)\r\n    }\r\n\r\n    self.setCandidateFractions = (fractions) => {\r\n        const cans = self.getCandidates()\r\n        cans.forEach((can, index) => {\r\n            const fraction = fractions[index]\r\n            can.setFraction(fraction)\r\n        })\r\n    }\r\n    self.setCandidateWins = (winsByCandidate) => {\r\n        const cans = self.getCandidates()\r\n        cans.forEach((can, index) => {\r\n            const win = winsByCandidate[index]\r\n            can.setWins(win)\r\n        })\r\n    }\r\n    self.renderForeground = () => {\r\n        const cans = self.getCandidates()\r\n        cans.forEach((can) => can.renderForeground())\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Made a super class, SimVoterList.\r\n * GeoVoters inherits from SimVoterList.\r\n * There is no OneVoters because there isn't any additional functionality that OneVoters would need.\r\n * SimVoterList is different from Voters because it is a list of simVoters.\r\n * @constructor\r\n */\r\nexport default function SimVoterList() {\r\n    const self = this\r\n\r\n    const simVoters = []\r\n    self.simVoters = simVoters\r\n\r\n    self.newVoterGroup = function (voterGroup) {\r\n        simVoters.push(voterGroup)\r\n    }\r\n\r\n    self.getVoterGroups = () => simVoters.filter((v) => v.voter.exists).map((v) => v.voter)\r\n    self.getSimVoterGroups = () => simVoters.filter((v) => v.voter.exists)\r\n\r\n    self.update = (candidates) => {\r\n        simVoters.forEach((v) => { if (v.voter.exists) v.update(candidates) })\r\n    }\r\n    self.render = () => {\r\n        simVoters.forEach((v) => { if (v.voter.exists) v.render() })\r\n    }\r\n    self.renderForeground = () => {\r\n        simVoters.forEach((v) => { if (v.voter.exists) v.renderForeground() })\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * The super class for each sim. Provides some basic required functionality.\r\n * @param {DraggableManager} dragm\r\n * @constructor\r\n */\r\nexport default function SimBase(dragm, screen) {\r\n    const self = this\r\n    self.enter = () => {\r\n        screen.eventHandlers.set(dragm.eventHandlers)\r\n    }\r\n    self.exit = () => {}\r\n    self.update = () => {}\r\n    self.render = () => { }\r\n    self.renderForeground = () => { }\r\n}\r\n","/** @module */\r\n\r\nimport OneVoterCircle from '../../voters/OneVoterCircle.js'\r\nimport SimCandidate from '../../candidates/SimCandidate.js'\r\nimport SimCandidateList from '../../candidates/SimCandidateList.js'\r\nimport SimVoterList from '../../voters/SimVoterList.js'\r\nimport SimBase from './SimBase.js'\r\n\r\n/**\r\n * Simulate one election with\r\n *   candidates in defined positions, and\r\n *   voters in a distribution that will be summed over.\r\n * @param {Screen} screen\r\n * @param {DraggableManager} dragm\r\n * @param {Menu} menu\r\n * @param {Changes} changes\r\n * @param {Election} election\r\n * @param {Object} canButton - a button that lets us add a candidate\r\n * @constructor\r\n */\r\nexport default function SimOne(screen, dragm, menu, changes, oneElection, canButton) {\r\n    const self = this\r\n\r\n    SimBase.call(self, dragm, screen)\r\n\r\n    const oneVoters = new SimVoterList()\r\n\r\n    const simCandidateList = new SimCandidateList()\r\n\r\n    self.addSimCandidate = (candidate) => {\r\n        simCandidateList.newCandidate(new SimCandidate(candidate, dragm))\r\n    }\r\n\r\n    self.addSimVoterCircle = (voterCircle) => {\r\n        oneVoters.newVoterGroup(new OneVoterCircle(voterCircle, dragm, screen))\r\n    }\r\n\r\n    const superEnter = self.enter\r\n    self.enter = () => {\r\n        superEnter()\r\n        canButton.show()\r\n    }\r\n\r\n    self.exit = () => {\r\n        canButton.hide()\r\n    }\r\n\r\n    self.update = () => {\r\n        if (changes.checkNone()) return\r\n        // clear changes, reset to []\r\n        changes.clear()\r\n        oneElection.updateTallies(oneVoters, simCandidateList)\r\n        oneVoters.update(simCandidateList)\r\n        screen.clear()\r\n        self.render()\r\n    }\r\n\r\n    self.render = () => {\r\n        oneVoters.render()\r\n    }\r\n    self.renderForeground = () => {\r\n        // sampleElections.renderForeground()\r\n        oneVoters.renderForeground()\r\n        simCandidateList.renderForeground()\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Use this to sample a random candidate from a collection of distributions of candidates.\r\n * Sample a point multiple times after the constructor call.\r\n * @param {CandidateDistribution[]} candidateDistributions\r\n * @constructor\r\n */\r\nexport default function CandidateDistributionSampler(candidateDistributions) {\r\n    const self = this\r\n    // cumulative distribution function\r\n    const cdf = getCDF(candidateDistributions)\r\n    self.samplePoint = function () {\r\n        return samplePoint1(candidateDistributions, cdf)\r\n    }\r\n}\r\n\r\nfunction samplePoint1(candidateDistributions, cdf) {\r\n    // pick a voter distribution\r\n    const iDist = randomDistribution(cdf)\r\n    const cd = candidateDistributions[iDist]\r\n    // sample circle\r\n    const point = randomInsideCircle(cd.x, cd.y, cd.r)\r\n    return point\r\n}\r\n\r\nfunction randomDistribution(cdf) {\r\n    // sample from distribution\r\n    // pick a random number from 0 to 1\r\n    const random1 = Math.random()\r\n    const selectDistribution = cdf.findIndex((x) => x >= random1)\r\n    return selectDistribution\r\n}\r\n\r\nfunction getCDF(candidateDistributions) {\r\n    // find the size of the voter distributions\r\n    const areasProportion = candidateDistributions.map((cd) => cd.r ** 2)\r\n\r\n    const sumAreasProportion = areasProportion.reduce((p, c) => p + c)\r\n\r\n    // probability mass function\r\n    const pmf = areasProportion.map((p) => p / sumAreasProportion)\r\n\r\n    // https://stackoverflow.com/a/20477613\r\n    // [5, 10, 3, 2];\r\n    // [5, 15, 18, 20]\r\n    // cumulative distribution function\r\n    const cdf = []\r\n    pmf.reduce((p, c, i) => {\r\n        const a = p + c\r\n        cdf[i] = a\r\n        return a\r\n    }, 0)\r\n\r\n    return cdf\r\n}\r\n\r\nfunction randomInsideCircle(X, Y, R) {\r\n    // https://stackoverflow.com/a/50746409\r\n    const r = R * Math.sqrt(Math.random())\r\n    const theta = Math.random() * 2 * Math.PI\r\n\r\n    // convert to cartesian\r\n\r\n    const x = X + r * Math.cos(theta)\r\n    const y = Y + r * Math.sin(theta)\r\n    return { x, y }\r\n}\r\n","/** @module */\r\n\r\nimport CandidateDistributionSampler from '../election/CandidateDistributionSampler.js'\r\n\r\n/**\r\n * A simple list of simCandidateDistribution instances.\r\n * It really just passes along function calls to each member of the list.\r\n * It also checks if that member exists. Alternatively, it was deleted.\r\n * @constructor\r\n */\r\nexport default function SimCandidateDistributionList() {\r\n    const self = this\r\n\r\n    const simCanDns = []\r\n\r\n    self.newCandidate = function (simCanDn) {\r\n        simCanDns.push(simCanDn)\r\n    }\r\n\r\n    // get sim entities that exist\r\n    self.getSimCandidateDistributions = () => {\r\n        const a = simCanDns.filter((simCanDn) => simCanDn.canDn.exists)\r\n        return a\r\n    }\r\n\r\n    // get the underlying entities of the above\r\n    self.getCandidateDistributions = () => {\r\n        const simCanDnsEx = self.getSimCandidateDistributions()\r\n        return simCanDnsEx.map((simCanDn) => simCanDn.canDn)\r\n    }\r\n\r\n    self.startSampler = () => {\r\n        const canDns = self.getCandidateDistributions()\r\n        self.sampler = new CandidateDistributionSampler(canDns)\r\n    }\r\n    self.render = () => {\r\n        const canDns = self.getCandidateDistributions()\r\n        canDns.forEach((canDn) => canDn.render())\r\n    }\r\n    self.renderForeground = () => {\r\n        const canDns = self.getCandidateDistributions()\r\n        canDns.forEach((canDn) => canDn.renderForeground())\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * SimCandidate has functionality for a canDn that is specific to a simulation.\r\n * SimCandidate has a canDn component.\r\n * The canDn component is a CandidateDistribution, for now.\r\n\r\n * @param {CandidateDistribution} canDn - a canDn component that SimCandidate builds upon.\r\n * @param {DraggableManager} dragm\r\n * @constructor\r\n */\r\nexport default function SimCandidateDistribution(canDn, dragm) {\r\n    const self = this\r\n    self.canDn = canDn\r\n\r\n    dragm.newSquareHandle(canDn, canDn.square)\r\n\r\n    self.renderForeground = () => {\r\n        self.canDn.renderForeground()\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport SimVoter from './SimVoter.js'\r\n\r\n/**\r\n * VoterCircle for simulations of many sampled candidates\r\n * VoterCircle class with Handle component to take care of dragging.\r\n * @param {VoterCircle} voterCircle - a voter component that SimVoter builds upon.\r\n * @param {DraggableManager} dragm\r\n * @param {screen} screen - draw to the screen\r\n * @constructor\r\n */\r\nexport default function SampleVoterCircle(voterCircle, dragm, screen) {\r\n    const self = this\r\n    SimVoter.call(self, voterCircle, dragm)\r\n\r\n    // Graphics component\r\n    self.render = function () {\r\n        const { ctx } = screen\r\n        // circle\r\n        ctx.beginPath()\r\n        // ctx.fillStyle = \"#eee\"\r\n        const { x, y, r } = self.voter\r\n        ctx.arc(x, y, r, 0, 2 * Math.PI)\r\n        // ctx.fill()\r\n        ctx.stroke()\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport SimCandidateDistributionList from '../../candidates/SimCandidateDistributionList.js'\r\nimport SimCandidateDistribution from '../../candidates/SimCandidateDistribution.js'\r\nimport SampleVoterCircle from '../../voters/SampleVoterCircle.js'\r\nimport SimVoterList from '../../voters/SimVoterList.js'\r\nimport SimBase from './SimBase.js'\r\n\r\n/**\r\n * Simulate many sample elections with\r\n *   candidates in random positions within a distribution, and\r\n *   voters in a distribution that will be summed over.\r\n * @param {Screen} screen\r\n * @param {DraggableManager} dragm\r\n * @param {Menu} menu\r\n * @param {Changes} changes\r\n * @param {SimElection} sampleElections\r\n * @param {Object} canDnButton - a button that lets us add a candidateDistribution\r\n * @constructor\r\n */\r\nexport default function SimSample(screen, dragm, menu, changes, sampleElections, canDnButton) {\r\n    const self = this\r\n\r\n    SimBase.call(self, dragm, screen)\r\n\r\n    const simCandidateList = new SimCandidateDistributionList()\r\n\r\n    self.addSimCandidateDistribution = (canDn) => {\r\n        simCandidateList.newCandidate(new SimCandidateDistribution(canDn, dragm))\r\n    }\r\n\r\n    const sampleVoters = new SimVoterList()\r\n\r\n    self.addSimVoterCircle = (voterCircle) => {\r\n        sampleVoters.newVoterGroup(new SampleVoterCircle(voterCircle, dragm, screen))\r\n    }\r\n\r\n    const superEnter = self.enter\r\n    self.enter = () => {\r\n        superEnter()\r\n        canDnButton.show()\r\n    }\r\n\r\n    self.exit = () => {\r\n        canDnButton.hide()\r\n    }\r\n\r\n    self.update = () => {\r\n        if (changes.checkNone()) {\r\n            const noChange = sampleElections.addSim(sampleVoters, simCandidateList)\r\n            if (!noChange) {\r\n                changes.clear()\r\n                // changed, so re-render\r\n                screen.clear()\r\n                self.render()\r\n            }\r\n        } else {\r\n            // clear changes, reset to []\r\n            changes.clear()\r\n            simCandidateList.startSampler()\r\n            sampleElections.startSim()\r\n            screen.clear()\r\n            self.render()\r\n        }\r\n    }\r\n\r\n    self.render = () => {\r\n        sampleElections.render()\r\n        sampleVoters.render()\r\n        simCandidateList.render()\r\n    }\r\n    self.renderForeground = () => {\r\n        sampleVoters.renderForeground()\r\n        simCandidateList.renderForeground()\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport SimVoter from './SimVoter.js'\r\n/**\r\n * A basis of voters, to be moved around according to noise.\r\n * Also, the user can move them around.\r\n * This is a Subclass of SimVoter.\r\n * @param {VoterCircle} voterCircle - a voter component that SimVoter builds upon.\r\n * @param {DraggableManager} dragm\r\n * @param {screen} screen - draw to the screen\r\n * @constructor\r\n */\r\nexport default function GeoVoterBasis(voterCircle, dragm, screen) {\r\n    const self = this\r\n    SimVoter.call(self, voterCircle, dragm)\r\n\r\n    // Graphics component\r\n    self.render = function () {\r\n        const { ctx } = screen\r\n        // circle\r\n        ctx.beginPath()\r\n        // ctx.fillStyle = \"#eee\"\r\n        ctx.arc(self.x, self.y, self.r, 0, 2 * Math.PI)\r\n        // ctx.fill()\r\n        ctx.stroke()\r\n    }\r\n    self.renderAt = function (newX, newY) {\r\n        const { ctx } = screen\r\n        // circle\r\n        ctx.beginPath()\r\n        // ctx.fillStyle = \"#eee\"\r\n        ctx.arc(newX, newY, self.r, 0, 2 * Math.PI)\r\n        // ctx.fill()\r\n        ctx.stroke()\r\n    }\r\n    self.renderCenterAt = function (newX, newY) {\r\n        const { ctx } = screen\r\n        // circle\r\n        ctx.beginPath()\r\n        ctx.fillStyle = '#555'\r\n        ctx.arc(newX, newY, 1, 0, 2 * Math.PI)\r\n        ctx.fill()\r\n        // ctx.stroke()\r\n    }\r\n}\r\n","/*\r\n * A fast javascript implementation of simplex noise by Jonas Wagner\r\n\r\nBased on a speed-improved simplex noise algorithm for 2D, 3D and 4D in Java.\r\nWhich is based on example code by Stefan Gustavson (stegu@itn.liu.se).\r\nWith Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).\r\nBetter rank ordering method by Stefan Gustavson in 2012.\r\n\r\n Copyright (c) 2021 Jonas Wagner\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights\r\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n copies of the Software, and to permit persons to whom the Software is\r\n furnished to do so, subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in all\r\n copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n SOFTWARE.\r\n */\r\n\r\nconst F2 = 0.5 * (Math.sqrt(3.0) - 1.0);\r\nconst G2 = (3.0 - Math.sqrt(3.0)) / 6.0;\r\nconst F3 = 1.0 / 3.0;\r\nconst G3 = 1.0 / 6.0;\r\nconst F4 = (Math.sqrt(5.0) - 1.0) / 4.0;\r\nconst G4 = (5.0 - Math.sqrt(5.0)) / 20.0;\r\n\r\nconst grad3 = new Float32Array([1, 1, 0,\r\n  -1, 1, 0,\r\n  1, -1, 0,\r\n\r\n  -1, -1, 0,\r\n  1, 0, 1,\r\n  -1, 0, 1,\r\n\r\n  1, 0, -1,\r\n  -1, 0, -1,\r\n  0, 1, 1,\r\n\r\n  0, -1, 1,\r\n  0, 1, -1,\r\n  0, -1, -1]);\r\n\r\nconst grad4 = new Float32Array([0, 1, 1, 1, 0, 1, 1, -1, 0, 1, -1, 1, 0, 1, -1, -1,\r\n  0, -1, 1, 1, 0, -1, 1, -1, 0, -1, -1, 1, 0, -1, -1, -1,\r\n  1, 0, 1, 1, 1, 0, 1, -1, 1, 0, -1, 1, 1, 0, -1, -1,\r\n  -1, 0, 1, 1, -1, 0, 1, -1, -1, 0, -1, 1, -1, 0, -1, -1,\r\n  1, 1, 0, 1, 1, 1, 0, -1, 1, -1, 0, 1, 1, -1, 0, -1,\r\n  -1, 1, 0, 1, -1, 1, 0, -1, -1, -1, 0, 1, -1, -1, 0, -1,\r\n  1, 1, 1, 0, 1, 1, -1, 0, 1, -1, 1, 0, 1, -1, -1, 0,\r\n  -1, 1, 1, 0, -1, 1, -1, 0, -1, -1, 1, 0, -1, -1, -1, 0]);\r\n\r\n/**\r\n * A random() function, must return a numer in the interval [0,1), just like Math.random().\r\n */ \r\nexport type RandomFn = () => number;\r\n\r\n/** Deterministic simplex noise generator suitable for 2D, 3D and 4D spaces. */\r\nexport class SimplexNoise {\r\n  private p: Uint8Array;\r\n  private perm: Uint8Array;\r\n  private permMod12: Uint8Array;\r\n  /**\r\n   * Creates a new `SimplexNoise` instance.\r\n   * This involves some setup. You can save a few cpu cycles by reusing the same instance.\r\n   * @param randomOrSeed A random number generator or a seed (string|number).\r\n   * Defaults to Math.random (random irreproducible initialization).\r\n   */\r\n  constructor(randomOrSeed: RandomFn|string|number = Math.random) {\r\n    const random = typeof randomOrSeed == 'function' ? randomOrSeed : alea(randomOrSeed);\r\n    this.p = buildPermutationTable(random);\r\n    this.perm = new Uint8Array(512);\r\n    this.permMod12 = new Uint8Array(512);\r\n    for (let i = 0; i < 512; i++) {\r\n      this.perm[i] = this.p[i & 255];\r\n      this.permMod12[i] = this.perm[i] % 12;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Samples the noise field in 2 dimensions\r\n   * @param x\r\n   * @param y \r\n   * @returns a number in the interval [-1, 1]\r\n   */\r\n  noise2D(x: number, y: number): number {\r\n    const permMod12 = this.permMod12;\r\n    const perm = this.perm;\r\n    let n0 = 0; // Noise contributions from the three corners\r\n    let n1 = 0;\r\n    let n2 = 0;\r\n    // Skew the input space to determine which simplex cell we're in\r\n    const s = (x + y) * F2; // Hairy factor for 2D\r\n    const i = Math.floor(x + s);\r\n    const j = Math.floor(y + s);\r\n    const t = (i + j) * G2;\r\n    const X0 = i - t; // Unskew the cell origin back to (x,y) space\r\n    const Y0 = j - t;\r\n    const x0 = x - X0; // The x,y distances from the cell origin\r\n    const y0 = y - Y0;\r\n    // For the 2D case, the simplex shape is an equilateral triangle.\r\n    // Determine which simplex we are in.\r\n    let i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\r\n    if (x0 > y0) {\r\n      i1 = 1;\r\n      j1 = 0;\r\n    } // lower triangle, XY order: (0,0)->(1,0)->(1,1)\r\n    else {\r\n      i1 = 0;\r\n      j1 = 1;\r\n    } // upper triangle, YX order: (0,0)->(0,1)->(1,1)\r\n    // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\r\n    // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\r\n    // c = (3-sqrt(3))/6\r\n    const x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords\r\n    const y1 = y0 - j1 + G2;\r\n    const x2 = x0 - 1.0 + 2.0 * G2; // Offsets for last corner in (x,y) unskewed coords\r\n    const y2 = y0 - 1.0 + 2.0 * G2;\r\n    // Work out the hashed gradient indices of the three simplex corners\r\n    const ii = i & 255;\r\n    const jj = j & 255;\r\n    // Calculate the contribution from the three corners\r\n    let t0 = 0.5 - x0 * x0 - y0 * y0;\r\n    if (t0 >= 0) {\r\n      const gi0 = permMod12[ii + perm[jj]] * 3;\r\n      t0 *= t0;\r\n      n0 = t0 * t0 * (grad3[gi0] * x0 + grad3[gi0 + 1] * y0); // (x,y) of grad3 used for 2D gradient\r\n    }\r\n    let t1 = 0.5 - x1 * x1 - y1 * y1;\r\n    if (t1 >= 0) {\r\n      const gi1 = permMod12[ii + i1 + perm[jj + j1]] * 3;\r\n      t1 *= t1;\r\n      n1 = t1 * t1 * (grad3[gi1] * x1 + grad3[gi1 + 1] * y1);\r\n    }\r\n    let t2 = 0.5 - x2 * x2 - y2 * y2;\r\n    if (t2 >= 0) {\r\n      const gi2 = permMod12[ii + 1 + perm[jj + 1]] * 3;\r\n      t2 *= t2;\r\n      n2 = t2 * t2 * (grad3[gi2] * x2 + grad3[gi2 + 1] * y2);\r\n    }\r\n    // Add contributions from each corner to get the final noise value.\r\n    // The result is scaled to return values in the interval [-1,1].\r\n    return 70.0 * (n0 + n1 + n2);\r\n  }\r\n\r\n  /**\r\n   * Samples the noise field in 3 dimensions\r\n   * @param x \r\n   * @param y \r\n   * @param z \r\n   * @returns a number in the interval [-1, 1]\r\n   */\r\n  noise3D(x:number, y:number, z:number): number {\r\n    const permMod12 = this.permMod12;\r\n    const perm = this.perm;\r\n    let n0, n1, n2, n3; // Noise contributions from the four corners\r\n    // Skew the input space to determine which simplex cell we're in\r\n    const s = (x + y + z) * F3; // Very nice and simple skew factor for 3D\r\n    const i = Math.floor(x + s);\r\n    const j = Math.floor(y + s);\r\n    const k = Math.floor(z + s);\r\n    const t = (i + j + k) * G3;\r\n    const X0 = i - t; // Unskew the cell origin back to (x,y,z) space\r\n    const Y0 = j - t;\r\n    const Z0 = k - t;\r\n    const x0 = x - X0; // The x,y,z distances from the cell origin\r\n    const y0 = y - Y0;\r\n    const z0 = z - Z0;\r\n    // For the 3D case, the simplex shape is a slightly irregular tetrahedron.\r\n    // Determine which simplex we are in.\r\n    let i1, j1, k1; // Offsets for second corner of simplex in (i,j,k) coords\r\n    let i2, j2, k2; // Offsets for third corner of simplex in (i,j,k) coords\r\n    if (x0 >= y0) {\r\n      if (y0 >= z0) {\r\n        i1 = 1;\r\n        j1 = 0;\r\n        k1 = 0;\r\n        i2 = 1;\r\n        j2 = 1;\r\n        k2 = 0;\r\n      } // X Y Z order\r\n      else if (x0 >= z0) {\r\n        i1 = 1;\r\n        j1 = 0;\r\n        k1 = 0;\r\n        i2 = 1;\r\n        j2 = 0;\r\n        k2 = 1;\r\n      } // X Z Y order\r\n      else {\r\n        i1 = 0;\r\n        j1 = 0;\r\n        k1 = 1;\r\n        i2 = 1;\r\n        j2 = 0;\r\n        k2 = 1;\r\n      } // Z X Y order\r\n    }\r\n    else { // x0<y0\r\n      if (y0 < z0) {\r\n        i1 = 0;\r\n        j1 = 0;\r\n        k1 = 1;\r\n        i2 = 0;\r\n        j2 = 1;\r\n        k2 = 1;\r\n      } // Z Y X order\r\n      else if (x0 < z0) {\r\n        i1 = 0;\r\n        j1 = 1;\r\n        k1 = 0;\r\n        i2 = 0;\r\n        j2 = 1;\r\n        k2 = 1;\r\n      } // Y Z X order\r\n      else {\r\n        i1 = 0;\r\n        j1 = 1;\r\n        k1 = 0;\r\n        i2 = 1;\r\n        j2 = 1;\r\n        k2 = 0;\r\n      } // Y X Z order\r\n    }\r\n    // A step of (1,0,0) in (i,j,k) means a step of (1-c,-c,-c) in (x,y,z),\r\n    // a step of (0,1,0) in (i,j,k) means a step of (-c,1-c,-c) in (x,y,z), and\r\n    // a step of (0,0,1) in (i,j,k) means a step of (-c,-c,1-c) in (x,y,z), where\r\n    // c = 1/6.\r\n    const x1 = x0 - i1 + G3; // Offsets for second corner in (x,y,z) coords\r\n    const y1 = y0 - j1 + G3;\r\n    const z1 = z0 - k1 + G3;\r\n    const x2 = x0 - i2 + 2.0 * G3; // Offsets for third corner in (x,y,z) coords\r\n    const y2 = y0 - j2 + 2.0 * G3;\r\n    const z2 = z0 - k2 + 2.0 * G3;\r\n    const x3 = x0 - 1.0 + 3.0 * G3; // Offsets for last corner in (x,y,z) coords\r\n    const y3 = y0 - 1.0 + 3.0 * G3;\r\n    const z3 = z0 - 1.0 + 3.0 * G3;\r\n    // Work out the hashed gradient indices of the four simplex corners\r\n    const ii = i & 255;\r\n    const jj = j & 255;\r\n    const kk = k & 255;\r\n    // Calculate the contribution from the four corners\r\n    let t0 = 0.6 - x0 * x0 - y0 * y0 - z0 * z0;\r\n    if (t0 < 0) n0 = 0.0;\r\n    else {\r\n      const gi0 = permMod12[ii + perm[jj + perm[kk]]] * 3;\r\n      t0 *= t0;\r\n      n0 = t0 * t0 * (grad3[gi0] * x0 + grad3[gi0 + 1] * y0 + grad3[gi0 + 2] * z0);\r\n    }\r\n    let t1 = 0.6 - x1 * x1 - y1 * y1 - z1 * z1;\r\n    if (t1 < 0) n1 = 0.0;\r\n    else {\r\n      const gi1 = permMod12[ii + i1 + perm[jj + j1 + perm[kk + k1]]] * 3;\r\n      t1 *= t1;\r\n      n1 = t1 * t1 * (grad3[gi1] * x1 + grad3[gi1 + 1] * y1 + grad3[gi1 + 2] * z1);\r\n    }\r\n    let t2 = 0.6 - x2 * x2 - y2 * y2 - z2 * z2;\r\n    if (t2 < 0) n2 = 0.0;\r\n    else {\r\n      const gi2 = permMod12[ii + i2 + perm[jj + j2 + perm[kk + k2]]] * 3;\r\n      t2 *= t2;\r\n      n2 = t2 * t2 * (grad3[gi2] * x2 + grad3[gi2 + 1] * y2 + grad3[gi2 + 2] * z2);\r\n    }\r\n    let t3 = 0.6 - x3 * x3 - y3 * y3 - z3 * z3;\r\n    if (t3 < 0) n3 = 0.0;\r\n    else {\r\n      const gi3 = permMod12[ii + 1 + perm[jj + 1 + perm[kk + 1]]] * 3;\r\n      t3 *= t3;\r\n      n3 = t3 * t3 * (grad3[gi3] * x3 + grad3[gi3 + 1] * y3 + grad3[gi3 + 2] * z3);\r\n    }\r\n    // Add contributions from each corner to get the final noise value.\r\n    // The result is scaled to stay just inside [-1,1]\r\n    return 32.0 * (n0 + n1 + n2 + n3);\r\n  }\r\n\r\n  /**\r\n   * Samples the noise field in 4 dimensions\r\n   * @param x \r\n   * @param y \r\n   * @param z \r\n   * @returns a number in the interval [-1, 1]\r\n   */\r\n  noise4D(x:number, y:number, z:number, w:number): number {\r\n    const perm = this.perm;\r\n\r\n    let n0, n1, n2, n3, n4; // Noise contributions from the five corners\r\n    // Skew the (x,y,z,w) space to determine which cell of 24 simplices we're in\r\n    const s = (x + y + z + w) * F4; // Factor for 4D skewing\r\n    const i = Math.floor(x + s);\r\n    const j = Math.floor(y + s);\r\n    const k = Math.floor(z + s);\r\n    const l = Math.floor(w + s);\r\n    const t = (i + j + k + l) * G4; // Factor for 4D unskewing\r\n    const X0 = i - t; // Unskew the cell origin back to (x,y,z,w) space\r\n    const Y0 = j - t;\r\n    const Z0 = k - t;\r\n    const W0 = l - t;\r\n    const x0 = x - X0; // The x,y,z,w distances from the cell origin\r\n    const y0 = y - Y0;\r\n    const z0 = z - Z0;\r\n    const w0 = w - W0;\r\n    // For the 4D case, the simplex is a 4D shape I won't even try to describe.\r\n    // To find out which of the 24 possible simplices we're in, we need to\r\n    // determine the magnitude ordering of x0, y0, z0 and w0.\r\n    // Six pair-wise comparisons are performed between each possible pair\r\n    // of the four coordinates, and the results are used to rank the numbers.\r\n    let rankx = 0;\r\n    let ranky = 0;\r\n    let rankz = 0;\r\n    let rankw = 0;\r\n    if (x0 > y0) rankx++;\r\n    else ranky++;\r\n    if (x0 > z0) rankx++;\r\n    else rankz++;\r\n    if (x0 > w0) rankx++;\r\n    else rankw++;\r\n    if (y0 > z0) ranky++;\r\n    else rankz++;\r\n    if (y0 > w0) ranky++;\r\n    else rankw++;\r\n    if (z0 > w0) rankz++;\r\n    else rankw++;\r\n    // simplex[c] is a 4-vector with the numbers 0, 1, 2 and 3 in some order.\r\n    // Many values of c will never occur, since e.g. x>y>z>w makes x<z, y<w and x<w\r\n    // impossible. Only the 24 indices which have non-zero entries make any sense.\r\n    // We use a thresholding to set the coordinates in turn from the largest magnitude.\r\n    // Rank 3 denotes the largest coordinate.\r\n    // Rank 2 denotes the second largest coordinate.\r\n    // Rank 1 denotes the second smallest coordinate.\r\n\r\n    // The integer offsets for the second simplex corner\r\n    const i1 = rankx >= 3 ? 1 : 0;\r\n    const j1 = ranky >= 3 ? 1 : 0;\r\n    const k1 = rankz >= 3 ? 1 : 0;\r\n    const l1 = rankw >= 3 ? 1 : 0;\r\n    // The integer offsets for the third simplex corner\r\n    const i2 = rankx >= 2 ? 1 : 0;\r\n    const j2 = ranky >= 2 ? 1 : 0;\r\n    const k2 = rankz >= 2 ? 1 : 0;\r\n    const l2 = rankw >= 2 ? 1 : 0;\r\n\r\n    // The integer offsets for the fourth simplex corner\r\n    const i3 = rankx >= 1 ? 1 : 0;\r\n    const j3 = ranky >= 1 ? 1 : 0;\r\n    const k3 = rankz >= 1 ? 1 : 0;\r\n    const l3 = rankw >= 1 ? 1 : 0;\r\n    // The fifth corner has all coordinate offsets = 1, so no need to compute that.\r\n    const x1 = x0 - i1 + G4; // Offsets for second corner in (x,y,z,w) coords\r\n    const y1 = y0 - j1 + G4;\r\n    const z1 = z0 - k1 + G4;\r\n    const w1 = w0 - l1 + G4;\r\n    const x2 = x0 - i2 + 2.0 * G4; // Offsets for third corner in (x,y,z,w) coords\r\n    const y2 = y0 - j2 + 2.0 * G4;\r\n    const z2 = z0 - k2 + 2.0 * G4;\r\n    const w2 = w0 - l2 + 2.0 * G4;\r\n    const x3 = x0 - i3 + 3.0 * G4; // Offsets for fourth corner in (x,y,z,w) coords\r\n    const y3 = y0 - j3 + 3.0 * G4;\r\n    const z3 = z0 - k3 + 3.0 * G4;\r\n    const w3 = w0 - l3 + 3.0 * G4;\r\n    const x4 = x0 - 1.0 + 4.0 * G4; // Offsets for last corner in (x,y,z,w) coords\r\n    const y4 = y0 - 1.0 + 4.0 * G4;\r\n    const z4 = z0 - 1.0 + 4.0 * G4;\r\n    const w4 = w0 - 1.0 + 4.0 * G4;\r\n    // Work out the hashed gradient indices of the five simplex corners\r\n    const ii = i & 255;\r\n    const jj = j & 255;\r\n    const kk = k & 255;\r\n    const ll = l & 255;\r\n    // Calculate the contribution from the five corners\r\n    let t0 = 0.6 - x0 * x0 - y0 * y0 - z0 * z0 - w0 * w0;\r\n    if (t0 < 0) n0 = 0.0;\r\n    else {\r\n      const gi0 = (perm[ii + perm[jj + perm[kk + perm[ll]]]] % 32) * 4;\r\n      t0 *= t0;\r\n      n0 = t0 * t0 * (grad4[gi0] * x0 + grad4[gi0 + 1] * y0 + grad4[gi0 + 2] * z0 + grad4[gi0 + 3] * w0);\r\n    }\r\n    let t1 = 0.6 - x1 * x1 - y1 * y1 - z1 * z1 - w1 * w1;\r\n    if (t1 < 0) n1 = 0.0;\r\n    else {\r\n      const gi1 = (perm[ii + i1 + perm[jj + j1 + perm[kk + k1 + perm[ll + l1]]]] % 32) * 4;\r\n      t1 *= t1;\r\n      n1 = t1 * t1 * (grad4[gi1] * x1 + grad4[gi1 + 1] * y1 + grad4[gi1 + 2] * z1 + grad4[gi1 + 3] * w1);\r\n    }\r\n    let t2 = 0.6 - x2 * x2 - y2 * y2 - z2 * z2 - w2 * w2;\r\n    if (t2 < 0) n2 = 0.0;\r\n    else {\r\n      const gi2 = (perm[ii + i2 + perm[jj + j2 + perm[kk + k2 + perm[ll + l2]]]] % 32) * 4;\r\n      t2 *= t2;\r\n      n2 = t2 * t2 * (grad4[gi2] * x2 + grad4[gi2 + 1] * y2 + grad4[gi2 + 2] * z2 + grad4[gi2 + 3] * w2);\r\n    }\r\n    let t3 = 0.6 - x3 * x3 - y3 * y3 - z3 * z3 - w3 * w3;\r\n    if (t3 < 0) n3 = 0.0;\r\n    else {\r\n      const gi3 = (perm[ii + i3 + perm[jj + j3 + perm[kk + k3 + perm[ll + l3]]]] % 32) * 4;\r\n      t3 *= t3;\r\n      n3 = t3 * t3 * (grad4[gi3] * x3 + grad4[gi3 + 1] * y3 + grad4[gi3 + 2] * z3 + grad4[gi3 + 3] * w3);\r\n    }\r\n    let t4 = 0.6 - x4 * x4 - y4 * y4 - z4 * z4 - w4 * w4;\r\n    if (t4 < 0) n4 = 0.0;\r\n    else {\r\n      const gi4 = (perm[ii + 1 + perm[jj + 1 + perm[kk + 1 + perm[ll + 1]]]] % 32) * 4;\r\n      t4 *= t4;\r\n      n4 = t4 * t4 * (grad4[gi4] * x4 + grad4[gi4 + 1] * y4 + grad4[gi4 + 2] * z4 + grad4[gi4 + 3] * w4);\r\n    }\r\n    // Sum up and scale the result to cover the range [-1,1]\r\n    return 27.0 * (n0 + n1 + n2 + n3 + n4);\r\n  }\r\n}\r\nexport default SimplexNoise;\r\n\r\n/**\r\n * Builds a random permutation table.\r\n * This is exported only for (internal) testing purposes.\r\n * Do not rely on this export.\r\n * @private\r\n */\r\nexport function buildPermutationTable(random: RandomFn): Uint8Array {\r\n  const p = new Uint8Array(256);\r\n  for (let i = 0; i < 256; i++) {\r\n    p[i] = i;\r\n  }\r\n  for (let i = 0; i < 255; i++) {\r\n    const r = i + ~~(random() * (256 - i));\r\n    const aux = p[i];\r\n    p[i] = p[r];\r\n    p[r] = aux;\r\n  }\r\n  return p;\r\n}\r\n\r\n/*\r\nThe ALEA PRNG and masher code used by simplex-noise.js\r\nis based on code by Johannes Baage, modified by Jonas Wagner.\r\nSee alea.md for the full license.\r\n*/\r\nfunction alea(seed: string|number): RandomFn {\r\n  let s0 = 0;\r\n  let s1 = 0;\r\n  let s2 = 0;\r\n  let c = 1;\r\n\r\n  const mash = masher();\r\n  s0 = mash(' ');\r\n  s1 = mash(' ');\r\n  s2 = mash(' ');\r\n\r\n  s0 -= mash(seed);\r\n  if (s0 < 0) {\r\n    s0 += 1;\r\n  }\r\n  s1 -= mash(seed);\r\n  if (s1 < 0) {\r\n    s1 += 1;\r\n  }\r\n  s2 -= mash(seed);\r\n  if (s2 < 0) {\r\n    s2 += 1;\r\n  }\r\n\r\n  return function() {\r\n    const t = 2091639 * s0 + c * 2.3283064365386963e-10; // 2^-32\r\n    s0 = s1;\r\n    s1 = s2;\r\n    return s2 = t - (c = t | 0);\r\n  };\r\n}\r\n\r\nfunction masher() {\r\n  let n = 0xefc8249d;\r\n  return function(data: number|string) {\r\n    data = data.toString();\r\n    for (let i = 0; i < data.length; i++) {\r\n      n += data.charCodeAt(i);\r\n      let h = 0.02519603282416938 * n;\r\n      n = h >>> 0;\r\n      h -= n;\r\n      h *= n;\r\n      n = h >>> 0;\r\n      h -= n;\r\n      n += h * 0x100000000; // 2^32\r\n    }\r\n    return (n >>> 0) * 2.3283064365386963e-10; // 2^-32\r\n  };\r\n}","/** @module */\r\n\r\n// import SimplexNoise from 'https://cdn.skypack.dev/simplex-noise@3.0.1'\r\nimport { SimplexNoise } from '../../lib/simplex-noise/dist/esm/simplex-noise.js'\r\n// https://runkit-packages.com/14.x.x/1644541101130/simplex-noise/#simplex-noisejs\r\n// https://npm.runkit.com/simplex-noise\r\n// https://www.npmjs.com/package/simplex-noise\r\n\r\n/**\r\n * Generate a noisy 2D map with two noise sources per pixel.\r\n * @param {Number} nx - Number of x pixels\r\n * @param {Number} ny - Number of y pixels\r\n * @constructor\r\n */\r\nexport default function GeoNoise(nx, ny) {\r\n    const self = this\r\n    // Simplex Noise Parameters\r\n    self.sn = []\r\n    const noiseWidth = 0.5\r\n    const noiseHeight = 0.5\r\n\r\n    // Geographic Noise Parameters - amplitude of noise\r\n    const xAmp = 100\r\n    const yAmp = 100\r\n\r\n    /** Generate simplex noise. */\r\n    self.genNoise = () => {\r\n        self.sn = makeGeoNoise(nx, ny, noiseWidth, noiseHeight, xAmp, yAmp)\r\n    }\r\n}\r\n\r\n/**\r\n * Generate a noisy 2D map with two noise sources per pixel.\r\n * @param {Number} nx - Number of x pixels\r\n * @param {Number} ny - Number of y pixels\r\n * @param {Number} noiseWidth -  A characteristic size of blobs, in pixels\r\n * @param {Number} noiseHeight - A characteristic size of blobs, in pixels\r\n * @returns {Number[][][]} - Noise in pixel displacement, indexed by row, col, dimension\r\n */\r\nexport function makeGeoNoise(nx, ny, noiseWidth, noiseHeight, xAmp, yAmp) {\r\n    const simplexX = new SimplexNoise('s')\r\n    const simplexY = new SimplexNoise('seed')\r\n    const map = zeros(nx, ny)\r\n    let sumX = 0\r\n    let sumY = 0\r\n    range(nx).forEach((ix) => {\r\n        range(ny).forEach((iy) => {\r\n            // fractional coordinate divided by period of waves\r\n            const x = (ix / nx) * (1 / noiseWidth)\r\n            const y = (iy / ny) * (1 / noiseHeight)\r\n            const noiseX = simplexX.noise2D(x, y)\r\n            const noiseY = simplexY.noise2D(x, y)\r\n            map[ix][iy][0] = (noiseX - 0.5)\r\n            map[ix][iy][1] = (noiseY - 0.5)\r\n            sumX += noiseX\r\n            sumY += noiseY\r\n        })\r\n    })\r\n    // normalize\r\n    const meanX = sumX / (nx * ny) - 0.5\r\n    const meanY = sumY / (nx * ny) - 0.5\r\n    map.forEach((a) => { // array\r\n        a.forEach((p) => { // pair\r\n            // eslint-disable-next-line no-param-reassign\r\n            p[0] = (p[0] - meanX) * xAmp\r\n            // eslint-disable-next-line no-param-reassign\r\n            p[1] = (p[1] - meanY) * yAmp\r\n        })\r\n    })\r\n    return map\r\n}\r\n\r\nfunction zeros(nx, ny) {\r\n    const empty = Array(nx).fill().map(() => Array(ny).fill().map(() => Array(2).fill(0)))\r\n    return empty\r\n}\r\n\r\nfunction range(n) {\r\n    return [...Array(n).keys()]\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Draws an image of noise, or anything really.\r\n * @param {Number} nx - Width in pixels\r\n * @param {Number} ny - Height in pixels\r\n * @param {Screen} screen - Draw here.\r\n * @constructor\r\n */\r\nexport default function NoiseImage(nx, ny, screen) {\r\n    const self = this\r\n\r\n    /*\r\n        Makes your pixel manip on an off-screen canvas\r\n        Returns the off-screen canvas\r\n        */\r\n\r\n    const canvas = document.createElement('canvas')\r\n    canvas.width = nx\r\n    canvas.height = ny\r\n    const offCtx = canvas.getContext('2d')\r\n    const imageData = offCtx.createImageData(nx, ny)\r\n\r\n    self.load = (sn) => {\r\n        const { data } = imageData\r\n\r\n        for (let x = 0; x < nx; x++) {\r\n            for (let y = 0; y < ny; y++) {\r\n                const r = sn[x][y][0] + 0.5\r\n                const g = sn[x][y][1] + 0.5\r\n                data[(x + y * nx) * 4 + 0] = r * 255\r\n                data[(x + y * nx) * 4 + 1] = (r + g) * 200\r\n                data[(x + y * nx) * 4 + 2] = g * 200\r\n                data[(x + y * nx) * 4 + 3] = 255\r\n            }\r\n        }\r\n\r\n        offCtx.putImageData(imageData, 0, 0)\r\n    }\r\n\r\n    self.loadColors = (colors) => {\r\n        const { data } = imageData\r\n\r\n        for (let x = 0; x < nx; x++) {\r\n            for (let y = 0; y < ny; y++) {\r\n                const color = colors[x][y]\r\n                const [r, g, b] = color\r\n                data[(x + y * nx) * 4 + 0] = r\r\n                data[(x + y * nx) * 4 + 1] = g\r\n                data[(x + y * nx) * 4 + 2] = b\r\n                data[(x + y * nx) * 4 + 3] = 255\r\n            }\r\n        }\r\n\r\n        offCtx.putImageData(imageData, 0, 0)\r\n    }\r\n\r\n    self.render = (renderWidth, renderHeight) => {\r\n        const { gctx } = screen\r\n        gctx.save()\r\n        gctx.imageSmoothingEnabled = false\r\n        gctx.drawImage(canvas, 0, 0, renderWidth, renderHeight)\r\n        gctx.restore()\r\n    }\r\n    // Draw simplex noise\r\n    // https://codepen.io/jwagner/pen/BNmpdm/?editors=0010\r\n    // Scale image\r\n    // https://stackoverflow.com/a/48858621\r\n}\r\n","export default function(polygon) {\r\n  var i = -1,\r\n      n = polygon.length,\r\n      a,\r\n      b = polygon[n - 1],\r\n      area = 0;\r\n\r\n  while (++i < n) {\r\n    a = b;\r\n    b = polygon[i];\r\n    area += a[1] * b[0] - a[0] * b[1];\r\n  }\r\n\r\n  return area / 2;\r\n}\r\n","export default function(polygon) {\r\n  var i = -1,\r\n      n = polygon.length,\r\n      x = 0,\r\n      y = 0,\r\n      a,\r\n      b = polygon[n - 1],\r\n      c,\r\n      k = 0;\r\n\r\n  while (++i < n) {\r\n    a = b;\r\n    b = polygon[i];\r\n    k += c = a[0] * b[1] - b[0] * a[1];\r\n    x += (a[0] + b[0]) * c;\r\n    y += (a[1] + b[1]) * c;\r\n  }\r\n\r\n  return k *= 3, [x / k, y / k];\r\n}\r\n","/** @module */\r\n\r\n// import { polygonCentroid } from 'https://cdn.skypack.dev/d3-polygon@3'\r\nimport { polygonCentroid } from '../../lib/d3-polygon/src/index.js'\r\n// import * as d3 from 'https://cdn.skypack.dev/d3@7'\r\nimport { Delaunay } from '../../lib/d3-delaunay.esm.js'\r\n/**\r\n * Calculate a voronoi diagram with some degree of equal capacity between voronoi cells.\r\n * Uses Lloyd's method.\r\n * @param {Number} w - number of discrete points wide of space to divide\r\n * @param {Number} h - number of points high\r\n * @param {Number} n - number of voronoi cells\r\n * @param {Number} tolFraction - fractional tolerance for relaxation. Maybe .01 is good.\r\n * @returns Centroids (list of points) and voronoi d3 object\r\n */\r\nexport default function lloydVoronoi(w, h, n, tolFraction) {\r\n    let centroids = randomPoints(w, h, n)\r\n    let converged = false\r\n    let voronoi\r\n    let polygons\r\n    const tol = tolFraction * Math.min(w, h)\r\n    for (let i = 0; i < 1000; i++) {\r\n        [centroids, converged, voronoi, polygons] = relax(centroids, w, h, tol)\r\n        if (converged) return centroids\r\n    }\r\n    return [centroids, voronoi, polygons]\r\n}\r\n\r\n// https://bl.ocks.org/veltman/3d1fb70e6993d4eb2eff7112c9e7bcf4\r\n\r\nfunction randomPoints(w, h, n) {\r\n    return Array(n).fill().map(() => [Math.random() * w, Math.random() * h])\r\n}\r\n\r\nfunction relax(points, w, h, tol) {\r\n    const delaunay = Delaunay.from(points)\r\n    const voronoi = delaunay.voronoi([0, 0, w, h])\r\n    const polygons = range(points.length).map((i) => voronoi.cellPolygon(i))\r\n    const centroids = polygons.map(polygonCentroid)\r\n    const converged = points.every((point, i) => distance2(point, centroids[i]) < tol)\r\n    return [centroids, converged, voronoi, polygons]\r\n}\r\n\r\n// function relax3(points, w, h) {\r\n//     const polygons = voronoi(points).polygons()\r\n//     polygons.map(d3.polygonCentroid)\r\n//     const converged = points.every((point, i) => distance2(point, centroids[i]) < 1)\r\n//     return { centroids, converged }\r\n// }\r\n\r\n// cellPolygons.prototype.map = function* (mapper, thisArg) {\r\n//     for (const val of this) {\r\n//         yield mapper.call(thisArg, val)\r\n//     }\r\n// }\r\n\r\nfunction distance2(x, y) {\r\n    return x ** 2 + y ** 2\r\n}\r\n\r\nfunction range(n) {\r\n    return [...Array(n).keys()]\r\n}\r\n","/**\r\n * Graphics Utilities\r\n * Just a few helpful functions that are self-contained and don't need much context.\r\n * @module */\r\n\r\nexport function drawStrokedColor(text, x, y, textsize, lw, color, ctx, textAlign) {\r\n    ctx.save()\r\n    ctx.textAlign = textAlign || 'center'\r\n    ctx.font = `${textsize}px Sans-serif`\r\n    ctx.lineWidth = lw\r\n    ctx.fillStyle = color\r\n    ctx.fillText(text, x, y)\r\n    ctx.restore()\r\n}\r\n\r\nexport function textPercent(f) {\r\n    const a = (100 * f).toFixed(0)\r\n    return a\r\n}\r\n","/**\r\n * Clips a polygon with another polygon to return a polygon.\r\n * Polygons must be counter-clockwise.\r\n * https://observablehq.com/@d3/polygonclip@1237\r\n * @param {Number[][]} clip - polygon\r\n * @param {Number[][]} subject - polygon, gets mutated\r\n * @returns {Number[][]} - polygon\r\n */\r\nexport default function polygonClip(clip, subject) {\r\n    const closed = polygonClosed(subject)\r\n    const n = clip.length - polygonClosed(clip)\r\n    subject = subject.slice() // copy before mutate\r\n    for (let i = 0, a = clip[n - 1], b, c, d; i < n; ++i) {\r\n        const input = subject.slice()\r\n        const m = input.length - closed\r\n        subject.length = 0\r\n        b = clip[i]\r\n        c = input[m - 1]\r\n        for (let j = 0; j < m; ++j) {\r\n            d = input[j]\r\n            if (lineOrient(d, a, b)) {\r\n                if (!lineOrient(c, a, b)) {\r\n                    subject.push(lineIntersect(c, d, a, b))\r\n                }\r\n                subject.push(d)\r\n            } else if (lineOrient(c, a, b)) {\r\n                subject.push(lineIntersect(c, d, a, b))\r\n            }\r\n            c = d\r\n        }\r\n        if (closed) subject.push(subject[0])\r\n        a = b\r\n    }\r\n    return subject.length ? subject : null\r\n}\r\nfunction lineOrient([px, py], [ax, ay], [bx, by]) {\r\n    return (bx - ax) * (py - ay) < (by - ay) * (px - ax)\r\n}\r\nfunction lineIntersect([ax, ay], [bx, by], [cx, cy], [dx, dy]) {\r\n    const bax = bx - ax; const bay = by - ay; const dcx = dx - cx; const\r\n        dcy = dy - cy\r\n    const k = (bax * (cy - ay) - bay * (cx - ax)) / (bay * dcx - bax * dcy)\r\n    return [cx + k * dcx, cy + k * dcy]\r\n}\r\nfunction polygonClosed(points) {\r\n    const [ax, ay] = points[0]; const\r\n        [bx, by] = points[points.length - 1]\r\n    return ax === bx && ay === by\r\n}\r\nfunction polygonConvex(points) {\r\n    const n = points.length\r\n    const [rx, ry] = points[n - 2]\r\n    let [qx, qy] = points[n - 1]\r\n    let vx = rx - qx; let\r\n        vy = ry - qy\r\n    for (let i = 0; i < n; ++i) {\r\n        const [px, py] = points[i]\r\n        const wx = qx - px; const\r\n            wy = qy - py\r\n        if (wx * vy < wy * vx) return false\r\n        if (wx || wy) vx = wx, vy = wy\r\n        qx = px, qy = py\r\n    }\r\n    return true\r\n}\r\n\r\nexport function testClip() {\r\n    const subject = [\r\n        [79, 200], [266, 100],\r\n        [452, 200],\r\n        [359, 450],\r\n        [172, 420]]\r\n    const clip = [[210, 90], [110, 400], [420, 400], [490, 250]]\r\n\r\n    return polygonClip(clip, subject)\r\n}","/**\r\n * Javascript Utilities\r\n * Just a few helpful functions that are self-contained and don't need much context.\r\n * @module */\r\n\r\n/**\r\n * List the indices of an array of length n.\r\n * @param {Number} n - length of array\r\n * @returns {Number[]} - A number array from 0 to n-1.\r\n */\r\nexport function range(n) {\r\n    return [...Array(n).keys()]\r\n}\r\n\r\n/**\r\n * Try to deepcopy an object.\r\n * @param {Object} a - an object to copy.\r\n * @returns {Object} A copy of a.\r\n */\r\nexport function jcopy(a) {\r\n    return JSON.parse(JSON.stringify(a))\r\n}\r\n","/** @module */\r\n\r\n// import _ from 'https://cdn.skypack.dev/lodash@4.17.21'\r\nimport polygonClip from '../../lib/polygonClip.js'\r\nimport { range, jcopy } from '../utilities/jsHelpers.js'\r\nimport { polygonArea } from '../../lib/d3-polygon/src/index.js'\r\n\r\n/**\r\n * What fraction of each voterGroup lives in each district?\r\n * Return an array indexed by district.\r\n * Each element contains an array of pairs.\r\n * The first of the pair is a voterGroup pair of coordinates.\r\n * The second of the pair is the fraction of the voterGroup within that district.\r\n * @param {DistrictMaker} districtMaker\r\n * @returns {Number[][][]} - an array of districts,\r\n * each with a list of census tract properties [x,y,overlap]\r\n */\r\nexport default function geoCensus(districtMaker) {\r\n    const {\r\n        nd, nx, ny, polygons,\r\n    } = districtMaker\r\n\r\n    const census = Array(nd).fill().map(() => [])\r\n\r\n    for (let gx = 0; gx < nx; gx++) { // x-coordinate of group\r\n        for (let gy = 0; gy < ny; gy++) { // y-coordinate of group\r\n            const subject = makeSquare(gx, gy)\r\n            range(nd).forEach((iDistrict) => {\r\n                const poly = polygons[iDistrict]\r\n                const clip = jcopy(poly).reverse()\r\n                const overlap = polygonClip(clip, subject)\r\n\r\n                // store data more sparsely because it is more efficient\r\n                // loop through all districts\r\n                if (overlap !== null) {\r\n                    census[iDistrict].push([gx, gy, polygonArea(overlap)])\r\n                }\r\n            })\r\n        }\r\n    }\r\n\r\n    return census\r\n}\r\n\r\nfunction makeSquare(x, y) {\r\n    // the points are in counterclockwise order\r\n    // assuming a coordinate system where y points down and x points right.\r\n    // top left\r\n    // bottom left\r\n    // bottom right\r\n    // top right\r\n    const subject = [\r\n        [x, y],\r\n        [x, y + 1],\r\n        [x + 1, y + 1],\r\n        [x + 1, y],\r\n    ]\r\n    return subject\r\n}\r\n","/** @module */\r\n\r\nimport lloydVoronoi from './lloydVoronoi.js'\r\nimport { polygonArea } from '../../lib/d3-polygon/src/index.js'\r\nimport { drawStrokedColor } from '../utilities/graphicsUtilities.js'\r\nimport geoCensus from './geoCensus.js'\r\n/**\r\n * Makes and draws district boundaries.\r\n * Right now, just for a uniform square geography.\r\n * @param {Screen} screen\r\n * @constructor\r\n */\r\nexport default function DistrictMaker(screen) {\r\n    const self = this\r\n\r\n    /**\r\n     * Define district lines and count demographics.\r\n     * @param {Number} nx - number of voter cells in x\r\n     * @param {Number} ny - number of voter cells in y\r\n     * @param {Number} nd - number of districts.\r\n     */\r\n    self.make = (nx, ny, nd) => {\r\n        [self.centroids, self.voronoi, self.polygons] = lloydVoronoi(nx, ny, nd, 0.01)\r\n        self.nx = nx\r\n        self.ny = ny\r\n        self.nd = nd\r\n        self.polygonAreas = self.polygons.map(polygonArea).map((x) => -x)\r\n        self.totalArea = nx * ny\r\n\r\n        self.census = geoCensus(self)\r\n    }\r\n\r\n    /**\r\n     * Draw Voronoi cell boundaries.\r\n     * @param {Number} geoMapWidth - width of image\r\n     * @param {Number} geoMapHeight - height of image\r\n     */\r\n    self.renderVoronoi = (geoMapWidth, geoMapHeight) => {\r\n        self.renderVoronoiGeneral(0, 0, geoMapWidth, geoMapHeight, null, renderAreaText)\r\n    }\r\n\r\n    self.renderVoronoiColors = (x, y, geoMapWidth, geoMapHeight, colors) => {\r\n        self.renderVoronoiGeneral(x, y, geoMapWidth, geoMapHeight, colors, undefined)\r\n    }\r\n    /**\r\n     * Draw a Voronoi Diagram\r\n     * @param {Number} x - translate image\r\n     * @param {Number} y - translate image\r\n     * @param {Number} geoMapWidth - width of image\r\n     * @param {Number} geoMapHeight - height of image\r\n     * @param {string[]} colors - an option, say \"null\" if do not want colors\r\n     * @param {Function} textFunction - an option, defaults to undefined\r\n     */\r\n    self.renderVoronoiGeneral = (x, y, geoMapWidth, geoMapHeight, colors, textFunction) => {\r\n        const { gctx } = screen\r\n        const {\r\n            voronoi, nx, ny, nd,\r\n        } = self\r\n        gctx.save()\r\n        const scaleX = geoMapWidth / nx\r\n        const scaleY = geoMapHeight / ny\r\n        gctx.translate(x, y)\r\n        gctx.scale(scaleX, scaleY)\r\n        for (let i = 0; i < nd; i++) {\r\n            gctx.beginPath()\r\n            gctx.strokeStyle = '#333'\r\n            gctx.lineWidth = 1 / scaleX\r\n            voronoi.renderCell(i, gctx)\r\n            if (colors !== null) { // option\r\n                gctx.fillStyle = colors[i]\r\n                gctx.fill()\r\n            }\r\n            gctx.stroke()\r\n            if (textFunction !== undefined) textFunction(i) // option\r\n        }\r\n        gctx.restore()\r\n    }\r\n\r\n    function renderAreaText(i) {\r\n        const { gctx } = screen\r\n        const c = self.centroids[i]\r\n        const textHeight = 1\r\n        // const area = textPercent(self.polygonAreas[i] / (self.nx * self.ny))\r\n        const area = self.polygonAreas[i].toFixed(0)\r\n        drawStrokedColor(area, c[0], c[1] + textHeight * 0.5 - 0.2, textHeight, 0.2, '#222', gctx)\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport GeoNoise from './geoNoise.js'\r\nimport NoiseImage from './NoiseImage.js'\r\nimport DistrictMaker from './DistrictMaker.js'\r\nimport { range } from '../utilities/jsHelpers.js'\r\nimport SimVoterList from './SimVoterList.js'\r\n\r\n/**\r\n * GeoVoters inherits from SimVoterList.\r\n * @param {Screen} screen\r\n * @param {GeoElection} geoElection\r\n * @constructor\r\n */\r\nexport default function GeoVoters(screen, geoElection) {\r\n    const self = this\r\n\r\n    // GeoVoters inherits from SimVoterList\r\n    // because we need to make a list instances of geoVoterBasis,\r\n    // and geoVoterBasis has a component called voter.\r\n    SimVoterList.call(self)\r\n\r\n    /** Number of districts */\r\n    const nd = 20\r\n\r\n    /** Number of census tracts in x and y */\r\n    const nx = 20\r\n    const ny = 20\r\n\r\n    // Code that handles drawing districts of equal number of voters.\r\n    self.districtMaker = new DistrictMaker(screen)\r\n\r\n    // Code that handles making geographic noise.\r\n    self.geoNoise = new GeoNoise(nx, ny)\r\n    self.geoNoise.genNoise()\r\n\r\n    // Code that handles making images of geographic noise.\r\n    self.noiseImage = new NoiseImage(nx, ny, screen)\r\n\r\n    // Manage VoterBasisSet //\r\n\r\n    /** This voter basis is repeated at every census tract on the geo map.\r\n     *  It is altered by translating it in policy space.\r\n     *  */\r\n\r\n    // Update VoterGroup Sets //\r\n\r\n    let simVoterGroups = []\r\n\r\n    /** Make districts and update voter sets */\r\n    self.updateDistricts = () => {\r\n        self.districtMaker.make(nx, ny, nd)\r\n    }\r\n    self.updateVoters = () => {\r\n        simVoterGroups = self.getSimVoterGroups()\r\n        self.updateFullSet()\r\n        self.updateVotersByDistrict()\r\n        self.updateVotersByTract()\r\n    }\r\n\r\n    self.updateFullSet = () => {\r\n        const { sn } = self.geoNoise\r\n        self.allVoterGroups = simVoterGroups.map(\r\n            (vb) => sn.map(\r\n                (rowNoise) => rowNoise.map(\r\n                    (cellNoise) => {\r\n                        const [xNoise, yNoise] = cellNoise\r\n                        const { x, y, r } = vb.voter\r\n                        return { x: x + xNoise, y: y + yNoise, r }\r\n                    },\r\n                ).flat(),\r\n            ).flat(),\r\n        ).flat()\r\n    }\r\n\r\n    self.updateVotersByDistrict = () => {\r\n        const { census } = self.districtMaker\r\n        const { sn } = self.geoNoise\r\n        self.voterGroupsByDistrict = range(nd).map(\r\n            (iDistrict) => simVoterGroups.map(\r\n                (vb) => census[iDistrict].map((g) => {\r\n                    const [gx, gy, gf] = g\r\n                    const [xNoise, yNoise] = sn[gx][gy]\r\n                    const { x, y, r } = vb.voter\r\n                    return {\r\n                        x: x + xNoise, y: y + yNoise, r, f: gf,\r\n                    }\r\n                }).flat(),\r\n            ).flat(),\r\n        )\r\n    }\r\n\r\n    self.updateVotersByTract = () => {\r\n        const { sn } = self.geoNoise\r\n        self.voterGroupsByTract = sn.map(\r\n            (rowNoise) => rowNoise.map(\r\n                (cellNoise) => simVoterGroups.map(\r\n                    (vb) => {\r\n                        const [xNoise, yNoise] = cellNoise\r\n                        const { x, y, r } = vb.voter\r\n                        return { x: x + xNoise, y: y + yNoise, r }\r\n                    },\r\n                ).flat(),\r\n            ),\r\n        )\r\n    }\r\n\r\n    // Display //\r\n\r\n    const geoMapWidth = 100\r\n    const geoMapHeight = 100\r\n\r\n    /** Render all maps and  */\r\n    self.render = () => {\r\n        renderPolicyNoise()\r\n        self.renderTractVotes()\r\n        self.renderDistrictWins()\r\n        self.renderDistrictVotes()\r\n        self.renderVoterBasisSet()\r\n    }\r\n    // Render census tract votes.\r\n    self.renderTractVotes = () => {\r\n        self.noiseImage.render(geoMapWidth, geoMapHeight)\r\n        self.districtMaker.renderVoronoi(geoMapWidth, geoMapHeight)\r\n    }\r\n    // Render district wins.\r\n    self.renderDistrictWins = () => {\r\n        const { renderVoronoiColors } = self.districtMaker\r\n        renderVoronoiColors(200, 0, geoMapWidth, geoMapHeight, geoElection.winnerColors)\r\n    }\r\n    // render district votes.\r\n    self.renderDistrictVotes = () => {\r\n        const { renderVoronoiColors } = self.districtMaker\r\n        renderVoronoiColors(100, 0, geoMapWidth, geoMapHeight, geoElection.blendColors)\r\n    }\r\n    self.renderVoterBasisSet = () => {\r\n        simVoterGroups.forEach((v) => v.render())\r\n    }\r\n\r\n    /** Draw dots to represent the political diversity across census tracts. */\r\n    function renderPolicyNoise() {\r\n        self.voterGroupsByTract.forEach((row) => {\r\n            row.forEach((cell) => {\r\n                cell.forEach((group) => {\r\n                    smallCircle(group.x, group.y)\r\n                })\r\n            })\r\n        })\r\n    }\r\n\r\n    /** Draw a small dot */\r\n    function smallCircle(x, y) {\r\n        const { ctx } = screen\r\n        ctx.beginPath()\r\n        ctx.fillStyle = '#555'\r\n        ctx.arc(x, y, 1, 0, 2 * Math.PI)\r\n        ctx.fill()\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport GeoVoterBasis from '../../voters/GeoVoterBasis.js'\r\nimport SimCandidate from '../../candidates/SimCandidate.js'\r\nimport SimCandidateList from '../../candidates/SimCandidateList.js'\r\nimport GeoVoters from '../../voters/GeoVoters.js'\r\nimport SimBase from './SimBase.js'\r\n/**\r\n * Simulate one election with\r\n *   candidates in defined positions, and\r\n *   voters in a distribution that will be summed over.\r\n * Create a geographical map with variations of voter center.\r\n * @param {Screen} screen\r\n * @param {DraggableManager} dragm\r\n * @param {Menu} menu\r\n * @param {Changes} changes\r\n * @param {Election} election\r\n * @param {Object} canButton - a button that lets us add a candidate\r\n * @constructor\r\n */\r\nexport default function SimGeoOne(screen, dragm, menu, changes, geoElection, canButton) {\r\n    const self = this\r\n\r\n    SimBase.call(self, dragm, screen)\r\n\r\n    const geoVoters = new GeoVoters(screen, geoElection)\r\n\r\n    const simCandidateList = new SimCandidateList()\r\n\r\n    self.addSimCandidate = (candidate) => {\r\n        simCandidateList.newCandidate(new SimCandidate(candidate, dragm))\r\n    }\r\n\r\n    self.addSimVoterCircle = (voterCircle) => {\r\n        geoVoters.newVoterGroup(new GeoVoterBasis(voterCircle, dragm, screen))\r\n    }\r\n\r\n    changes.add(['districts'])\r\n\r\n    const superEnter = self.enter\r\n    self.enter = () => {\r\n        superEnter()\r\n        screen.showGeoMaps()\r\n        canButton.show()\r\n    }\r\n\r\n    self.exit = () => {\r\n        screen.hideGeoMaps()\r\n        canButton.hide()\r\n    }\r\n\r\n    self.update = () => {\r\n        if (changes.checkNone()) return\r\n        // clear changes, reset to []\r\n        if (changes.check(['districts', 'simType'])) {\r\n            geoVoters.updateDistricts()\r\n        }\r\n        changes.clear()\r\n        geoVoters.updateVoters() // can make this only trigger when voters change\r\n        geoElection.updateVotes(geoVoters, simCandidateList)\r\n        screen.clear()\r\n        self.render()\r\n    }\r\n\r\n    self.render = () => {\r\n        geoVoters.render()\r\n    }\r\n    self.renderForeground = () => {\r\n        simCandidateList.renderForeground()\r\n        geoVoters.renderForeground()\r\n    }\r\n}\r\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","/**\r\n * The Ease class provides a collection of easing functions for use with tween.js.\r\n */\r\n var Easing = {\r\n    Linear: {\r\n        None: function (amount) {\r\n            return amount;\r\n        },\r\n    },\r\n    Quadratic: {\r\n        In: function (amount) {\r\n            return amount * amount;\r\n        },\r\n        Out: function (amount) {\r\n            return amount * (2 - amount);\r\n        },\r\n        InOut: function (amount) {\r\n            if ((amount *= 2) < 1) {\r\n                return 0.5 * amount * amount;\r\n            }\r\n            return -0.5 * (--amount * (amount - 2) - 1);\r\n        },\r\n    },\r\n    Cubic: {\r\n        In: function (amount) {\r\n            return amount * amount * amount;\r\n        },\r\n        Out: function (amount) {\r\n            return --amount * amount * amount + 1;\r\n        },\r\n        InOut: function (amount) {\r\n            if ((amount *= 2) < 1) {\r\n                return 0.5 * amount * amount * amount;\r\n            }\r\n            return 0.5 * ((amount -= 2) * amount * amount + 2);\r\n        },\r\n    },\r\n    Quartic: {\r\n        In: function (amount) {\r\n            return amount * amount * amount * amount;\r\n        },\r\n        Out: function (amount) {\r\n            return 1 - --amount * amount * amount * amount;\r\n        },\r\n        InOut: function (amount) {\r\n            if ((amount *= 2) < 1) {\r\n                return 0.5 * amount * amount * amount * amount;\r\n            }\r\n            return -0.5 * ((amount -= 2) * amount * amount * amount - 2);\r\n        },\r\n    },\r\n    Quintic: {\r\n        In: function (amount) {\r\n            return amount * amount * amount * amount * amount;\r\n        },\r\n        Out: function (amount) {\r\n            return --amount * amount * amount * amount * amount + 1;\r\n        },\r\n        InOut: function (amount) {\r\n            if ((amount *= 2) < 1) {\r\n                return 0.5 * amount * amount * amount * amount * amount;\r\n            }\r\n            return 0.5 * ((amount -= 2) * amount * amount * amount * amount + 2);\r\n        },\r\n    },\r\n    Sinusoidal: {\r\n        In: function (amount) {\r\n            return 1 - Math.cos((amount * Math.PI) / 2);\r\n        },\r\n        Out: function (amount) {\r\n            return Math.sin((amount * Math.PI) / 2);\r\n        },\r\n        InOut: function (amount) {\r\n            return 0.5 * (1 - Math.cos(Math.PI * amount));\r\n        },\r\n    },\r\n    Exponential: {\r\n        In: function (amount) {\r\n            return amount === 0 ? 0 : Math.pow(1024, amount - 1);\r\n        },\r\n        Out: function (amount) {\r\n            return amount === 1 ? 1 : 1 - Math.pow(2, -10 * amount);\r\n        },\r\n        InOut: function (amount) {\r\n            if (amount === 0) {\r\n                return 0;\r\n            }\r\n            if (amount === 1) {\r\n                return 1;\r\n            }\r\n            if ((amount *= 2) < 1) {\r\n                return 0.5 * Math.pow(1024, amount - 1);\r\n            }\r\n            return 0.5 * (-Math.pow(2, -10 * (amount - 1)) + 2);\r\n        },\r\n    },\r\n    Circular: {\r\n        In: function (amount) {\r\n            return 1 - Math.sqrt(1 - amount * amount);\r\n        },\r\n        Out: function (amount) {\r\n            return Math.sqrt(1 - --amount * amount);\r\n        },\r\n        InOut: function (amount) {\r\n            if ((amount *= 2) < 1) {\r\n                return -0.5 * (Math.sqrt(1 - amount * amount) - 1);\r\n            }\r\n            return 0.5 * (Math.sqrt(1 - (amount -= 2) * amount) + 1);\r\n        },\r\n    },\r\n    Elastic: {\r\n        In: function (amount) {\r\n            if (amount === 0) {\r\n                return 0;\r\n            }\r\n            if (amount === 1) {\r\n                return 1;\r\n            }\r\n            return -Math.pow(2, 10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI);\r\n        },\r\n        Out: function (amount) {\r\n            if (amount === 0) {\r\n                return 0;\r\n            }\r\n            if (amount === 1) {\r\n                return 1;\r\n            }\r\n            return Math.pow(2, -10 * amount) * Math.sin((amount - 0.1) * 5 * Math.PI) + 1;\r\n        },\r\n        InOut: function (amount) {\r\n            if (amount === 0) {\r\n                return 0;\r\n            }\r\n            if (amount === 1) {\r\n                return 1;\r\n            }\r\n            amount *= 2;\r\n            if (amount < 1) {\r\n                return -0.5 * Math.pow(2, 10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI);\r\n            }\r\n            return 0.5 * Math.pow(2, -10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI) + 1;\r\n        },\r\n    },\r\n    Back: {\r\n        In: function (amount) {\r\n            var s = 1.70158;\r\n            return amount * amount * ((s + 1) * amount - s);\r\n        },\r\n        Out: function (amount) {\r\n            var s = 1.70158;\r\n            return --amount * amount * ((s + 1) * amount + s) + 1;\r\n        },\r\n        InOut: function (amount) {\r\n            var s = 1.70158 * 1.525;\r\n            if ((amount *= 2) < 1) {\r\n                return 0.5 * (amount * amount * ((s + 1) * amount - s));\r\n            }\r\n            return 0.5 * ((amount -= 2) * amount * ((s + 1) * amount + s) + 2);\r\n        },\r\n    },\r\n    Bounce: {\r\n        In: function (amount) {\r\n            return 1 - Easing.Bounce.Out(1 - amount);\r\n        },\r\n        Out: function (amount) {\r\n            if (amount < 1 / 2.75) {\r\n                return 7.5625 * amount * amount;\r\n            }\r\n            else if (amount < 2 / 2.75) {\r\n                return 7.5625 * (amount -= 1.5 / 2.75) * amount + 0.75;\r\n            }\r\n            else if (amount < 2.5 / 2.75) {\r\n                return 7.5625 * (amount -= 2.25 / 2.75) * amount + 0.9375;\r\n            }\r\n            else {\r\n                return 7.5625 * (amount -= 2.625 / 2.75) * amount + 0.984375;\r\n            }\r\n        },\r\n        InOut: function (amount) {\r\n            if (amount < 0.5) {\r\n                return Easing.Bounce.In(amount * 2) * 0.5;\r\n            }\r\n            return Easing.Bounce.Out(amount * 2 - 1) * 0.5 + 0.5;\r\n        },\r\n    },\r\n};\r\n\r\nvar now;\r\n// Include a performance.now polyfill.\r\n// In node.js, use process.hrtime.\r\n// eslint-disable-next-line\r\n// @ts-ignore\r\nif (typeof self === 'undefined' && typeof process !== 'undefined' && process.hrtime) {\r\n    now = function () {\r\n        // eslint-disable-next-line\r\n        // @ts-ignore\r\n        var time = process.hrtime();\r\n        // Convert [seconds, nanoseconds] to milliseconds.\r\n        return time[0] * 1000 + time[1] / 1000000;\r\n    };\r\n}\r\n// In a browser, use self.performance.now if it is available.\r\nelse if (typeof self !== 'undefined' && self.performance !== undefined && self.performance.now !== undefined) {\r\n    // This must be bound, because directly assigning this function\r\n    // leads to an invocation exception in Chrome.\r\n    now = self.performance.now.bind(self.performance);\r\n}\r\n// Use Date.now if it is available.\r\nelse if (Date.now !== undefined) {\r\n    now = Date.now;\r\n}\r\n// Otherwise, use 'new Date().getTime()'.\r\nelse {\r\n    now = function () {\r\n        return new Date().getTime();\r\n    };\r\n}\r\nvar now$1 = now;\r\n\r\n/**\r\n * Controlling groups of tweens\r\n *\r\n * Using the TWEEN singleton to manage your tweens can cause issues in large apps with many components.\r\n * In these cases, you may want to create your own smaller groups of tween\r\n */\r\nvar Group = /** @class */ (function () {\r\n    function Group() {\r\n        this._tweens = {};\r\n        this._tweensAddedDuringUpdate = {};\r\n    }\r\n    Group.prototype.getAll = function () {\r\n        var _this = this;\r\n        return Object.keys(this._tweens).map(function (tweenId) {\r\n            return _this._tweens[tweenId];\r\n        });\r\n    };\r\n    Group.prototype.removeAll = function () {\r\n        this._tweens = {};\r\n    };\r\n    Group.prototype.add = function (tween) {\r\n        this._tweens[tween.getId()] = tween;\r\n        this._tweensAddedDuringUpdate[tween.getId()] = tween;\r\n    };\r\n    Group.prototype.remove = function (tween) {\r\n        delete this._tweens[tween.getId()];\r\n        delete this._tweensAddedDuringUpdate[tween.getId()];\r\n    };\r\n    Group.prototype.update = function (time, preserve) {\r\n        if (time === void 0) { time = now$1(); }\r\n        if (preserve === void 0) { preserve = false; }\r\n        var tweenIds = Object.keys(this._tweens);\r\n        if (tweenIds.length === 0) {\r\n            return false;\r\n        }\r\n        // Tweens are updated in \"batches\". If you add a new tween during an\r\n        // update, then the new tween will be updated in the next batch.\r\n        // If you remove a tween during an update, it may or may not be updated.\r\n        // However, if the removed tween was added during the current batch,\r\n        // then it will not be updated.\r\n        while (tweenIds.length > 0) {\r\n            this._tweensAddedDuringUpdate = {};\r\n            for (var i = 0; i < tweenIds.length; i++) {\r\n                var tween = this._tweens[tweenIds[i]];\r\n                var autoStart = !preserve;\r\n                if (tween && tween.update(time, autoStart) === false && !preserve) {\r\n                    delete this._tweens[tweenIds[i]];\r\n                }\r\n            }\r\n            tweenIds = Object.keys(this._tweensAddedDuringUpdate);\r\n        }\r\n        return true;\r\n    };\r\n    return Group;\r\n}());\r\n\r\n/**\r\n *\r\n */\r\nvar Interpolation = {\r\n    Linear: function (v, k) {\r\n        var m = v.length - 1;\r\n        var f = m * k;\r\n        var i = Math.floor(f);\r\n        var fn = Interpolation.Utils.Linear;\r\n        if (k < 0) {\r\n            return fn(v[0], v[1], f);\r\n        }\r\n        if (k > 1) {\r\n            return fn(v[m], v[m - 1], m - f);\r\n        }\r\n        return fn(v[i], v[i + 1 > m ? m : i + 1], f - i);\r\n    },\r\n    Bezier: function (v, k) {\r\n        var b = 0;\r\n        var n = v.length - 1;\r\n        var pw = Math.pow;\r\n        var bn = Interpolation.Utils.Bernstein;\r\n        for (var i = 0; i <= n; i++) {\r\n            b += pw(1 - k, n - i) * pw(k, i) * v[i] * bn(n, i);\r\n        }\r\n        return b;\r\n    },\r\n    CatmullRom: function (v, k) {\r\n        var m = v.length - 1;\r\n        var f = m * k;\r\n        var i = Math.floor(f);\r\n        var fn = Interpolation.Utils.CatmullRom;\r\n        if (v[0] === v[m]) {\r\n            if (k < 0) {\r\n                i = Math.floor((f = m * (1 + k)));\r\n            }\r\n            return fn(v[(i - 1 + m) % m], v[i], v[(i + 1) % m], v[(i + 2) % m], f - i);\r\n        }\r\n        else {\r\n            if (k < 0) {\r\n                return v[0] - (fn(v[0], v[0], v[1], v[1], -f) - v[0]);\r\n            }\r\n            if (k > 1) {\r\n                return v[m] - (fn(v[m], v[m], v[m - 1], v[m - 1], f - m) - v[m]);\r\n            }\r\n            return fn(v[i ? i - 1 : 0], v[i], v[m < i + 1 ? m : i + 1], v[m < i + 2 ? m : i + 2], f - i);\r\n        }\r\n    },\r\n    Utils: {\r\n        Linear: function (p0, p1, t) {\r\n            return (p1 - p0) * t + p0;\r\n        },\r\n        Bernstein: function (n, i) {\r\n            var fc = Interpolation.Utils.Factorial;\r\n            return fc(n) / fc(i) / fc(n - i);\r\n        },\r\n        Factorial: (function () {\r\n            var a = [1];\r\n            return function (n) {\r\n                var s = 1;\r\n                if (a[n]) {\r\n                    return a[n];\r\n                }\r\n                for (var i = n; i > 1; i--) {\r\n                    s *= i;\r\n                }\r\n                a[n] = s;\r\n                return s;\r\n            };\r\n        })(),\r\n        CatmullRom: function (p0, p1, p2, p3, t) {\r\n            var v0 = (p2 - p0) * 0.5;\r\n            var v1 = (p3 - p1) * 0.5;\r\n            var t2 = t * t;\r\n            var t3 = t * t2;\r\n            return (2 * p1 - 2 * p2 + v0 + v1) * t3 + (-3 * p1 + 3 * p2 - 2 * v0 - v1) * t2 + v0 * t + p1;\r\n        },\r\n    },\r\n};\r\n\r\n/**\r\n * Utils\r\n */\r\nvar Sequence = /** @class */ (function () {\r\n    function Sequence() {\r\n    }\r\n    Sequence.nextId = function () {\r\n        return Sequence._nextId++;\r\n    };\r\n    Sequence._nextId = 0;\r\n    return Sequence;\r\n}());\r\n\r\nvar mainGroup = new Group();\r\n\r\n/**\r\n * Tween.js - Licensed under the MIT license\r\n * https://github.com/tweenjs/tween.js\r\n * ----------------------------------------------\r\n *\r\n * See https://github.com/tweenjs/tween.js/graphs/contributors for the full list of contributors.\r\n * Thank you all, you're awesome!\r\n */\r\nvar Tween = /** @class */ (function () {\r\n    function Tween(_object, _group) {\r\n        if (_group === void 0) { _group = mainGroup; }\r\n        this._object = _object;\r\n        this._group = _group;\r\n        this._isPaused = false;\r\n        this._pauseStart = 0;\r\n        this._valuesStart = {};\r\n        this._valuesEnd = {};\r\n        this._valuesStartRepeat = {};\r\n        this._duration = 1000;\r\n        this._initialRepeat = 0;\r\n        this._repeat = 0;\r\n        this._yoyo = false;\r\n        this._isPlaying = false;\r\n        this._reversed = false;\r\n        this._delayTime = 0;\r\n        this._startTime = 0;\r\n        this._easingFunction = Easing.Linear.None;\r\n        this._interpolationFunction = Interpolation.Linear;\r\n        this._chainedTweens = [];\r\n        this._onStartCallbackFired = false;\r\n        this._id = Sequence.nextId();\r\n        this._isChainStopped = false;\r\n        this._goToEnd = false;\r\n    }\r\n    Tween.prototype.getId = function () {\r\n        return this._id;\r\n    };\r\n    Tween.prototype.isPlaying = function () {\r\n        return this._isPlaying;\r\n    };\r\n    Tween.prototype.isPaused = function () {\r\n        return this._isPaused;\r\n    };\r\n    Tween.prototype.to = function (properties, duration) {\r\n        // TODO? restore this, then update the 07_dynamic_to example to set fox\r\n        // tween's to on each update. That way the behavior is opt-in (there's\r\n        // currently no opt-out).\r\n        // for (const prop in properties) this._valuesEnd[prop] = properties[prop]\r\n        this._valuesEnd = Object.create(properties);\r\n        if (duration !== undefined) {\r\n            this._duration = duration;\r\n        }\r\n        return this;\r\n    };\r\n    Tween.prototype.duration = function (d) {\r\n        this._duration = d;\r\n        return this;\r\n    };\r\n    Tween.prototype.start = function (time) {\r\n        if (this._isPlaying) {\r\n            return this;\r\n        }\r\n        // eslint-disable-next-line\r\n        this._group && this._group.add(this);\r\n        this._repeat = this._initialRepeat;\r\n        if (this._reversed) {\r\n            // If we were reversed (f.e. using the yoyo feature) then we need to\r\n            // flip the tween direction back to forward.\r\n            this._reversed = false;\r\n            for (var property in this._valuesStartRepeat) {\r\n                this._swapEndStartRepeatValues(property);\r\n                this._valuesStart[property] = this._valuesStartRepeat[property];\r\n            }\r\n        }\r\n        this._isPlaying = true;\r\n        this._isPaused = false;\r\n        this._onStartCallbackFired = false;\r\n        this._isChainStopped = false;\r\n        this._startTime = time !== undefined ? (typeof time === 'string' ? now$1() + parseFloat(time) : time) : now$1();\r\n        this._startTime += this._delayTime;\r\n        this._setupProperties(this._object, this._valuesStart, this._valuesEnd, this._valuesStartRepeat);\r\n        return this;\r\n    };\r\n    Tween.prototype._setupProperties = function (_object, _valuesStart, _valuesEnd, _valuesStartRepeat) {\r\n        for (var property in _valuesEnd) {\r\n            var startValue = _object[property];\r\n            var startValueIsArray = Array.isArray(startValue);\r\n            var propType = startValueIsArray ? 'array' : typeof startValue;\r\n            var isInterpolationList = !startValueIsArray && Array.isArray(_valuesEnd[property]);\r\n            // If `to()` specifies a property that doesn't exist in the source object,\r\n            // we should not set that property in the object\r\n            if (propType === 'undefined' || propType === 'function') {\r\n                continue;\r\n            }\r\n            // Check if an Array was provided as property value\r\n            if (isInterpolationList) {\r\n                var endValues = _valuesEnd[property];\r\n                if (endValues.length === 0) {\r\n                    continue;\r\n                }\r\n                // handle an array of relative values\r\n                endValues = endValues.map(this._handleRelativeValue.bind(this, startValue));\r\n                // Create a local copy of the Array with the start value at the front\r\n                _valuesEnd[property] = [startValue].concat(endValues);\r\n            }\r\n            // handle the deepness of the values\r\n            if ((propType === 'object' || startValueIsArray) && startValue && !isInterpolationList) {\r\n                _valuesStart[property] = startValueIsArray ? [] : {};\r\n                // eslint-disable-next-line\r\n                for (var prop in startValue) {\r\n                    // eslint-disable-next-line\r\n                    // @ts-ignore FIXME?\r\n                    _valuesStart[property][prop] = startValue[prop];\r\n                }\r\n                _valuesStartRepeat[property] = startValueIsArray ? [] : {}; // TODO? repeat nested values? And yoyo? And array values?\r\n                // eslint-disable-next-line\r\n                // @ts-ignore FIXME?\r\n                this._setupProperties(startValue, _valuesStart[property], _valuesEnd[property], _valuesStartRepeat[property]);\r\n            }\r\n            else {\r\n                // Save the starting value, but only once.\r\n                if (typeof _valuesStart[property] === 'undefined') {\r\n                    _valuesStart[property] = startValue;\r\n                }\r\n                if (!startValueIsArray) {\r\n                    // eslint-disable-next-line\r\n                    // @ts-ignore FIXME?\r\n                    _valuesStart[property] *= 1.0; // Ensures we're using numbers, not strings\r\n                }\r\n                if (isInterpolationList) {\r\n                    // eslint-disable-next-line\r\n                    // @ts-ignore FIXME?\r\n                    _valuesStartRepeat[property] = _valuesEnd[property].slice().reverse();\r\n                }\r\n                else {\r\n                    _valuesStartRepeat[property] = _valuesStart[property] || 0;\r\n                }\r\n            }\r\n        }\r\n    };\r\n    Tween.prototype.stop = function () {\r\n        if (!this._isChainStopped) {\r\n            this._isChainStopped = true;\r\n            this.stopChainedTweens();\r\n        }\r\n        if (!this._isPlaying) {\r\n            return this;\r\n        }\r\n        // eslint-disable-next-line\r\n        this._group && this._group.remove(this);\r\n        this._isPlaying = false;\r\n        this._isPaused = false;\r\n        if (this._onStopCallback) {\r\n            this._onStopCallback(this._object);\r\n        }\r\n        return this;\r\n    };\r\n    Tween.prototype.end = function () {\r\n        this._goToEnd = true;\r\n        this.update(Infinity);\r\n        return this;\r\n    };\r\n    Tween.prototype.pause = function (time) {\r\n        if (time === void 0) { time = now$1(); }\r\n        if (this._isPaused || !this._isPlaying) {\r\n            return this;\r\n        }\r\n        this._isPaused = true;\r\n        this._pauseStart = time;\r\n        // eslint-disable-next-line\r\n        this._group && this._group.remove(this);\r\n        return this;\r\n    };\r\n    Tween.prototype.resume = function (time) {\r\n        if (time === void 0) { time = now$1(); }\r\n        if (!this._isPaused || !this._isPlaying) {\r\n            return this;\r\n        }\r\n        this._isPaused = false;\r\n        this._startTime += time - this._pauseStart;\r\n        this._pauseStart = 0;\r\n        // eslint-disable-next-line\r\n        this._group && this._group.add(this);\r\n        return this;\r\n    };\r\n    Tween.prototype.stopChainedTweens = function () {\r\n        for (var i = 0, numChainedTweens = this._chainedTweens.length; i < numChainedTweens; i++) {\r\n            this._chainedTweens[i].stop();\r\n        }\r\n        return this;\r\n    };\r\n    Tween.prototype.group = function (group) {\r\n        this._group = group;\r\n        return this;\r\n    };\r\n    Tween.prototype.delay = function (amount) {\r\n        this._delayTime = amount;\r\n        return this;\r\n    };\r\n    Tween.prototype.repeat = function (times) {\r\n        this._initialRepeat = times;\r\n        this._repeat = times;\r\n        return this;\r\n    };\r\n    Tween.prototype.repeatDelay = function (amount) {\r\n        this._repeatDelayTime = amount;\r\n        return this;\r\n    };\r\n    Tween.prototype.yoyo = function (yoyo) {\r\n        this._yoyo = yoyo;\r\n        return this;\r\n    };\r\n    Tween.prototype.easing = function (easingFunction) {\r\n        this._easingFunction = easingFunction;\r\n        return this;\r\n    };\r\n    Tween.prototype.interpolation = function (interpolationFunction) {\r\n        this._interpolationFunction = interpolationFunction;\r\n        return this;\r\n    };\r\n    Tween.prototype.chain = function () {\r\n        var tweens = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            tweens[_i] = arguments[_i];\r\n        }\r\n        this._chainedTweens = tweens;\r\n        return this;\r\n    };\r\n    Tween.prototype.onStart = function (callback) {\r\n        this._onStartCallback = callback;\r\n        return this;\r\n    };\r\n    Tween.prototype.onUpdate = function (callback) {\r\n        this._onUpdateCallback = callback;\r\n        return this;\r\n    };\r\n    Tween.prototype.onRepeat = function (callback) {\r\n        this._onRepeatCallback = callback;\r\n        return this;\r\n    };\r\n    Tween.prototype.onComplete = function (callback) {\r\n        this._onCompleteCallback = callback;\r\n        return this;\r\n    };\r\n    Tween.prototype.onStop = function (callback) {\r\n        this._onStopCallback = callback;\r\n        return this;\r\n    };\r\n    /**\r\n     * @returns true if the tween is still playing after the update, false\r\n     * otherwise (calling update on a paused tween still returns true because\r\n     * it is still playing, just paused).\r\n     */\r\n    Tween.prototype.update = function (time, autoStart) {\r\n        if (time === void 0) { time = now$1(); }\r\n        if (autoStart === void 0) { autoStart = true; }\r\n        if (this._isPaused)\r\n            return true;\r\n        var property;\r\n        var elapsed;\r\n        var endTime = this._startTime + this._duration;\r\n        if (!this._goToEnd && !this._isPlaying) {\r\n            if (time > endTime)\r\n                return false;\r\n            if (autoStart)\r\n                this.start(time);\r\n        }\r\n        this._goToEnd = false;\r\n        if (time < this._startTime) {\r\n            return true;\r\n        }\r\n        if (this._onStartCallbackFired === false) {\r\n            if (this._onStartCallback) {\r\n                this._onStartCallback(this._object);\r\n            }\r\n            this._onStartCallbackFired = true;\r\n        }\r\n        elapsed = (time - this._startTime) / this._duration;\r\n        elapsed = this._duration === 0 || elapsed > 1 ? 1 : elapsed;\r\n        var value = this._easingFunction(elapsed);\r\n        // properties transformations\r\n        this._updateProperties(this._object, this._valuesStart, this._valuesEnd, value);\r\n        if (this._onUpdateCallback) {\r\n            this._onUpdateCallback(this._object, elapsed);\r\n        }\r\n        if (elapsed === 1) {\r\n            if (this._repeat > 0) {\r\n                if (isFinite(this._repeat)) {\r\n                    this._repeat--;\r\n                }\r\n                // Reassign starting values, restart by making startTime = now\r\n                for (property in this._valuesStartRepeat) {\r\n                    if (!this._yoyo && typeof this._valuesEnd[property] === 'string') {\r\n                        this._valuesStartRepeat[property] =\r\n                            // eslint-disable-next-line\r\n                            // @ts-ignore FIXME?\r\n                            this._valuesStartRepeat[property] + parseFloat(this._valuesEnd[property]);\r\n                    }\r\n                    if (this._yoyo) {\r\n                        this._swapEndStartRepeatValues(property);\r\n                    }\r\n                    this._valuesStart[property] = this._valuesStartRepeat[property];\r\n                }\r\n                if (this._yoyo) {\r\n                    this._reversed = !this._reversed;\r\n                }\r\n                if (this._repeatDelayTime !== undefined) {\r\n                    this._startTime = time + this._repeatDelayTime;\r\n                }\r\n                else {\r\n                    this._startTime = time + this._delayTime;\r\n                }\r\n                if (this._onRepeatCallback) {\r\n                    this._onRepeatCallback(this._object);\r\n                }\r\n                return true;\r\n            }\r\n            else {\r\n                if (this._onCompleteCallback) {\r\n                    this._onCompleteCallback(this._object);\r\n                }\r\n                for (var i = 0, numChainedTweens = this._chainedTweens.length; i < numChainedTweens; i++) {\r\n                    // Make the chained tweens start exactly at the time they should,\r\n                    // even if the `update()` method was called way past the duration of the tween\r\n                    this._chainedTweens[i].start(this._startTime + this._duration);\r\n                }\r\n                this._isPlaying = false;\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    };\r\n    Tween.prototype._updateProperties = function (_object, _valuesStart, _valuesEnd, value) {\r\n        for (var property in _valuesEnd) {\r\n            // Don't update properties that do not exist in the source object\r\n            if (_valuesStart[property] === undefined) {\r\n                continue;\r\n            }\r\n            var start = _valuesStart[property] || 0;\r\n            var end = _valuesEnd[property];\r\n            var startIsArray = Array.isArray(_object[property]);\r\n            var endIsArray = Array.isArray(end);\r\n            var isInterpolationList = !startIsArray && endIsArray;\r\n            if (isInterpolationList) {\r\n                _object[property] = this._interpolationFunction(end, value);\r\n            }\r\n            else if (typeof end === 'object' && end) {\r\n                // eslint-disable-next-line\r\n                // @ts-ignore FIXME?\r\n                this._updateProperties(_object[property], start, end, value);\r\n            }\r\n            else {\r\n                // Parses relative end values with start as base (e.g.: +10, -3)\r\n                end = this._handleRelativeValue(start, end);\r\n                // Protect against non numeric properties.\r\n                if (typeof end === 'number') {\r\n                    // eslint-disable-next-line\r\n                    // @ts-ignore FIXME?\r\n                    _object[property] = start + (end - start) * value;\r\n                }\r\n            }\r\n        }\r\n    };\r\n    Tween.prototype._handleRelativeValue = function (start, end) {\r\n        if (typeof end !== 'string') {\r\n            return end;\r\n        }\r\n        if (end.charAt(0) === '+' || end.charAt(0) === '-') {\r\n            return start + parseFloat(end);\r\n        }\r\n        else {\r\n            return parseFloat(end);\r\n        }\r\n    };\r\n    Tween.prototype._swapEndStartRepeatValues = function (property) {\r\n        var tmp = this._valuesStartRepeat[property];\r\n        var endValue = this._valuesEnd[property];\r\n        if (typeof endValue === 'string') {\r\n            this._valuesStartRepeat[property] = this._valuesStartRepeat[property] + parseFloat(endValue);\r\n        }\r\n        else {\r\n            this._valuesStartRepeat[property] = this._valuesEnd[property];\r\n        }\r\n        this._valuesEnd[property] = tmp;\r\n    };\r\n    return Tween;\r\n}());\r\n\r\nvar VERSION = '18.6.4';\r\n\r\n/**\r\n * Tween.js - Licensed under the MIT license\r\n * https://github.com/tweenjs/tween.js\r\n * ----------------------------------------------\r\n *\r\n * See https://github.com/tweenjs/tween.js/graphs/contributors for the full list of contributors.\r\n * Thank you all, you're awesome!\r\n */\r\nvar nextId = Sequence.nextId;\r\n/**\r\n * Controlling groups of tweens\r\n *\r\n * Using the TWEEN singleton to manage your tweens can cause issues in large apps with many components.\r\n * In these cases, you may want to create your own smaller groups of tweens.\r\n */\r\nvar TWEEN = mainGroup;\r\n// This is the best way to export things in a way that's compatible with both ES\r\n// Modules and CommonJS, without build hacks, and so as not to break the\r\n// existing API.\r\n// https://github.com/rollup/rollup/issues/1961#issuecomment-423037881\r\nvar getAll = TWEEN.getAll.bind(TWEEN);\r\nvar removeAll = TWEEN.removeAll.bind(TWEEN);\r\nvar add = TWEEN.add.bind(TWEEN);\r\nvar remove = TWEEN.remove.bind(TWEEN);\r\nvar update = TWEEN.update.bind(TWEEN);\r\nvar exports = {\r\n    Easing: Easing,\r\n    Group: Group,\r\n    Interpolation: Interpolation,\r\n    now: now$1,\r\n    Sequence: Sequence,\r\n    nextId: nextId,\r\n    Tween: Tween,\r\n    VERSION: VERSION,\r\n    getAll: getAll,\r\n    removeAll: removeAll,\r\n    add: add,\r\n    remove: remove,\r\n    update: update,\r\n};\r\n\r\nexport default exports;\r\nexport { Easing, Group, Interpolation, Sequence, Tween, VERSION, add, getAll, nextId, now$1 as now, remove, removeAll, update };","/** @module */\r\n\r\nimport { Tween } from '../../lib/tween.esm.js'\r\n\r\n/**\r\n */\r\n\r\n/**\r\n * Shows a circle at the parent object xy coordinates.\r\n * Animates the circle when picking up and dropping.\r\n * @param {(Candidate|CandidateDistribution|VoterCircle|SampleVoterCircle)} parent\r\n *  - something with x and y attributes.\r\n * @param {Number} r - radius of graphic\r\n * @param {String} color - color code\r\n * @param {Screen} screen - something with .ctx to draw to.\r\n * @constructor\r\n */\r\nexport default function CircleGraphic(parent, r, color, screen) {\r\n    const self = this\r\n\r\n    self.r = r\r\n    self.trueR = r\r\n\r\n    self.pickUp = function () {\r\n        self.tween = new Tween(self)\r\n        self.tween.to({ r: self.trueR * 2 }, 100)\r\n        self.tween.start()\r\n    }\r\n    self.drop = function () {\r\n        self.tween = new Tween(self)\r\n        self.tween.to({ r: self.trueR }, 100)\r\n        self.tween.start()\r\n    }\r\n\r\n    // Graphics component\r\n    self.render = function () {\r\n        const { fctx } = screen\r\n\r\n        if (self.tween) {\r\n            self.tween.update()\r\n        }\r\n\r\n        // handle\r\n\r\n        fctx.beginPath()\r\n        fctx.fillStyle = color\r\n        fctx.arc(parent.x, parent.y, self.r, 0, 2 * Math.PI)\r\n        fctx.fill()\r\n        fctx.stroke()\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport CircleGraphic from './CircleGraphic.js'\r\n\r\n/**\r\n * VoterCircle class with Handle component to take care of dragging.\r\n * VoronoiGroup component takes care of drawing votes.\r\n * @param {Number} x\r\n * @param {Number} y\r\n * @param {Number} r - radius of circle of candidate positions.\r\n * @param {Screen} screen\r\n * @param {Registrar} voterRegistrar\r\n * @param {Commander} commander\r\n * @param {Changes} changes\r\n * @param {Boolean} doLoad - Should we add the voter without adding to the history?\r\n * @constructor\r\n */\r\nexport default function VoterCircle(\r\n    x,\r\n    y,\r\n    r,\r\n    screen,\r\n    voterRegistrar,\r\n    commander,\r\n    changes,\r\n    doLoad,\r\n    voterCommander,\r\n) {\r\n    const self = this\r\n\r\n    // Get assigned a id by the voterRegistrar list manager\r\n\r\n    const id = voterRegistrar.new(self)\r\n\r\n    // Instantiate Variables\r\n\r\n    // use commands to instantiate variables\r\n    self.instantiate = () => {\r\n        // set current value because we need to be able to undo by returning to these values\r\n        // voterCommander.setEClientList.setCurrentValue(id, 0)\r\n        // voterCommander.setXYClientList.setCurrentValue(id, { x, y })\r\n        // voterCommander.setRClientList.setCurrentValue(id, r)\r\n\r\n        const commands = [\r\n            voterCommander.setEClientList.command(id, 1, 0), // set alive flag\r\n            voterCommander.setXYClientList.command(id, { x, y }, { x, y }),\r\n            voterCommander.setRClientList.command(id, r, r),\r\n        ]\r\n        // Either load the commands because we don't want to create an item of history\r\n        // Or do the commands because want to store an item in history, so that we can undo.\r\n        if (doLoad) {\r\n            commander.loadCommands(commands)\r\n        } else {\r\n            commander.doCommands(commands)\r\n        }\r\n    }\r\n\r\n    self.setEAction = (e) => {\r\n        self.exists = e\r\n        changes.add(['draggables'])\r\n    }\r\n    self.setE = (e) => {\r\n        const cur = voterCommander.setEClientList.getCurrentValue(id)\r\n        voterCommander.setEClientList.go(id, e, cur)\r\n    }\r\n\r\n    self.setXYAction = (p) => {\r\n        self.x = p.x\r\n        self.y = p.y\r\n        changes.add(['draggables'])\r\n    }\r\n    self.setXY = (p) => {\r\n        const cur = voterCommander.setXYClientList.getCurrentValue(id)\r\n        voterCommander.setXYClientList.go(id, p, cur)\r\n    }\r\n\r\n    self.setRAction = (newR) => {\r\n        self.r = newR\r\n        changes.add(['radius'])\r\n    }\r\n    self.setR = (newR) => {\r\n        const cur = voterCommander.setRClientList.getCurrentValue(id)\r\n        voterCommander.setRClientList.go(id, newR, cur)\r\n    }\r\n\r\n    self.instantiate()\r\n\r\n    // Done instantiating variables\r\n\r\n    const circle = new CircleGraphic(self, 10, '#555', screen)\r\n    self.circle = circle\r\n\r\n    // Drawing\r\n\r\n    self.renderForeground = () => {\r\n        // handle\r\n        circle.render()\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport { Tween } from '../../lib/tween.esm.js'\r\n\r\n/**\r\n * Square is a graphic.\r\n * It displays itself on a parent object.\r\n * Its parent object stores its x and y.\r\n * It shows a square at the parent object xy coordinates.\r\n * It animates the square when picking up and dropping.\r\n * @param {Object} parent\r\n * @param {Number} parent.x\r\n * @param {Number} parent.y\r\n * @param {Number} w - width of square to draw.\r\n * @param {Number} h - height of square to draw.\r\n * @param {String} color\r\n * @param {Screen} screen\r\n * @constructor\r\n */\r\nexport default function SquareGraphic(parent, w, h, color, screen) {\r\n    const self = this\r\n    self.w = w // display width, because we're going to make animations with it\r\n    self.h = h\r\n    self.trueW = w // true width, because we want to return to this width after animating.\r\n    self.trueH = h\r\n    self.color = color\r\n\r\n    self.pickUp = function () {\r\n        self.tweenSq = new Tween(self)\r\n        self.tweenSq.to({ w: self.trueW + 10, h: self.trueH + 10 }, 100)\r\n        self.tweenSq.start()\r\n    }\r\n    self.drop = function () {\r\n        self.tweenSq = new Tween(self)\r\n        self.tweenSq.to({ w: self.trueW, h: self.trueH }, 100)\r\n        self.tweenSq.start()\r\n    }\r\n\r\n    // Graphics component\r\n    self.render = function () {\r\n        const { fctx } = screen\r\n\r\n        if (self.tweenSq) {\r\n            self.tweenSq.update()\r\n        }\r\n        fctx.beginPath()\r\n        fctx.fillStyle = self.color\r\n        fctx.rect(\r\n            (parent.x - 0.5 * self.w) - 0.5,\r\n            (parent.y - 0.5 * self.h) - 0.5,\r\n            self.w + 1,\r\n            self.h + 1,\r\n        )\r\n        fctx.fill()\r\n        fctx.stroke()\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport SquareGraphic from './SquareGraphic.js'\r\nimport { drawStrokedColor, textPercent } from '../utilities/graphicsUtilities.js'\r\n\r\n/**\r\n * Candidate class on top of handle.\r\n * Candidate adds candidate behavior on top of a draggable handle handle.\r\n * @param {Number} x\r\n * @param {Number} y\r\n * @param {Number} w\r\n * @param {Number} h\r\n * @param {String} color\r\n * @param {Screen} screen\r\n * @param {Registrar} candidateRegistrar\r\n * @param {Commander} commander\r\n * @param {Changes} changes\r\n * @param {Boolean} doLoad - Should we add the candidateDistribution without adding to the history?\r\n * @constructor\r\n */\r\nexport default function Candidate(\r\n    x,\r\n    y,\r\n    w,\r\n    h,\r\n    color,\r\n    screen,\r\n    candidateRegistrar,\r\n    commander,\r\n    changes,\r\n    doLoad,\r\n    candidateCommander,\r\n) {\r\n    const self = this\r\n\r\n    const id = candidateRegistrar.new(self)\r\n\r\n    // Instantiate Variables\r\n\r\n    // use commands to instantiate variables\r\n    self.instantiate = () => {\r\n        // set current value because we need to be able to undo by returning to these values\r\n        // candidateCommander.setEClientList.setCurrentValue(id, 0)\r\n        // candidateCommander.setXYClientList.setCurrentValue(id, { x, y })\r\n\r\n        const commands = [\r\n            // candidateCommander.setNumberCandidatesClient.command(id + 1),\r\n            candidateCommander.setEClientList.command(id, 1, 0), // set alive flag\r\n            candidateCommander.setXYClientList.command(id, { x, y }, { x, y }),\r\n        ]\r\n        // Either load the commands because we don't want to create an item of history\r\n        // Or do the commands because want to store an item in history, so that we can undo.\r\n        if (doLoad) {\r\n            commander.loadCommands(commands)\r\n        } else {\r\n            commander.doCommands(commands)\r\n        }\r\n    }\r\n    self.setEAction = (e) => {\r\n        self.exists = e\r\n        changes.add(['draggables'])\r\n    }\r\n    self.setE = (e) => {\r\n        const cur = candidateCommander.setEClientList.getCurrentValue(id)\r\n        candidateCommander.setEClientList.go(id, e, cur)\r\n    }\r\n\r\n    self.setXYAction = (p) => {\r\n        self.x = p.x\r\n        self.y = p.y\r\n        changes.add(['draggables'])\r\n    }\r\n    self.setXY = (p) => {\r\n        const cur = candidateCommander.setXYClientList.getCurrentValue(id)\r\n        candidateCommander.setXYClientList.go(id, p, cur)\r\n    }\r\n\r\n    self.instantiate()\r\n\r\n    const square = new SquareGraphic(self, w, h, color, screen) // square is for rendering\r\n    self.square = square\r\n\r\n    self.fraction = 0\r\n    self.setFraction = function (fraction) {\r\n        self.fraction = fraction\r\n    }\r\n\r\n    self.setWins = (wins) => {\r\n        self.wins = wins\r\n    }\r\n\r\n    self.renderForeground = function () {\r\n        square.render()\r\n\r\n        drawStrokedColor(textPercent(self.fraction), self.x, self.y - square.h * 0.5 - 2, 20, 2, '#222', screen.fctx)\r\n\r\n        if (self.wins !== undefined) {\r\n            drawStrokedColor(self.wins, self.x, self.y + square.h * 0.5 + 20 + 2, 20, 2, '#222', screen.fctx)\r\n        }\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport SquareGraphic from './SquareGraphic.js'\r\n\r\n/**\r\n * This represents a spatial distribution of candidates.\r\n * A draggable handle handle provides draggable behavior.\r\n * @param {Number} x\r\n * @param {Number} y\r\n * @param {Number} r\r\n * @param {Screen} screen\r\n * @param {Registrar} candidateDnRegistrar\r\n * @param {Commander} commander\r\n * @param {Changes} changes\r\n * @param {Boolean} doLoad - Should we add the candidateDistribution without adding to the history?\r\n * @constructor\r\n */\r\nexport default function CandidateDistribution(\r\n    x,\r\n    y,\r\n    r,\r\n    screen,\r\n    candidateDnRegistrar,\r\n    commander,\r\n    changes,\r\n    doLoad,\r\n    candidateDnCommander,\r\n) {\r\n    const self = this\r\n\r\n    const id = candidateDnRegistrar.new(self)\r\n\r\n    // Instantiate Variables\r\n\r\n    // use commands to instantiate variables\r\n    self.instantiate = () => {\r\n        // candidateDnCommander.setEClientList.setCurrentValue(id, 0)\r\n        // candidateDnCommander.setXYClientList.setCurrentValue(id, { x, y })\r\n        // candidateDnCommander.setRClientList.setCurrentValue(id, r)\r\n        const commands = [\r\n            candidateDnCommander.setEClientList.command(id, 1, 0), // set alive flag\r\n            candidateDnCommander.setXYClientList.command(id, { x, y }, { x, y }),\r\n            candidateDnCommander.setRClientList.command(id, r, r),\r\n        ]\r\n        // Either load the commands because we don't want to create an item of history\r\n        // Or do the commands because want to store an item in history, so that we can undo.\r\n        if (doLoad) {\r\n            commander.loadCommands(commands)\r\n        } else {\r\n            commander.doCommands(commands)\r\n        }\r\n    }\r\n\r\n    self.setEAction = (e) => {\r\n        self.exists = e\r\n        changes.add(['draggables'])\r\n    }\r\n    self.setE = (e) => {\r\n        const cur = candidateDnCommander.setEClientList.getCurrentValue(id)\r\n        candidateDnCommander.setEClientList.go(id, e, cur)\r\n    }\r\n\r\n    self.setXYAction = (p) => {\r\n        self.x = p.x\r\n        self.y = p.y\r\n        changes.add(['draggables'])\r\n    }\r\n    self.setXY = (p) => {\r\n        const cur = candidateDnCommander.setXYClientList.getCurrentValue(id)\r\n        candidateDnCommander.setXYClientList.go(id, p, cur)\r\n    }\r\n\r\n    self.setRAction = (newR) => {\r\n        self.r = newR\r\n        changes.add(['radius'])\r\n    }\r\n    self.setR = (newR) => {\r\n        const cur = candidateDnCommander.setRClientList.getCurrentValue(id)\r\n        candidateDnCommander.setRClientList.go(id, newR, cur)\r\n    }\r\n\r\n    self.instantiate()\r\n\r\n    const square = new SquareGraphic(self, 21, 21, '#ccc', screen) // square is for rendering\r\n    self.square = square\r\n\r\n    self.render = function () {\r\n        const { ctx } = screen\r\n\r\n        ctx.beginPath()\r\n        // ctx.fillStyle = \"grey\"\r\n        ctx.arc(self.x, self.y, self.r, 0, 2 * Math.PI)\r\n        // ctx.fill()\r\n        ctx.stroke()\r\n    }\r\n    self.renderForeground = () => {\r\n        square.render()\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Gives an id to an entity.\r\n * @constructor\r\n */\r\nexport default function Registrar() {\r\n    const self = this\r\n\r\n    const entities = []\r\n    let nextID = 0\r\n\r\n    self.new = function (entity) {\r\n        entities.push(entity)\r\n        const id = nextID\r\n        nextID += 1\r\n        return id\r\n    }\r\n    self.num = () => nextID\r\n    self.get = (id) => entities[id]\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Draggable Manager gives draggable behavior to objects on a canvas.\r\n * If anything changes, an item is added to the \"changes\" array.\r\n * Calling screen.setEventHandlers(dragm.eventHandlers) sets the eventhandlers on the screen.\r\n * @param {Screen} screen\r\n * @param {Changes} changes\r\n * @constructor\r\n */\r\nexport default function DraggableManager(screen, changes) {\r\n    const self = this\r\n\r\n    // private variables\r\n    let drag = {}\r\n    const draggables = []\r\n\r\n    const canvas = screen.foreground\r\n\r\n    // add draggable objects\r\n    self.newSquareHandle = function (o, g) {\r\n        // set properties here so that we don't set properties on the actual object\r\n        const p = { isSquare: true }\r\n        draggables.push({ o, g, p })\r\n    }\r\n    self.newCircleHandle = function (o, g) { // object, graphic\r\n        const p = { isCircle: true }\r\n        draggables.push({ o, g, p })\r\n    }\r\n\r\n    // Mouse Listeners\r\n    // As a sidenote, it is interesting that we don't need to call model.update here\r\n    // because we are using a game loop that will call model.update.\r\n    const start = function (event) {\r\n        const mouse = {}\r\n        mouse.x = event.offsetX\r\n        mouse.y = event.offsetY\r\n        const extra = (event.isTouch) ? 10 : 0\r\n        const nd = draggables.length\r\n        for (let i = 0; i < nd; i++) {\r\n            const d = draggables[i]\r\n            if (d.o.exists && hitTest(d, mouse, extra)) {\r\n                if (event.isTouch) {\r\n                    event.preventDefault()\r\n                    event.stopPropagation()\r\n                }\r\n                drag.iDragging = i\r\n                drag.isDragging = true\r\n                drag.offX = d.o.x - mouse.x\r\n                drag.offY = d.o.y - mouse.y\r\n                d.g.pickUp()\r\n                canvas.dataset.cursor = 'grabbing' // CSS data attribute\r\n                break // exit after picking one object\r\n            }\r\n        }\r\n    }\r\n\r\n    const end = function () {\r\n        if (drag.iDragging !== undefined) {\r\n            const dragging = draggables[drag.iDragging]\r\n            dragging.g.drop()\r\n        }\r\n        drag = {}\r\n    }\r\n\r\n    const move = function (event) {\r\n        const mouse = {}\r\n        mouse.x = event.offsetX\r\n        mouse.y = event.offsetY\r\n        if (drag.isDragging) { // because the mouse is moving\r\n            if (event.isTouch) {\r\n                event.preventDefault()\r\n                event.stopPropagation()\r\n            }\r\n            const dragging = draggables[drag.iDragging]\r\n            dragging.o.setXY({ x: mouse.x + drag.offX, y: mouse.y + drag.offY })\r\n            changes.add(['draggables'])\r\n        } else {\r\n            // see if we're hovering over something grabbable\r\n            // because we want the user to see if they can grab something\r\n            const nd = draggables.length\r\n            for (let i = 0; i < nd; i++) {\r\n                const d = draggables[i]\r\n                if (d.o.exists && hitTest(d, mouse, 0)) {\r\n                    canvas.dataset.cursor = 'grab'\r\n                    return\r\n                }\r\n            }\r\n            canvas.dataset.cursor = '' // nothing to grab\r\n        }\r\n    }\r\n\r\n    // Touch Listeners\r\n    const touchmove = (e) => {\r\n        const pass = passTouch(e)\r\n        move(pass)\r\n    }\r\n    const touchstart = (e) => {\r\n        const pass = passTouch(e)\r\n        start(pass)\r\n    }\r\n    const touchend = (e) => {\r\n        const pass = passTouch(e)\r\n        end(pass)\r\n    }\r\n\r\n    self.eventHandlers = {\r\n        start, move, end, touchmove, touchstart, touchend,\r\n    }\r\n\r\n    /**\r\n     * Make a touch event look like a mouse event, with a flag.\r\n     * @param {Event} e - The event from the DOM\r\n     * @returns {Event} - The same event it received, plus some added properties.\r\n     */\r\n    function passTouch(e) {\r\n        const rect = e.target.getBoundingClientRect()\r\n        const w = e.target.clientWidth\r\n        const h = e.target.clientHeight\r\n        let x = e.changedTouches[0].clientX - rect.left\r\n        let y = e.changedTouches[0].clientY - rect.top\r\n        if (x < 0) x = 0\r\n        if (y < 0) y = 0\r\n        if (x > w) x = w\r\n        if (y > h) y = h\r\n        const pass = { offsetX: x, offsetY: y, isTouch: true }\r\n        Object.assign(e, pass)\r\n        return e\r\n    }\r\n\r\n    /**\r\n     * Check whether m, e.g. a mouse, hits d, a draggable object.\r\n     * @param {Object} d - An entry in the draggables array.\r\n     * @param {Object} m - An object with properties x and y, e.g. a mouse.\r\n     * @param {Number} extra - Extra slack to catch touches outside of the hitbox.\r\n     * @returns {Boolean} - Whether m hits d.\r\n     */\r\n    function hitTest(d, m, extra) {\r\n        // Only drag an object if we're near it.\r\n        const x = d.o.x - m.x\r\n        const y = d.o.y - m.y\r\n        if (d.p.isCircle) {\r\n            const { r } = d.g\r\n            const hit = x * x + y * y < (r + extra) * (r + extra)\r\n            return hit\r\n        } if (d.p.isSquare) {\r\n            const { w, h } = d.g\r\n            const hit = Math.abs(x) < 0.5 * w + extra && Math.abs(y) < 0.5 * h + extra\r\n            return hit\r\n        }\r\n        return false\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Add button to layout for adding a candidate\r\n * @param {Layout} layout\r\n * @param {Commander} commander\r\n */\r\nexport default function CreateAddCandidate(layout, sim) {\r\n    const self = this\r\n\r\n    const addCandidateButton = document.createElement('button')\r\n\r\n    addCandidateButton.className = 'button2'\r\n    addCandidateButton.innerText = 'Add Candidate'\r\n\r\n    addCandidateButton.onclick = () => {\r\n        sim.addCandidatePressed()\r\n    }\r\n\r\n    layout.newElement('addCandidate', addCandidateButton)\r\n\r\n    self.show = () => {\r\n        addCandidateButton.hidden = false\r\n    }\r\n    self.hide = () => {\r\n        addCandidateButton.hidden = true\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Add button to layout for adding a candidate\r\n * @param {Layout} layout\r\n * @param {Commander} commander\r\n */\r\nexport default function CreateAddCandidateDistribution(layout, sim) {\r\n    const self = this\r\n    const addCandidateDistributionButton = document.createElement('button')\r\n\r\n    addCandidateDistributionButton.className = 'button2'\r\n    addCandidateDistributionButton.innerText = 'Add Candidate Distribution'\r\n\r\n    addCandidateDistributionButton.onclick = () => {\r\n        sim.addCandidateDistributionPressed()\r\n    }\r\n\r\n    layout.newElement('addCandidateDistribution', addCandidateDistributionButton)\r\n\r\n    self.show = () => {\r\n        addCandidateDistributionButton.hidden = false\r\n    }\r\n    self.hide = () => {\r\n        addCandidateDistributionButton.hidden = true\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Register clients with the commander for setting entity values.\r\n * This is here because we need an action that takes an id.\r\n * @param {Registrar} candidateRegistrar\r\n * @param {Commander} commander\r\n * @param {Sim} sim\r\n * @constructor\r\n */\r\nexport default function CandidateCommander(candidateRegistrar, commander, sim) {\r\n    const self = this\r\n\r\n    const prefix = 'candidates'\r\n\r\n    self.setEClientList = commander.addClientList({\r\n        action: (id, e) => {\r\n            const candidate = candidateRegistrar.get(id)\r\n            candidate.setEAction(e)\r\n        },\r\n        name: `${prefix}-setE`,\r\n    })\r\n\r\n    self.setXYClientList = commander.addClientList({\r\n        action: (id, p) => {\r\n            const candidate = candidateRegistrar.get(id)\r\n            candidate.setXYAction(p)\r\n        },\r\n        name: `${prefix}-setXY`,\r\n        props: { isSetXY: true },\r\n    })\r\n\r\n    // This is kind of weird because this value is not a good measure of the number of entities.\r\n    // An undo will reduce the number stored with the command name,\r\n    // but not reduce the number of entities.\r\n    // So we disable undo.\r\n    // Well, actually we can just loadCommands in order to avoid undo.\r\n    self.setNumberCandidatesClient = commander.addClient({\r\n        action: (num) => {\r\n            sim.setNumberCandidatesAction(num)\r\n        },\r\n        currentValue: 0,\r\n        name: `${prefix}-setNumberAtLeast`,\r\n        props: { isFirstAction: true },\r\n    })\r\n    self.setNumberCandidates = (num) => {\r\n        commander.loadCommands([self.setNumberCandidatesClient.command(num)])\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Register clients with the commander for setting entity values.\r\n * This is here because we need an action that takes an id.\r\n * @param {Registrar} candidateDnRegistrar\r\n * @param {Commander} commander\r\n * @param {Sim} sim\r\n * @constructor\r\n */\r\nexport default function CandidateDnCommander(candidateDnRegistrar, commander, sim) {\r\n    const self = this\r\n\r\n    const prefix = 'candidateDns'\r\n\r\n    self.setEClientList = commander.addClientList({\r\n        action: (id, e) => {\r\n            const candidateDn = candidateDnRegistrar.get(id)\r\n            candidateDn.setEAction(e)\r\n        },\r\n        name: `${prefix}-setE`,\r\n    })\r\n\r\n    self.setXYClientList = commander.addClientList({\r\n        action: (id, p) => {\r\n            const candidateDn = candidateDnRegistrar.get(id)\r\n            candidateDn.setXYAction(p)\r\n        },\r\n        name: `${prefix}-setXY`,\r\n        props: { isSetXY: true },\r\n    })\r\n\r\n    self.setRClientList = commander.addClientList({\r\n        action: (id, r) => {\r\n            const candidateDn = candidateDnRegistrar.get(id)\r\n            candidateDn.setRAction(r)\r\n        },\r\n        name: `${prefix}-setR`,\r\n    })\r\n\r\n    // This is kind of weird because this value is not a good measure of the number of entities.\r\n    // An undo will reduce the number stored with the command name,\r\n    // but not reduce the number of entities.\r\n    // So we disable undo.\r\n    self.setNumberCandidateDnsClient = commander.addClient({\r\n        action: (num) => {\r\n            sim.setNumberCandidateDnsAction(num)\r\n        },\r\n        currentValue: 0,\r\n        name: `${prefix}-setNumberAtLeast`,\r\n        props: { isFirstAction: true },\r\n    })\r\n    self.setNumberCandidateDns = (num) => {\r\n        commander.loadCommands([self.setNumberCandidateDnsClient.command(num)])\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Register clients with the commander for setting entity values.\r\n * This is here because we need an action that takes an id.\r\n * @param {Registrar} voterRegistrar\r\n * @param {Commander} commander\r\n * @param {Sim} sim\r\n * @constructor\r\n */\r\nexport default function VoterCircleCommander(voterRegistrar, commander, sim) {\r\n    const self = this\r\n\r\n    const prefix = 'voters'\r\n\r\n    self.setEClientList = commander.addClientList({\r\n        action: (id, e) => {\r\n            const voter = voterRegistrar.get(id)\r\n            voter.setEAction(e)\r\n        },\r\n        name: `${prefix}-setE`,\r\n    })\r\n\r\n    self.setXYClientList = commander.addClientList({\r\n        action: (id, p) => {\r\n            const voter = voterRegistrar.get(id)\r\n            voter.setXYAction(p)\r\n        },\r\n        name: `${prefix}-setXY`,\r\n        props: { isSetXY: true },\r\n    })\r\n\r\n    self.setRClientList = commander.addClientList({\r\n        action: (id, r) => {\r\n            const voter = voterRegistrar.get(id)\r\n            voter.setRAction(r)\r\n        },\r\n        name: `${prefix}-setR`,\r\n    })\r\n\r\n    // This is kind of weird because this value is not a good measure of the number of entities.\r\n    // An undo will reduce the number stored with the command name,\r\n    // but not reduce the number of entities.\r\n    // So we disable undo.\r\n    self.setNumberVotersClient = commander.addClient({\r\n        action: (num) => sim.setNumberVotersAction(num),\r\n        currentValue: 0,\r\n        name: `${prefix}-setNumberAtLeast`,\r\n        props: { isFirstAction: true },\r\n    })\r\n    self.setNumberVoters = (num) => {\r\n        commander.loadCommands([self.setNumberVotersClient.command(num)])\r\n    }\r\n}\r\n","/** @module */\r\n\r\nimport SimOne from './states/SimOne.js'\r\nimport SimSample from './states/SimSample.js'\r\nimport SimGeoOne from './states/SimGeoOne.js'\r\nimport VoterCircle from '../voters/VoterCircle.js'\r\nimport Candidate from '../candidates/Candidate.js'\r\nimport CandidateDistribution from '../candidates/CandidateDistribution.js'\r\nimport Registrar from './Registrar.js'\r\nimport DraggableManager from '../ui/DraggableManager.js'\r\nimport createAddVoter from '../ui/createAddVoter.js'\r\nimport CreateAddCandidate from '../ui/CreateAddCandidate.js'\r\nimport CreateAddCandidateDistribution from '../ui/CreateAddCandidateDistribution.js'\r\nimport CandidateCommander from '../candidates/CandidateCommander.js'\r\nimport CandidateDnCommander from '../candidates/CandidateDnCommander.js'\r\nimport VoterCircleCommander from '../voters/VoterCircleCommander.js'\r\n\r\n/**\r\n * Simulation is the main task we're trying to accomplish in this program.\r\n * There are multiple states that the sim can be in.\r\n * Each state simulates something different.\r\n * Each state has initialization, update, and render procedures.\r\n * This is a state machine.\r\n * @param {Screen} screen\r\n * @param {Menu} menu\r\n * @param {Changes} changes\r\n * @param {OneElection} oneElection\r\n * @param {SampleElections} sampleElections\r\n * @param {GeoElection} geoElection\r\n * @param {Commander} commander\r\n *\r\n * @constructor\r\n */\r\nexport default function Sim(\r\n    screen,\r\n    menu,\r\n    changes,\r\n    oneElection,\r\n    sampleElections,\r\n    geoElection,\r\n    commander,\r\n    layout,\r\n) {\r\n    const self = this\r\n\r\n    // Buttons //\r\n\r\n    const label = document.createElement('div')\r\n    label.setAttribute('class', 'button-group-label')\r\n    label.innerText = 'Sim Controls:'\r\n    layout.newElement('simControlsLabel', label)\r\n\r\n    createAddVoter(layout, self)\r\n    const canButton = new CreateAddCandidate(layout, self)\r\n    const canDnButton = new CreateAddCandidateDistribution(layout, self)\r\n\r\n    // States //\r\n\r\n    const voterRegistrar = new Registrar()\r\n    const candidateRegistrar = new Registrar()\r\n    const candidateDnRegistrar = new Registrar()\r\n\r\n    const dragms = {\r\n        one: new DraggableManager(screen, changes),\r\n        sample: new DraggableManager(screen, changes),\r\n        geoOne: new DraggableManager(screen, changes),\r\n    }\r\n    const sims = {\r\n        one: new SimOne(screen, dragms.one, menu, changes, oneElection, canButton),\r\n        // eslint-disable-next-line max-len\r\n        sample: new SimSample(screen, dragms.sample, menu, changes, sampleElections, canDnButton),\r\n        geoOne: new SimGeoOne(screen, dragms.geoOne, menu, changes, geoElection, canButton),\r\n    }\r\n\r\n    // Entities //\r\n\r\n    const candidateCommander = new CandidateCommander(candidateRegistrar, commander, self)\r\n    const candidateDnCommander = new CandidateDnCommander(candidateDnRegistrar, commander, self)\r\n    const voterCommander = new VoterCircleCommander(voterRegistrar, commander, self)\r\n\r\n    self.addCandidatePressed = () => {\r\n        // really, we want to make a command to set numCandidates to at least an amount\r\n        const num = candidateRegistrar.num() + 1\r\n        candidateCommander.setNumberCandidates(num)\r\n    }\r\n    self.setNumberCandidatesAction = (num) => {\r\n        while (candidateRegistrar.num() < num) {\r\n            self.addCandidate(50, 50, 'yellow', false)\r\n        }\r\n    }\r\n\r\n    self.addCandidateDistributionPressed = () => {\r\n        const num = candidateDnRegistrar.num() + 1\r\n        candidateDnCommander.setNumberCandidateDns(num)\r\n    }\r\n    self.setNumberCandidateDnsAction = (num) => {\r\n        while (candidateDnRegistrar.num() < num) {\r\n            self.addCandidateDistribution(50, 50, 100, false)\r\n        }\r\n    }\r\n\r\n    self.addCandidate = (x, y, c, doLoad) => {\r\n        // eslint-disable-next-line no-new, max-len\r\n        const candidate = new Candidate(x, y, 21, 21, c, screen, candidateRegistrar, commander, changes, doLoad, candidateCommander)\r\n        sims.one.addSimCandidate(candidate)\r\n        sims.geoOne.addSimCandidate(candidate)\r\n\r\n        const num = candidateRegistrar.num()\r\n        candidateCommander.setNumberCandidates(num)\r\n    }\r\n    self.addCandidateDistribution = (x, y, r, doLoad) => {\r\n        // eslint-disable-next-line no-new, max-len\r\n        const candidateDistribution = new CandidateDistribution(x, y, r, screen, candidateDnRegistrar, commander, changes, doLoad, candidateDnCommander)\r\n        sims.sample.addSimCandidateDistribution(candidateDistribution)\r\n\r\n        const num = candidateDnRegistrar.num()\r\n        candidateDnCommander.setNumberCandidateDns(num)\r\n    }\r\n\r\n    self.addVoterPressed = () => {\r\n        const num = voterRegistrar.num() + 1\r\n        voterCommander.setNumberVoters(num)\r\n    }\r\n    self.setNumberVotersAction = (num) => {\r\n        while (voterRegistrar.num() < num) {\r\n            self.addVoterCircle(50, 50, 100, false)\r\n        }\r\n    }\r\n\r\n    self.addVoterCircle = (x, y, r, doLoad) => {\r\n        // eslint-disable-next-line max-len\r\n        const voterCircle = new VoterCircle(x, y, r, screen, voterRegistrar, commander, changes, doLoad, voterCommander)\r\n\r\n        sims.one.addSimVoterCircle(voterCircle)\r\n        sims.geoOne.addSimVoterCircle(voterCircle)\r\n        sims.sample.addSimVoterCircle(voterCircle)\r\n\r\n        const num = voterRegistrar.num()\r\n        voterCommander.setNumberVoters(num)\r\n    }\r\n\r\n    self.addCandidate(50, 100, '#e52', true)\r\n    self.addCandidate(100, 50, '#5e2', true)\r\n    self.addCandidate(300 - 100, 300 - 50, '#25e', true)\r\n    self.addCandidateDistribution(150, 150, 100, true)\r\n    self.addVoterCircle(50, 150, 100, true)\r\n    self.addVoterCircle(250, 150, 100, true)\r\n\r\n    // State Machine //\r\n\r\n    self.state = 'one' // default\r\n    // self.typeExit = self.state\r\n    changes.add(['simType'])\r\n\r\n    self.update = () => {\r\n        // state change\r\n        if (changes.check(['simType'])) {\r\n            // exit states\r\n            Object.keys(sims).forEach((k) => sims[k].exit())\r\n            // enter state\r\n            sims[self.state].enter()\r\n        }\r\n\r\n        // state update\r\n        sims[self.state].update()\r\n    }\r\n    self.renderForeground = () => { sims[self.state].renderForeground() }\r\n    self.render = () => { sims[self.state].render() }\r\n\r\n    // -- Menu -- //\r\n\r\n    // add a menu item to switch between types of sims\r\n    // a list of simulation types\r\n    self.typeList = [\r\n        { name: 'One Election', value: 'one', state: '' },\r\n        { name: 'Sample Elections', value: 'sample', state: '' },\r\n        { name: 'Geo Election', value: 'geoOne', state: '' },\r\n    ]\r\n    menu.addMenuItem(\r\n        self,\r\n        {\r\n            label: 'Simulation:',\r\n            prop: 'state',\r\n            setProp: (p) => { self.state = p },\r\n            options: self.typeList,\r\n            change: ['simType'],\r\n        },\r\n    )\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Add buttons to layout for undo and redo, and connect them to commander for functionality.\r\n * @param {Layout} layout\r\n * @param {Commander} commander\r\n */\r\nexport default function createAddVoter(layout, sim) {\r\n    const addVoterButton = document.createElement('button')\r\n\r\n    addVoterButton.innerText = 'Add Voter'\r\n    addVoterButton.className = 'button2'\r\n\r\n    addVoterButton.onclick = () => {\r\n        sim.addVoterPressed()\r\n    }\r\n\r\n    layout.newElement('addVoter', addVoterButton)\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Simulate winners from many sampled elections.\r\n * Candidates are sampled from a distribution.\r\n * Winners are drawn as points.\r\n * The simulation is dynamic. More simulations are performed at each frame.\r\n * @param {Screen} screen\r\n * @param {Menu} menu\r\n * @param {Election} election\r\n * @constructor\r\n */\r\nexport default function SampleElections(screen, menu, election) {\r\n    const self = this\r\n\r\n    self.points = []\r\n    self.newPoints = []\r\n\r\n    self.startSim = function () {\r\n        self.points = []\r\n        clearBuffer()\r\n    }\r\n\r\n    self.addSim = function (sampleVoters, sampleCandidates) {\r\n        // add more points\r\n\r\n        if (self.points.length > 5000) return 1\r\n        // this limit right now is about graphics rendering.\r\n        // todo: render to a buffer\r\n\r\n        // number of sample elections\r\n        const ns = 20\r\n\r\n        const voterGroups = sampleVoters.getVoterGroups()\r\n\r\n        for (let i = 0; i < ns; i++) {\r\n            // choose a number of candidates\r\n            let nk\r\n            if (election.method.checkElectionType() === 'singleWinner') {\r\n                nk = 5\r\n            } else if (election.method.checkElectionType() === 'allocation') {\r\n                nk = 10\r\n            }\r\n            const canList = []\r\n            for (let k = 0; k < nk; k++) {\r\n                // sample a point from the distribution of candidates\r\n                const point = sampleCandidates.sampler.samplePoint()\r\n\r\n                // make a candidate\r\n                canList.push(point)\r\n            }\r\n\r\n            // find winner position\r\n            const results = election.runElection(voterGroups, canList)\r\n\r\n            if (election.method.checkElectionType() === 'singleWinner') {\r\n                const { winner } = results\r\n\r\n                // record point\r\n                const winPoint = { x: winner.x, y: winner.y }\r\n                self.points.push(winPoint)\r\n                self.newPoints.push(winPoint)\r\n            } else {\r\n                const { allocation } = results\r\n\r\n                const jitterSize = 10\r\n                canList.forEach(\r\n                    (can, k) => {\r\n                        const numPoints = allocation[k]\r\n                        for (let m = 0; m < numPoints; m++) {\r\n                            let winPoint\r\n                            if (m === 0) {\r\n                                // record point\r\n                                winPoint = { x: can.x, y: can.y }\r\n                            } else {\r\n                                // add jitter\r\n                                winPoint = {\r\n                                    x: can.x + (Math.random() - 0.5) * jitterSize,\r\n                                    y: can.y + (Math.random() - 0.5) * jitterSize,\r\n                                }\r\n                            }\r\n                            // record point\r\n                            self.points.push(winPoint)\r\n                            self.newPoints.push(winPoint)\r\n                        }\r\n                    },\r\n                )\r\n            }\r\n        }\r\n        renderToBuffer()\r\n        return 0\r\n    }\r\n\r\n    // buffer canvas\r\n    const canvas2 = document.createElement('canvas')\r\n    canvas2.width = screen.canvas.width\r\n    canvas2.height = screen.canvas.height\r\n    const context2 = canvas2.getContext('2d')\r\n\r\n    function clearBuffer() {\r\n        context2.clearRect(0, 0, canvas2.width, canvas2.height)\r\n    }\r\n\r\n    function renderToBuffer() {\r\n        const ctx = context2\r\n        renderPoints(ctx, self.newPoints)\r\n        self.newPoints = []\r\n    }\r\n\r\n    self.render = function () {\r\n        if (screen.noBuffers) {\r\n            self.noBufferRender()\r\n        } else {\r\n            self.bufferRender()\r\n        }\r\n    }\r\n\r\n    self.bufferRender = function () {\r\n        const { ctx } = screen\r\n        ctx.drawImage(canvas2, 0, 0)\r\n    }\r\n\r\n    // use this if we want to export to an SVG\r\n    self.noBufferRender = function () {\r\n        const { ctx } = screen\r\n        renderPoints(ctx, self.points)\r\n    }\r\n\r\n    function renderPoints(ctx, points) {\r\n        ctx.fillStyle = 'grey'\r\n        const n = points.length\r\n        for (let i = 0; i < n; i++) {\r\n            const p = points[i]\r\n            // dot\r\n            ctx.beginPath()\r\n            ctx.arc(p.x, p.y, 3, 0, 2 * Math.PI)\r\n            ctx.fill()\r\n        }\r\n    }\r\n}\r\n","\r\n// https://codepen.io/darsain/pen/XpgMGp\r\n\r\nconst r = Math.round\r\n\r\nexport function toRGBA(d) {\r\n    const l = d.length\r\n    const rgba = Array(4).fill()\r\n    if (d.slice(0, 3).toLowerCase() === 'rgb') {\r\n        d = d.replace(' ', '').split(',')\r\n        rgba[0] = parseInt(d[0].slice(d[3].toLowerCase() === 'a' ? 5 : 4), 10)\r\n        rgba[1] = parseInt(d[1], 10)\r\n        rgba[2] = parseInt(d[2], 10)\r\n        rgba[3] = d[3] ? parseFloat(d[3]) : -1\r\n    } else {\r\n        if (l < 6) d = parseInt(String(d[1]) + d[1] + d[2] + d[2] + d[3] + d[3] + (l > 4 ? String(d[4]) + d[4] : ''), 16)\r\n        else d = parseInt(d.slice(1), 16)\r\n        rgba[0] = (d >> 16) & 255\r\n        rgba[1] = (d >> 8) & 255\r\n        rgba[2] = d & 255\r\n        rgba[3] = l === 9 || l === 5 ? r((((d >> 24) & 255) / 255) * 10000) / 10000 : -1\r\n    }\r\n    return rgba\r\n}\r\n\r\nexport function blend(from, to, p = 0.5) {\r\n    from = from.trim()\r\n    to = to.trim()\r\n    const b = p < 0\r\n    p = b ? p * -1 : p\r\n    const f = toRGBA(from)\r\n    const t = toRGBA(to)\r\n\r\n    if (to[0] === 'r') {\r\n        return `rgb${to[3] === 'a' ? 'a(' : '('\r\n        }${r(((t[0] - f[0]) * p) + f[0])},${\r\n            r(((t[1] - f[1]) * p) + f[1])},${\r\n            r(((t[2] - f[2]) * p) + f[2])\r\n        }${f[3] < 0 && t[3] < 0 ? '' : `,${\r\n            f[3] > -1 && t[3] > -1\r\n                ? r((((t[3] - f[3]) * p) + f[3]) * 10000) / 10000\r\n                : t[3] < 0 ? f[3] : t[3]}`})`\r\n    }\r\n\r\n    return `#${(0x100000000 + ((\r\n        f[3] > -1 && t[3] > -1\r\n            ? r((((t[3] - f[3]) * p) + f[3]) * 255)\r\n            : t[3] > -1 ? r(t[3] * 255) : f[3] > -1 ? r(f[3] * 255) : 255\r\n    ) * 0x1000000)\r\n    + (r(((t[0] - f[0]) * p) + f[0]) * 0x10000)\r\n        + (r(((t[1] - f[1]) * p) + f[1]) * 0x100)\r\n        + r(((t[2] - f[2]) * p) + f[2])\r\n    ).toString(16).slice(f[3] > -1 || t[3] > -1 ? 1 : 3)}`\r\n}\r\n","/** @module */\r\n\r\n// import { normal } from 'color-blend'\r\n\r\nimport { blend, toRGBA } from '../../lib/colorBlendScript.js'\r\n\r\n/**\r\n * Blend colors in given proportions.\r\n * @param {Number[]} f - proportions of colors, as fraction of 1.\r\n * @param {String[]} colors -\r\n * @returns {String} - Color\r\n */\r\nexport default function colorBlend(f, colors) { // f fractions\r\n    const fraction01 = frac(f[1], f[0])\r\n    const color01 = blend(colors[0], colors[1], fraction01)\r\n    const fraction012 = frac(f[2], f[1] + f[0])\r\n    const color012 = blend(color01, colors[2], fraction012)\r\n    return color012\r\n}\r\n\r\nfunction frac(thing, other) {\r\n    return thing / (thing + other)\r\n}\r\n\r\nexport { toRGBA }\r\n","/** @module */\r\n\r\nimport colorBlend, { toRGBA } from './colorBlend.js'\r\n\r\n/**\r\n * An election with many districts.\r\n * Voters are from many groups.\r\n * Voter groups are centered around a point.\r\n * The point is moved by simplex noise to create distinct districts.\r\n * All the voter groups share the same voter basis.\r\n * @param {Menu} menu\r\n * @param {Election} election\r\n * @constructor\r\n */\r\nexport default function GeoElection(screen, menu, election) {\r\n    const self = this\r\n\r\n    self.updateVotes = (geoVoters, candidates) => {\r\n        self.updateStatewideTallies(geoVoters, candidates)\r\n        self.updateNoiseImage(geoVoters, candidates)\r\n        self.runDistrictElections(geoVoters, candidates)\r\n        self.updateWinColors(candidates)\r\n        self.updateColorBlendGeoMap(candidates)\r\n        self.updateWins(candidates)\r\n    }\r\n\r\n    /** Show tallies over all the districts\r\n     * Find statewide support for candidates (parties).\r\n     */\r\n    self.updateStatewideTallies = function (geoVoters, candidates) {\r\n        const canList = candidates.getCandidates()\r\n        const { allVoterGroups } = geoVoters\r\n        const electionResults = election.runElection(allVoterGroups, canList)\r\n        const { tallyFractions } = electionResults.votes\r\n        candidates.setCandidateFractions(tallyFractions)\r\n    }\r\n\r\n    /** Visualize voter demographics according to votes for candidates within a voterGroup.\r\n     * Hold mini-elections within a voterGroup.\r\n     */\r\n    self.updateNoiseImage = function (geoVoters, candidates) {\r\n        // visualize simplex noise\r\n        // self.geoVoters.noiseImage.load(sn)\r\n\r\n        // visualize noise with election data\r\n        const canList = candidates.getCandidates()\r\n        const { voterGroupsByTract } = geoVoters\r\n\r\n        const resultsByTract = voterGroupsByTract.map(\r\n            (row) => row.map(\r\n                (voterGroups) => election.runElection(voterGroups, canList),\r\n            ),\r\n        )\r\n\r\n        // get color\r\n        const colorSet = canList.map((can) => can.square.color)\r\n        const allColors = resultsByTract.map(\r\n            (row) => row.map(\r\n                (results) => {\r\n                    const { tallyFractions } = results.votes\r\n                    const color = toRGBA(colorBlend(tallyFractions, colorSet))\r\n                    return color\r\n                },\r\n            ),\r\n        )\r\n\r\n        geoVoters.noiseImage.loadColors(allColors)\r\n    }\r\n\r\n    /** Run separate elections in each district. */\r\n    self.runDistrictElections = (geoVoters, candidates) => {\r\n        // Loop through districts.\r\n        // Find who won.\r\n\r\n        const canList = candidates.getCandidates()\r\n        const { voterGroupsByDistrict } = geoVoters\r\n\r\n        self.resultsByDistrict = voterGroupsByDistrict.map(\r\n            (voterGroups) => election.runElection(voterGroups, canList),\r\n        )\r\n    }\r\n    self.updateWinColors = (candidates) => {\r\n        // calculate color for win map\r\n        if (election.method.checkElectionType() === 'singleWinner') {\r\n            self.winnerColors = self.resultsByDistrict.map((results) => results.winner.square.color)\r\n        } else {\r\n            const canList = candidates.getCandidates()\r\n            const colorSet = canList.map((can) => can.square.color)\r\n            self.winnerColors = self.resultsByDistrict.map(\r\n                (results) => {\r\n                    const { allocation } = results\r\n                    const sum = allocation.reduce((p, c) => p + c)\r\n                    const fractions = allocation.map((x) => x / sum)\r\n                    const color = colorBlend(fractions, colorSet)\r\n                    return color\r\n                },\r\n            )\r\n        }\r\n    }\r\n\r\n    // Show wins across all districts for each candidate\r\n    self.updateWins = function (candidates) {\r\n        // make a histogram\r\n        const canList = candidates.getCandidates()\r\n        const numCandidates = canList.length\r\n        const histogram = Array(numCandidates).fill(0)\r\n        if (election.method.checkElectionType() === 'singleWinner') {\r\n            const iWinners = self.resultsByDistrict.map((results) => results.iWinner)\r\n            iWinners.forEach((iWinner) => {\r\n                histogram[iWinner] += 1\r\n            })\r\n        } else {\r\n            self.resultsByDistrict.forEach(\r\n                (results) => {\r\n                    const { allocation } = results\r\n                    for (let i = 0; i < numCandidates; i++) {\r\n                        histogram[i] += allocation[i]\r\n                    }\r\n                },\r\n            )\r\n        }\r\n        candidates.setCandidateWins(histogram)\r\n    }\r\n\r\n    /** Update color for each district, based on votes for each candidate.\r\n     * Blend candidate colors in proportion to their votes.\r\n     */\r\n    self.updateColorBlendGeoMap = (candidates) => {\r\n        self.blendColors = self.resultsByDistrict.map((results) => {\r\n            const { tallyFractions } = results.votes\r\n            const canList = candidates.getCandidates()\r\n            const colorSet = canList.map((can) => can.square.color)\r\n            const color = colorBlend(tallyFractions, colorSet)\r\n            return color\r\n        })\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Layout keeps an internal ordered list of div names.\r\n * It creates a parent div to fill with these divs.\r\n * New divs are added according to the order of the names.\r\n * If the new div isn't in the list, then it is added at the end of the parent div.\r\n * @param {String[]} - Names in an ordered list for the layout.\r\n * @constructor\r\n */\r\nexport default function Layout(order) {\r\n    const self = this\r\n\r\n    const divsByName = {}\r\n    const extraDivs = []\r\n\r\n    /**\r\n     * Adds a new div with a name that should be in Layout's internal ordered list.\r\n     * @param {String} name\r\n     * @param {HTMLElement} div\r\n     */\r\n    self.newElement = (name, div) => {\r\n        if (order.includes(name)) {\r\n            divsByName[name] = div\r\n        } else {\r\n            extraDivs.push(div)\r\n        }\r\n    }\r\n\r\n    /**\r\n     * When we're done adding new divs, we return a parent div.\r\n     * @returns The parent div containing all other divs in order.\r\n     */\r\n    self.makeComponent = () => {\r\n        const parent = document.createElement('div')\r\n        order.forEach((name) => {\r\n            const div = divsByName[name]\r\n            if (div !== undefined) {\r\n                parent.appendChild(div)\r\n            }\r\n        })\r\n        extraDivs.forEach((div) => {\r\n            parent.appendChild(div)\r\n        })\r\n        return parent\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * A simple election.\r\n * Voters are in shaped distributions.\r\n * @param {Screen} screen\r\n * @param {Menu} menu\r\n * @param {Election} election\r\n * @constructor\r\n */\r\nexport default function OneElection(screen, menu, election) {\r\n    const self = this\r\n\r\n    self.updateTallies = function (oneVoters, candidates) {\r\n        // only update the tallies for each candidate so they can be shown\r\n\r\n        // Voters cast votes for candidates.\r\n        // There is also a separate graphical representation in VoronoiGroup.js\r\n\r\n        const votes = election.castVotes(oneVoters, candidates)\r\n        candidates.setCandidateFractions(votes.tallyFractions)\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Both the command pattern and the memento pattern are used here.\r\n * Commands are performed to make changes to the mementos.\r\n *\r\n * Memento Pattern:\r\n *  Caretaker: this class. It keeps config as a list of mementos.\r\n *  Originator: menuItem.\r\n *  Mementos: Config is a list of mementos. It's not a strict pattern.\r\n *\r\n * Command Pattern:\r\n *  Client: this class. It asks an invoker to execute commands.\r\n *  Command: a name-value pair. Actions are listed by name. Commands are stored in history.\r\n *  Invoker: actions, execute(). The invoker keeps a list of actions to execute.\r\n *  Receiver: menuItem. The receiver calls commander.addAction(...) to add to the invoker's actions.\r\n *\r\n * References:\r\n * * [First google result for \"invoker command pattern\". It has a classic example of a stock broker.](https://home.csulb.edu/~pnguyen/cecs277/lecnotes/Command%20Pattern%201.pdf)\r\n * * [Memento Pattern on Wikipedia](https://en.wikipedia.org/wiki/Memento_pattern)\r\n * * [Memento Tutorial from refractoring.guru](https://refactoring.guru/design-patterns/memento)\r\n * @constructor\r\n */\r\nexport default function Commander(comMessenger) {\r\n    const self = this\r\n\r\n    // Keep commands and undos in history\r\n    const history = []\r\n    let head = -1 // Head is where we are in history, where our head is at.\r\n\r\n    self.clearHistory = () => {\r\n        history.splice(0, history.length)\r\n        head = -1\r\n    }\r\n\r\n    // The list of all mementos\r\n    const config = {}\r\n\r\n    // A list of actions we can execute (for invoker)\r\n    const actions = []\r\n\r\n    const firstActions = []\r\n\r\n    comMessenger.addCommander(self)\r\n\r\n    /**\r\n     * A menu item or other object can add an action that it wants to execute with a value.\r\n     * The action can be performed by calling commander.do(command),\r\n     * where command has a name and value.\r\n     * @param {String} name - The name of the action.\r\n     * @param {Function} action - The action function itself, which is called with a value.\r\n     */\r\n    self.addAction = (name, action, currentValue, props) => {\r\n        if (props !== undefined && props.isFirstAction) {\r\n            firstActions[name] = true\r\n        }\r\n        actions[name] = action\r\n        config[name] = currentValue\r\n    }\r\n\r\n    // make a client with a command and a way to do the command\r\n    self.addClient = (args) => {\r\n        const {\r\n            name, action, currentValue, props,\r\n        } = args\r\n\r\n        self.addAction(name, action, currentValue, props)\r\n        const command = (value) => ({ name, value, props })\r\n        const go = (value) => self.do(command(value))\r\n        const client = { command, go }\r\n        return client\r\n    }\r\n\r\n    /** Say we want to change a value for the nth candidate.\r\n     * And say the nth candidate doesn't exist.\r\n     * Then we have to use an action which acts on the list of candidates,\r\n     * rather than the candidate itself.\r\n     */\r\n    self.addActionList = (name, action) => {\r\n        actions[name] = action\r\n        config[name] = []\r\n    }\r\n\r\n    /**\r\n     * Make a client with a command and a way to do the command.\r\n     * This type of client deals with lists.\r\n     * @param {Object} args\r\n     * @returns {Object} - methods command(id,value) and go(id,value)\r\n     */\r\n    self.addClientList = (args) => {\r\n        const {\r\n            name, action, props,\r\n        } = args\r\n\r\n        self.addActionList(name, action)\r\n        const command = (id, value, currentValue) => ({\r\n            name, id, value, props, currentValue,\r\n        })\r\n        const go = (id, value, currentValue) => self.do(command(id, value, currentValue))\r\n        const setCurrentValue = (id, currentValue) => {\r\n            config[name][id] = currentValue\r\n        }\r\n        const getCurrentValue = (id) => config[name][id]\r\n        const client = {\r\n            command, go, setCurrentValue, getCurrentValue,\r\n        }\r\n        return client\r\n    }\r\n\r\n    /**\r\n     * Actually execute the action. Also, store the memento.\r\n     * @param {Object} command -\r\n     */\r\n    const execute = (command) => {\r\n        const { name, id, value } = command\r\n        const action = actions[name]\r\n        if (action) {\r\n            // Actually change the config.\r\n            if (id !== undefined) {\r\n                action(id, value)\r\n                config[name][id] = value\r\n            } else {\r\n                action(value)\r\n                config[name] = value\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Put a commandMessenger in the middle,\r\n     * between the command being asked for and the command being done.\r\n     * @param {Object} command - a command to do. See passDo.\r\n     */\r\n    self.do = (command) => {\r\n        comMessenger.broadcastDo(command, self)\r\n    }\r\n    self.doCommands = (commands) => {\r\n        comMessenger.broadcastDoCommands(commands, self)\r\n    }\r\n\r\n    /**\r\n     * We want to do a command. We need to keep track of what we do so we can undo it.\r\n     * @param {Object} command\r\n     * @param {String} command.name\r\n     * @param {(String|Number|Boolean)} command.value\r\n     * @param {Object} command.props - a catchall for easier coding\r\n     */\r\n    self.passDo = (command) => {\r\n        const { name, id, props } = command // command is {name, value, props}\r\n\r\n        // Store the current value so we can undo the command.\r\n        let currentValue\r\n        if (id === undefined) {\r\n            currentValue = config[name]\r\n        } else {\r\n            currentValue = command.currentValue\r\n        }\r\n\r\n        // Store how to undo the command.\r\n        const undoCommand = {\r\n            name, id, value: currentValue, props,\r\n        }\r\n\r\n        // remove future redos\r\n        // example: head:-1 means history will be cleared splice(0,length)\r\n        history.splice(head + 1, history.length - (head + 1))\r\n\r\n        // Add command to history\r\n        history.push([{ command, undoCommand }])\r\n        head += 1\r\n\r\n        // Actually preform the command.\r\n        execute(command)\r\n    }\r\n    /**\r\n     * Do a set of commands together, so they have one history item.\r\n     * @param {Object[]} commands - a list of command objects\r\n     */\r\n    self.passDoCommands = (commands) => {\r\n        const historyItem = []\r\n        commands.forEach((command) => {\r\n        // todo: make into one undo item\r\n            const { name, id, props } = command // command is {name, value, props}\r\n\r\n            // Store the current value so we can undo the command.\r\n            let currentValue\r\n            if (id === undefined) {\r\n                currentValue = config[name]\r\n            } else {\r\n                currentValue = command.currentValue\r\n            }\r\n\r\n            // Store how to undo the command.\r\n            const undoCommand = {\r\n                name, id, value: currentValue, props,\r\n            }\r\n\r\n            // Store in one history item\r\n            historyItem.push({ command, undoCommand })\r\n\r\n            // Actually preform the command.\r\n            execute(command)\r\n        })\r\n\r\n        // remove future redos\r\n        // example: head:-1 means history will be cleared splice(0,length)\r\n        history.splice(head + 1, history.length - (head + 1))\r\n\r\n        // Add command to history\r\n        history.push(historyItem)\r\n        head += 1\r\n    }\r\n\r\n    // control the duration of the setXY undos with a timeout. Here's a default timeout.\r\n    const xyDuration = 30\r\n    let xyTimer = setTimeout(() => null, xyDuration)\r\n\r\n    self.undo = () => {\r\n        if (head === -1) return // There is no history\r\n\r\n        const last = history[head]\r\n        last.forEach((pair) => { execute(pair.undoCommand) })\r\n\r\n        head -= 1 // Now we're in the past.\r\n\r\n        // If we're in a setXY chain, then continue with another undo after a pause.\r\n        const { undoCommand } = last[0]\r\n        if (undoCommand.props === undefined) return\r\n        if (undoCommand.props.isSetXY !== true) return\r\n        if (head === -1) return\r\n        const penUltimate = history[head][0]\r\n        if (penUltimate.undoCommand.name === undoCommand.name) {\r\n            // todo: make this only work for repeated setXY commands\r\n            // set timer and callback\r\n            clearTimeout(xyTimer)\r\n            xyTimer = setTimeout(self.undo, xyDuration)\r\n        }\r\n    }\r\n\r\n    self.redo = () => {\r\n        if (head === history.length - 1) return // Nothing to do\r\n\r\n        const next = history[head + 1]\r\n        next.forEach((pair) => execute(pair.command))\r\n\r\n        head += 1 // Now we're in the future.\r\n\r\n        // If we're in a setXY chain, then continue with another redo after a pause.\r\n        const { command } = next[0]\r\n        if (command.props === undefined) return\r\n        if (command.props.isSetXY !== true) return\r\n        if (head === history.length - 1) return\r\n        const nextnext = history[head + 1][0]\r\n        if (nextnext.command.name === command.name) {\r\n            // todo: make this only work for repeated setXY commands\r\n            // set timer and callback\r\n            clearTimeout(xyTimer)\r\n            xyTimer = setTimeout(self.redo, xyDuration)\r\n        }\r\n    }\r\n\r\n    self.loadConfig = (newConfig) => {\r\n        comMessenger.broadcastLoadConfig(newConfig, self)\r\n    }\r\n\r\n    self.passLoadConfig = (newConfig) => {\r\n        // newConfig is a list of commands to execute.\r\n        self.loadConfigPriority(newConfig, 'high')\r\n        self.loadConfigPriority(newConfig, 'low')\r\n    }\r\n\r\n    self.loadConfigPriority = (newConfig, priority) => {\r\n        // newConfig is a list of commands to execute.\r\n        const names = Object.keys(newConfig)\r\n        names.forEach((name) => {\r\n            // Decide whether to process commands, based on their priority.\r\n            const isHigh = firstActions[name] !== undefined\r\n            if (priority === 'low' && isHigh) {\r\n                return\r\n            }\r\n            if (priority === 'high' && !isHigh) {\r\n                return\r\n            }\r\n\r\n            // if we have a list, then create commands for each item in the list\r\n            const valueArray = newConfig[name]\r\n            if (valueArray instanceof Array) {\r\n                valueArray.forEach((value, id) => {\r\n                    // const subValue = newConfig[name][id]\r\n                    const command = { name, id, value }\r\n                    execute(command)\r\n                })\r\n            } else {\r\n                const value = valueArray\r\n                const command = { name, value }\r\n                execute(command)\r\n            }\r\n        })\r\n    }\r\n\r\n    self.loadCommands = (commands) => {\r\n        comMessenger.broadCastLoadCommands(commands, self)\r\n    }\r\n    self.passLoadCommands = (commands) => {\r\n        // execute commands without adding to history\r\n        commands.forEach((command) => {\r\n            execute(command)\r\n        })\r\n    }\r\n\r\n    self.getConfig = () => structuredClone(config)\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Add buttons for saving the configuration to a link.\r\n * @param {Layout} layout\r\n * @param {Commander} commander\r\n */\r\nexport default function addSaveConfigToLink(layout, commander, sandboxURL) {\r\n    const button = document.createElement('button')\r\n    button.className = 'button2'\r\n    button.innerText = 'Save Link'\r\n\r\n    const button2 = document.createElement('button')\r\n    button2.className = 'button2'\r\n    button2.innerText = 'Copy Link to Clipboard'\r\n\r\n    const text = document.createElement('textarea')\r\n\r\n    button.onclick = () => {\r\n        const link = getLink()\r\n        text.value = link\r\n    }\r\n    button2.onclick = () => {\r\n        const link = getLink()\r\n        navigator.clipboard.writeText(link)\r\n    }\r\n    function getLink() {\r\n        const config = commander.getConfig()\r\n        const encodedConfig = encodeURIComponent(JSON.stringify(config))\r\n        const currentUrlFolder = getFolder()\r\n\r\n        const link = `${currentUrlFolder}/${sandboxURL}?a=${encodedConfig}`\r\n        return link\r\n    }\r\n    function getFolder() {\r\n        const sp = document.location.href.split('/')\r\n        const sl = sp.slice(0, sp.length - 1)\r\n        const folder = sl.join('/')\r\n        return folder\r\n    }\r\n\r\n    const clearDiv = document.createElement('div')\r\n\r\n    const div = document.createElement('div')\r\n    div.appendChild(button)\r\n    div.appendChild(button2)\r\n    div.appendChild(clearDiv)\r\n    div.appendChild(text)\r\n\r\n    layout.newElement('saveConfigToLink', div)\r\n}\r\n","/** @module */\r\n\r\nimport Changes from './Changes.js'\r\nimport Screen from './Screen.js'\r\nimport addSVGOutput from './addSVGOutput.js'\r\nimport Menu from '../menu/Menu.js'\r\nimport Election from '../election/Election.js'\r\nimport Sim from '../sim/Sim.js'\r\nimport SampleElections from '../election/SampleElections.js'\r\nimport GeoElection from '../election/GeoElection.js'\r\nimport Layout from './Layout.js'\r\nimport OneElection from '../election/OneElection.js'\r\nimport Commander from './Commander.js'\r\nimport addUndo from './addUndo.js'\r\nimport addSaveConfigToText from './addSaveConfigToText.js'\r\nimport addLoadConfigText from './loadConfigText.js'\r\nimport addSaveConfigToLink from './addSaveConfigToLink.js'\r\n\r\n/**\r\n * Set up a user interface to run a simulation.\r\n * @param {Object} config - An object containing commands. A command is a {name,value} pair.\r\n */\r\nexport default function sandbox(config, comMessenger, sandboxURL) {\r\n    // manage dependent calculations because we only want to do calculations if we need to\r\n    const changes = new Changes()\r\n\r\n    const layout = new Layout([\r\n        'menu',\r\n        'simControlsLabel',\r\n        'addVoter',\r\n        'addCandidate',\r\n        'addCandidateDistribution',\r\n        'undo',\r\n        'redo',\r\n        'clearDiv',\r\n        'screen',\r\n        'foreground',\r\n        'geoMaps',\r\n        'saveConfigToLink',\r\n        'saveConfigToText',\r\n        'loadConfigText',\r\n        'svgUIDiv',\r\n    ])\r\n\r\n    const commander = new Commander(comMessenger)\r\n\r\n    const menu = new Menu(changes, layout, commander)\r\n\r\n    addUndo(layout, commander)\r\n\r\n    addSaveConfigToLink(layout, commander, sandboxURL)\r\n\r\n    addSaveConfigToText(layout, commander)\r\n\r\n    addLoadConfigText(layout, commander)\r\n\r\n    const screen = new Screen(300, 300, layout)\r\n\r\n    addSVGOutput(screen, draw, layout)\r\n\r\n    const election = new Election(menu)\r\n\r\n    const oneElection = new OneElection(screen, menu, election)\r\n\r\n    const sampleElections = new SampleElections(screen, menu, election)\r\n\r\n    const geoElection = new GeoElection(screen, menu, election)\r\n\r\n    // eslint-disable-next-line max-len\r\n    const sim = new Sim(screen, menu, changes, oneElection, sampleElections, geoElection, commander, layout)\r\n\r\n    commander.loadConfig(config)\r\n    commander.clearHistory()\r\n\r\n    const div = layout.makeComponent()\r\n\r\n    window.requestAnimationFrame(gameLoop)\r\n\r\n    return div\r\n\r\n    function gameLoop() {\r\n        update()\r\n        drawForeground()\r\n        window.requestAnimationFrame(gameLoop)\r\n    }\r\n\r\n    function update() {\r\n        sim.update()\r\n    }\r\n\r\n    function drawForeground() {\r\n        screen.clearForeground()\r\n        sim.renderForeground()\r\n    }\r\n\r\n    function draw() {\r\n        screen.clear()\r\n        sim.render()\r\n        sim.renderForeground()\r\n    }\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Add buttons to layout for undo and redo, and connect them to commander for functionality.\r\n * @param {Layout} layout\r\n * @param {Commander} commander\r\n */\r\nexport default function addUndo(layout, commander) {\r\n    const undoButton = document.createElement('button')\r\n    const redoButton = document.createElement('button')\r\n\r\n    undoButton.className = 'button2'\r\n    redoButton.className = 'button2'\r\n\r\n    undoButton.innerText = 'Undo'\r\n    redoButton.innerText = 'Redo'\r\n\r\n    undoButton.onclick = commander.undo\r\n    redoButton.onclick = commander.redo\r\n\r\n    layout.newElement('undo', undoButton)\r\n    layout.newElement('redo', redoButton)\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Add buttons for saving the configuration to a textbox.\r\n * @param {Layout} layout\r\n * @param {Commander} commander\r\n */\r\nexport default function addSaveConfigToText(layout, commander) {\r\n    const button = document.createElement('button')\r\n\r\n    button.className = 'button2'\r\n\r\n    button.innerText = 'Save Config To Text'\r\n\r\n    const text = document.createElement('textarea')\r\n\r\n    button.onclick = () => {\r\n        const config = commander.getConfig()\r\n        text.value = JSON.stringify(config)\r\n    }\r\n\r\n    const clearDiv = document.createElement('div')\r\n\r\n    const div = document.createElement('div')\r\n    div.appendChild(button)\r\n    div.appendChild(clearDiv)\r\n    div.appendChild(text)\r\n\r\n    layout.newElement('saveConfigToText', div)\r\n}\r\n","/** @module */\r\n\r\n/**\r\n * Add buttons to layout for undo and redo, and connect them to commander for functionality.\r\n * @param {Layout} layout\r\n * @param {Commander} commander\r\n */\r\nexport default function addLoadConfigText(layout, commander) {\r\n    const button = document.createElement('button')\r\n\r\n    button.className = 'button2'\r\n\r\n    button.innerText = 'Load Config Text'\r\n\r\n    const text = document.createElement('textarea')\r\n\r\n    button.onclick = () => {\r\n        if (text.value === '') return\r\n        const config = JSON.parse(text.value)\r\n        commander.loadConfig(config)\r\n    }\r\n\r\n    const clearDiv = document.createElement('div')\r\n\r\n    const div = document.createElement('div')\r\n    div.appendChild(button)\r\n    div.appendChild(clearDiv)\r\n    div.appendChild(text)\r\n\r\n    layout.newElement('loadConfigText', div)\r\n}\r\n","/** @module */\r\n\r\nimport checkURL from './checkURL.js'\r\nimport ComMessenger from './ComMessenger.js'\r\nimport sandbox from './sandbox.js'\r\n\r\n/** Find all the divs of class \"sandbox\".\r\n * Add the sandbox as a neighbor under the same parent. */\r\nconst targets = Array.from(document.getElementsByClassName('sandbox'))\r\ntargets.forEach((target) => {\r\n    const hasConfig = target.dataset.config !== undefined\r\n    const targetConfig = (hasConfig) ? JSON.parse(target.dataset.config) : {}\r\n    const cu = checkURL()\r\n    const config = (cu.yes) ? cu.config : targetConfig\r\n\r\n    const hasSandboxURL = target.dataset.sandboxurl !== undefined\r\n    const sandboxURL = hasSandboxURL ? target.dataset.sandboxurl : ''\r\n\r\n    const comMessenger = new ComMessenger()\r\n    const div = sandbox(config, comMessenger, sandboxURL)\r\n    const parent = target.parentNode\r\n    parent.appendChild(div)\r\n})\r\n","/** @module */\r\n\r\n/**\r\n * Check if the URL is giving a configuration.\r\n * @returns {Object} - Property yes means we have a config to use from the URL.\r\n */\r\nexport default function checkURL() {\r\n    const urlParams = new URLSearchParams(window.location.search)\r\n\r\n    const yes = urlParams.has('a')\r\n\r\n    const config = yes ? JSON.parse(urlParams.get('a')) : {}\r\n\r\n    return { yes, config }\r\n}\r\n"],"names":["protect","this","linked","commanders","setLinked","value","addCommander","commander","push","broadcastDo","command","originCommander","forEach","com","passDo","broadcastDoCommands","commands","passDoCommands","broadcastLoadConfig","newConfig","passLoadConfig","broadCastLoadCommands","passLoadCommands","self","changes","add","changeList","c","check","n","includes","checkNone","length","clear","splice","handlers","start","move","end","touchmove","touchstart","touchend","set","eHandlers","Object","assign","w","h","layout","width","height","canvas","document","createElement","setAttribute","ctx","getContext","foreground","fctx","geoMaps","gctx","clearDiv","newElement","noBuffers","pixelRatio","context","backingStore","backingStorePixelRatio","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","window","devicePixelRatio","$705ca8a2f34171f8$var$getPixelRatio","style","h3","Math","round","scale","clearRect","clearForeground","setCtx","setFCtx","setGCtx","setNoBuffers","showGeoMaps","display","hideGeoMaps","eventHandlers","$506b705d01454b72$export$2e2bcd8739ae039","onmousedown","e","onmousemove","onmouseup","addEventListener","current","$1241477ff5cc3c1e$var$STYLES","$1241477ff5cc3c1e$export$3b0a2f84a08ecd6c","$1241477ff5cc3c1e$var$CanvasGradient","$1241477ff5cc3c1e$var$CanvasPattern","$1241477ff5cc3c1e$var$namedEntities","$1241477ff5cc3c1e$var$format","str","args","i","keys","replace","RegExp","$1241477ff5cc3c1e$var$randomString","holder","randomstring","Error","chars","floor","random","$1241477ff5cc3c1e$var$getDominantBaseline","textBaseline","mapping","alphabetic","hanging","top","bottom","middle","items","radix","entity","base10","lookup","split","parseInt","$1241477ff5cc3c1e$var$createNamedToNumberedLookup","strokeStyle","svgAttr","svg","apply","fillStyle","lineCap","lineJoin","miterLimit","lineWidth","shadowColor","shadowOffsetX","shadowOffsetY","textAlign","lineDash","gradientNode","__root","__ctx","prototype","addColorStop","offset","color","matches","stop","__createElement","indexOf","exec","r","g","b","appendChild","pattern","o","defaultOptions","enableMirroring","arguments","options","undefined","__document","__canvas","__setDefaultStyles","__stack","__getStyleState","__groupStack","createElementNS","setAttributeNS","__ids","__defs","__currentElement","elementName","properties","resetFill","key","element","__applyStyleState","styleState","__applyStyleToCurrentElement","type","__currentElementsToStyle","currentStyleGroup","children","node","id","childNodes","getAttribute","currentElement","attr","opacity","globalAlpha","__closestGroupOrSvg","nodeName","parentNode","getSerializedSvg","fixNamedEntities","regexp","serialized","XMLSerializer","serializeToString","test","getSvg","save","group","parent","restore","pop","state","__addTransform","t","__applyCurrentDefaultPath","transform","x","y","rotate","angle","degrees","PI","cx","translate","a","d","f","beginPath","path","__currentDefaultPath","__currentPosition","console","error","__addPathCommand","moveTo","closePath","lineTo","bezierCurveTo","cp1x","cp1y","cp2x","cp2y","quadraticCurveTo","cpx","cpy","$1241477ff5cc3c1e$var$normalize","vector","len","sqrt","screen","draw","svgUIDiv","button","className","innerText","onclick","old","oldF","svgCtx","svgHideButton","hidden","svgDiv","innerHTML","downloadLink","url","encodeURIComponent","href","outputSVG","oldG","svgGCtx","gSvg","gSvgDiv","gDownloadLink","gUrl","outputGSVG","download","margin","buttonConfig","onChoose","config","name","nameIsHTML","dom","fixMargin","max","marginRight","realname","onClick","turnOff","isOn","turnOn","config1","data","makeData","buttonConfigs","doMakeData","labelName","label","labelIsHTML","isCheckbox","isCheckboxBool","justButton","buttonHidden","buttonDOMByValue","init","buttons","buttonsByName","labelDOM","conf","$d019958dda7398e8$export$2e2bcd8739ae039","onToggle","i1","selected","updateNames","data2","redraw","configureHidden","buttonName","entries","buttonData","setTimeout","highlight","propName","propValue","ibu","bu","ibu1","theButton","filter","object","prop","setProp","change","list","do","action","select","addAction","configure","choose","$4088c71a26df2b7b$export$2e2bcd8739ae039","divMenu","addMenuItem","choice","menuItem","$ced2438c3869b330$export$2e2bcd8739ae039","cans","lines","Array","k","c1","c2","$7b2626bce2a28c1d$var$equidistantLine","$7b2626bce2a28c1d$var$findLines","sumArea","voterGroup","area","lineSet","$7b2626bce2a28c1d$var$sumCircle","dx","dy","circle","sum","x1","y1","diff2","half","high","low","line","ay","A","ax","Infinity","y2","min","arcTo","x2","radius","x0","y0","unit_vec_p1_p0","unit_vec_p1_p2","cos","theta","acos","abs","unit_vec_p1_origin","len_p1_origin","sin","x3","y3","unit_vec_origin_start_tangent","unit_vec_origin_end_tangent","getAngle","startAngle","endAngle","arc","stroke","fill","rect","fillRect","strokeRect","__clearCanvas","rootGroup","removeChild","createLinearGradient","grad","gradientUnits","createRadialGradient","r0","r1","cy","fx","fy","__parseFont","fontPart","font","size","family","weight","decoration","__fontHref","__wrapTextLink","__applyText","text","textElement","left","right","center","createTextNode","fillText","strokeText","measureText","pluralityBallot","candidates","voterGroups","summer","$7b2626bce2a28c1d$export$2e2bcd8739ae039","tally","map","index","total","reduce","p","votes","tallyFractions","nk","huntingtonHill","electionMethodOptions","seats","threshold","populations","nparties","minPopulation","sort","divisorPattern","_","lastSignpost","flat","menu","run","electionResults","checkElectionType","methodResults","$ee120a7268fdcb91$export$2e2bcd8739ae039","electionMethod","allocation","iWinner","electionMethodList","electionMethodListByFunctionName","setElectionMethod","method","$b860c4c21bb814d1$export$2e2bcd8739ae039","runElection","canList","$a0cd9654243cb66c$export$2e2bcd8739ae039","castVotes","voters","getVoterGroups","getCandidates","$e5cd87510cb0735f$var$splitter","$e5cd87510cb0735f$var$sum","elen","flen","Q","Qnew","hh","bvirt","enow","fnow","eindex","findex","hindex","$e5cd87510cb0735f$var$vec","Float64Array","$e5cd87510cb0735f$var$B","$e5cd87510cb0735f$var$C1","$e5cd87510cb0735f$var$C2","$e5cd87510cb0735f$var$D","$e5cd87510cb0735f$var$u","$e5cd87510cb0735f$var$orient2d","bx","by","detleft","detright","det","detsum","acxtail","acytail","bcxtail","bcytail","ahi","alo","bhi","blo","_i","_j","_0","s1","s0","t1","t0","u3","acx","bcx","acy","bcy","$e5cd87510cb0735f$var$estimate","errbound","C1len","C2len","Dlen","$e5cd87510cb0735f$var$orient2dadapt","$e5cd87510cb0735f$var$EPSILON","pow","$e5cd87510cb0735f$var$EDGE_STACK","Uint32Array","$e5cd87510cb0735f$var$Delaunator","points","getX","$e5cd87510cb0735f$var$defaultGetX","getY","$e5cd87510cb0735f$var$defaultGetY","coords","maxTriangles","_triangles","_halfedges","Int32Array","_hashSize","ceil","_hullPrev","_hullNext","_hullTri","_hullHash","_ids","_dists","update","hullPrev","hullNext","hullTri","hullHash","minX","minY","maxX","maxY","i0","i2","minDist","i3","$e5cd87510cb0735f$var$dist","i0x","i0y","i4","i1x","i1y","minRadius","i5","$e5cd87510cb0735f$var$circumradius","i2x","i2y","$e5cd87510cb0735f$var$quicksort","hull","j","i8","d0","subarray","triangles","halfedges","ex","ey","bl","cl","$e5cd87510cb0735f$var$circumcenter","_cx","_cy","i6","_hullStart","hullSize","_hashKey","trianglesLen","_addTriangle","xp","yp","q","_legalize","i7","$e5cd87510cb0735f$var$pseudoAngle","ar","a0","al","$e5cd87510cb0735f$var$inCircle","p0","pr","pl","p1","hbl","_link","br","b0","px","py","bp","cp","ids","dists","temp","tempDist","$e5cd87510cb0735f$var$swap","arr","tmp","$e5cd87510cb0735f$var$epsilon","$e5cd87510cb0735f$var$Path","_x0","_y0","_x1","_y1","slice","$e5cd87510cb0735f$export$20f0351992a349","constructor","delaunay","xmin","ymin","xmax","ymax","_circumcenters","vectors","_init","circumcenters","t2","t3","ab","sign","i9","buffer","inedges","ti","tj","xi","yi","xj","yj","_renderSegment","h0","h1","i10","v","_project","_clip","i11","cell","cellPolygon","polygon","$e5cd87510cb0735f$var$Polygon","renderCell","S","c0","_regioncode","_clipSegment","_step","ci","neighbors","cj","loop","ai","li","aj","lj","_cell","e0","V","_clipInfinite","_clipFinite","P","e1","sx0","sy0","sx1","sy1","_edgecode","_edge","contains","vx0","vy0","vxn","vyn","from","unshift","i12","vx","vy","$e5cd87510cb0735f$var$tau","$e5cd87510cb0735f$var$pow","$e5cd87510cb0735f$var$pointX","$e5cd87510cb0735f$var$pointY","$e5cd87510cb0735f$var$jitter","static","that","$e5cd87510cb0735f$export$42fc3f3b24093a06","array","$e5cd87510cb0735f$var$flatArray","$e5cd87510cb0735f$var$flatIterable","_delaunator","$e5cd87510cb0735f$var$collinear","collinear","bounds","hypot","i13","hullIndex","_hullIndex","n1","l","dt","dc","render","renderHull","trianglePolygon","renderTriangle","voronoi","clip","square","voterCircle","dragm","voter","newCircleHandle","renderForeground","$be74229b9e6046ab$export$2e2bcd8739ae039","call","voronoiGroup","$549d032d5ec3640b$export$2e2bcd8739ae039","candidate","newSquareHandle","simCans","newCandidate","simCan","getSimCandidates","exists","setCandidateFractions","fractions","can","fraction","setFraction","setCandidateWins","winsByCandidate","win","setWins","simVoters","newVoterGroup","getSimVoterGroups","enter","exit","oneElection","canButton","$da9ab18c28e2e6aa$export$2e2bcd8739ae039","oneVoters","$25d368a5b3ca04c7$export$2e2bcd8739ae039","simCandidateList","$1d8389cb79293516$export$2e2bcd8739ae039","addSimCandidate","$0e6c44fc7a433117$export$2e2bcd8739ae039","addSimVoterCircle","$7b30254c18364dc7$export$2e2bcd8739ae039","superEnter","show","hide","updateTallies","candidateDistributions","cdf","areasProportion","cd","sumAreasProportion","pmf","$cba26d0191240401$var$getCDF","samplePoint","iDist","random1","findIndex","$cba26d0191240401$var$randomDistribution","X","Y","R","$cba26d0191240401$var$randomInsideCircle","$cba26d0191240401$var$samplePoint1","simCanDns","simCanDn","getSimCandidateDistributions","canDn","getCandidateDistributions","startSampler","canDns","sampler","$cba26d0191240401$export$2e2bcd8739ae039","sampleElections","canDnButton","$4fa69ba06ea48962$export$2e2bcd8739ae039","addSimCandidateDistribution","$1c01ef12293a8615$export$2e2bcd8739ae039","sampleVoters","$cdeaa7e23b6b8c93$export$2e2bcd8739ae039","addSim","startSim","renderAt","newX","newY","renderCenterAt","$f556f940d09c9a1d$var$F2","$f556f940d09c9a1d$var$G2","$f556f940d09c9a1d$var$G3","$f556f940d09c9a1d$var$F4","$f556f940d09c9a1d$var$G4","$f556f940d09c9a1d$var$grad3","Float32Array","$f556f940d09c9a1d$var$grad4","randomOrSeed","$f556f940d09c9a1d$var$alea","$f556f940d09c9a1d$export$98cd52c6119fe283","perm","Uint8Array","permMod12","noise2D","n0","n2","s","j1","ii","jj","gi0","gi1","gi2","noise3D","z","n3","z0","k1","j2","k2","z1","z2","z3","kk","gi3","noise4D","n4","w0","rankx","ranky","rankz","rankw","l1","l2","j3","k3","l3","w1","w2","x4","y4","z4","w4","ll","w3","t4","gi4","nx","ny","sn","genNoise","noiseWidth","noiseHeight","xAmp","yAmp","simplexX","$f556f940d09c9a1d$export$7cef8d54b4fb09be","simplexY","$c913a56498196062$var$zeros","sumX","sumY","$c913a56498196062$var$range","ix","iy","noiseX","noiseY","meanX","meanY","$c913a56498196062$export$8cea35b328240292","offCtx","imageData","createImageData","putImageData","colors","renderWidth","renderHeight","imageSmoothingEnabled","drawImage","tolFraction","polygons","centroids","$b88c6a1775da370c$var$randomPoints","converged","tol","$b88c6a1775da370c$var$relax","$381ccf2757a64c6c$export$2e2bcd8739ae039","every","point","$b88c6a1775da370c$var$distance2","$11eb5e0ad93fc4ca$export$a2f18a0619b13ed4","textsize","lw","subject","closed","$e484bd409bc88322$var$polygonClosed","input","m","$e484bd409bc88322$var$lineOrient","$e484bd409bc88322$var$lineIntersect","bax","bay","dcx","dcy","$51d4c6038662af31$export$d02631cccf789723","$fbefcda9c3d500d6$var$makeSquare","make","nd","polygonAreas","$a9cc2d0bc18368cd$export$2e2bcd8739ae039","totalArea","census","districtMaker","gx","gy","iDistrict","overlap","$e484bd409bc88322$export$2e2bcd8739ae039","JSON","parse","stringify","reverse","$fbefcda9c3d500d6$export$2e2bcd8739ae039","renderVoronoi","geoMapWidth","geoMapHeight","renderVoronoiGeneral","renderAreaText","renderVoronoiColors","textFunction","scaleX","scaleY","geoElection","$ea87173ebe7c496f$export$2e2bcd8739ae039","geoNoise","$c913a56498196062$export$2e2bcd8739ae039","noiseImage","$554f2c796a0f1bd5$export$2e2bcd8739ae039","simVoterGroups","updateDistricts","updateVoters","updateFullSet","updateVotersByDistrict","updateVotersByTract","vb","rowNoise","cellNoise","xNoise","yNoise","gf","row","smallCircle","renderTractVotes","renderDistrictWins","renderDistrictVotes","renderVoterBasisSet","winnerColors","blendColors","geoVoters","$b9c43796ba5f2294$export$2e2bcd8739ae039","$ab669385e2ccd59d$export$2e2bcd8739ae039","updateVotes","$478baf4512f7400e$var$cachedSetTimeout","$478baf4512f7400e$var$cachedClearTimeout","$478baf4512f7400e$var$process","$478baf4512f7400e$exports","$478baf4512f7400e$var$defaultSetTimout","$478baf4512f7400e$var$defaultClearTimeout","$478baf4512f7400e$var$runTimeout","fun","clearTimeout","$478baf4512f7400e$var$currentQueue","$478baf4512f7400e$var$queue","$478baf4512f7400e$var$draining","$478baf4512f7400e$var$queueIndex","$478baf4512f7400e$var$cleanUpNextTick","concat","$478baf4512f7400e$var$drainQueue","timeout","marker","$478baf4512f7400e$var$runClearTimeout","$478baf4512f7400e$var$Item","$478baf4512f7400e$var$noop","nextTick","title","browser","env","argv","version","versions","on","addListener","once","off","removeListener","removeAllListeners","emit","prependListener","prependOnceListener","listeners","binding","cwd","chdir","dir","umask","$48c47b1a48ae3b30$export$cea96571ebbff9dd","None","amount","In","Out","InOut","Bounce","hrtime","time","performance","now","bind","Date","getTime","$48c47b1a48ae3b30$export$eb2fcfdbd7ba97d4","_tweens","_tweensAddedDuringUpdate","getAll","_this","tweenId","removeAll","tween","getId","remove","preserve","$48c47b1a48ae3b30$export$461939dd4422153","tweenIds","autoStart","$48c47b1a48ae3b30$export$b0cc4f9860136880","Linear","fn","Utils","pw","bn","Bernstein","CatmullRom","fc","Factorial","p2","p3","v0","v1","$48c47b1a48ae3b30$export$edde1bcb1b2b310e","nextId","_nextId","$48c47b1a48ae3b30$export$208a41d6b4e37b97","_object","_group","$48c47b1a48ae3b30$var$mainGroup","_isPaused","_pauseStart","_valuesStart","_valuesEnd","_valuesStartRepeat","_duration","_initialRepeat","_repeat","_yoyo","_isPlaying","_reversed","_delayTime","_startTime","_easingFunction","_interpolationFunction","_chainedTweens","_onStartCallbackFired","_id","_isChainStopped","_goToEnd","isPlaying","isPaused","to","duration","create","property","_swapEndStartRepeatValues","parseFloat","_setupProperties","startValue","startValueIsArray","isArray","propType","isInterpolationList","endValues","_handleRelativeValue","stopChainedTweens","_onStopCallback","pause","resume","numChainedTweens","delay","repeat","times","repeatDelay","_repeatDelayTime","yoyo","easing","easingFunction","interpolation","interpolationFunction","chain","tweens","onStart","callback","_onStartCallback","onUpdate","_onUpdateCallback","onRepeat","_onRepeatCallback","onComplete","_onCompleteCallback","onStop","endTime","elapsed","_updateProperties","startIsArray","endIsArray","charAt","endValue","trueR","pickUp","drop","voterRegistrar","doLoad","voterCommander","new","instantiate","setEClientList","setXYClientList","setRClientList","loadCommands","doCommands","setEAction","setE","cur","getCurrentValue","go","setXYAction","setXY","setRAction","newR","setR","$6096d1144969c10b$export$2e2bcd8739ae039","trueW","trueH","tweenSq","candidateRegistrar","candidateCommander","$16cfe2bdd82d8091$export$2e2bcd8739ae039","wins","toFixed","candidateDnRegistrar","candidateDnCommander","entities","nextID","num","get","drag","draggables","isSquare","isCircle","event","mouse","offsetX","offsetY","extra","isTouch","hitTest","preventDefault","stopPropagation","iDragging","isDragging","offX","offY","dataset","cursor","passTouch","target","getBoundingClientRect","clientWidth","clientHeight","changedTouches","clientX","clientY","pass","sim","addCandidateButton","addCandidatePressed","addCandidateDistributionButton","addCandidateDistributionPressed","prefix","addClientList","props","isSetXY","setNumberCandidatesClient","addClient","setNumberCandidatesAction","currentValue","isFirstAction","setNumberCandidates","setNumberCandidateDnsClient","setNumberCandidateDnsAction","setNumberCandidateDns","setNumberVotersClient","setNumberVotersAction","setNumberVoters","addVoterButton","addVoterPressed","$dec6a0caf79678fa$export$2e2bcd8739ae039","$82dd95abdcc618be$export$2e2bcd8739ae039","$8a15635393605ec7$export$2e2bcd8739ae039","$93bf61687e0acd03$export$2e2bcd8739ae039","dragms","one","$86d3719043a1dad3$export$2e2bcd8739ae039","sample","geoOne","sims","$fb1d46f883a07efa$export$2e2bcd8739ae039","$2a17d13d0aa17349$export$2e2bcd8739ae039","$813812d418de76d3$export$2e2bcd8739ae039","$7cad4102d954b952$export$2e2bcd8739ae039","$c4318fed8ddd96e4$export$2e2bcd8739ae039","$b926216e6e1f6793$export$2e2bcd8739ae039","addCandidate","addCandidateDistribution","$857f7aab49c32763$export$2e2bcd8739ae039","candidateDistribution","$6d216d0a2ec1877e$export$2e2bcd8739ae039","addVoterCircle","$6bff24280984d4c1$export$2e2bcd8739ae039","typeList","election","newPoints","context2","canvas2","sampleCandidates","results","winner","winPoint","jitterSize","numPoints","renderPoints","noBufferRender","bufferRender","$c77b28194f78f735$var$r","$c77b28194f78f735$export$8da5152a7cb9deca","rgba","toLowerCase","String","$c77b28194f78f735$export$fdb28526eb2966c3","trim","toString","fraction01","$ef353fcd6eb81187$var$frac","color01","fraction012","thing","other","updateStatewideTallies","updateNoiseImage","runDistrictElections","updateWinColors","updateColorBlendGeoMap","updateWins","allVoterGroups","voterGroupsByTract","resultsByTract","allColors","$ef353fcd6eb81187$export$2e2bcd8739ae039","colorSet","loadColors","voterGroupsByDistrict","resultsByDistrict","histogram","numCandidates","order","divsByName","extraDivs","div","makeComponent","comMessenger","history","head","clearHistory","actions","firstActions","execute","undoCommand","historyItem","xyTimer","undo","last","pair","redo","next","loadConfigPriority","priority","isHigh","valueArray","sandboxURL","button2","getLink","getConfig","encodedConfig","sp","location","sl","join","getFolder","link","navigator","clipboard","writeText","$5b0e6872a2899b94$export$2e2bcd8739ae039","$e0b757014bff90a3$export$2e2bcd8739ae039","$9218c03a72a2d8af$export$2e2bcd8739ae039","$391ef04f7f5158b8$export$2e2bcd8739ae039","undoButton","redoButton","$9675cf90b4357778$export$2e2bcd8739ae039","$abbeddaf5e12dd5d$export$2e2bcd8739ae039","$b4e5e8903004cfae$export$2e2bcd8739ae039","loadConfig","$750ce3a5446dbf8c$export$2e2bcd8739ae039","$705ca8a2f34171f8$export$2e2bcd8739ae039","$cc1b5be8d2aed4c2$export$2e2bcd8739ae039","$1090428139f5fe20$export$2e2bcd8739ae039","$40306ad643699081$export$2e2bcd8739ae039","$0ec65aed8fc29256$export$2e2bcd8739ae039","$c074b4bed6c2b13f$export$2e2bcd8739ae039","$24bbb315554fbe91$export$2e2bcd8739ae039","requestAnimationFrame","gameLoop","getElementsByClassName","targetConfig","cu","urlParams","URLSearchParams","search","yes","has","$1bfb1b3e5baf01b1$export$2e2bcd8739ae039","sandboxurl","$c79d11f6216552bb$export$2e2bcd8739ae039","$7d90bec1f5d5bdaf$export$2e2bcd8739ae039"],"version":3,"file":"addSandboxes.js.map"}